(()=>{var e={};e.id=702,e.ids=[702],e.modules={47849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},14300:e=>{"use strict";e.exports=require("buffer")},71733:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>l.a,__next_app__:()=>x,originalPathname:()=>m,pages:()=>d,routeModule:()=>u,tree:()=>o});var r=s(50482),a=s(69108),n=s(62563),l=s.n(n),i=s(68300),c={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>i[e]);s.d(t,c);let o=["",{children:["dashboard",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,79865)),"/Users/mario/friction-intelligence/app/dashboard/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,82917)),"/Users/mario/friction-intelligence/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,69361,23)),"next/dist/client/components/not-found-error"]}],d=["/Users/mario/friction-intelligence/app/dashboard/page.tsx"],m="/dashboard/page",x={require:s,loadChunk:()=>Promise.resolve()},u=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/dashboard/page",pathname:"/dashboard",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},80827:(e,t,s)=>{Promise.resolve().then(s.bind(s,36596))},51713:()=>{},30727:(e,t,s)=>{Promise.resolve().then(s.t.bind(s,2583,23)),Promise.resolve().then(s.t.bind(s,26840,23)),Promise.resolve().then(s.t.bind(s,38771,23)),Promise.resolve().then(s.t.bind(s,13225,23)),Promise.resolve().then(s.t.bind(s,9295,23)),Promise.resolve().then(s.t.bind(s,43982,23))},36596:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>M});var r=s(95344),a=s(3729),n=s(57435),l=s(8428),i=s(69224);/**
 * @license lucide-react v0.316.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let c=(0,i.Z)("ArrowUpDown",[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]]),o=(0,i.Z)("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]),d=(0,i.Z)("ArrowDown",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]);var m=s(46064),x=s(77402),u=s(18452);/**
 * @license lucide-react v0.316.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let h=(0,i.Z)("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),g=(0,i.Z)("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]);var p=s(66138);function y({top25:e,singleOperator:t}){let s=[...e,...t],a=s.length,n=s.reduce((e,t)=>e+(t.current_snapshot?.ofi_score||0),0)/(a||1),l=s.filter(e=>e.current_snapshot?.trend_direction==="worsening").length,i=s.filter(e=>e.current_snapshot?.trend_direction==="improving").length,c=s.reduce((e,t)=>e+(t.alert_count||0),0),o=[{name:"Total Accounts",value:a,icon:g,color:"text-blue-600",bg:"bg-blue-50"},{name:"Avg. Friction Score",value:n.toFixed(1),icon:g,color:n>=50?"text-red-600":"text-green-600",bg:n>=50?"bg-red-50":"bg-green-50"},{name:"Trending Up",value:l,icon:m.Z,color:"text-red-600",bg:"bg-red-50",subtext:"friction increasing"},{name:"Trending Down",value:i,icon:x.Z,color:"text-green-600",bg:"bg-green-50",subtext:"friction decreasing"},{name:"Active Alerts",value:c,icon:p.Z,color:c>0?"text-yellow-600":"text-gray-600",bg:c>0?"bg-yellow-50":"bg-gray-50"}];return r.jsx("div",{className:"grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-5",children:o.map(e=>{let t=e.icon;return r.jsx("div",{className:"bg-white overflow-hidden rounded-lg border border-gray-200",children:r.jsx("div",{className:"p-5",children:(0,r.jsxs)("div",{className:"flex items-center",children:[r.jsx("div",{className:`flex-shrink-0 ${e.bg} rounded-md p-3`,children:r.jsx(t,{className:`h-6 w-6 ${e.color}`,"aria-hidden":"true"})}),r.jsx("div",{className:"ml-5 w-0 flex-1",children:(0,r.jsxs)("dl",{children:[r.jsx("dt",{className:"text-sm font-medium text-gray-500 truncate",children:e.name}),(0,r.jsxs)("dd",{className:"flex items-baseline",children:[r.jsx("div",{className:`text-2xl font-semibold ${e.color}`,children:e.value}),e.subtext&&r.jsx("div",{className:"ml-2 text-xs text-gray-500",children:e.subtext})]})]})})]})})},e.name)})})}/**
 * @license lucide-react v0.316.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let f=(0,i.Z)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);var b=s(14513);/**
 * @license lucide-react v0.316.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let v=(0,i.Z)("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]);function j({account:e}){var t,s;let a=(0,l.useRouter)(),n=e.arr?Math.round(e.arr/12):null,i=e.current_snapshot?.ofi_score||0;return(0,r.jsxs)("button",{onClick:()=>a.push(`/account/${e.id}`),className:"w-full text-left p-4 bg-white rounded-lg border border-gray-200 hover:border-blue-500 hover:shadow-md transition-all",children:[(0,r.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,r.jsxs)("div",{className:"flex-1",children:[r.jsx("h3",{className:"font-semibold text-gray-900 mb-1",children:e.name}),(0,r.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[r.jsx("span",{children:n?`$${n.toLocaleString()}/mo`:"No MRR"}),e.vertical&&(0,r.jsxs)(r.Fragment,{children:[r.jsx("span",{children:"•"}),r.jsx("span",{children:e.vertical})]})]})]}),e.current_snapshot&&(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[r.jsx("div",{className:`text-lg font-bold ${i>=70?"text-red-600":i>=40?"text-yellow-600":"text-green-600"}`,children:Math.round(i)}),e.current_snapshot.trend_direction&&r.jsx("div",{className:"worsening"===(t=e.current_snapshot.trend_direction)?"text-red-600":"improving"===t?"text-green-600":"text-gray-400",children:"worsening"===(s=e.current_snapshot.trend_direction)?r.jsx(m.Z,{className:"w-4 h-4"}):"improving"===s?r.jsx(x.Z,{className:"w-4 h-4"}):null})]})]}),e.alert_count>0&&(0,r.jsxs)("div",{className:"flex items-center gap-1 text-sm text-red-600 mt-2",children:[r.jsx(p.Z,{className:"w-4 h-4"}),(0,r.jsxs)("span",{children:[e.alert_count," active alert",1!==e.alert_count?"s":""]})]}),e.recent_friction_cards&&e.recent_friction_cards.length>0&&r.jsx("div",{className:"mt-3 pt-3 border-t border-gray-100",children:(0,r.jsxs)("p",{className:"text-xs text-gray-600 line-clamp-2",children:["Latest: ",e.recent_friction_cards[0].summary]})})]})}function N({favorites:e,onUpdate:t}){let[s,l]=(0,a.useState)(""),[i,c]=(0,a.useState)([]),[o,d]=(0,a.useState)([]),[m,x]=(0,a.useState)(!1),u=(0,n.createClientComponentClient)();async function h(){let{data:e}=await u.from("accounts").select("*").order("arr",{ascending:!1}).limit(200);d(e||[])}(0,a.useEffect)(()=>{h()},[]);let g=(0,a.useMemo)(()=>{if(!s)return e;let t=s.toLowerCase();return e.filter(e=>e.account.name.toLowerCase().includes(t))},[e,s]);async function p(e){console.log("Adding favorite:",e);try{let{data:{user:s}}=await u.auth.getUser();if(!s)return;await u.from("favorites").insert({user_id:s.id,account_id:e}),l(""),x(!1),c([]),t()}catch(e){console.error("Error adding favorite:",e)}}async function y(e){try{await u.from("favorites").delete().eq("id",e),t()}catch(e){console.error("Error removing favorite:",e)}}let N=s.length>=2?i:o.filter(t=>!e.some(e=>e.account_id===t.id)).slice(0,50);return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[r.jsx("h3",{className:"text-lg font-semibold",children:"Favorites"}),(0,r.jsxs)("button",{onClick:()=>x(!m),className:"flex items-center gap-2 px-3 py-2 text-sm bg-purple-600 text-white rounded-lg hover:bg-purple-700",children:[r.jsx(f,{className:"w-4 h-4"}),m?"Close":"Add Account"]})]}),m&&(0,r.jsxs)("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg",children:[(0,r.jsxs)("div",{className:"relative",children:[r.jsx(f,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),r.jsx("input",{type:"text",value:s,onChange:t=>{l(t.target.value),x(!1),function(t){if(t.length<2){c([]);return}let s=new Set(e.map(e=>e.account_id));c(o.filter(e=>!s.has(e.id)&&e.name.toLowerCase().includes(t.toLowerCase())).slice(0,20))}(t.target.value)},placeholder:"Search accounts by name...",className:"w-full pl-10 pr-10 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"}),s&&r.jsx("button",{onClick:()=>{l(""),x(!1),c([])},className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:r.jsx(b.Z,{className:"w-5 h-5"})})]}),N.length>0&&(0,r.jsxs)("div",{className:"mt-4 space-y-2 max-h-96 overflow-y-auto",children:[r.jsx("p",{className:"text-sm text-gray-600 mb-2",children:s.length>=2?"Search results:":"All accounts (top 50):"}),N.map(e=>r.jsx("button",{onClick:()=>p(e.id),className:"w-full text-left p-3 bg-white rounded-lg border border-gray-200 hover:border-purple-500 hover:bg-purple-50 transition-all",children:(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsxs)("div",{children:[r.jsx("p",{className:"font-semibold text-gray-900",children:e.name}),(0,r.jsxs)("p",{className:"text-sm text-gray-600",children:["$",Math.round((e.arr||0)/12).toLocaleString(),"/mo",e.vertical&&` • ${e.vertical}`]})]}),r.jsx(v,{className:"w-5 h-5 text-gray-400"})]})},e.id))]})]}),!m&&e.length>5&&(0,r.jsxs)("div",{className:"relative mb-4",children:[r.jsx(f,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),r.jsx("input",{type:"text",value:s,onChange:e=>l(e.target.value),placeholder:"Filter your favorites...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]})]}),0===g.length?(0,r.jsxs)("div",{className:"text-center py-12 bg-white rounded-lg border border-gray-200",children:[r.jsx(v,{className:"w-12 h-12 text-gray-300 mx-auto mb-4"}),r.jsx("p",{className:"text-gray-600",children:s?"No favorites match your search":'No favorites yet. Click "Add Account" to get started!'})]}):r.jsx("div",{className:"grid grid-cols-1 gap-4",children:g.map(e=>(0,r.jsxs)("div",{className:"relative",children:[r.jsx(j,{account:e.account}),r.jsx("button",{onClick:()=>y(e.id),className:"absolute top-2 right-2 px-3 py-1 bg-white text-red-600 text-sm font-medium rounded-lg border border-gray-200 shadow hover:bg-red-50 transition-colors",title:"Remove from favorites",children:"Remove"})]},e.id))})]})}/**
 * @license lucide-react v0.316.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let w=(0,i.Z)("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);var _=s(96885);function k({allAccounts:e}){let[t,s]=(0,a.useState)([]),[n,l]=(0,a.useState)([]),[i,c]=(0,a.useState)([]),[o,d]=(0,a.useState)(!1),m=(0,a.useMemo)(()=>{let t=new Set;return e.forEach(e=>{e.vertical&&e.vertical.split(", ").forEach(e=>{let s=e.split(" (")[0];t.add(s)})}),Array.from(t).sort()},[e]),x=(0,a.useMemo)(()=>{let t=new Set;return e.forEach(e=>{e.segment&&t.add(e.segment)}),Array.from(t).sort()},[e]),u=(0,a.useMemo)(()=>{let t=new Set;return e.forEach(e=>{e.cs_segment&&t.add(e.cs_segment)}),Array.from(t).sort()},[e]),h=(0,a.useMemo)(()=>e.filter(e=>(!(t.length>0)||!!e.vertical&&!!t.some(t=>e.vertical.includes(t)))&&(!(n.length>0)||!!n.includes(e.segment))&&(!(i.length>0)||!!i.includes(e.cs_segment))&&(!o||"Managed"===e.managed_account)),[e,t,n,i,o]),g=(0,a.useMemo)(()=>{let e=h.filter(e=>e.current_snapshot?.ofi_score),t=e.length>0?Math.round(e.reduce((e,t)=>e+t.current_snapshot.ofi_score,0)/e.length):0,s={};h.forEach(e=>{e.current_snapshot?.top_themes?.forEach(e=>{s[e.theme_key]=(s[e.theme_key]||0)+e.count})});let r=Object.entries(s).sort((e,t)=>t[1]-e[1]).slice(0,5).map(([e,t])=>({key:e,count:t}));return{avgScore:t,accountCount:h.length,topThemes:r}},[h]),p=(e,t,s)=>{s(t.includes(e)?t.filter(t=>t!==e):[...t,e])};return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[r.jsx(w,{className:"w-5 h-5 text-gray-600"}),r.jsx("h3",{className:"text-lg font-semibold",children:"Filter Accounts"})]}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[r.jsx("p",{className:"text-sm font-medium text-gray-700 mb-2",children:"Products"}),r.jsx("div",{className:"flex flex-wrap gap-2",children:m.map(e=>r.jsx("button",{onClick:()=>p(e,t,s),className:`px-3 py-1 text-sm rounded-full border transition-colors ${t.includes(e)?"bg-purple-100 border-purple-300 text-purple-700":"bg-gray-50 border-gray-200 text-gray-600 hover:bg-gray-100"}`,children:e},e))})]}),x.length>0&&(0,r.jsxs)("div",{children:[r.jsx("p",{className:"text-sm font-medium text-gray-700 mb-2",children:"Segment"}),r.jsx("div",{className:"flex flex-wrap gap-2",children:x.map(e=>r.jsx("button",{onClick:()=>p(e,n,l),className:`px-3 py-1 text-sm rounded-full border transition-colors ${n.includes(e)?"bg-blue-100 border-blue-300 text-blue-700":"bg-gray-50 border-gray-200 text-gray-600 hover:bg-gray-100"}`,children:e},e))})]}),u.length>0&&(0,r.jsxs)("div",{children:[r.jsx("p",{className:"text-sm font-medium text-gray-700 mb-2",children:"CS Segment"}),r.jsx("div",{className:"flex flex-wrap gap-2",children:u.map(e=>r.jsx("button",{onClick:()=>p(e,i,c),className:`px-3 py-1 text-sm rounded-full border transition-colors ${i.includes(e)?"bg-green-100 border-green-300 text-green-700":"bg-gray-50 border-gray-200 text-gray-600 hover:bg-gray-100"}`,children:e},e))})]}),r.jsx("div",{children:(0,r.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[r.jsx("input",{type:"checkbox",checked:o,onChange:e=>d(e.target.checked),className:"w-4 h-4 text-purple-600"}),r.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Managed Accounts Only"})]})}),(t.length>0||n.length>0||i.length>0||o)&&r.jsx("button",{onClick:()=>{s([]),l([]),c([]),d(!1)},className:"text-sm text-gray-600 hover:text-gray-900 underline",children:"Clear all filters"})]})]}),h.length>0&&(0,r.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[r.jsx("h3",{className:"text-lg font-semibold",children:"Report Summary"}),(0,r.jsxs)("button",{className:"flex items-center gap-2 px-3 py-2 text-sm bg-purple-600 text-white rounded-lg hover:bg-purple-700",children:[r.jsx(_.Z,{className:"w-4 h-4"}),"Export Report"]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[(0,r.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[r.jsx("p",{className:"text-sm text-gray-600",children:"Accounts"}),r.jsx("p",{className:"text-3xl font-bold text-gray-900",children:g.accountCount})]}),(0,r.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[r.jsx("p",{className:"text-sm text-gray-600",children:"Avg OFI Score"}),r.jsx("p",{className:"text-3xl font-bold text-gray-900",children:g.avgScore})]}),(0,r.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[r.jsx("p",{className:"text-sm text-gray-600",children:"Top Themes"}),r.jsx("p",{className:"text-3xl font-bold text-gray-900",children:g.topThemes.length})]})]}),g.topThemes.length>0&&(0,r.jsxs)("div",{children:[r.jsx("p",{className:"text-sm font-medium text-gray-700 mb-3",children:"Most Common Friction Themes"}),r.jsx("div",{className:"space-y-2",children:g.topThemes.map(e=>(0,r.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded",children:[r.jsx("span",{className:"text-sm font-medium text-gray-900",children:e.key.split("_").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")}),(0,r.jsxs)("span",{className:"text-sm font-bold text-purple-600",children:[e.count," issues"]})]},e.key))})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("h3",{className:"text-lg font-semibold mb-4",children:[h.length," Account",1!==h.length?"s":""]}),0===h.length?r.jsx("div",{className:"bg-gray-50 rounded-lg p-8 text-center",children:r.jsx("p",{className:"text-gray-600",children:"No accounts match your filters"})}):r.jsx("div",{className:"grid grid-cols-1 gap-4",children:h.map(e=>r.jsx(j,{account:e},e.id))})]})]})}var C=s(25390);/**
 * @license lucide-react v0.316.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let S=(0,i.Z)("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);function A(e){if(!e)return"Other";let t=e.toUpperCase();return t.includes("EDGE")?"EDGE":t.includes("SITELINK")?"SiteLink":"Other"}function Z({accounts:e}){let[t,s]=(0,a.useState)("All"),[n,i]=(0,a.useState)(null),c=(0,l.useRouter)(),o=function(e,t){let s="All"===t?e:e.filter(e=>A(e.vertical)===t),r=new Map;for(let e of s){let t=e.current_snapshot?.top_themes;if(t&&0!==t.length)for(let s of t){let t=r.get(s.theme_key);t||(t={theme_key:s.theme_key,total_count:0,total_severity:0,accounts:new Map,severity_counts:{low:0,medium:0,high:0}},r.set(s.theme_key,t)),t.total_count+=s.count,t.total_severity+=s.avg_severity*s.count,s.avg_severity<3?t.severity_counts.low+=s.count:s.avg_severity<4?t.severity_counts.medium+=s.count:t.severity_counts.high+=s.count;let a=t.accounts.get(e.id);a||(a={id:e.id,name:e.name,count:0,total_severity:0},t.accounts.set(e.id,a)),a.count+=s.count,a.total_severity+=s.avg_severity*s.count}}let a=[];for(let e of Array.from(r.values())){let t=Array.from(e.accounts.values()).map(e=>({id:e.id,name:e.name,count:e.count,avg_severity:e.total_severity/e.count}));t.sort((e,t)=>{let s=e.count*e.avg_severity;return t.count*t.avg_severity-s}),a.push({theme_key:e.theme_key,theme_label:e.theme_key.split("_").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" "),total_count:e.total_count,avg_severity:e.total_severity/e.total_count,affected_accounts:t,severity_distribution:e.severity_counts})}return a.sort((e,t)=>{let s=e.total_count*e.avg_severity;return t.total_count*t.avg_severity-s}),a}(e,t),d=o.reduce((e,t)=>e+t.total_count,0),m=("All"===t?e:e.filter(e=>A(e.vertical)===t)).filter(e=>e.current_snapshot?.top_themes&&e.current_snapshot.top_themes.length>0).length;function x(e){return e>=4?"bg-red-100 text-red-800":e>=3?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"}return r.jsx("div",{className:"space-y-6",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,r.jsxs)("div",{children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Key Friction Themes"}),(0,r.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:[d," total issues across ",m," accounts"]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[r.jsx("label",{htmlFor:"product-filter",className:"text-sm font-medium text-gray-700",children:"Filter by Product:"}),(0,r.jsxs)("select",{id:"product-filter",value:t,onChange:e=>s(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm",children:[r.jsx("option",{value:"All",children:"All Products"}),r.jsx("option",{value:"EDGE",children:"EDGE"}),r.jsx("option",{value:"SiteLink",children:"SiteLink"}),r.jsx("option",{value:"Other",children:"Other"})]})]})]}),0===o.length&&r.jsx("div",{className:"text-center py-12",children:(0,r.jsxs)("p",{className:"text-gray-500",children:["No friction data found for ","All"===t?"any accounts":`${t} customers`,"."]})}),o.length>0&&r.jsx("div",{className:"space-y-3",children:o.map((e,t)=>(0,r.jsxs)("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[(0,r.jsxs)("button",{onClick:()=>{var t;i(n===(t=e.theme_key)?null:t)},className:"w-full px-4 py-3 flex items-center justify-between hover:bg-gray-50 transition-colors",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[n===e.theme_key?r.jsx(C.Z,{className:"w-5 h-5 text-gray-400"}):r.jsx(S,{className:"w-5 h-5 text-gray-400"}),(0,r.jsxs)("span",{className:"text-sm font-medium text-gray-500",children:[t+1,"."]}),r.jsx("span",{className:"text-base font-semibold text-gray-900",children:e.theme_label})]}),(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsxs)("span",{className:"text-sm text-gray-600",children:[e.total_count," ",1===e.total_count?"issue":"issues"]}),(0,r.jsxs)("span",{className:`px-2.5 py-0.5 rounded-full text-xs font-medium ${x(e.avg_severity)}`,children:["Avg Severity: ",e.avg_severity.toFixed(1)]}),(0,r.jsxs)("span",{className:"text-sm text-gray-600",children:[e.affected_accounts.length," ",1===e.affected_accounts.length?"account":"accounts"]})]})]}),n===e.theme_key&&(0,r.jsxs)("div",{className:"px-4 py-4 bg-gray-50 border-t border-gray-200",children:[(0,r.jsxs)("div",{className:"mb-4",children:[r.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Severity Distribution"}),(0,r.jsxs)("div",{className:"flex items-center gap-6",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"text-xs font-medium text-red-800",children:"High (4-5):"}),r.jsx("span",{className:"text-sm text-gray-900",children:e.severity_distribution.high})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"text-xs font-medium text-yellow-800",children:"Medium (3):"}),r.jsx("span",{className:"text-sm text-gray-900",children:e.severity_distribution.medium})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"text-xs font-medium text-green-800",children:"Low (1-2):"}),r.jsx("span",{className:"text-sm text-gray-900",children:e.severity_distribution.low})]})]})]}),(0,r.jsxs)("div",{children:[r.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Affected Accounts"}),r.jsx("div",{className:"space-y-2",children:e.affected_accounts.map(e=>r.jsx("button",{onClick:()=>c.push(`/account/${e.id}`),className:"w-full text-left px-3 py-2 bg-white rounded border border-gray-200 hover:border-blue-500 hover:bg-blue-50 transition-colors",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[r.jsx("span",{className:"text-sm font-medium text-gray-900",children:e.name}),(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsxs)("span",{className:"text-xs text-gray-600",children:[e.count," ",1===e.count?"issue":"issues"]}),r.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-medium ${x(e.avg_severity)}`,children:e.avg_severity.toFixed(1)})]})]})},e.id))})]})]})]},e.theme_key))})]})})}function M(){let[e,t]=(0,a.useState)([]),[s,i]=(0,a.useState)([]),[g,p]=(0,a.useState)(!0),[f,b]=(0,a.useState)("portfolios"),[v,j]=(0,a.useState)("arr"),[w,_]=(0,a.useState)("desc"),C=(0,n.createClientComponentClient)(),S=(0,l.useRouter)();async function A(){try{let{data:e}=await C.from("portfolios").select("*").order("created_at",{ascending:!1}),s=e?.find(e=>"Top 25 by MRR"===e.name);if(s){let e=s.account_ids||[],{data:r}=await C.from("accounts").select(`
            *,
            current_snapshot:account_snapshots!account_snapshots_account_id_fkey(
              ofi_score,
              trend_direction,
              top_themes,
              created_at
            )
          `).in("id",e).order("arr",{ascending:!1});if(r){let e=r.map(e=>({...e,current_snapshot:Array.isArray(e.current_snapshot)?e.current_snapshot[0]:e.current_snapshot})).filter(e=>"Test"!==e.name);t(e)}}await M()}catch(e){console.error("Error loading dashboard:",e)}finally{p(!1)}}async function M(){let{data:{user:e}}=await C.auth.getUser();if(!e)return;let{data:t}=await C.from("favorites").select(`
        *,
        account:accounts(*)
      `).eq("user_id",e.id).order("created_at",{ascending:!1});i(t||[])}async function E(){try{let e=await fetch("/api/salesforce/sync",{method:"POST"});if(!e.ok)throw Error("Sync failed");let t=await e.json();alert(t.message||`Synced ${t.synced} accounts successfully! Friction analysis is running in the background. Refresh in a few minutes to see scores.`),await A()}catch(e){console.error("Sync error:",e),alert("Failed to sync with Salesforce. Please try again.")}}function $(e){v===e?_("asc"===w?"desc":"asc"):(j(e),_("desc"))}function P(e){return v!==e?r.jsx(c,{className:"w-4 h-4 ml-1 inline"}):"asc"===w?r.jsx(o,{className:"w-4 h-4 ml-1 inline"}):r.jsx(d,{className:"w-4 h-4 ml-1 inline"})}(0,a.useEffect)(()=>{A()},[]);let F=e=>"worsening"===e?r.jsx(m.Z,{className:"w-4 h-4 text-red-500"}):"improving"===e?r.jsx(x.Z,{className:"w-4 h-4 text-green-500"}):r.jsx(u.Z,{className:"w-4 h-4 text-gray-400"});return g?r.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[r.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),r.jsx("p",{className:"mt-4 text-gray-600",children:"Loading your portfolio..."})]})}):(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[r.jsx("header",{className:"bg-white border-b border-gray-200",children:r.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsxs)("div",{children:[r.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Friction Intelligence"}),r.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Early warning system for customer friction"})]}),(0,r.jsxs)("button",{onClick:()=>S.push("/settings"),className:"flex items-center gap-2 px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50",children:[r.jsx(h,{className:"w-4 h-4"}),"Settings"]})]})})}),(0,r.jsxs)("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,r.jsxs)("div",{className:"mb-6 flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex gap-2",children:[r.jsx("button",{onClick:()=>b("portfolios"),className:`px-4 py-2 rounded-lg font-medium ${"portfolios"===f?"bg-blue-600 text-white":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"}`,children:"Portfolios"}),(0,r.jsxs)("button",{onClick:()=>b("favorites"),className:`px-4 py-2 rounded-lg font-medium ${"favorites"===f?"bg-blue-600 text-white":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"}`,children:["Favorites (",s.length,")"]}),r.jsx("button",{onClick:()=>b("reports"),className:`px-4 py-2 rounded-lg font-medium ${"reports"===f?"bg-blue-600 text-white":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"}`,children:"Custom Reports"}),r.jsx("button",{onClick:()=>b("themes"),className:`px-4 py-2 rounded-lg font-medium ${"themes"===f?"bg-blue-600 text-white":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"}`,children:"Key Friction Themes"})]}),r.jsx("button",{onClick:E,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 font-medium",children:"Sync Now"})]}),"portfolios"===f&&(0,r.jsxs)(r.Fragment,{children:[0===e.length&&r.jsx("div",{className:"text-center py-12 bg-white rounded-lg border border-gray-200",children:r.jsx("p",{className:"text-gray-500",children:"No accounts found. Click Sync Now to load accounts from Salesforce."})}),e.length>0&&r.jsx(y,{top25:e,singleOperator:[]}),(0,r.jsxs)("section",{className:"mt-12",children:[r.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Top 25 by ARR"}),r.jsx("div",{className:"bg-white rounded-lg border border-gray-200 overflow-x-auto",children:(0,r.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[r.jsx("thead",{className:"bg-gray-50",children:(0,r.jsxs)("tr",{children:[(0,r.jsxs)("th",{onClick:()=>$("name"),className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100",children:["Account ",P("name")]}),(0,r.jsxs)("th",{onClick:()=>$("arr"),className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100",children:["ARR ",P("arr")]}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Products"}),(0,r.jsxs)("th",{onClick:()=>$("ofi"),className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100",children:["OFI Score ",P("ofi")]}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Trend"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Last Analyzed"})]})}),r.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:e.sort((e,t)=>{let s,r;switch(v){case"name":s=e.name.toLowerCase(),r=t.name.toLowerCase();break;case"arr":s=e.arr||0,r=t.arr||0;break;case"ofi":s=e.current_snapshot?.ofi_score||0,r=t.current_snapshot?.ofi_score||0;break;default:return 0}return s<r?"asc"===w?-1:1:s>r?"asc"===w?1:-1:0}).map(e=>(0,r.jsxs)("tr",{onClick:()=>S.push(`/account/${e.id}`),className:"hover:bg-gray-50 cursor-pointer",children:[(0,r.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[r.jsx("div",{className:"text-sm font-medium text-gray-900",children:e.name}),r.jsx("div",{className:"text-sm text-gray-500",children:e.segment})]}),(0,r.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:["$",(e.arr||0).toLocaleString()]}),r.jsx("td",{className:"px-6 py-4 text-sm text-gray-500",children:e.vertical||"N/A"}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.current_snapshot?.ofi_score?(0,r.jsxs)("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${e.current_snapshot.ofi_score>=70?"bg-red-100 text-red-800":e.current_snapshot.ofi_score>=40?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"}`,children:[e.current_snapshot.ofi_score," - ",e.current_snapshot.ofi_score>=70?"High Friction":e.current_snapshot.ofi_score>=40?"Medium Friction":"Low Friction"]}):r.jsx("span",{className:"text-sm text-gray-400",children:"Not analyzed"})}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:F(e.current_snapshot?.trend_direction)}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.current_snapshot?.created_at?new Date(e.current_snapshot.created_at).toLocaleDateString():"Never"})]},e.id))})]})})]})]}),"favorites"===f&&r.jsx(N,{favorites:s,onUpdate:M}),"reports"===f&&r.jsx(k,{allAccounts:e}),"themes"===f&&r.jsx(Z,{accounts:e})]})]})}},69224:(e,t,s)=>{"use strict";s.d(t,{Z:()=>l});var r=s(3729),a={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.316.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),l=(e,t)=>{let s=(0,r.forwardRef)(({color:s="currentColor",size:l=24,strokeWidth:i=2,absoluteStrokeWidth:c,className:o="",children:d,...m},x)=>(0,r.createElement)("svg",{ref:x,...a,width:l,height:l,stroke:s,strokeWidth:c?24*Number(i)/Number(l):i,className:["lucide",`lucide-${n(e)}`,o].join(" "),...m},[...t.map(([e,t])=>(0,r.createElement)(e,t)),...Array.isArray(d)?d:[d]]));return s.displayName=`${e}`,s}},66138:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});/**
 * @license lucide-react v0.316.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,s(69224).Z)("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},25390:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});/**
 * @license lucide-react v0.316.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,s(69224).Z)("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]])},96885:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});/**
 * @license lucide-react v0.316.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,s(69224).Z)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]])},18452:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});/**
 * @license lucide-react v0.316.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,s(69224).Z)("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]])},77402:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});/**
 * @license lucide-react v0.316.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,s(69224).Z)("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]])},46064:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});/**
 * @license lucide-react v0.316.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,s(69224).Z)("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]])},14513:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});/**
 * @license lucide-react v0.316.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,s(69224).Z)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},79865:(e,t,s)=>{"use strict";s.r(t),s.d(t,{$$typeof:()=>n,__esModule:()=>a,default:()=>l});let r=(0,s(86843).createProxy)(String.raw`/Users/mario/friction-intelligence/app/dashboard/page.tsx`),{__esModule:a,$$typeof:n}=r,l=r.default},82917:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>n,metadata:()=>a});var r=s(25036);s(67272);let a={title:"Friction Intelligence | Storable",description:"Early warning system for customer friction"};function n({children:e}){return r.jsx("html",{lang:"en",children:r.jsx("body",{children:e})})}},67272:()=>{}};var t=require("../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[456,356,407],()=>s(71733));module.exports=r})();