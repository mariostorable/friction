"use strict";(()=>{var e={};e.id=112,e.ids=[112],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{e.exports=require("buffer")},64573:(e,t,i)=>{i.r(t),i.d(t,{headerHooks:()=>_,originalPathname:()=>v,patchFetch:()=>y,requestAsyncStorage:()=>h,routeModule:()=>l,serverHooks:()=>m,staticGenerationAsyncStorage:()=>g,staticGenerationBailout:()=>p});var r={};i.r(r),i.d(r,{GET:()=>d});var s=i(95419),a=i(69108),o=i(99678),n=i(78070),c=i(57699),u=i(7439);async function d(e,{params:t}){try{let e=(0,c.createRouteHandlerClient)({cookies:u.cookies}),{data:{user:i}}=await e.auth.getUser();if(!i)return n.Z.json({error:"Not authenticated"},{status:401});let r=t.id,{data:s}=await e.from("friction_cards").select("theme_key, severity").eq("account_id",r);if(!s||0===s.length)return n.Z.json({recentlyResolved:[],onRadar:[],shouldPrioritize:[],comingSoon:[],themeStats:{}});let a={};s.forEach(e=>{let t=e.theme_key;a[t]||(a[t]={count:0,avgSeverity:0,weight:0}),a[t].count++,a[t].avgSeverity+=e.severity||3}),Object.keys(a).forEach(e=>{let t=a[e];t.avgSeverity=t.avgSeverity/t.count,t.weight=t.count*t.avgSeverity});let o=Object.keys(a),{data:d}=await e.from("theme_jira_links").select(`
        theme_key,
        match_confidence,
        jira_issues!inner(
          id,
          jira_key,
          summary,
          description,
          status,
          priority,
          assignee_name,
          resolution_date,
          updated_date,
          issue_url,
          labels
        )
      `).in("theme_key",o).eq("jira_issues.user_id",i.id);if(!d||0===d.length){let e=o.map(e=>({theme_key:e,case_count:a[e].count,avg_severity:a[e].avgSeverity,weight:a[e].weight,hasTicket:!1})).sort((e,t)=>t.weight-e.weight).slice(0,5);return n.Z.json({recentlyResolved:[],onRadar:[],shouldPrioritize:e,comingSoon:[],themeStats:a})}let l=new Date,h=new Date(l.getTime()-6048e5),g=new Date(l.getTime()-2592e6),m=new Date(l.getTime()-7776e6),_=[],p=[],v=[],y=new Set;d.forEach(e=>{let t=e.jira_issues,i=e.theme_key;y.add(i);let r={...t,theme_key:i,theme_weight:a[i]?.weight||0,case_count:a[i]?.count||0,match_confidence:e.match_confidence};if(t.resolution_date){let e=new Date(t.resolution_date);e>=h?(r.resolved_days_ago=Math.floor((l.getTime()-e.getTime())/864e5),r.time_period="7d",_.push(r)):e>=g?(r.resolved_days_ago=Math.floor((l.getTime()-e.getTime())/864e5),r.time_period="30d",_.push(r)):e>=m&&(r.resolved_days_ago=Math.floor((l.getTime()-e.getTime())/864e5),r.time_period="90d",_.push(r))}else{let e=t.status?.toLowerCase()||"";e.includes("progress")||e.includes("development")||e.includes("review")?v.push(r):p.push(r)}});let w=o.filter(e=>!y.has(e)).map(e=>({theme_key:e,case_count:a[e].count,avg_severity:a[e].avgSeverity,weight:a[e].weight,hasTicket:!1})).sort((e,t)=>t.weight-e.weight).slice(0,5),f=[...w];return _.sort((e,t)=>{if(e.time_period!==t.time_period){let i={"7d":0,"30d":1,"90d":2};return i[e.time_period]-i[t.time_period]}return t.theme_weight-e.theme_weight}),p.sort((e,t)=>t.theme_weight-e.theme_weight),v.sort((e,t)=>t.theme_weight-e.theme_weight),n.Z.json({recentlyResolved:_.slice(0,10),onRadar:p.slice(0,10),shouldPrioritize:f,comingSoon:v.slice(0,10),themeStats:a,summary:{resolved_7d:_.filter(e=>"7d"===e.time_period).length,resolved_30d:_.filter(e=>"30d"===e.time_period).length,resolved_90d:_.length,open_count:p.length+v.length,in_progress:v.length,needs_ticket:w.length}})}catch(e){return console.error("Error fetching Jira status:",e),n.Z.json({error:"Failed to fetch Jira status",details:e instanceof Error?e.message:"Unknown"},{status:500})}}let l=new s.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/accounts/[id]/jira-status/route",pathname:"/api/accounts/[id]/jira-status",filename:"route",bundlePath:"app/api/accounts/[id]/jira-status/route"},resolvedPagePath:"/Users/mario/friction-intelligence/app/api/accounts/[id]/jira-status/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:h,staticGenerationAsyncStorage:g,serverHooks:m,headerHooks:_,staticGenerationBailout:p}=l,v="/api/accounts/[id]/jira-status/route";function y(){return(0,o.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:g})}}};var t=require("../../../../../webpack-runtime.js");t.C(e);var i=e=>t(t.s=e),r=t.X(0,[456,552,421],()=>i(64573));module.exports=r})();