"use strict";(()=>{var e={};e.id=749,e.ids=[749],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},86763:(e,r,s)=>{s.r(r),s.d(r,{headerHooks:()=>f,originalPathname:()=>y,patchFetch:()=>j,requestAsyncStorage:()=>p,routeModule:()=>l,serverHooks:()=>g,staticGenerationAsyncStorage:()=>h,staticGenerationBailout:()=>_});var o={};s.r(o),s.d(o,{GET:()=>d,maxDuration:()=>u});var t=s(95419),n=s(69108),i=s(99678),a=s(78070),c=s(23950);let u=60;async function d(e){try{if(e.headers.get("authorization")!==`Bearer ${process.env.CRON_SECRET}`)return a.Z.json({error:"Unauthorized"},{status:401});let r=(0,c.eI)("https://skoknvludvonitgekwno.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{autoRefreshToken:!1,persistSession:!1}}),{data:s,error:o}=await r.from("integrations").select("id, user_id, instance_url, metadata").eq("integration_type","jira").eq("status","active");if(o)return console.error("Failed to fetch Jira integrations:",o),a.Z.json({error:"Failed to fetch integrations"},{status:500});if(!s||0===s.length)return console.log("No active Jira integrations found"),a.Z.json({message:"No Jira integrations to sync"});console.log(`Found ${s.length} active Jira integration(s) to sync`);let t=[];for(let e of s)try{console.log(`Syncing Jira for user ${e.user_id}`);let r=process.env.VERCEL_URL?`https://${process.env.VERCEL_URL}`:"http://localhost:3000",s=await fetch(`${r}/api/jira/sync`,{method:"POST",headers:{"Content-Type":"application/json","x-user-id":e.user_id}}),o=await s.json();s.ok?(console.log(`Successfully synced ${o.synced} issues for user ${e.user_id}`),t.push({user_id:e.user_id,success:!0,synced:o.synced,links_created:o.links_created})):(console.error(`Failed to sync for user ${e.user_id}:`,o.error),t.push({user_id:e.user_id,success:!1,error:o.error}))}catch(r){console.error(`Error syncing for user ${e.user_id}:`,r),t.push({user_id:e.user_id,success:!1,error:r instanceof Error?r.message:"Unknown error"})}return a.Z.json({success:!0,integrations_processed:s.length,results:t})}catch(e){return console.error("Cron job error:",e),a.Z.json({error:"Cron job failed",details:e instanceof Error?e.message:"Unknown"},{status:500})}}let l=new t.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/cron/sync-jira/route",pathname:"/api/cron/sync-jira",filename:"route",bundlePath:"app/api/cron/sync-jira/route"},resolvedPagePath:"/Users/mario/friction-intelligence/app/api/cron/sync-jira/route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:p,staticGenerationAsyncStorage:h,serverHooks:g,headerHooks:f,staticGenerationBailout:_}=l,y="/api/cron/sync-jira/route";function j(){return(0,i.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:h})}}};var r=require("../../../../webpack-runtime.js");r.C(e);var s=e=>r(r.s=e),o=r.X(0,[456,552],()=>s(86763));module.exports=o})();