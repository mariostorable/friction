"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/cron/analyze-portfolio/route";
exports.ids = ["app/api/cron/analyze-portfolio/route"];
exports.modules = {

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fcron%2Fanalyze-portfolio%2Froute&page=%2Fapi%2Fcron%2Fanalyze-portfolio%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fcron%2Fanalyze-portfolio%2Froute.ts&appDir=%2FUsers%2Fmario%2Ffriction-intelligence%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fmario%2Ffriction-intelligence&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fcron%2Fanalyze-portfolio%2Froute&page=%2Fapi%2Fcron%2Fanalyze-portfolio%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fcron%2Fanalyze-portfolio%2Froute.ts&appDir=%2FUsers%2Fmario%2Ffriction-intelligence%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fmario%2Ffriction-intelligence&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   headerHooks: () => (/* binding */ headerHooks),\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage),\n/* harmony export */   staticGenerationBailout: () => (/* binding */ staticGenerationBailout)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _Users_mario_friction_intelligence_app_api_cron_analyze_portfolio_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./app/api/cron/analyze-portfolio/route.ts */ \"(rsc)/./app/api/cron/analyze-portfolio/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/cron/analyze-portfolio/route\",\n        pathname: \"/api/cron/analyze-portfolio\",\n        filename: \"route\",\n        bundlePath: \"app/api/cron/analyze-portfolio/route\"\n    },\n    resolvedPagePath: \"/Users/mario/friction-intelligence/app/api/cron/analyze-portfolio/route.ts\",\n    nextConfigOutput,\n    userland: _Users_mario_friction_intelligence_app_api_cron_analyze_portfolio_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks, headerHooks, staticGenerationBailout } = routeModule;\nconst originalPathname = \"/api/cron/analyze-portfolio/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZjcm9uJTJGYW5hbHl6ZS1wb3J0Zm9saW8lMkZyb3V0ZSZwYWdlPSUyRmFwaSUyRmNyb24lMkZhbmFseXplLXBvcnRmb2xpbyUyRnJvdXRlJmFwcFBhdGhzPSZwYWdlUGF0aD1wcml2YXRlLW5leHQtYXBwLWRpciUyRmFwaSUyRmNyb24lMkZhbmFseXplLXBvcnRmb2xpbyUyRnJvdXRlLnRzJmFwcERpcj0lMkZVc2VycyUyRm1hcmlvJTJGZnJpY3Rpb24taW50ZWxsaWdlbmNlJTJGYXBwJnBhZ2VFeHRlbnNpb25zPXRzeCZwYWdlRXh0ZW5zaW9ucz10cyZwYWdlRXh0ZW5zaW9ucz1qc3gmcGFnZUV4dGVuc2lvbnM9anMmcm9vdERpcj0lMkZVc2VycyUyRm1hcmlvJTJGZnJpY3Rpb24taW50ZWxsaWdlbmNlJmlzRGV2PXRydWUmdHNjb25maWdQYXRoPXRzY29uZmlnLmpzb24mYmFzZVBhdGg9JmFzc2V0UHJlZml4PSZuZXh0Q29uZmlnT3V0cHV0PSZwcmVmZXJyZWRSZWdpb249Jm1pZGRsZXdhcmVDb25maWc9ZTMwJTNEISIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7OztBQUFzRztBQUN2QztBQUNjO0FBQzBCO0FBQ3ZHO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QixnSEFBbUI7QUFDM0M7QUFDQSxjQUFjLHlFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxZQUFZO0FBQ1osQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBLFFBQVEsdUdBQXVHO0FBQy9HO0FBQ0E7QUFDQSxXQUFXLDRFQUFXO0FBQ3RCO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDNko7O0FBRTdKIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZnJpY3Rpb24taW50ZWxsaWdlbmNlLz9kZjRjIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFwcFJvdXRlUm91dGVNb2R1bGUgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUtbW9kdWxlcy9hcHAtcm91dGUvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgcGF0Y2hGZXRjaCBhcyBfcGF0Y2hGZXRjaCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2xpYi9wYXRjaC1mZXRjaFwiO1xuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIi9Vc2Vycy9tYXJpby9mcmljdGlvbi1pbnRlbGxpZ2VuY2UvYXBwL2FwaS9jcm9uL2FuYWx5emUtcG9ydGZvbGlvL3JvdXRlLnRzXCI7XG4vLyBXZSBpbmplY3QgdGhlIG5leHRDb25maWdPdXRwdXQgaGVyZSBzbyB0aGF0IHdlIGNhbiB1c2UgdGhlbSBpbiB0aGUgcm91dGVcbi8vIG1vZHVsZS5cbmNvbnN0IG5leHRDb25maWdPdXRwdXQgPSBcIlwiXG5jb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBBcHBSb3V0ZVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5BUFBfUk9VVEUsXG4gICAgICAgIHBhZ2U6IFwiL2FwaS9jcm9uL2FuYWx5emUtcG9ydGZvbGlvL3JvdXRlXCIsXG4gICAgICAgIHBhdGhuYW1lOiBcIi9hcGkvY3Jvbi9hbmFseXplLXBvcnRmb2xpb1wiLFxuICAgICAgICBmaWxlbmFtZTogXCJyb3V0ZVwiLFxuICAgICAgICBidW5kbGVQYXRoOiBcImFwcC9hcGkvY3Jvbi9hbmFseXplLXBvcnRmb2xpby9yb3V0ZVwiXG4gICAgfSxcbiAgICByZXNvbHZlZFBhZ2VQYXRoOiBcIi9Vc2Vycy9tYXJpby9mcmljdGlvbi1pbnRlbGxpZ2VuY2UvYXBwL2FwaS9jcm9uL2FuYWx5emUtcG9ydGZvbGlvL3JvdXRlLnRzXCIsXG4gICAgbmV4dENvbmZpZ091dHB1dCxcbiAgICB1c2VybGFuZFxufSk7XG4vLyBQdWxsIG91dCB0aGUgZXhwb3J0cyB0aGF0IHdlIG5lZWQgdG8gZXhwb3NlIGZyb20gdGhlIG1vZHVsZS4gVGhpcyBzaG91bGRcbi8vIGJlIGVsaW1pbmF0ZWQgd2hlbiB3ZSd2ZSBtb3ZlZCB0aGUgb3RoZXIgcm91dGVzIHRvIHRoZSBuZXcgZm9ybWF0LiBUaGVzZVxuLy8gYXJlIHVzZWQgdG8gaG9vayBpbnRvIHRoZSByb3V0ZS5cbmNvbnN0IHsgcmVxdWVzdEFzeW5jU3RvcmFnZSwgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MsIGhlYWRlckhvb2tzLCBzdGF0aWNHZW5lcmF0aW9uQmFpbG91dCB9ID0gcm91dGVNb2R1bGU7XG5jb25zdCBvcmlnaW5hbFBhdGhuYW1lID0gXCIvYXBpL2Nyb24vYW5hbHl6ZS1wb3J0Zm9saW8vcm91dGVcIjtcbmZ1bmN0aW9uIHBhdGNoRmV0Y2goKSB7XG4gICAgcmV0dXJuIF9wYXRjaEZldGNoKHtcbiAgICAgICAgc2VydmVySG9va3MsXG4gICAgICAgIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2VcbiAgICB9KTtcbn1cbmV4cG9ydCB7IHJvdXRlTW9kdWxlLCByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcywgaGVhZGVySG9va3MsIHN0YXRpY0dlbmVyYXRpb25CYWlsb3V0LCBvcmlnaW5hbFBhdGhuYW1lLCBwYXRjaEZldGNoLCAgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXBwLXJvdXRlLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fcron%2Fanalyze-portfolio%2Froute&page=%2Fapi%2Fcron%2Fanalyze-portfolio%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fcron%2Fanalyze-portfolio%2Froute.ts&appDir=%2FUsers%2Fmario%2Ffriction-intelligence%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fmario%2Ffriction-intelligence&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./app/api/cron/analyze-portfolio/route.ts":
/*!*************************************************!*\
  !*** ./app/api/cron/analyze-portfolio/route.ts ***!
  \*************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GET: () => (/* binding */ GET),\n/* harmony export */   dynamic: () => (/* binding */ dynamic),\n/* harmony export */   maxDuration: () => (/* binding */ maxDuration)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/web/exports/next-response */ \"(rsc)/./node_modules/next/dist/server/web/exports/next-response.js\");\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @supabase/supabase-js */ \"(rsc)/./node_modules/@supabase/supabase-js/dist/index.mjs\");\n\n\nconst dynamic = \"force-dynamic\";\nconst maxDuration = 300;\nasync function GET(request) {\n    console.log(\"=== Analyze Portfolio Endpoint Called ===\");\n    // TEMPORARILY DISABLED: Verify cron secret\n    const authHeader = request.headers.get(\"authorization\");\n    console.log(\"Auth header present:\", !!authHeader);\n    console.log(\"CRON_SECRET configured:\", !!process.env.CRON_SECRET);\n    // if (authHeader !== `Bearer ${process.env.CRON_SECRET}`) {\n    //   console.error('Authorization failed - auth mismatch');\n    //   return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    // }\n    console.log(\"Auth check disabled for testing, starting analysis...\");\n    try {\n        const supabase = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_1__.createClient)(\"https://skoknvludvonitgekwno.supabase.co\", process.env.SUPABASE_SERVICE_ROLE_KEY);\n        // Get all users with portfolios\n        const { data: portfolios } = await supabase.from(\"portfolios\").select(\"user_id, account_ids, portfolio_type\").eq(\"portfolio_type\", \"top_25\");\n        if (!portfolios || portfolios.length === 0) {\n            return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                message: \"No portfolios found\"\n            });\n        }\n        const results = [];\n        let accountsAnalyzed = 0;\n        const MAX_ANALYSES_PER_RUN = 1; // Limit to 1 account per run when analyzing 100 cases each\n        for (const portfolio of portfolios){\n            for (const accountId of portfolio.account_ids){\n                try {\n                    // Get account details\n                    const { data: account } = await supabase.from(\"accounts\").select(\"salesforce_id, name\").eq(\"id\", accountId).single();\n                    if (!account) continue;\n                    // Check if account already has a snapshot from today\n                    const today = new Date().toISOString().split(\"T\")[0];\n                    const { data: existingSnapshot } = await supabase.from(\"account_snapshots\").select(\"id, ofi_score\").eq(\"account_id\", accountId).eq(\"snapshot_date\", today).maybeSingle();\n                    if (existingSnapshot) {\n                        console.log(`Skipping ${account.name} - already analyzed today (OFI: ${existingSnapshot.ofi_score})`);\n                        results.push({\n                            accountId,\n                            account: account.name,\n                            status: \"skipped\",\n                            ofi: existingSnapshot.ofi_score,\n                            reason: \"Already analyzed today\"\n                        });\n                        continue;\n                    }\n                    // Stop after analyzing MAX_ANALYSES_PER_RUN accounts to avoid timeout\n                    if (accountsAnalyzed >= MAX_ANALYSES_PER_RUN) {\n                        console.log(`Reached max analysis limit (${MAX_ANALYSES_PER_RUN}), stopping to avoid timeout`);\n                        break;\n                    }\n                    // Get integration\n                    const { data: integration } = await supabase.from(\"integrations\").select(\"*\").eq(\"user_id\", portfolio.user_id).eq(\"integration_type\", \"salesforce\").single();\n                    if (!integration) continue;\n                    // Get tokens\n                    const { data: tokens } = await supabase.from(\"oauth_tokens\").select(\"*\").eq(\"integration_id\", integration.id).single();\n                    if (!tokens) continue;\n                    // Fetch cases from Salesforce (looking back 90 days, most recent first)\n                    const query = `SELECT Id,CaseNumber,Subject,Description,Status,Priority,CreatedDate FROM Case WHERE AccountId='${account.salesforce_id}' AND CreatedDate=LAST_N_DAYS:90 ORDER BY CreatedDate DESC LIMIT 100`;\n                    console.log(`Fetching cases for account: ${account.name} (${account.salesforce_id})`);\n                    const casesResponse = await fetch(`${integration.instance_url}/services/data/v59.0/query?q=${encodeURIComponent(query)}`, {\n                        headers: {\n                            \"Authorization\": `Bearer ${tokens.access_token}`,\n                            \"Content-Type\": \"application/json\"\n                        }\n                    });\n                    if (!casesResponse.ok) {\n                        console.error(`Failed to fetch cases for ${account.name}:`, casesResponse.status);\n                        results.push({\n                            accountId,\n                            account: account.name,\n                            status: \"failed\",\n                            error: \"Salesforce fetch failed\"\n                        });\n                        continue;\n                    }\n                    const casesData = await casesResponse.json();\n                    console.log(`Found ${casesData.records?.length || 0} cases for ${account.name}`);\n                    if (!casesData.records || casesData.records.length === 0) {\n                        // Create snapshot with OFI 0 for accounts with no cases\n                        const { error: snapshotError } = await supabase.from(\"account_snapshots\").insert({\n                            account_id: accountId,\n                            snapshot_date: new Date().toISOString().split(\"T\")[0],\n                            ofi_score: 0,\n                            friction_card_count: 0,\n                            high_severity_count: 0,\n                            case_volume: 0\n                        });\n                        if (snapshotError) {\n                            console.error(`Error creating snapshot for ${account.name}:`, snapshotError);\n                            results.push({\n                                accountId,\n                                account: account.name,\n                                status: \"snapshot_error\",\n                                error: snapshotError.message\n                            });\n                        } else {\n                            console.log(`✓ Snapshot created for ${account.name} with OFI 0 (no cases)`);\n                            results.push({\n                                accountId,\n                                account: account.name,\n                                status: \"no_cases\",\n                                cases: 0,\n                                ofi: 0\n                            });\n                        }\n                        accountsAnalyzed++; // Count this as analyzed\n                        continue;\n                    }\n                    // Delete old data for this account to ensure we only work with fresh 90-day data\n                    console.log(`Cleaning up old data for ${account.name}...`);\n                    // Delete old friction cards\n                    const { error: cardsDeleteError } = await supabase.from(\"friction_cards\").delete().eq(\"account_id\", accountId).eq(\"user_id\", portfolio.user_id);\n                    if (cardsDeleteError) {\n                        console.error(`Error deleting old friction_cards for ${account.name}:`, cardsDeleteError);\n                    }\n                    // Delete old raw_inputs\n                    const { error: inputsDeleteError } = await supabase.from(\"raw_inputs\").delete().eq(\"account_id\", accountId).eq(\"user_id\", portfolio.user_id);\n                    if (inputsDeleteError) {\n                        console.error(`Error deleting old raw_inputs for ${account.name}:`, inputsDeleteError);\n                    }\n                    console.log(`Old data cleaned up successfully for ${account.name}`);\n                    // Store raw inputs\n                    const rawInputs = casesData.records.map((sfCase)=>({\n                            user_id: portfolio.user_id,\n                            account_id: accountId,\n                            source_type: \"salesforce_case\",\n                            source_id: sfCase.Id,\n                            source_url: `${integration.instance_url}/${sfCase.Id}`,\n                            text_content: `Case #${sfCase.CaseNumber}: ${sfCase.Subject}\\n\\n${sfCase.Description || \"No description\"}`,\n                            metadata: {\n                                case_number: sfCase.CaseNumber,\n                                subject: sfCase.Subject,\n                                status: sfCase.Status,\n                                created_date: sfCase.CreatedDate\n                            },\n                            processed: false\n                        }));\n                    const { data: insertedInputs } = await supabase.from(\"raw_inputs\").insert(rawInputs).select();\n                    if (!insertedInputs || insertedInputs.length === 0) continue;\n                    // Analyze with Claude (up to 100 cases per account)\n                    const limitedInputs = insertedInputs.slice(0, 100);\n                    const frictionCards = [];\n                    for (const input of limitedInputs){\n                        const prompt = `Analyze this customer support case and return ONLY valid JSON with no other text, explanation, or markdown formatting.\n\nRequired JSON structure:\n{\n  \"summary\": \"brief summary of the issue\",\n  \"theme_key\": \"one of: billing_confusion, integration_failures, ui_confusion, performance_issues, other\",\n  \"severity\": 1-5 (number),\n  \"sentiment\": \"one of: frustrated, confused, neutral\",\n  \"root_cause\": \"brief root cause hypothesis\"\n}\n\nCase to analyze:\n${input.text_content}\n\nReturn ONLY the JSON object, nothing else.`;\n                        try {\n                            const anthropicResponse = await fetch(\"https://api.anthropic.com/v1/messages\", {\n                                method: \"POST\",\n                                headers: {\n                                    \"Content-Type\": \"application/json\",\n                                    \"x-api-key\": process.env.ANTHROPIC_API_KEY,\n                                    \"anthropic-version\": \"2023-06-01\"\n                                },\n                                body: JSON.stringify({\n                                    model: \"claude-sonnet-4-20250514\",\n                                    max_tokens: 300,\n                                    messages: [\n                                        {\n                                            role: \"user\",\n                                            content: prompt\n                                        }\n                                    ]\n                                })\n                            });\n                            if (anthropicResponse.ok) {\n                                const data = await anthropicResponse.json();\n                                const text = data.content[0].text.replace(/```json\\n?/g, \"\").replace(/```/g, \"\").trim();\n                                const analysis = JSON.parse(text);\n                                frictionCards.push({\n                                    user_id: portfolio.user_id,\n                                    account_id: accountId,\n                                    raw_input_id: input.id,\n                                    summary: analysis.summary,\n                                    theme_key: analysis.theme_key || \"other\",\n                                    severity: analysis.severity || 3,\n                                    sentiment: analysis.sentiment || \"neutral\",\n                                    root_cause_hypothesis: analysis.root_cause || \"Unknown\",\n                                    evidence_snippets: [],\n                                    confidence_score: 0.7,\n                                    reasoning: \"Cron analysis\"\n                                });\n                            }\n                        } catch (e) {\n                            console.error(\"Analysis error:\", e);\n                        }\n                    }\n                    if (frictionCards.length > 0) {\n                        await supabase.from(\"friction_cards\").insert(frictionCards);\n                        const inputIds = limitedInputs.map((i)=>i.id);\n                        console.log(`Marking ${inputIds.length} inputs as processed:`, inputIds);\n                        const { error: updateError } = await supabase.from(\"raw_inputs\").update({\n                            processed: true\n                        }).in(\"id\", inputIds);\n                        if (updateError) {\n                            console.error(\"Error updating processed flag:\", updateError);\n                        } else {\n                            console.log(`Successfully marked ${inputIds.length} inputs as processed`);\n                        }\n                        // Calculate OFI\n                        const severityWeights = {\n                            1: 0.5,\n                            2: 1,\n                            3: 2,\n                            4: 5,\n                            5: 10\n                        };\n                        const weightedScore = frictionCards.reduce((sum, card)=>sum + (severityWeights[card.severity] || 1), 0);\n                        const ofiScore = Math.min(100, Math.round(weightedScore * 2));\n                        console.log(`Creating snapshot for ${account.name}: OFI ${ofiScore}, ${frictionCards.length} cards`);\n                        const { error: snapshotError } = await supabase.from(\"account_snapshots\").insert({\n                            account_id: accountId,\n                            snapshot_date: new Date().toISOString().split(\"T\")[0],\n                            ofi_score: ofiScore,\n                            friction_card_count: frictionCards.length,\n                            high_severity_count: frictionCards.filter((c)=>c.severity >= 4).length,\n                            case_volume: casesData.records.length\n                        }).select();\n                        if (snapshotError) {\n                            console.error(`Error creating snapshot for ${account.name}:`, snapshotError);\n                            results.push({\n                                accountId,\n                                account: account.name,\n                                status: \"snapshot_error\",\n                                error: snapshotError.message\n                            });\n                            accountsAnalyzed++; // Count snapshot errors too\n                        } else {\n                            console.log(`✓ Snapshot created successfully for ${account.name}`);\n                            results.push({\n                                accountId,\n                                account: account.name,\n                                status: \"success\",\n                                cases: casesData.records.length,\n                                analyzed: frictionCards.length,\n                                ofi: ofiScore\n                            });\n                            accountsAnalyzed++; // Increment counter after successful processing\n                        }\n                    }\n                } catch (error) {\n                    results.push({\n                        accountId,\n                        status: \"error\",\n                        error: String(error)\n                    });\n                    accountsAnalyzed++; // Count errors too to avoid infinite loops\n                }\n            }\n        }\n        console.log(\"=== Analysis Complete ===\");\n        console.log(\"Total accounts processed:\", results.length);\n        const successCount = results.filter((r)=>r.status === \"success\").length;\n        const noCasesCount = results.filter((r)=>r.status === \"no_cases\").length;\n        const failedCount = results.filter((r)=>r.status === \"failed\").length;\n        const skippedCount = results.filter((r)=>r.status === \"skipped\").length;\n        console.log(`Success: ${successCount}, Skipped: ${skippedCount}, No Cases: ${noCasesCount}, Failed: ${failedCount}`);\n        console.log(\"Results summary:\", results.map((r)=>({\n                account: r.account,\n                status: r.status,\n                analyzed: r.analyzed,\n                ofi: r.ofi\n            })));\n        return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n            success: true,\n            results,\n            total: results.length,\n            summary: {\n                analyzed: successCount,\n                skipped: skippedCount,\n                no_cases: noCasesCount,\n                failed: failedCount\n            }\n        });\n    } catch (error) {\n        console.error(\"=== Analysis Failed ===\", error);\n        return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n            error: \"Cron failed\",\n            details: String(error)\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9hcHAvYXBpL2Nyb24vYW5hbHl6ZS1wb3J0Zm9saW8vcm91dGUudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBd0Q7QUFDSDtBQUU5QyxNQUFNRSxVQUFVLGdCQUFnQjtBQUNoQyxNQUFNQyxjQUFjLElBQUk7QUFFeEIsZUFBZUMsSUFBSUMsT0FBb0I7SUFDNUNDLFFBQVFDLEdBQUcsQ0FBQztJQUVaLDJDQUEyQztJQUMzQyxNQUFNQyxhQUFhSCxRQUFRSSxPQUFPLENBQUNDLEdBQUcsQ0FBQztJQUN2Q0osUUFBUUMsR0FBRyxDQUFDLHdCQUF3QixDQUFDLENBQUNDO0lBQ3RDRixRQUFRQyxHQUFHLENBQUMsMkJBQTJCLENBQUMsQ0FBQ0ksUUFBUUMsR0FBRyxDQUFDQyxXQUFXO0lBRWhFLDREQUE0RDtJQUM1RCwyREFBMkQ7SUFDM0QsMEVBQTBFO0lBQzFFLElBQUk7SUFFSlAsUUFBUUMsR0FBRyxDQUFDO0lBRVosSUFBSTtRQUNGLE1BQU1PLFdBQVdiLG1FQUFZQSxDQUMzQlUsMENBQW9DLEVBQ3BDQSxRQUFRQyxHQUFHLENBQUNJLHlCQUF5QjtRQUd2QyxnQ0FBZ0M7UUFDaEMsTUFBTSxFQUFFQyxNQUFNQyxVQUFVLEVBQUUsR0FBRyxNQUFNSixTQUNoQ0ssSUFBSSxDQUFDLGNBQ0xDLE1BQU0sQ0FBQyx3Q0FDUEMsRUFBRSxDQUFDLGtCQUFrQjtRQUV4QixJQUFJLENBQUNILGNBQWNBLFdBQVdJLE1BQU0sS0FBSyxHQUFHO1lBQzFDLE9BQU90QixrRkFBWUEsQ0FBQ3VCLElBQUksQ0FBQztnQkFBRUMsU0FBUztZQUFzQjtRQUM1RDtRQUVBLE1BQU1DLFVBQVUsRUFBRTtRQUNsQixJQUFJQyxtQkFBbUI7UUFDdkIsTUFBTUMsdUJBQXVCLEdBQUcsMkRBQTJEO1FBRTNGLEtBQUssTUFBTUMsYUFBYVYsV0FBWTtZQUNsQyxLQUFLLE1BQU1XLGFBQWFELFVBQVVFLFdBQVcsQ0FBRTtnQkFDN0MsSUFBSTtvQkFDRixzQkFBc0I7b0JBQ3RCLE1BQU0s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QU07Z0JBQUU5RyxTQUFTOEcsRUFBRTlHLE9BQU87Z0JBQUVXLFFBQVFtRyxFQUFFbkcsTUFBTTtnQkFBRWdHLFVBQVVHLEVBQUVILFFBQVE7Z0JBQUUvRixLQUFLa0csRUFBRWxHLEdBQUc7WUFBQztRQUUzSCxPQUFPM0Msa0ZBQVlBLENBQUN1QixJQUFJLENBQUM7WUFDdkIwSCxTQUFTO1lBQ1R4SDtZQUNBeUgsT0FBT3pILFFBQVFILE1BQU07WUFDckIwRixTQUFTO2dCQUNQMEIsVUFBVUU7Z0JBQ1ZPLFNBQVNIO2dCQUNUSSxVQUFVTjtnQkFDVk8sUUFBUU47WUFDVjtRQUNGO0lBRUYsRUFBRSxPQUFPdEYsT0FBTztRQUNkbkQsUUFBUW1ELEtBQUssQ0FBQywyQkFBMkJBO1FBQ3pDLE9BQU96RCxrRkFBWUEsQ0FBQ3VCLElBQUksQ0FBQztZQUFFa0MsT0FBTztZQUFlNkYsU0FBU1gsT0FBT2xGO1FBQU8sR0FBRztZQUFFZixRQUFRO1FBQUk7SUFDM0Y7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL2ZyaWN0aW9uLWludGVsbGlnZW5jZS8uL2FwcC9hcGkvY3Jvbi9hbmFseXplLXBvcnRmb2xpby9yb3V0ZS50cz8zZjI0Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5leHRSZXF1ZXN0LCBOZXh0UmVzcG9uc2UgfSBmcm9tICduZXh0L3NlcnZlcic7XG5pbXBvcnQgeyBjcmVhdGVDbGllbnQgfSBmcm9tICdAc3VwYWJhc2Uvc3VwYWJhc2UtanMnO1xuXG5leHBvcnQgY29uc3QgZHluYW1pYyA9ICdmb3JjZS1keW5hbWljJztcbmV4cG9ydCBjb25zdCBtYXhEdXJhdGlvbiA9IDMwMDtcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIEdFVChyZXF1ZXN0OiBOZXh0UmVxdWVzdCkge1xuICBjb25zb2xlLmxvZygnPT09IEFuYWx5emUgUG9ydGZvbGlvIEVuZHBvaW50IENhbGxlZCA9PT0nKTtcblxuICAvLyBURU1QT1JBUklMWSBESVNBQkxFRDogVmVyaWZ5IGNyb24gc2VjcmV0XG4gIGNvbnN0IGF1dGhIZWFkZXIgPSByZXF1ZXN0LmhlYWRlcnMuZ2V0KCdhdXRob3JpemF0aW9uJyk7XG4gIGNvbnNvbGUubG9nKCdBdXRoIGhlYWRlciBwcmVzZW50OicsICEhYXV0aEhlYWRlcik7XG4gIGNvbnNvbGUubG9nKCdDUk9OX1NFQ1JFVCBjb25maWd1cmVkOicsICEhcHJvY2Vzcy5lbnYuQ1JPTl9TRUNSRVQpO1xuXG4gIC8vIGlmIChhdXRoSGVhZGVyICE9PSBgQmVhcmVyICR7cHJvY2Vzcy5lbnYuQ1JPTl9TRUNSRVR9YCkge1xuICAvLyAgIGNvbnNvbGUuZXJyb3IoJ0F1dGhvcml6YXRpb24gZmFpbGVkIC0gYXV0aCBtaXNtYXRjaCcpO1xuICAvLyAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiAnVW5hdXRob3JpemVkJyB9LCB7IHN0YXR1czogNDAxIH0pO1xuICAvLyB9XG5cbiAgY29uc29sZS5sb2coJ0F1dGggY2hlY2sgZGlzYWJsZWQgZm9yIHRlc3RpbmcsIHN0YXJ0aW5nIGFuYWx5c2lzLi4uJyk7XG5cbiAgdHJ5IHtcbiAgICBjb25zdCBzdXBhYmFzZSA9IGNyZWF0ZUNsaWVudChcbiAgICAgIHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCEsXG4gICAgICBwcm9jZXNzLmVudi5TVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZIVxuICAgICk7XG5cbiAgICAvLyBHZXQgYWxsIHVzZXJzIHdpdGggcG9ydGZvbGlvc1xuICAgIGNvbnN0IHsgZGF0YTogcG9ydGZvbGlvcyB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgIC5mcm9tKCdwb3J0Zm9saW9zJylcbiAgICAgIC5zZWxlY3QoJ3VzZXJfaWQsIGFjY291bnRfaWRzLCBwb3J0Zm9saW9fdHlwZScpXG4gICAgICAuZXEoJ3BvcnRmb2xpb190eXBlJywgJ3RvcF8yNScpO1xuXG4gICAgaWYgKCFwb3J0Zm9saW9zIHx8IHBvcnRmb2xpb3MubGVuZ3RoID09PSAwKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBtZXNzYWdlOiAnTm8gcG9ydGZvbGlvcyBmb3VuZCcgfSk7XG4gICAgfVxuXG4gICAgY29uc3QgcmVzdWx0cyA9IFtdO1xuICAgIGxldCBhY2NvdW50c0FuYWx5emVkID0gMDtcbiAgICBjb25zdCBNQVhfQU5BTFlTRVNfUEVSX1JVTiA9IDE7IC8vIExpbWl0IHRvIDEgYWNjb3VudCBwZXIgcnVuIHdoZW4gYW5hbHl6aW5nIDEwMCBjYXNlcyBlYWNoXG5cbiAgICBmb3IgKGNvbnN0IHBvcnRmb2xpbyBvZiBwb3J0Zm9saW9zKSB7XG4gICAgICBmb3IgKGNvbnN0IGFjY291bnRJZCBvZiBwb3J0Zm9saW8uYWNjb3VudF9pZHMpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAvLyBHZXQgYWNjb3VudCBkZXRhaWxzXG4gICAgICAgICAgY29uc3QgeyBkYXRhOiBhY2NvdW50IH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgICAgICAgLmZyb20oJ2FjY291bnRzJylcbiAgICAgICAgICAgIC5zZWxlY3QoJ3NhbGVzZm9yY2VfaWQsIG5hbWUnKVxuICAgICAgICAgICAgLmVxKCdpZCcsIGFjY291bnRJZClcbiAgICAgICAgICAgIC5zaW5nbGUoKTtcblxuICAgICAgICAgIGlmICghYWNjb3VudCkgY29udGludWU7XG5cbiAgICAgICAgICAvLyBDaGVjayBpZiBhY2NvdW50IGFscmVhZHkgaGFzIGEgc25hcHNob3QgZnJvbSB0b2RheVxuICAgICAgICAgIGNvbnN0IHRvZGF5ID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpLnNwbGl0KCdUJylbMF07XG4gICAgICAgICAgY29uc3QgeyBkYXRhOiBleGlzdGluZ1NuYXBzaG90IH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgICAgICAgLmZyb20oJ2FjY291bnRfc25hcHNob3RzJylcbiAgICAgICAgICAgIC5zZWxlY3QoJ2lkLCBvZmlfc2NvcmUnKVxuICAgICAgICAgICAgLmVxKCdhY2NvdW50X2lkJywgYWNjb3VudElkKVxuICAgICAgICAgICAgLmVxKCdzbmFwc2hvdF9kYXRlJywgdG9kYXkpXG4gICAgICAgICAgICAubWF5YmVTaW5nbGUoKTtcblxuICAgICAgICAgIGlmIChleGlzdGluZ1NuYXBzaG90KSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhgU2tpcHBpbmcgJHthY2NvdW50Lm5hbWV9IC0gYWxyZWFkeSBhbmFseXplZCB0b2RheSAoT0ZJOiAke2V4aXN0aW5nU25hcHNob3Qub2ZpX3Njb3JlfSlgKTtcbiAgICAgICAgICAgIHJlc3VsdHMucHVzaCh7XG4gICAgICAgICAgICAgIGFjY291bnRJZCxcbiAgICAgICAgICAgICAgYWNjb3VudDogYWNjb3VudC5uYW1lLFxuICAgICAgICAgICAgICBzdGF0dXM6ICdza2lwcGVkJyxcbiAgICAgICAgICAgICAgb2ZpOiBleGlzdGluZ1NuYXBzaG90Lm9maV9zY29yZSxcbiAgICAgICAgICAgICAgcmVhc29uOiAnQWxyZWFkeSBhbmFseXplZCB0b2RheSdcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgLy8gU3RvcCBhZnRlciBhbmFseXppbmcgTUFYX0FOQUxZU0VTX1BFUl9SVU4gYWNjb3VudHMgdG8gYXZvaWQgdGltZW91dFxuICAgICAgICAgIGlmIChhY2NvdW50c0FuYWx5emVkID49IE1BWF9BTkFMWVNFU19QRVJfUlVOKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhgUmVhY2hlZCBtYXggYW5hbHlzaXMgbGltaXQgKCR7TUFYX0FOQUxZU0VTX1BFUl9SVU59KSwgc3RvcHBpbmcgdG8gYXZvaWQgdGltZW91dGApO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgLy8gR2V0IGludGVncmF0aW9uXG4gICAgICAgICAgY29uc3QgeyBkYXRhOiBpbnRlZ3JhdGlvbiB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgICAgICAgIC5mcm9tKCdpbnRlZ3JhdGlvbnMnKVxuICAgICAgICAgICAgLnNlbGVjdCgnKicpXG4gICAgICAgICAgICAuZXEoJ3VzZXJfaWQnLCBwb3J0Zm9saW8udXNlcl9pZClcbiAgICAgICAgICAgIC5lcSgnaW50ZWdyYXRpb25fdHlwZScsICdzYWxlc2ZvcmNlJylcbiAgICAgICAgICAgIC5zaW5nbGUoKTtcblxuICAgICAgICAgIGlmICghaW50ZWdyYXRpb24pIGNvbnRpbnVlO1xuXG4gICAgICAgICAgLy8gR2V0IHRva2Vuc1xuICAgICAgICAgIGNvbnN0IHsgZGF0YTogdG9rZW5zIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgICAgICAgLmZyb20oJ29hdXRoX3Rva2VucycpXG4gICAgICAgICAgICAuc2VsZWN0KCcqJylcbiAgICAgICAgICAgIC5lcSgnaW50ZWdyYXRpb25faWQnLCBpbnRlZ3JhdGlvbi5pZClcbiAgICAgICAgICAgIC5zaW5nbGUoKTtcblxuICAgICAgICAgIGlmICghdG9rZW5zKSBjb250aW51ZTtcblxuICAgICAgICAgIC8vIEZldGNoIGNhc2VzIGZyb20gU2FsZXNmb3JjZSAobG9va2luZyBiYWNrIDkwIGRheXMsIG1vc3QgcmVjZW50IGZpcnN0KVxuICAgICAgICAgIGNvbnN0IHF1ZXJ5ID0gYFNFTEVDVCBJZCxDYXNlTnVtYmVyLFN1YmplY3QsRGVzY3JpcHRpb24sU3RhdHVzLFByaW9yaXR5LENyZWF0ZWREYXRlIEZST00gQ2FzZSBXSEVSRSBBY2NvdW50SWQ9JyR7YWNjb3VudC5zYWxlc2ZvcmNlX2lkfScgQU5EIENyZWF0ZWREYXRlPUxBU1RfTl9EQVlTOjkwIE9SREVSIEJZIENyZWF0ZWREYXRlIERFU0MgTElNSVQgMTAwYDtcbiAgICAgICAgICBjb25zb2xlLmxvZyhgRmV0Y2hpbmcgY2FzZXMgZm9yIGFjY291bnQ6ICR7YWNjb3VudC5uYW1lfSAoJHthY2NvdW50LnNhbGVzZm9yY2VfaWR9KWApO1xuXG4gICAgICAgICAgY29uc3QgY2FzZXNSZXNwb25zZSA9IGF3YWl0IGZldGNoKFxuICAgICAgICAgICAgYCR7aW50ZWdyYXRpb24uaW5zdGFuY2VfdXJsfS9zZXJ2aWNlcy9kYXRhL3Y1OS4wL3F1ZXJ5P3E9JHtlbmNvZGVVUklDb21wb25lbnQocXVlcnkpfWAsXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgICAgICAnQXV0aG9yaXphdGlvbic6IGBCZWFyZXIgJHt0b2tlbnMuYWNjZXNzX3Rva2VufWAsXG4gICAgICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH1cbiAgICAgICAgICApO1xuXG4gICAgICAgICAgaWYgKCFjYXNlc1Jlc3BvbnNlLm9rKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKGBGYWlsZWQgdG8gZmV0Y2ggY2FzZXMgZm9yICR7YWNjb3VudC5uYW1lfTpgLCBjYXNlc1Jlc3BvbnNlLnN0YXR1cyk7XG4gICAgICAgICAgICByZXN1bHRzLnB1c2goeyBhY2NvdW50SWQsIGFjY291bnQ6IGFjY291bnQubmFtZSwgc3RhdHVzOiAnZmFpbGVkJywgZXJyb3I6ICdTYWxlc2ZvcmNlIGZldGNoIGZhaWxlZCcgfSk7XG4gICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBjb25zdCBjYXNlc0RhdGEgPSBhd2FpdCBjYXNlc1Jlc3BvbnNlLmpzb24oKTtcbiAgICAgICAgICBjb25zb2xlLmxvZyhgRm91bmQgJHtjYXNlc0RhdGEucmVjb3Jkcz8ubGVuZ3RoIHx8IDB9IGNhc2VzIGZvciAke2FjY291bnQubmFtZX1gKTtcblxuICAgICAgICAgIGlmICghY2FzZXNEYXRhLnJlY29yZHMgfHwgY2FzZXNEYXRhLnJlY29yZHMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAvLyBDcmVhdGUgc25hcHNob3Qgd2l0aCBPRkkgMCBmb3IgYWNjb3VudHMgd2l0aCBubyBjYXNlc1xuICAgICAgICAgICAgY29uc3QgeyBlcnJvcjogc25hcHNob3RFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2UuZnJvbSgnYWNjb3VudF9zbmFwc2hvdHMnKS5pbnNlcnQoe1xuICAgICAgICAgICAgICBhY2NvdW50X2lkOiBhY2NvdW50SWQsXG4gICAgICAgICAgICAgIHNuYXBzaG90X2RhdGU6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKS5zcGxpdCgnVCcpWzBdLFxuICAgICAgICAgICAgICBvZmlfc2NvcmU6IDAsXG4gICAgICAgICAgICAgIGZyaWN0aW9uX2NhcmRfY291bnQ6IDAsXG4gICAgICAgICAgICAgIGhpZ2hfc2V2ZXJpdHlfY291bnQ6IDAsXG4gICAgICAgICAgICAgIGNhc2Vfdm9sdW1lOiAwLFxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGlmIChzbmFwc2hvdEVycm9yKSB7XG4gICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYEVycm9yIGNyZWF0aW5nIHNuYXBzaG90IGZvciAke2FjY291bnQubmFtZX06YCwgc25hcHNob3RFcnJvcik7XG4gICAgICAgICAgICAgIHJlc3VsdHMucHVzaCh7IGFjY291bnRJZCwgYWNjb3VudDogYWNjb3VudC5uYW1lLCBzdGF0dXM6ICdzbmFwc2hvdF9lcnJvcicsIGVycm9yOiBzbmFwc2hvdEVycm9yLm1lc3NhZ2UgfSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBjb25zb2xlLmxvZyhg4pyTIFNuYXBzaG90IGNyZWF0ZWQgZm9yICR7YWNjb3VudC5uYW1lfSB3aXRoIE9GSSAwIChubyBjYXNlcylgKTtcbiAgICAgICAgICAgICAgcmVzdWx0cy5wdXNoKHsgYWNjb3VudElkLCBhY2NvdW50OiBhY2NvdW50Lm5hbWUsIHN0YXR1czogJ25vX2Nhc2VzJywgY2FzZXM6IDAsIG9maTogMCB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGFjY291bnRzQW5hbHl6ZWQrKzsgLy8gQ291bnQgdGhpcyBhcyBhbmFseXplZFxuICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgLy8gRGVsZXRlIG9sZCBkYXRhIGZvciB0aGlzIGFjY291bnQgdG8gZW5zdXJlIHdlIG9ubHkgd29yayB3aXRoIGZyZXNoIDkwLWRheSBkYXRhXG4gICAgICAgICAgY29uc29sZS5sb2coYENsZWFuaW5nIHVwIG9sZCBkYXRhIGZvciAke2FjY291bnQubmFtZX0uLi5gKTtcblxuICAgICAgICAgIC8vIERlbGV0ZSBvbGQgZnJpY3Rpb24gY2FyZHNcbiAgICAgICAgICBjb25zdCB7IGVycm9yOiBjYXJkc0RlbGV0ZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgICAgICAgLmZyb20oJ2ZyaWN0aW9uX2NhcmRzJylcbiAgICAgICAgICAgIC5kZWxldGUoKVxuICAgICAgICAgICAgLmVxKCdhY2NvdW50X2lkJywgYWNjb3VudElkKVxuICAgICAgICAgICAgLmVxKCd1c2VyX2lkJywgcG9ydGZvbGlvLnVzZXJfaWQpO1xuXG4gICAgICAgICAgaWYgKGNhcmRzRGVsZXRlRXJyb3IpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYEVycm9yIGRlbGV0aW5nIG9sZCBmcmljdGlvbl9jYXJkcyBmb3IgJHthY2NvdW50Lm5hbWV9OmAsIGNhcmRzRGVsZXRlRXJyb3IpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIC8vIERlbGV0ZSBvbGQgcmF3X2lucHV0c1xuICAgICAgICAgIGNvbnN0IHsgZXJyb3I6IGlucHV0c0RlbGV0ZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgICAgICAgLmZyb20oJ3Jhd19pbnB1dHMnKVxuICAgICAgICAgICAgLmRlbGV0ZSgpXG4gICAgICAgICAgICAuZXEoJ2FjY291bnRfaWQnLCBhY2NvdW50SWQpXG4gICAgICAgICAgICAuZXEoJ3VzZXJfaWQnLCBwb3J0Zm9saW8udXNlcl9pZCk7XG5cbiAgICAgICAgICBpZiAoaW5wdXRzRGVsZXRlRXJyb3IpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYEVycm9yIGRlbGV0aW5nIG9sZCByYXdfaW5wdXRzIGZvciAke2FjY291bnQubmFtZX06YCwgaW5wdXRzRGVsZXRlRXJyb3IpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGNvbnNvbGUubG9nKGBPbGQgZGF0YSBjbGVhbmVkIHVwIHN1Y2Nlc3NmdWxseSBmb3IgJHthY2NvdW50Lm5hbWV9YCk7XG5cbiAgICAgICAgICAvLyBTdG9yZSByYXcgaW5wdXRzXG4gICAgICAgICAgY29uc3QgcmF3SW5wdXRzID0gY2FzZXNEYXRhLnJlY29yZHMubWFwKChzZkNhc2U6IGFueSkgPT4gKHtcbiAgICAgICAgICAgIHVzZXJfaWQ6IHBvcnRmb2xpby51c2VyX2lkLFxuICAgICAgICAgICAgYWNjb3VudF9pZDogYWNjb3VudElkLFxuICAgICAgICAgICAgc291cmNlX3R5cGU6ICdzYWxlc2ZvcmNlX2Nhc2UnLFxuICAgICAgICAgICAgc291cmNlX2lkOiBzZkNhc2UuSWQsXG4gICAgICAgICAgICBzb3VyY2VfdXJsOiBgJHtpbnRlZ3JhdGlvbi5pbnN0YW5jZV91cmx9LyR7c2ZDYXNlLklkfWAsXG4gICAgICAgICAgICB0ZXh0X2NvbnRlbnQ6IGBDYXNlICMke3NmQ2FzZS5DYXNlTnVtYmVyfTogJHtzZkNhc2UuU3ViamVjdH1cXG5cXG4ke3NmQ2FzZS5EZXNjcmlwdGlvbiB8fCAnTm8gZGVzY3JpcHRpb24nfWAsXG4gICAgICAgICAgICBtZXRhZGF0YToge1xuICAgICAgICAgICAgICBjYXNlX251bWJlcjogc2ZDYXNlLkNhc2VOdW1iZXIsXG4gICAgICAgICAgICAgIHN1YmplY3Q6IHNmQ2FzZS5TdWJqZWN0LFxuICAgICAgICAgICAgICBzdGF0dXM6IHNmQ2FzZS5TdGF0dXMsXG4gICAgICAgICAgICAgIGNyZWF0ZWRfZGF0ZTogc2ZDYXNlLkNyZWF0ZWREYXRlLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHByb2Nlc3NlZDogZmFsc2UsXG4gICAgICAgICAgfSkpO1xuXG4gICAgICAgICAgY29uc3QgeyBkYXRhOiBpbnNlcnRlZElucHV0cyB9ID0gYXdhaXQgc3VwYWJhc2UuZnJvbSgncmF3X2lucHV0cycpLmluc2VydChyYXdJbnB1dHMpLnNlbGVjdCgpO1xuXG4gICAgICAgICAgaWYgKCFpbnNlcnRlZElucHV0cyB8fCBpbnNlcnRlZElucHV0cy5sZW5ndGggPT09IDApIGNvbnRpbnVlO1xuXG4gICAgICAgICAgLy8gQW5hbHl6ZSB3aXRoIENsYXVkZSAodXAgdG8gMTAwIGNhc2VzIHBlciBhY2NvdW50KVxuICAgICAgICAgIGNvbnN0IGxpbWl0ZWRJbnB1dHMgPSBpbnNlcnRlZElucHV0cy5zbGljZSgwLCAxMDApO1xuICAgICAgICAgIGNvbnN0IGZyaWN0aW9uQ2FyZHMgPSBbXTtcblxuICAgICAgICAgIGZvciAoY29uc3QgaW5wdXQgb2YgbGltaXRlZElucHV0cykge1xuICAgICAgICAgICAgY29uc3QgcHJvbXB0ID0gYEFuYWx5emUgdGhpcyBjdXN0b21lciBzdXBwb3J0IGNhc2UgYW5kIHJldHVybiBPTkxZIHZhbGlkIEpTT04gd2l0aCBubyBvdGhlciB0ZXh0LCBleHBsYW5hdGlvbiwgb3IgbWFya2Rvd24gZm9ybWF0dGluZy5cblxuUmVxdWlyZWQgSlNPTiBzdHJ1Y3R1cmU6XG57XG4gIFwic3VtbWFyeVwiOiBcImJyaWVmIHN1bW1hcnkgb2YgdGhlIGlzc3VlXCIsXG4gIFwidGhlbWVfa2V5XCI6IFwib25lIG9mOiBiaWxsaW5nX2NvbmZ1c2lvbiwgaW50ZWdyYXRpb25fZmFpbHVyZXMsIHVpX2NvbmZ1c2lvbiwgcGVyZm9ybWFuY2VfaXNzdWVzLCBvdGhlclwiLFxuICBcInNldmVyaXR5XCI6IDEtNSAobnVtYmVyKSxcbiAgXCJzZW50aW1lbnRcIjogXCJvbmUgb2Y6IGZydXN0cmF0ZWQsIGNvbmZ1c2VkLCBuZXV0cmFsXCIsXG4gIFwicm9vdF9jYXVzZVwiOiBcImJyaWVmIHJvb3QgY2F1c2UgaHlwb3RoZXNpc1wiXG59XG5cbkNhc2UgdG8gYW5hbHl6ZTpcbiR7aW5wdXQudGV4dF9jb250ZW50fVxuXG5SZXR1cm4gT05MWSB0aGUgSlNPTiBvYmplY3QsIG5vdGhpbmcgZWxzZS5gO1xuXG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICBjb25zdCBhbnRocm9waWNSZXNwb25zZSA9IGF3YWl0IGZldGNoKCdodHRwczovL2FwaS5hbnRocm9waWMuY29tL3YxL21lc3NhZ2VzJywge1xuICAgICAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgICAgICAgICAgICAgICAneC1hcGkta2V5JzogcHJvY2Vzcy5lbnYuQU5USFJPUElDX0FQSV9LRVkhLFxuICAgICAgICAgICAgICAgICAgJ2FudGhyb3BpYy12ZXJzaW9uJzogJzIwMjMtMDYtMDEnLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgICAgICAgICAgbW9kZWw6ICdjbGF1ZGUtc29ubmV0LTQtMjAyNTA1MTQnLFxuICAgICAgICAgICAgICAgICAgbWF4X3Rva2VuczogMzAwLFxuICAgICAgICAgICAgICAgICAgbWVzc2FnZXM6IFt7IHJvbGU6ICd1c2VyJywgY29udGVudDogcHJvbXB0IH1dLFxuICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICBpZiAoYW50aHJvcGljUmVzcG9uc2Uub2spIHtcbiAgICAgICAgICAgICAgICBjb25zdCBkYXRhID0gYXdhaXQgYW50aHJvcGljUmVzcG9uc2UuanNvbigpO1xuICAgICAgICAgICAgICAgIGNvbnN0IHRleHQgPSBkYXRhLmNvbnRlbnRbMF0udGV4dC5yZXBsYWNlKC9gYGBqc29uXFxuPy9nLCAnJykucmVwbGFjZSgvYGBgL2csICcnKS50cmltKCk7XG4gICAgICAgICAgICAgICAgY29uc3QgYW5hbHlzaXMgPSBKU09OLnBhcnNlKHRleHQpO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIGZyaWN0aW9uQ2FyZHMucHVzaCh7XG4gICAgICAgICAgICAgICAgICB1c2VyX2lkOiBwb3J0Zm9saW8udXNlcl9pZCxcbiAgICAgICAgICAgICAgICAgIGFjY291bnRfaWQ6IGFjY291bnRJZCxcbiAgICAgICAgICAgICAgICAgIHJhd19pbnB1dF9pZDogaW5wdXQuaWQsXG4gICAgICAgICAgICAgICAgICBzdW1tYXJ5OiBhbmFseXNpcy5zdW1tYXJ5LFxuICAgICAgICAgICAgICAgICAgdGhlbWVfa2V5OiBhbmFseXNpcy50aGVtZV9rZXkgfHwgJ290aGVyJyxcbiAgICAgICAgICAgICAgICAgIHNldmVyaXR5OiBhbmFseXNpcy5zZXZlcml0eSB8fCAzLFxuICAgICAgICAgICAgICAgICAgc2VudGltZW50OiBhbmFseXNpcy5zZW50aW1lbnQgfHwgJ25ldXRyYWwnLFxuICAgICAgICAgICAgICAgICAgcm9vdF9jYXVzZV9oeXBvdGhlc2lzOiBhbmFseXNpcy5yb290X2NhdXNlIHx8ICdVbmtub3duJyxcbiAgICAgICAgICAgICAgICAgIGV2aWRlbmNlX3NuaXBwZXRzOiBbXSxcbiAgICAgICAgICAgICAgICAgIGNvbmZpZGVuY2Vfc2NvcmU6IDAuNyxcbiAgICAgICAgICAgICAgICAgIHJlYXNvbmluZzogJ0Nyb24gYW5hbHlzaXMnLFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0FuYWx5c2lzIGVycm9yOicsIGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cblxuICAgICAgICAgIGlmIChmcmljdGlvbkNhcmRzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIGF3YWl0IHN1cGFiYXNlLmZyb20oJ2ZyaWN0aW9uX2NhcmRzJykuaW5zZXJ0KGZyaWN0aW9uQ2FyZHMpO1xuXG4gICAgICAgICAgICBjb25zdCBpbnB1dElkcyA9IGxpbWl0ZWRJbnB1dHMubWFwKChpOiBhbnkpID0+IGkuaWQpO1xuICAgICAgICAgICAgY29uc29sZS5sb2coYE1hcmtpbmcgJHtpbnB1dElkcy5sZW5ndGh9IGlucHV0cyBhcyBwcm9jZXNzZWQ6YCwgaW5wdXRJZHMpO1xuXG4gICAgICAgICAgICBjb25zdCB7IGVycm9yOiB1cGRhdGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgICAgICAgICAgLmZyb20oJ3Jhd19pbnB1dHMnKVxuICAgICAgICAgICAgICAudXBkYXRlKHsgcHJvY2Vzc2VkOiB0cnVlIH0pXG4gICAgICAgICAgICAgIC5pbignaWQnLCBpbnB1dElkcyk7XG5cbiAgICAgICAgICAgIGlmICh1cGRhdGVFcnJvcikge1xuICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciB1cGRhdGluZyBwcm9jZXNzZWQgZmxhZzonLCB1cGRhdGVFcnJvcik7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgU3VjY2Vzc2Z1bGx5IG1hcmtlZCAke2lucHV0SWRzLmxlbmd0aH0gaW5wdXRzIGFzIHByb2Nlc3NlZGApO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBDYWxjdWxhdGUgT0ZJXG4gICAgICAgICAgICBjb25zdCBzZXZlcml0eVdlaWdodHM6IGFueSA9IHsgMTogMC41LCAyOiAxLCAzOiAyLCA0OiA1LCA1OiAxMCB9O1xuICAgICAgICAgICAgY29uc3Qgd2VpZ2h0ZWRTY29yZSA9IGZyaWN0aW9uQ2FyZHMucmVkdWNlKChzdW0sIGNhcmQpID0+IHN1bSArIChzZXZlcml0eVdlaWdodHNbY2FyZC5zZXZlcml0eV0gfHwgMSksIDApO1xuICAgICAgICAgICAgY29uc3Qgb2ZpU2NvcmUgPSBNYXRoLm1pbigxMDAsIE1hdGgucm91bmQod2VpZ2h0ZWRTY29yZSAqIDIpKTtcblxuICAgICAgICAgICAgY29uc29sZS5sb2coYENyZWF0aW5nIHNuYXBzaG90IGZvciAke2FjY291bnQubmFtZX06IE9GSSAke29maVNjb3JlfSwgJHtmcmljdGlvbkNhcmRzLmxlbmd0aH0gY2FyZHNgKTtcblxuICAgICAgICAgICAgY29uc3QgeyBlcnJvcjogc25hcHNob3RFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2UuZnJvbSgnYWNjb3VudF9zbmFwc2hvdHMnKS5pbnNlcnQoe1xuICAgICAgICAgICAgICBhY2NvdW50X2lkOiBhY2NvdW50SWQsXG4gICAgICAgICAgICAgIHNuYXBzaG90X2RhdGU6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKS5zcGxpdCgnVCcpWzBdLFxuICAgICAgICAgICAgICBvZmlfc2NvcmU6IG9maVNjb3JlLFxuICAgICAgICAgICAgICBmcmljdGlvbl9jYXJkX2NvdW50OiBmcmljdGlvbkNhcmRzLmxlbmd0aCxcbiAgICAgICAgICAgICAgaGlnaF9zZXZlcml0eV9jb3VudDogZnJpY3Rpb25DYXJkcy5maWx0ZXIoYyA9PiBjLnNldmVyaXR5ID49IDQpLmxlbmd0aCxcbiAgICAgICAgICAgICAgY2FzZV92b2x1bWU6IGNhc2VzRGF0YS5yZWNvcmRzLmxlbmd0aCxcbiAgICAgICAgICAgIH0pLnNlbGVjdCgpO1xuXG4gICAgICAgICAgICBpZiAoc25hcHNob3RFcnJvcikge1xuICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGBFcnJvciBjcmVhdGluZyBzbmFwc2hvdCBmb3IgJHthY2NvdW50Lm5hbWV9OmAsIHNuYXBzaG90RXJyb3IpO1xuICAgICAgICAgICAgICByZXN1bHRzLnB1c2goeyBhY2NvdW50SWQsIGFjY291bnQ6IGFjY291bnQubmFtZSwgc3RhdHVzOiAnc25hcHNob3RfZXJyb3InLCBlcnJvcjogc25hcHNob3RFcnJvci5tZXNzYWdlIH0pO1xuICAgICAgICAgICAgICBhY2NvdW50c0FuYWx5emVkKys7IC8vIENvdW50IHNuYXBzaG90IGVycm9ycyB0b29cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIGNvbnNvbGUubG9nKGDinJMgU25hcHNob3QgY3JlYXRlZCBzdWNjZXNzZnVsbHkgZm9yICR7YWNjb3VudC5uYW1lfWApO1xuICAgICAgICAgICAgICByZXN1bHRzLnB1c2goeyBhY2NvdW50SWQsIGFjY291bnQ6IGFjY291bnQubmFtZSwgc3RhdHVzOiAnc3VjY2VzcycsIGNhc2VzOiBjYXNlc0RhdGEucmVjb3Jkcy5sZW5ndGgsIGFuYWx5emVkOiBmcmljdGlvbkNhcmRzLmxlbmd0aCwgb2ZpOiBvZmlTY29yZSB9KTtcbiAgICAgICAgICAgICAgYWNjb3VudHNBbmFseXplZCsrOyAvLyBJbmNyZW1lbnQgY291bnRlciBhZnRlciBzdWNjZXNzZnVsIHByb2Nlc3NpbmdcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG5cbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICByZXN1bHRzLnB1c2goeyBhY2NvdW50SWQsIHN0YXR1czogJ2Vycm9yJywgZXJyb3I6IFN0cmluZyhlcnJvcikgfSk7XG4gICAgICAgICAgYWNjb3VudHNBbmFseXplZCsrOyAvLyBDb3VudCBlcnJvcnMgdG9vIHRvIGF2b2lkIGluZmluaXRlIGxvb3BzXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICBjb25zb2xlLmxvZygnPT09IEFuYWx5c2lzIENvbXBsZXRlID09PScpO1xuICAgIGNvbnNvbGUubG9nKCdUb3RhbCBhY2NvdW50cyBwcm9jZXNzZWQ6JywgcmVzdWx0cy5sZW5ndGgpO1xuXG4gICAgY29uc3Qgc3VjY2Vzc0NvdW50ID0gcmVzdWx0cy5maWx0ZXIociA9PiByLnN0YXR1cyA9PT0gJ3N1Y2Nlc3MnKS5sZW5ndGg7XG4gICAgY29uc3Qgbm9DYXNlc0NvdW50ID0gcmVzdWx0cy5maWx0ZXIociA9PiByLnN0YXR1cyA9PT0gJ25vX2Nhc2VzJykubGVuZ3RoO1xuICAgIGNvbnN0IGZhaWxlZENvdW50ID0gcmVzdWx0cy5maWx0ZXIociA9PiByLnN0YXR1cyA9PT0gJ2ZhaWxlZCcpLmxlbmd0aDtcbiAgICBjb25zdCBza2lwcGVkQ291bnQgPSByZXN1bHRzLmZpbHRlcihyID0+IHIuc3RhdHVzID09PSAnc2tpcHBlZCcpLmxlbmd0aDtcblxuICAgIGNvbnNvbGUubG9nKGBTdWNjZXNzOiAke3N1Y2Nlc3NDb3VudH0sIFNraXBwZWQ6ICR7c2tpcHBlZENvdW50fSwgTm8gQ2FzZXM6ICR7bm9DYXNlc0NvdW50fSwgRmFpbGVkOiAke2ZhaWxlZENvdW50fWApO1xuICAgIGNvbnNvbGUubG9nKCdSZXN1bHRzIHN1bW1hcnk6JywgcmVzdWx0cy5tYXAociA9PiAoeyBhY2NvdW50OiByLmFjY291bnQsIHN0YXR1czogci5zdGF0dXMsIGFuYWx5emVkOiByLmFuYWx5emVkLCBvZmk6IHIub2ZpIH0pKSk7XG5cbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIHJlc3VsdHMsXG4gICAgICB0b3RhbDogcmVzdWx0cy5sZW5ndGgsXG4gICAgICBzdW1tYXJ5OiB7XG4gICAgICAgIGFuYWx5emVkOiBzdWNjZXNzQ291bnQsXG4gICAgICAgIHNraXBwZWQ6IHNraXBwZWRDb3VudCxcbiAgICAgICAgbm9fY2FzZXM6IG5vQ2FzZXNDb3VudCxcbiAgICAgICAgZmFpbGVkOiBmYWlsZWRDb3VudFxuICAgICAgfVxuICAgIH0pO1xuXG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignPT09IEFuYWx5c2lzIEZhaWxlZCA9PT0nLCBlcnJvcik7XG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6ICdDcm9uIGZhaWxlZCcsIGRldGFpbHM6IFN0cmluZyhlcnJvcikgfSwgeyBzdGF0dXM6IDUwMCB9KTtcbiAgfVxufVxuIl0sIm5hbWVzIjpbIk5leHRSZXNwb25zZSIsImNyZWF0ZUNsaWVudCIsImR5bmFtaWMiLCJtYXhEdXJhdGlvbiIsIkdFVCIsInJlcXVlc3QiLCJjb25zb2xlIiwibG9nIiwiYXV0aEhlYWRlciIsImhlYWRlcnMiLCJnZXQiLCJwcm9jZXNzIiwiZW52IiwiQ1JPTl9TRUNSRVQiLCJzdXBhYmFzZSIsIk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCIsIlNVUEFCQVNFX1NFUlZJQ0VfUk9MRV9LRVkiLCJkYXRhIiwicG9ydGZvbGlvcyIsImZyb20iLCJzZWxlY3QiLCJlcSIsImxlbmd0aCIsImpzb24iLCJtZXNzYWdlIiwicmVzdWx0cyIsImFjY291bnRzQW5hbHl6ZWQiLCJNQVhfQU5BTFlTRVNfUEVSX1JVTiIsInBvcnRmb2xpbyIsImFjY291bnRJZCIsImFjY291bnRfaWRzIiwiYWNjb3VudCIsInNpbmdsZSIsInRvZGF5IiwiRGF0ZSIsInRvSVNPU3RyaW5nIiwic3BsaXQiLCJleGlzdGluZ1NuYXBzaG90IiwibWF5YmVTaW5nbGUiLCJuYW1lIiwib2ZpX3Njb3JlIiwicHVzaCIsInN0YXR1cyIsIm9maSIsInJlYXNvbiIsImludGVncmF0aW9uIiwidXNlcl9pZCIsInRva2VucyIsImlkIiwicXVlcnkiLCJzYWxlc2ZvcmNlX2lkIiwiY2FzZXNSZXNwb25zZSIsImZldGNoIiwiaW5zdGFuY2VfdXJsIiwiZW5jb2RlVVJJQ29tcG9uZW50IiwiYWNjZXNzX3Rva2VuIiwib2siLCJlcnJvciIsImNhc2VzRGF0YSIsInJlY29yZHMiLCJzbmFwc2hvdEVycm9yIiwiaW5zZXJ0IiwiYWNjb3VudF9pZCIsInNuYXBzaG90X2RhdGUiLCJmcmljdGlvbl9jYXJkX2NvdW50IiwiaGlnaF9zZXZlcml0eV9jb3VudCIsImNhc2Vfdm9sdW1lIiwiY2FzZXMiLCJjYXJkc0RlbGV0ZUVycm9yIiwiZGVsZXRlIiwiaW5wdXRzRGVsZXRlRXJyb3IiLCJyYXdJbnB1dHMiLCJtYXAiLCJzZkNhc2UiLCJzb3VyY2VfdHlwZSIsInNvdXJjZV9pZCIsIklkIiwic291cmNlX3VybCIsInRleHRfY29udGVudCIsIkNhc2VOdW1iZXIiLCJTdWJqZWN0IiwiRGVzY3JpcHRpb24iLCJtZXRhZGF0YSIsImNhc2VfbnVtYmVyIiwic3ViamVjdCIsIlN0YXR1cyIsImNyZWF0ZWRfZGF0ZSIsIkNyZWF0ZWREYXRlIiwicHJvY2Vzc2VkIiwiaW5zZXJ0ZWRJbnB1dHMiLCJsaW1pdGVkSW5wdXRzIiwic2xpY2UiLCJmcmljdGlvbkNhcmRzIiwiaW5wdXQiLCJwcm9tcHQiLCJhbnRocm9waWNSZXNwb25zZSIsIm1ldGhvZCIsIkFOVEhST1BJQ19BUElfS0VZIiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJtb2RlbCIsIm1heF90b2tlbnMiLCJtZXNzYWdlcyIsInJvbGUiLCJjb250ZW50IiwidGV4dCIsInJlcGxhY2UiLCJ0cmltIiwiYW5hbHlzaXMiLCJwYXJzZSIsInJhd19pbnB1dF9pZCIsInN1bW1hcnkiLCJ0aGVtZV9rZXkiLCJzZXZlcml0eSIsInNlbnRpbWVudCIsInJvb3RfY2F1c2VfaHlwb3RoZXNpcyIsInJvb3RfY2F1c2UiLCJldmlkZW5jZV9zbmlwcGV0cyIsImNvbmZpZGVuY2Vfc2NvcmUiLCJyZWFzb25pbmciLCJlIiwiaW5wdXRJZHMiLCJpIiwidXBkYXRlRXJyb3IiLCJ1cGRhdGUiLCJpbiIsInNldmVyaXR5V2VpZ2h0cyIsIndlaWdodGVkU2NvcmUiLCJyZWR1Y2UiLCJzdW0iLCJjYXJkIiwib2ZpU2NvcmUiLCJNYXRoIiwibWluIiwicm91bmQiLCJmaWx0ZXIiLCJjIiwiYW5hbHl6ZWQiLCJTdHJpbmciLCJzdWNjZXNzQ291bnQiLCJyIiwibm9DYXNlc0NvdW50IiwiZmFpbGVkQ291bnQiLCJza2lwcGVkQ291bnQiLCJzdWNjZXNzIiwidG90YWwiLCJza2lwcGVkIiwibm9fY2FzZXMiLCJmYWlsZWQiLCJkZXRhaWxzIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./app/api/cron/analyze-portfolio/route.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/@supabase","vendor-chunks/tslib","vendor-chunks/iceberg-js"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fcron%2Fanalyze-portfolio%2Froute&page=%2Fapi%2Fcron%2Fanalyze-portfolio%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fcron%2Fanalyze-portfolio%2Froute.ts&appDir=%2FUsers%2Fmario%2Ffriction-intelligence%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fmario%2Ffriction-intelligence&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();