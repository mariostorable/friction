"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/jira/sync/route";
exports.ids = ["app/api/jira/sync/route"];
exports.modules = {

/***/ "../../client/components/action-async-storage.external":
/*!*******************************************************************************!*\
  !*** external "next/dist/client/components/action-async-storage.external.js" ***!
  \*******************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/action-async-storage.external.js");

/***/ }),

/***/ "../../client/components/request-async-storage.external":
/*!********************************************************************************!*\
  !*** external "next/dist/client/components/request-async-storage.external.js" ***!
  \********************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/request-async-storage.external.js");

/***/ }),

/***/ "../../client/components/static-generation-async-storage.external":
/*!******************************************************************************************!*\
  !*** external "next/dist/client/components/static-generation-async-storage.external.js" ***!
  \******************************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/static-generation-async-storage.external.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "buffer":
/*!*************************!*\
  !*** external "buffer" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("buffer");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("crypto");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fjira%2Fsync%2Froute&page=%2Fapi%2Fjira%2Fsync%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fjira%2Fsync%2Froute.ts&appDir=%2FUsers%2Fmario%2Ffriction-intelligence%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fmario%2Ffriction-intelligence&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!*********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fjira%2Fsync%2Froute&page=%2Fapi%2Fjira%2Fsync%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fjira%2Fsync%2Froute.ts&appDir=%2FUsers%2Fmario%2Ffriction-intelligence%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fmario%2Ffriction-intelligence&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \*********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   headerHooks: () => (/* binding */ headerHooks),\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage),\n/* harmony export */   staticGenerationBailout: () => (/* binding */ staticGenerationBailout)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _Users_mario_friction_intelligence_app_api_jira_sync_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./app/api/jira/sync/route.ts */ \"(rsc)/./app/api/jira/sync/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/jira/sync/route\",\n        pathname: \"/api/jira/sync\",\n        filename: \"route\",\n        bundlePath: \"app/api/jira/sync/route\"\n    },\n    resolvedPagePath: \"/Users/mario/friction-intelligence/app/api/jira/sync/route.ts\",\n    nextConfigOutput,\n    userland: _Users_mario_friction_intelligence_app_api_jira_sync_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks, headerHooks, staticGenerationBailout } = routeModule;\nconst originalPathname = \"/api/jira/sync/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZqaXJhJTJGc3luYyUyRnJvdXRlJnBhZ2U9JTJGYXBpJTJGamlyYSUyRnN5bmMlMkZyb3V0ZSZhcHBQYXRocz0mcGFnZVBhdGg9cHJpdmF0ZS1uZXh0LWFwcC1kaXIlMkZhcGklMkZqaXJhJTJGc3luYyUyRnJvdXRlLnRzJmFwcERpcj0lMkZVc2VycyUyRm1hcmlvJTJGZnJpY3Rpb24taW50ZWxsaWdlbmNlJTJGYXBwJnBhZ2VFeHRlbnNpb25zPXRzeCZwYWdlRXh0ZW5zaW9ucz10cyZwYWdlRXh0ZW5zaW9ucz1qc3gmcGFnZUV4dGVuc2lvbnM9anMmcm9vdERpcj0lMkZVc2VycyUyRm1hcmlvJTJGZnJpY3Rpb24taW50ZWxsaWdlbmNlJmlzRGV2PXRydWUmdHNjb25maWdQYXRoPXRzY29uZmlnLmpzb24mYmFzZVBhdGg9JmFzc2V0UHJlZml4PSZuZXh0Q29uZmlnT3V0cHV0PSZwcmVmZXJyZWRSZWdpb249Jm1pZGRsZXdhcmVDb25maWc9ZTMwJTNEISIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7OztBQUFzRztBQUN2QztBQUNjO0FBQ2E7QUFDMUY7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLGdIQUFtQjtBQUMzQztBQUNBLGNBQWMseUVBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLFlBQVk7QUFDWixDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsUUFBUSx1R0FBdUc7QUFDL0c7QUFDQTtBQUNBLFdBQVcsNEVBQVc7QUFDdEI7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUM2Sjs7QUFFN0oiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9mcmljdGlvbi1pbnRlbGxpZ2VuY2UvPzVhYzAiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXBwUm91dGVSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1tb2R1bGVzL2FwcC1yb3V0ZS9tb2R1bGUuY29tcGlsZWRcIjtcbmltcG9ydCB7IFJvdXRlS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBwYXRjaEZldGNoIGFzIF9wYXRjaEZldGNoIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvbGliL3BhdGNoLWZldGNoXCI7XG5pbXBvcnQgKiBhcyB1c2VybGFuZCBmcm9tIFwiL1VzZXJzL21hcmlvL2ZyaWN0aW9uLWludGVsbGlnZW5jZS9hcHAvYXBpL2ppcmEvc3luYy9yb3V0ZS50c1wiO1xuLy8gV2UgaW5qZWN0IHRoZSBuZXh0Q29uZmlnT3V0cHV0IGhlcmUgc28gdGhhdCB3ZSBjYW4gdXNlIHRoZW0gaW4gdGhlIHJvdXRlXG4vLyBtb2R1bGUuXG5jb25zdCBuZXh0Q29uZmlnT3V0cHV0ID0gXCJcIlxuY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgQXBwUm91dGVSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuQVBQX1JPVVRFLFxuICAgICAgICBwYWdlOiBcIi9hcGkvamlyYS9zeW5jL3JvdXRlXCIsXG4gICAgICAgIHBhdGhuYW1lOiBcIi9hcGkvamlyYS9zeW5jXCIsXG4gICAgICAgIGZpbGVuYW1lOiBcInJvdXRlXCIsXG4gICAgICAgIGJ1bmRsZVBhdGg6IFwiYXBwL2FwaS9qaXJhL3N5bmMvcm91dGVcIlxuICAgIH0sXG4gICAgcmVzb2x2ZWRQYWdlUGF0aDogXCIvVXNlcnMvbWFyaW8vZnJpY3Rpb24taW50ZWxsaWdlbmNlL2FwcC9hcGkvamlyYS9zeW5jL3JvdXRlLnRzXCIsXG4gICAgbmV4dENvbmZpZ091dHB1dCxcbiAgICB1c2VybGFuZFxufSk7XG4vLyBQdWxsIG91dCB0aGUgZXhwb3J0cyB0aGF0IHdlIG5lZWQgdG8gZXhwb3NlIGZyb20gdGhlIG1vZHVsZS4gVGhpcyBzaG91bGRcbi8vIGJlIGVsaW1pbmF0ZWQgd2hlbiB3ZSd2ZSBtb3ZlZCB0aGUgb3RoZXIgcm91dGVzIHRvIHRoZSBuZXcgZm9ybWF0LiBUaGVzZVxuLy8gYXJlIHVzZWQgdG8gaG9vayBpbnRvIHRoZSByb3V0ZS5cbmNvbnN0IHsgcmVxdWVzdEFzeW5jU3RvcmFnZSwgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MsIGhlYWRlckhvb2tzLCBzdGF0aWNHZW5lcmF0aW9uQmFpbG91dCB9ID0gcm91dGVNb2R1bGU7XG5jb25zdCBvcmlnaW5hbFBhdGhuYW1lID0gXCIvYXBpL2ppcmEvc3luYy9yb3V0ZVwiO1xuZnVuY3Rpb24gcGF0Y2hGZXRjaCgpIHtcbiAgICByZXR1cm4gX3BhdGNoRmV0Y2goe1xuICAgICAgICBzZXJ2ZXJIb29rcyxcbiAgICAgICAgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZVxuICAgIH0pO1xufVxuZXhwb3J0IHsgcm91dGVNb2R1bGUsIHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzLCBoZWFkZXJIb29rcywgc3RhdGljR2VuZXJhdGlvbkJhaWxvdXQsIG9yaWdpbmFsUGF0aG5hbWUsIHBhdGNoRmV0Y2gsICB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hcHAtcm91dGUuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fjira%2Fsync%2Froute&page=%2Fapi%2Fjira%2Fsync%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fjira%2Fsync%2Froute.ts&appDir=%2FUsers%2Fmario%2Ffriction-intelligence%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fmario%2Ffriction-intelligence&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./app/api/jira/sync/route.ts":
/*!************************************!*\
  !*** ./app/api/jira/sync/route.ts ***!
  \************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   POST: () => (/* binding */ POST),\n/* harmony export */   maxDuration: () => (/* binding */ maxDuration)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/web/exports/next-response */ \"(rsc)/./node_modules/next/dist/server/web/exports/next-response.js\");\n/* harmony import */ var _supabase_auth_helpers_nextjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @supabase/auth-helpers-nextjs */ \"(rsc)/./node_modules/@supabase/auth-helpers-nextjs/dist/index.js\");\n/* harmony import */ var _supabase_auth_helpers_nextjs__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_supabase_auth_helpers_nextjs__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @supabase/supabase-js */ \"(rsc)/./node_modules/@supabase/supabase-js/dist/index.mjs\");\n/* harmony import */ var next_headers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/headers */ \"(rsc)/./node_modules/next/dist/api/headers.js\");\n/* harmony import */ var _lib_encryption__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/lib/encryption */ \"(rsc)/./lib/encryption.ts\");\n\n\n\n\n\nconst maxDuration = 60;\n// Theme keyword mapping for intelligent matching\nconst THEME_KEYWORDS = {\n    \"billing_confusion\": [\n        \"billing\",\n        \"invoice\",\n        \"payment\",\n        \"charge\",\n        \"subscription\",\n        \"pricing\",\n        \"refund\",\n        \"credit\"\n    ],\n    \"integration_failures\": [\n        \"integration\",\n        \"api\",\n        \"sync\",\n        \"connection\",\n        \"webhook\",\n        \"import\",\n        \"export\",\n        \"connector\"\n    ],\n    \"ui_confusion\": [\n        \"ui\",\n        \"interface\",\n        \"confusing\",\n        \"unclear\",\n        \"hard to find\",\n        \"navigation\",\n        \"usability\",\n        \"ux\"\n    ],\n    \"performance_issues\": [\n        \"slow\",\n        \"performance\",\n        \"loading\",\n        \"timeout\",\n        \"lag\",\n        \"speed\",\n        \"hanging\",\n        \"freeze\"\n    ],\n    \"missing_features\": [\n        \"feature request\",\n        \"missing\",\n        \"add\",\n        \"enhancement\",\n        \"capability\",\n        \"functionality\"\n    ],\n    \"training_gaps\": [\n        \"training\",\n        \"how to\",\n        \"tutorial\",\n        \"documentation\",\n        \"help\",\n        \"guide\",\n        \"learn\"\n    ],\n    \"support_response_time\": [\n        \"support\",\n        \"response\",\n        \"waiting\",\n        \"delayed\",\n        \"ticket\",\n        \"no reply\"\n    ],\n    \"data_quality\": [\n        \"data\",\n        \"incorrect\",\n        \"missing\",\n        \"wrong\",\n        \"inaccurate\",\n        \"corrupt\",\n        \"inconsistent\"\n    ],\n    \"reporting_issues\": [\n        \"report\",\n        \"dashboard\",\n        \"analytics\",\n        \"export\",\n        \"csv\",\n        \"excel\",\n        \"chart\"\n    ],\n    \"access_permissions\": [\n        \"access\",\n        \"permission\",\n        \"login\",\n        \"password\",\n        \"locked out\",\n        \"authentication\",\n        \"authorization\"\n    ],\n    \"configuration_problems\": [\n        \"configuration\",\n        \"settings\",\n        \"setup\",\n        \"config\",\n        \"preferences\"\n    ],\n    \"notification_issues\": [\n        \"notification\",\n        \"email\",\n        \"alert\",\n        \"reminder\",\n        \"message\"\n    ],\n    \"workflow_inefficiency\": [\n        \"workflow\",\n        \"process\",\n        \"manual\",\n        \"tedious\",\n        \"time consuming\",\n        \"inefficient\"\n    ],\n    \"mobile_issues\": [\n        \"mobile\",\n        \"app\",\n        \"ios\",\n        \"android\",\n        \"phone\",\n        \"tablet\",\n        \"responsive\"\n    ]\n};\nasync function POST(request) {\n    try {\n        const supabase = (0,_supabase_auth_helpers_nextjs__WEBPACK_IMPORTED_MODULE_1__.createRouteHandlerClient)({\n            cookies: next_headers__WEBPACK_IMPORTED_MODULE_2__.cookies\n        });\n        const { data: { user } } = await supabase.auth.getUser();\n        if (!user) {\n            return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                error: \"Not authenticated\"\n            }, {\n                status: 401\n            });\n        }\n        // Get Jira integration\n        const { data: integration } = await supabase.from(\"integrations\").select(\"*\").eq(\"user_id\", user.id).eq(\"integration_type\", \"jira\").eq(\"status\", \"active\").single();\n        if (!integration) {\n            return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                error: \"Jira not connected\"\n            }, {\n                status: 400\n            });\n        }\n        // Get API token\n        const supabaseAdmin = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_4__.createClient)(\"https://skoknvludvonitgekwno.supabase.co\", process.env.SUPABASE_SERVICE_ROLE_KEY, {\n            auth: {\n                autoRefreshToken: false,\n                persistSession: false\n            }\n        });\n        // Retrieve and decrypt API token\n        let tokens;\n        try {\n            tokens = await (0,_lib_encryption__WEBPACK_IMPORTED_MODULE_3__.getDecryptedToken)(supabaseAdmin, integration.id);\n        } catch (error) {\n            console.error(\"Failed to decrypt Jira token:\", error);\n            return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                error: \"Failed to access credentials\",\n                details: \"Please reconnect Jira\"\n            }, {\n                status: 500\n            });\n        }\n        if (!tokens) {\n            return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                error: \"No API token found. Please reconnect Jira.\"\n            }, {\n                status: 400\n            });\n        }\n        const email = integration.metadata?.email;\n        const authHeader = `Basic ${Buffer.from(`${email}:${tokens.access_token}`).toString(\"base64\")}`;\n        // Fetch ALL issues from Jira (last 90 days, updated recently) with pagination\n        const jql = `updated >= -90d ORDER BY updated DESC`;\n        const maxResults = 100; // Jira's max per request\n        let startAt = 0;\n        let allIssues = [];\n        let totalIssues = 0;\n        console.log(`Fetching Jira issues with JQL: ${jql}`);\n        // Paginate through all results\n        do {\n            const jiraResponse = await fetch(`${integration.instance_url}/rest/api/3/search/jql?jql=${encodeURIComponent(jql)}&startAt=${startAt}&maxResults=${maxResults}&fields=summary,description,status,priority,assignee,labels,created,updated,resolutiondate,comment,sprint`, {\n                headers: {\n                    \"Authorization\": authHeader,\n                    \"Accept\": \"application/json\"\n                }\n            });\n            if (!jiraResponse.ok) {\n                const errorText = await jiraResponse.text();\n                console.error(\"Jira API error:\", errorText);\n                return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                    error: \"Failed to fetch issues from Jira\",\n                    details: errorText\n                }, {\n                    status: 500\n                });\n            }\n            const jiraData = await jiraResponse.json();\n            totalIssues = jiraData.total || 0;\n            if (jiraData.issues && jiraData.issues.length > 0) {\n                allIssues = allIssues.concat(jiraData.issues);\n                console.log(`Fetched ${allIssues.length} of ${totalIssues} total Jira issues`);\n            }\n            startAt += maxResults;\n        // Continue if there are more results\n        }while (allIssues.length < totalIssues);\n        console.log(`Finished fetching ${allIssues.length} Jira issues`);\n        if (allIssues.length === 0) {\n            return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                success: true,\n                synced: 0,\n                links_created: 0,\n                message: \"No Jira issues found in the last 90 days\"\n            });\n        }\n        // Transform and store Jira issues\n        const jiraIssues = allIssues.map((issue)=>({\n                user_id: user.id,\n                integration_id: integration.id,\n                jira_id: issue.id,\n                jira_key: issue.key,\n                summary: issue.fields.summary,\n                description: issue.fields.description || \"\",\n                status: issue.fields.status?.name || \"Unknown\",\n                priority: issue.fields.priority?.name || null,\n                assignee_name: issue.fields.assignee?.displayName || null,\n                assignee_email: issue.fields.assignee?.emailAddress || null,\n                sprint_name: issue.fields.sprint?.name || null,\n                labels: issue.fields.labels || [],\n                created_date: issue.fields.created,\n                updated_date: issue.fields.updated,\n                resolution_date: issue.fields.resolutiondate || null,\n                issue_url: `${integration.instance_url}/browse/${issue.key}`,\n                metadata: {\n                    comment_count: issue.fields.comment?.total || 0,\n                    issue_type: issue.fields.issuetype?.name || \"Unknown\"\n                },\n                last_synced_at: new Date().toISOString()\n            }));\n        // Upsert issues\n        const { data: insertedIssues, error: insertError } = await supabase.from(\"jira_issues\").upsert(jiraIssues, {\n            onConflict: \"user_id,jira_key\",\n            ignoreDuplicates: false\n        }).select();\n        if (insertError) {\n            console.error(\"Insert error:\", insertError);\n            return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                error: \"Failed to store Jira issues\",\n                details: insertError.message\n            }, {\n                status: 500\n            });\n        }\n        console.log(`Stored ${insertedIssues?.length || 0} Jira issues`);\n        // Create theme links using keyword matching\n        let linksCreated = 0;\n        for (const issue of insertedIssues || []){\n            const linkedThemes = await linkIssueToThemes(supabase, user.id, issue);\n            linksCreated += linkedThemes.length;\n        }\n        // Update integration last_synced_at\n        await supabase.from(\"integrations\").update({\n            last_synced_at: new Date().toISOString()\n        }).eq(\"id\", integration.id);\n        console.log(`Sync complete: ${insertedIssues?.length} issues, ${linksCreated} theme links created`);\n        return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n            success: true,\n            synced: insertedIssues?.length || 0,\n            total_available: totalIssues,\n            links_created: linksCreated,\n            message: `Synced ${insertedIssues?.length} of ${totalIssues} total issues available`\n        });\n    } catch (error) {\n        console.error(\"Jira sync error:\", error);\n        return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n            error: \"Jira sync failed\",\n            details: error instanceof Error ? error.message : \"Unknown\"\n        }, {\n            status: 500\n        });\n    }\n}\n// Helper: Link a Jira issue to friction themes\nasync function linkIssueToThemes(supabase, userId, issue) {\n    const linkedThemes = [];\n    const searchText = `${issue.summary} ${issue.description || \"\"}`.toLowerCase();\n    // Strategy 1: Label-based matching (highest confidence)\n    for (const label of issue.labels || []){\n        const labelLower = label.toLowerCase().replace(/[_-\\s]/g, \"_\");\n        // Check if label matches a theme key exactly\n        if (THEME_KEYWORDS[labelLower]) {\n            await createThemeLink(supabase, userId, issue.id, labelLower, \"label\", 1.0);\n            linkedThemes.push(labelLower);\n        }\n    }\n    // Strategy 2: Keyword-based matching (medium confidence)\n    for (const [themeKey, keywords] of Object.entries(THEME_KEYWORDS)){\n        // Skip if already linked via label\n        if (linkedThemes.includes(themeKey)) continue;\n        // Count keyword matches\n        const matchCount = keywords.filter((keyword)=>searchText.includes(keyword.toLowerCase())).length;\n        if (matchCount >= 2) {\n            // At least 2 keywords match → high confidence\n            await createThemeLink(supabase, userId, issue.id, themeKey, \"keyword\", 0.8);\n            linkedThemes.push(themeKey);\n        } else if (matchCount === 1) {\n            // 1 keyword match → medium confidence\n            await createThemeLink(supabase, userId, issue.id, themeKey, \"keyword\", 0.5);\n            linkedThemes.push(themeKey);\n        }\n    }\n    return linkedThemes;\n}\n// Helper: Create theme-jira link\nasync function createThemeLink(supabase, userId, jiraIssueId, themeKey, matchType, confidence) {\n    try {\n        await supabase.from(\"theme_jira_links\").upsert({\n            user_id: userId,\n            jira_issue_id: jiraIssueId,\n            theme_key: themeKey,\n            match_type: matchType,\n            match_confidence: confidence\n        }, {\n            onConflict: \"jira_issue_id,theme_key\",\n            ignoreDuplicates: true\n        });\n    } catch (error) {\n        console.error(`Failed to create theme link for ${themeKey}:`, error);\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9hcHAvYXBpL2ppcmEvc3luYy9yb3V0ZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQUF3RDtBQUNpQjtBQUNwQjtBQUNkO0FBQ2M7QUFFOUMsTUFBTUssY0FBYyxHQUFHO0FBRTlCLGlEQUFpRDtBQUNqRCxNQUFNQyxpQkFBMkM7SUFDL0MscUJBQXFCO1FBQUM7UUFBVztRQUFXO1FBQVc7UUFBVTtRQUFnQjtRQUFXO1FBQVU7S0FBUztJQUMvRyx3QkFBd0I7UUFBQztRQUFlO1FBQU87UUFBUTtRQUFjO1FBQVc7UUFBVTtRQUFVO0tBQVk7SUFDaEgsZ0JBQWdCO1FBQUM7UUFBTTtRQUFhO1FBQWE7UUFBVztRQUFnQjtRQUFjO1FBQWE7S0FBSztJQUM1RyxzQkFBc0I7UUFBQztRQUFRO1FBQWU7UUFBVztRQUFXO1FBQU87UUFBUztRQUFXO0tBQVM7SUFDeEcsb0JBQW9CO1FBQUM7UUFBbUI7UUFBVztRQUFPO1FBQWU7UUFBYztLQUFnQjtJQUN2RyxpQkFBaUI7UUFBQztRQUFZO1FBQVU7UUFBWTtRQUFpQjtRQUFRO1FBQVM7S0FBUTtJQUM5Rix5QkFBeUI7UUFBQztRQUFXO1FBQVk7UUFBVztRQUFXO1FBQVU7S0FBVztJQUM1RixnQkFBZ0I7UUFBQztRQUFRO1FBQWE7UUFBVztRQUFTO1FBQWM7UUFBVztLQUFlO0lBQ2xHLG9CQUFvQjtRQUFDO1FBQVU7UUFBYTtRQUFhO1FBQVU7UUFBTztRQUFTO0tBQVE7SUFDM0Ysc0JBQXNCO1FBQUM7UUFBVTtRQUFjO1FBQVM7UUFBWTtRQUFjO1FBQWtCO0tBQWdCO0lBQ3BILDBCQUEwQjtRQUFDO1FBQWlCO1FBQVk7UUFBUztRQUFVO0tBQWM7SUFDekYsdUJBQXVCO1FBQUM7UUFBZ0I7UUFBUztRQUFTO1FBQVk7S0FBVTtJQUNoRix5QkFBeUI7UUFBQztRQUFZO1FBQVc7UUFBVTtRQUFXO1FBQWtCO0tBQWM7SUFDdEcsaUJBQWlCO1FBQUM7UUFBVTtRQUFPO1FBQU87UUFBVztRQUFTO1FBQVU7S0FBYTtBQUN2RjtBQUVPLGVBQWVDLEtBQUtDLE9BQW9CO0lBQzdDLElBQUk7UUFDRixNQUFNQyxXQUFXUix1RkFBd0JBLENBQUM7WUFBRUUsT0FBT0EsbURBQUFBO1FBQUM7UUFFcEQsTUFBTSxFQUFFTyxNQUFNLEVBQUVDLElBQUksRUFBRSxFQUFFLEdBQUcsTUFBTUYsU0FBU0csSUFBSSxDQUFDQyxPQUFPO1FBQ3RELElBQUksQ0FBQ0YsTUFBTTtZQUNULE9BQU9YLGtGQUFZQSxDQUFDYyxJQUFJLENBQUM7Z0JBQUVDLE9BQU87WUFBb0IsR0FBRztnQkFBRUMsUUFBUTtZQUFJO1FBQ3pFO1FBRUEsdUJBQXVCO1FBQ3ZCLE1BQU0sRUFBRU4sTUFBTU8sV0FBVyxFQUFFLEdBQUcsTUFBTVIsU0FDakNTLElBQUksQ0FBQyxnQkFDTEMsTUFBTSxDQUFDLEtBQ1BDLEVBQUUsQ0FBQyxXQUFXVCxLQUFLVSxFQUFFLEVBQ3JCRCxFQUFFLENBQUMsb0JBQW9CLFFBQ3ZCQSxFQUFFLENBQUMsVUFBVSxVQUNiRSxNQUFNO1FBRVQsSUFBSSxDQUFDTCxhQUFhO1lBQ2hCLE9BQU9qQixrRkFBWUEsQ0FBQ2MsSUFBSSxDQUFDO2dCQUFFQyxPQUFPO1lBQXFCLEdBQUc7Z0JBQUVDLFFBQVE7WUFBSTtRQUMxRTtRQUVBLGdCQUFnQjtRQUNoQixNQUFNTyxnQkFBZ0JyQixtRUFBWUEsQ0FDaENzQiwwQ0FBb0MsRUFDcENBLFFBQVFDLEdBQUcsQ0FBQ0UseUJBQXlCLEVBQ3JDO1lBQ0VmLE1BQU07Z0JBQ0pnQixrQkFBa0I7Z0JBQ2xCQyxnQkFBZ0I7WUFDbEI7UUFDRjtRQUdGLGlDQUFpQztRQUNqQyxJQUFJQztRQUNKLElBQUk7WUFDRkEsU0FBUyxNQUFNMUIsa0VBQWlCQSxDQUFDbUIsZUFBZU4sWUFBWUksRUFBRTtRQUNoRSxFQUFFLE9BQU9OLE9BQU87WUFDZGdCLFFBQVFoQixLQUFLLENBQUMsaUNBQWlDQTtZQUMvQyxPQUFPZixrRkFBWUEsQ0FBQ2MsSUFBSSxDQUFDO2dCQUN2QkMsT0FBTztnQkFDUGlCLFNBQVM7WUFDWCxHQUFHO2dCQUFFaEIsUUFBUTtZQUFJO1FBQ25CO1FBRUEsSUFBSSxDQUFDYyxRQUFRO1lBQ1gsT0FBTzlCLGtGQUFZQSxDQUFDYyxJQUFJLENBQUM7Z0JBQUVDLE9BQU87WUFBNkMsR0FBRztnQkFBRUMsUUFBUTtZQUFJO1FBQ2xHO1FBRUEsTUFBTWlCLFFBQVFoQixZQUFZaUIsUUFBUSxFQUFFRDtRQUNwQyxNQUFNRSxhQUFhLENBQUMsTUFBTSxFQUFFQyxPQUFPbEIsSUFBSSxDQUFDLENBQUMsRUFBRWUsTUFBTSxDQUFDLEVBQUVILE9BQU9PLFlBQVksQ0FBQyxDQUFDLEVBQUVDLFFBQVEsQ0FBQyxVQUFVLENBQUM7UUFFL0YsOEVBQThFO1FBQzlFLE1BQU1DLE1BQU0sQ0FBQyxxQ0FBcUMsQ0FBQztRQUNuRCxNQUFNQyxhQUFhLEtBQUsseUJBQXlCO1FBQ2pELElBQUlDLFVBQVU7UUFDZCxJQUFJQyxZQUFtQixFQUFFO1FBQ3pCLElBQUlDLGNBQWM7UUFFbEJaLFFBQVFhLEdBQUcsQ0FBQyxDQUFDLCtCQUErQixFQUFFTCxJQUFJLENBQUM7UUFFbkQsK0JBQStCO1FBQy9CLEdBQUc7WUFDRCxNQUFNTSxlQUFlLE1BQU1DLE1BQ3pCLENBQUMsRUFBRTdCLFlBQVk4QixZQUFZLENBQUMsMkJBQTJCLEVBQUVDLG1CQUFtQlQsS0FBSyxTQUFTLEVBQUVFLFFBQVEsWUFBWSxFQUFFRCxXQUFXLHlHQUF5RyxDQUFDLEVBQ3ZPO2dCQUNFUyxTQUFTO29CQUNQLGlCQUFpQmQ7b0JBQ2pCLFVBQVU7Z0JBQ1o7WUFDRjtZQUdGLElBQUksQ0FBQ1UsYUFBYUssRUFBRSxFQUFFO2dCQUNwQixNQUFNQyxZQUFZLE1BQU1OLGFBQWFPLElBQUk7Z0JBQ3pDckIsUUFBUWhCLEtBQUssQ0FBQyxtQkFBbUJvQztnQkFDakMsT0FBT25ELGtGQUFZQSxDQUFDYyxJQUFJLENBQUM7b0JBQ3ZCQyxPQUFPO29CQUNQaUIsU0FBU21CO2dCQUNYLEdBQUc7b0JBQUVuQyxRQUFRO2dCQUFJO1lBQ25CO1lBRUEsTUFBTXFDLFdBQVcsTUFBTVIsYUFBYS9CLElBQUk7WUFDeEM2QixjQUFjVSxTQUFTQyxLQUFLLElBQUk7WUFFaEMsSUFBSUQsU0FBU0UsTUFBTSxJQUFJRixTQUFTRSxNQUFNLENBQUNDLE1BQU0sR0FBRyxHQUFHO2dCQUNqRGQsWUFBWUEsVUFBVWUsTUFBTSxDQUFDSixTQUFTRSxNQUFNO2dCQUM1Q3hCLFFBQVFhLEdBQUcsQ0FBQyxDQUFDLFFBQVEsRUFBRUYsVUFBVWMsTUFBTSxDQUFDLElBQUksRUFBRWIsWUFBWSxrQkFBa0IsQ0FBQztZQUMvRTtZQUVBRixXQUFXRDtRQUVYLHFDQUFxQztRQUN2QyxRQUFTRSxVQUFVYyxNQUFNLEdBQUdiLGFBQWE7UUFFekNaLFFBQVFhLEdBQUcsQ0FBQyxDQUFDLGtCQUFrQixFQUFFRixVQUFVYyxNQUFNLENBQUMsWUFBWSxDQUFDO1FBRS9ELElBQUlkLFVBQVVjLE1BQU0sS0FBSyxHQUFHO1lBQzFCLE9BQU94RCxrRkFBWUEsQ0FBQ2MsSUFBSSxDQUFDO2dCQUN2QjRDLFNBQVM7Z0JBQ1RDLFFBQVE7Z0JBQ1JDLGVBQWU7Z0JBQ2ZDLFNBQVM7WUFDWDtRQUNGO1FBRUEsa0NBQWtDO1FBQ2xDLE1BQU1DLGFBQWFwQixVQUFVcUIsR0FBRyxDQUFDLENBQUNDLFFBQWdCO2dCQUNoREMsU0FBU3RELEtBQUtVLEVBQUU7Z0JBQ2hCNkMsZ0JBQWdCakQsWUFBWUksRUFBRTtnQkFDOUI4QyxTQUFTSCxNQUFNM0MsRUFBRTtnQkFDakIrQyxVQUFVSixNQUFNSyxHQUFHO2dCQUNuQkMsU0FBU04sTUFBTU8sTUFBTSxDQUFDRCxPQUFPO2dCQUM3QkUsYUFBYVIsTUFBTU8sTUFBTSxDQUFDQyxXQUFXLElBQUk7Z0JBQ3pDeEQsUUFBUWdELE1BQU1PLE1BQU0sQ0FBQ3ZELE1BQU0sRUFBRXlELFFBQVE7Z0JBQ3JDQyxVQUFVVixNQUFNTyxNQUFNLENBQUNHLFFBQVEsRUFBRUQsUUFBUTtnQkFDekNFLGVBQWVYLE1BQU1PLE1BQU0sQ0FBQ0ssUUFBUSxFQUFFQyxlQUFlO2dCQUNyREMsZ0JBQWdCZCxNQUFNTyxNQUFNLENBQUNLLFFBQVEsRUFBRUcsZ0JBQWdCO2dCQUN2REMsYUFBYWhCLE1BQU1PLE1BQU0sQ0FBQ1UsTUFBTSxFQUFFUixRQUFRO2dCQUMxQ1MsUUFBUWxCLE1BQU1PLE1BQU0sQ0FBQ1csTUFBTSxJQUFJLEVBQUU7Z0JBQ2pDQyxjQUFjbkIsTUFBTU8sTUFBTSxDQUFDYSxPQUFPO2dCQUNsQ0MsY0FBY3JCLE1BQU1PLE1BQU0sQ0FBQ2UsT0FBTztnQkFDbENDLGlCQUFpQnZCLE1BQU1PLE1BQU0sQ0FBQ2lCLGNBQWMsSUFBSTtnQkFDaERDLFdBQVcsQ0FBQyxFQUFFeEUsWUFBWThCLFlBQVksQ0FBQyxRQUFRLEVBQUVpQixNQUFNSyxHQUFHLENBQUMsQ0FBQztnQkFDNURuQyxVQUFVO29CQUNSd0QsZUFBZTFCLE1BQU1PLE1BQU0sQ0FBQ29CLE9BQU8sRUFBRXJDLFNBQVM7b0JBQzlDc0MsWUFBWTVCLE1BQU1PLE1BQU0sQ0FBQ3NCLFNBQVMsRUFBRXBCLFFBQVE7Z0JBQzlDO2dCQUNBcUIsZ0JBQWdCLElBQUlDLE9BQU9DLFdBQVc7WUFDeEM7UUFFQSxnQkFBZ0I7UUFDaEIsTUFBTSxFQUFFdEYsTUFBTXVGLGNBQWMsRUFBRWxGLE9BQU9tRixXQUFXLEVBQUUsR0FBRyxNQUFNekYsU0FDeERTLElBQUksQ0FBQyxlQUNMaUYsTUFBTSxDQUFDckMsWUFBWTtZQUNsQnNDLFlBQVk7WUFDWkMsa0JBQWtCO1FBQ3BCLEdBQ0NsRixNQUFNO1FBRVQsSUFBSStFLGFBQWE7WUFDZm5FLFFBQVFoQixLQUFLLENBQUMsaUJBQWlCbUY7WUFDL0IsT0FBT2xHLGtGQUFZQSxDQUFDYyxJQUFJLENBQUM7Z0JBQ3ZCQyxPQUFPO2dCQUNQaUIsU0FBU2tFLFlBQVlyQyxPQUFPO1lBQzlCLEdBQUc7Z0JBQUU3QyxRQUFRO1lBQUk7UUFDbkI7UUFFQWUsUUFBUWEsR0FBRyxDQUFDLENBQUMsT0FBTyxFQUFFcUQsZ0JBQWdCekMsVUFBVSxFQUFFLFlBQVksQ0FBQztRQUUvRCw0Q0FBNEM7UUFDNUMsSUFBSThDLGVBQWU7UUFFbkIsS0FBSyxNQUFNdEMsU0FBU2lDLGtCQUFrQixFQUFFLENBQUU7WUFDeEMsTUFBTU0sZUFBZSxNQUFNQyxrQkFBa0IvRixVQUFVRSxLQUFLVSxFQUFFLEVBQUUyQztZQUNoRXNDLGdCQUFnQkMsYUFBYS9DLE1BQU07UUFDckM7UUFFQSxvQ0FBb0M7UUFDcEMsTUFBTS9DLFNBQ0hTLElBQUksQ0FBQyxnQkFDTHVGLE1BQU0sQ0FBQztZQUFFWCxnQkFBZ0IsSUFBSUMsT0FBT0MsV0FBVztRQUFHLEdBQ2xENUUsRUFBRSxDQUFDLE1BQU1ILFlBQVlJLEVBQUU7UUFFMUJVLFFBQVFhLEdBQUcsQ0FBQyxDQUFDLGVBQWUsRUFBRXFELGdCQUFnQnpDLE9BQU8sU0FBUyxFQUFFOEMsYUFBYSxvQkFBb0IsQ0FBQztRQUVsRyxPQUFPdEcsa0ZBQVlBLENBQUNjLElBQUksQ0FBQztZQUN2QjRDLFNBQVM7WUFDVEMsUUFBUXNDLGdCQUFnQnpDLFVBQVU7WUFDbENrRCxpQkFBaUIvRDtZQUNqQmlCLGVBQWUwQztZQUNmekMsU0FBUyxDQUFDLE9BQU8sRUFBRW9DLGdCQUFnQnpDLE9BQU8sSUFBSSxFQUFFYixZQUFZLHVCQUF1QixDQUFDO1FBQ3RGO0lBRUYsRUFBRSxPQUFPNUIsT0FBTztRQUNkZ0IsUUFBUWhCLEtBQUssQ0FBQyxvQkFBb0JBO1FBQ2xDLE9BQU9mLGtGQUFZQSxDQUFDYyxJQUFJLENBQUM7WUFDdkJDLE9BQU87WUFDUGlCLFNBQVNqQixpQkFBaUI0RixRQUFRNUYsTUFBTThDLE9BQU8sR0FBRztRQUNwRCxHQUFHO1lBQUU3QyxRQUFRO1FBQUk7SUFDbkI7QUFDRjtBQUVBLCtDQUErQztBQUMvQyxlQUFld0Ysa0JBQWtCL0YsUUFBYSxFQUFFbUcsTUFBYyxFQUFFNUMsS0FBVTtJQUN4RSxNQUFNdUMsZUFBeUIsRUFBRTtJQUNqQyxNQUFNTSxhQUFhLENBQUMsRUFBRTdDLE1BQU1NLE9BQU8sQ0FBQyxDQUFDLEVBQUVOLE1BQU1RLFdBQVcsSUFBSSxHQUFHLENBQUMsQ0FBQ3NDLFdBQVc7SUFFNUUsd0RBQXdEO0lBQ3hELEtBQUssTUFBTUMsU0FBUy9DLE1BQU1rQixNQUFNLElBQUksRUFBRSxDQUFFO1FBQ3RDLE1BQU04QixhQUFhRCxNQUFNRCxXQUFXLEdBQUdHLE9BQU8sQ0FBQyxXQUFXO1FBRTFELDZDQUE2QztRQUM3QyxJQUFJM0csY0FBYyxDQUFDMEcsV0FBVyxFQUFFO1lBQzlCLE1BQU1FLGdCQUFnQnpHLFVBQVVtRyxRQUFRNUMsTUFBTTNDLEVBQUUsRUFBRTJGLFlBQVksU0FBUztZQUN2RVQsYUFBYVksSUFBSSxDQUFDSDtRQUNwQjtJQUNGO0lBRUEseURBQXlEO0lBQ3pELEtBQUssTUFBTSxDQUFDSSxVQUFVQyxTQUFTLElBQUlDLE9BQU9DLE9BQU8sQ0FBQ2pILGdCQUFpQjtRQUNqRSxtQ0FBbUM7UUFDbkMsSUFBSWlHLGFBQWFpQixRQUFRLENBQUNKLFdBQVc7UUFFckMsd0JBQXdCO1FBQ3hCLE1BQU1LLGFBQWFKLFNBQVNLLE1BQU0sQ0FBQ0MsQ0FBQUEsVUFDakNkLFdBQVdXLFFBQVEsQ0FBQ0csUUFBUWIsV0FBVyxLQUN2Q3RELE1BQU07UUFFUixJQUFJaUUsY0FBYyxHQUFHO1lBQ25CLDhDQUE4QztZQUM5QyxNQUFNUCxnQkFBZ0J6RyxVQUFVbUcsUUFBUTVDLE1BQU0zQyxFQUFFLEVBQUUrRixVQUFVLFdBQVc7WUFDdkViLGFBQWFZLElBQUksQ0FBQ0M7UUFDcEIsT0FBTyxJQUFJSyxlQUFlLEdBQUc7WUFDM0Isc0NBQXNDO1lBQ3RDLE1BQU1QLGdCQUFnQnpHLFVBQVVtRyxRQUFRNUMsTUFBTTNDLEVBQUUsRUFBRStGLFVBQVUsV0FBVztZQUN2RWIsYUFBYVksSUFBSSxDQUFDQztRQUNwQjtJQUNGO0lBRUEsT0FBT2I7QUFDVDtBQUVBLGlDQUFpQztBQUNqQyxlQUFlVyxnQkFDYnpHLFFBQWEsRUFDYm1HLE1BQWMsRUFDZGdCLFdBQW1CLEVBQ25CUixRQUFnQixFQUNoQlMsU0FBOEIsRUFDOUJDLFVBQWtCO0lBRWxCLElBQUk7UUFDRixNQUFNckgsU0FDSFMsSUFBSSxDQUFDLG9CQUNMaUYsTUFBTSxDQUFDO1lBQ05sQyxTQUFTMkM7WUFDVG1CLGVBQWVIO1lBQ2ZJLFdBQVdaO1lBQ1hhLFlBQVlKO1lBQ1pLLGtCQUFrQko7UUFDcEIsR0FBRztZQUNEMUIsWUFBWTtZQUNaQyxrQkFBa0I7UUFDcEI7SUFDSixFQUFFLE9BQU90RixPQUFPO1FBQ2RnQixRQUFRaEIsS0FBSyxDQUFDLENBQUMsZ0NBQWdDLEVBQUVxRyxTQUFTLENBQUMsQ0FBQyxFQUFFckc7SUFDaEU7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL2ZyaWN0aW9uLWludGVsbGlnZW5jZS8uL2FwcC9hcGkvamlyYS9zeW5jL3JvdXRlLnRzP2IzZjEiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmV4dFJlcXVlc3QsIE5leHRSZXNwb25zZSB9IGZyb20gJ25leHQvc2VydmVyJztcbmltcG9ydCB7IGNyZWF0ZVJvdXRlSGFuZGxlckNsaWVudCB9IGZyb20gJ0BzdXBhYmFzZS9hdXRoLWhlbHBlcnMtbmV4dGpzJztcbmltcG9ydCB7IGNyZWF0ZUNsaWVudCB9IGZyb20gJ0BzdXBhYmFzZS9zdXBhYmFzZS1qcyc7XG5pbXBvcnQgeyBjb29raWVzIH0gZnJvbSAnbmV4dC9oZWFkZXJzJztcbmltcG9ydCB7IGdldERlY3J5cHRlZFRva2VuIH0gZnJvbSAnQC9saWIvZW5jcnlwdGlvbic7XG5cbmV4cG9ydCBjb25zdCBtYXhEdXJhdGlvbiA9IDYwO1xuXG4vLyBUaGVtZSBrZXl3b3JkIG1hcHBpbmcgZm9yIGludGVsbGlnZW50IG1hdGNoaW5nXG5jb25zdCBUSEVNRV9LRVlXT1JEUzogUmVjb3JkPHN0cmluZywgc3RyaW5nW10+ID0ge1xuICAnYmlsbGluZ19jb25mdXNpb24nOiBbJ2JpbGxpbmcnLCAnaW52b2ljZScsICdwYXltZW50JywgJ2NoYXJnZScsICdzdWJzY3JpcHRpb24nLCAncHJpY2luZycsICdyZWZ1bmQnLCAnY3JlZGl0J10sXG4gICdpbnRlZ3JhdGlvbl9mYWlsdXJlcyc6IFsnaW50ZWdyYXRpb24nLCAnYXBpJywgJ3N5bmMnLCAnY29ubmVjdGlvbicsICd3ZWJob29rJywgJ2ltcG9ydCcsICdleHBvcnQnLCAnY29ubmVjdG9yJ10sXG4gICd1aV9jb25mdXNpb24nOiBbJ3VpJywgJ2ludGVyZmFjZScsICdjb25mdXNpbmcnLCAndW5jbGVhcicsICdoYXJkIHRvIGZpbmQnLCAnbmF2aWdhdGlvbicsICd1c2FiaWxpdHknLCAndXgnXSxcbiAgJ3BlcmZvcm1hbmNlX2lzc3Vlcyc6IFsnc2xvdycsICdwZXJmb3JtYW5jZScsICdsb2FkaW5nJywgJ3RpbWVvdXQnLCAnbGFnJywgJ3NwZWVkJywgJ2hhbmdpbmcnLCAnZnJlZXplJ10sXG4gICdtaXNzaW5nX2ZlYXR1cmVzJzogWydmZWF0dXJlIHJlcXVlc3QnLCAnbWlzc2luZycsICdhZGQnLCAnZW5oYW5jZW1lbnQnLCAnY2FwYWJpbGl0eScsICdmdW5jdGlvbmFsaXR5J10sXG4gICd0cmFpbmluZ19nYXBzJzogWyd0cmFpbmluZycsICdob3cgdG8nLCAndHV0b3JpYWwnLCAnZG9jdW1lbnRhdGlvbicsICdoZWxwJywgJ2d1aWRlJywgJ2xlYXJuJ10sXG4gICdzdXBwb3J0X3Jlc3BvbnNlX3RpbWUnOiBbJ3N1cHBvcnQnLCAncmVzcG9uc2UnLCAnd2FpdGluZycsICdkZWxheWVkJywgJ3RpY2tldCcsICdubyByZXBseSddLFxuICAnZGF0YV9xdWFsaXR5JzogWydkYXRhJywgJ2luY29ycmVjdCcsICdtaXNzaW5nJywgJ3dyb25nJywgJ2luYWNjdXJhdGUnLCAnY29ycnVwdCcsICdpbmNvbnNpc3RlbnQnXSxcbiAgJ3JlcG9ydGluZ19pc3N1ZXMnOiBbJ3JlcG9ydCcsICdkYXNoYm9hcmQnLCAnYW5hbHl0aWNzJywgJ2V4cG9ydCcsICdjc3YnLCAnZXhjZWwnLCAnY2hhcnQnXSxcbiAgJ2FjY2Vzc19wZXJtaXNzaW9ucyc6IFsnYWNjZXNzJywgJ3Blcm1pc3Npb24nLCAnbG9naW4nLCAncGFzc3dvcmQnLCAnbG9ja2VkIG91dCcsICdhdXRoZW50aWNhdGlvbicsICdhdXRob3JpemF0aW9uJ10sXG4gICdjb25maWd1cmF0aW9uX3Byb2JsZW1zJzogWydjb25maWd1cmF0aW9uJywgJ3NldHRpbmdzJywgJ3NldHVwJywgJ2NvbmZpZycsICdwcmVmZXJlbmNlcyddLFxuICAnbm90aWZpY2F0aW9uX2lzc3Vlcyc6IFsnbm90aWZpY2F0aW9uJywgJ2VtYWlsJywgJ2FsZXJ0JywgJ3JlbWluZGVyJywgJ21lc3NhZ2UnXSxcbiAgJ3dvcmtmbG93X2luZWZmaWNpZW5jeSc6IFsnd29ya2Zsb3cnLCAncHJvY2VzcycsICdtYW51YWwnLCAndGVkaW91cycsICd0aW1lIGNvbnN1bWluZycsICdpbmVmZmljaWVudCddLFxuICAnbW9iaWxlX2lzc3Vlcyc6IFsnbW9iaWxlJywgJ2FwcCcsICdpb3MnLCAnYW5kcm9pZCcsICdwaG9uZScsICd0YWJsZXQnLCAncmVzcG9uc2l2ZSddLFxufTtcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIFBPU1QocmVxdWVzdDogTmV4dFJlcXVlc3QpIHtcbiAgdHJ5IHtcbiAgICBjb25zdCBzdXBhYmFzZSA9IGNyZWF0ZVJvdXRlSGFuZGxlckNsaWVudCh7IGNvb2tpZXMgfSk7XG5cbiAgICBjb25zdCB7IGRhdGE6IHsgdXNlciB9IH0gPSBhd2FpdCBzdXBhYmFzZS5hdXRoLmdldFVzZXIoKTtcbiAgICBpZiAoIXVzZXIpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiAnTm90IGF1dGhlbnRpY2F0ZWQnIH0sIHsgc3RhdHVzOiA0MDEgfSk7XG4gICAgfVxuXG4gICAgLy8gR2V0IEppcmEgaW50ZWdyYXRpb25cbiAgICBjb25zdCB7IGRhdGE6IGludGVncmF0aW9uIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgLmZyb20oJ2ludGVncmF0aW9ucycpXG4gICAgICAuc2VsZWN0KCcqJylcbiAgICAgIC5lcSgndXNlcl9pZCcsIHVzZXIuaWQpXG4gICAgICAuZXEoJ2ludGVncmF0aW9uX3R5cGUnLCAnamlyYScpXG4gICAgICAuZXEoJ3N0YXR1cycsICdhY3RpdmUnKVxuICAgICAgLnNpbmdsZSgpO1xuXG4gICAgaWYgKCFpbnRlZ3JhdGlvbikge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6ICdKaXJhIG5vdCBjb25uZWN0ZWQnIH0sIHsgc3RhdHVzOiA0MDAgfSk7XG4gICAgfVxuXG4gICAgLy8gR2V0IEFQSSB0b2tlblxuICAgIGNvbnN0IHN1cGFiYXNlQWRtaW4gPSBjcmVhdGVDbGllbnQoXG4gICAgICBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwhLFxuICAgICAgcHJvY2Vzcy5lbnYuU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWSEsXG4gICAgICB7XG4gICAgICAgIGF1dGg6IHtcbiAgICAgICAgICBhdXRvUmVmcmVzaFRva2VuOiBmYWxzZSxcbiAgICAgICAgICBwZXJzaXN0U2Vzc2lvbjogZmFsc2VcbiAgICAgICAgfVxuICAgICAgfVxuICAgICk7XG5cbiAgICAvLyBSZXRyaWV2ZSBhbmQgZGVjcnlwdCBBUEkgdG9rZW5cbiAgICBsZXQgdG9rZW5zO1xuICAgIHRyeSB7XG4gICAgICB0b2tlbnMgPSBhd2FpdCBnZXREZWNyeXB0ZWRUb2tlbihzdXBhYmFzZUFkbWluLCBpbnRlZ3JhdGlvbi5pZCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byBkZWNyeXB0IEppcmEgdG9rZW46JywgZXJyb3IpO1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgICAgZXJyb3I6ICdGYWlsZWQgdG8gYWNjZXNzIGNyZWRlbnRpYWxzJyxcbiAgICAgICAgZGV0YWlsczogJ1BsZWFzZSByZWNvbm5lY3QgSmlyYSdcbiAgICAgIH0sIHsgc3RhdHVzOiA1MDAgfSk7XG4gICAgfVxuXG4gICAgaWYgKCF0b2tlbnMpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiAnTm8gQVBJIHRva2VuIGZvdW5kLiBQbGVhc2UgcmVjb25uZWN0IEppcmEuJyB9LCB7IHN0YXR1czogNDAwIH0pO1xuICAgIH1cblxuICAgIGNvbnN0IGVtYWlsID0gaW50ZWdyYXRpb24ubWV0YWRhdGE/LmVtYWlsO1xuICAgIGNvbnN0IGF1dGhIZWFkZXIgPSBgQmFzaWMgJHtCdWZmZXIuZnJvbShgJHtlbWFpbH06JHt0b2tlbnMuYWNjZXNzX3Rva2VufWApLnRvU3RyaW5nKCdiYXNlNjQnKX1gO1xuXG4gICAgLy8gRmV0Y2ggQUxMIGlzc3VlcyBmcm9tIEppcmEgKGxhc3QgOTAgZGF5cywgdXBkYXRlZCByZWNlbnRseSkgd2l0aCBwYWdpbmF0aW9uXG4gICAgY29uc3QganFsID0gYHVwZGF0ZWQgPj0gLTkwZCBPUkRFUiBCWSB1cGRhdGVkIERFU0NgO1xuICAgIGNvbnN0IG1heFJlc3VsdHMgPSAxMDA7IC8vIEppcmEncyBtYXggcGVyIHJlcXVlc3RcbiAgICBsZXQgc3RhcnRBdCA9IDA7XG4gICAgbGV0IGFsbElzc3VlczogYW55W10gPSBbXTtcbiAgICBsZXQgdG90YWxJc3N1ZXMgPSAwO1xuXG4gICAgY29uc29sZS5sb2coYEZldGNoaW5nIEppcmEgaXNzdWVzIHdpdGggSlFMOiAke2pxbH1gKTtcblxuICAgIC8vIFBhZ2luYXRlIHRocm91Z2ggYWxsIHJlc3VsdHNcbiAgICBkbyB7XG4gICAgICBjb25zdCBqaXJhUmVzcG9uc2UgPSBhd2FpdCBmZXRjaChcbiAgICAgICAgYCR7aW50ZWdyYXRpb24uaW5zdGFuY2VfdXJsfS9yZXN0L2FwaS8zL3NlYXJjaC9qcWw/anFsPSR7ZW5jb2RlVVJJQ29tcG9uZW50KGpxbCl9JnN0YXJ0QXQ9JHtzdGFydEF0fSZtYXhSZXN1bHRzPSR7bWF4UmVzdWx0c30mZmllbGRzPXN1bW1hcnksZGVzY3JpcHRpb24sc3RhdHVzLHByaW9yaXR5LGFzc2lnbmVlLGxhYmVscyxjcmVhdGVkLHVwZGF0ZWQscmVzb2x1dGlvbmRhdGUsY29tbWVudCxzcHJpbnRgLFxuICAgICAgICB7XG4gICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgJ0F1dGhvcml6YXRpb24nOiBhdXRoSGVhZGVyLFxuICAgICAgICAgICAgJ0FjY2VwdCc6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgICAgICB9LFxuICAgICAgICB9XG4gICAgICApO1xuXG4gICAgICBpZiAoIWppcmFSZXNwb25zZS5vaykge1xuICAgICAgICBjb25zdCBlcnJvclRleHQgPSBhd2FpdCBqaXJhUmVzcG9uc2UudGV4dCgpO1xuICAgICAgICBjb25zb2xlLmVycm9yKCdKaXJhIEFQSSBlcnJvcjonLCBlcnJvclRleHQpO1xuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgICAgIGVycm9yOiAnRmFpbGVkIHRvIGZldGNoIGlzc3VlcyBmcm9tIEppcmEnLFxuICAgICAgICAgIGRldGFpbHM6IGVycm9yVGV4dFxuICAgICAgICB9LCB7IHN0YXR1czogNTAwIH0pO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBqaXJhRGF0YSA9IGF3YWl0IGppcmFSZXNwb25zZS5qc29uKCk7XG4gICAgICB0b3RhbElzc3VlcyA9IGppcmFEYXRhLnRvdGFsIHx8IDA7XG5cbiAgICAgIGlmIChqaXJhRGF0YS5pc3N1ZXMgJiYgamlyYURhdGEuaXNzdWVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgYWxsSXNzdWVzID0gYWxsSXNzdWVzLmNvbmNhdChqaXJhRGF0YS5pc3N1ZXMpO1xuICAgICAgICBjb25zb2xlLmxvZyhgRmV0Y2hlZCAke2FsbElzc3Vlcy5sZW5ndGh9IG9mICR7dG90YWxJc3N1ZXN9IHRvdGFsIEppcmEgaXNzdWVzYCk7XG4gICAgICB9XG5cbiAgICAgIHN0YXJ0QXQgKz0gbWF4UmVzdWx0cztcblxuICAgICAgLy8gQ29udGludWUgaWYgdGhlcmUgYXJlIG1vcmUgcmVzdWx0c1xuICAgIH0gd2hpbGUgKGFsbElzc3Vlcy5sZW5ndGggPCB0b3RhbElzc3Vlcyk7XG5cbiAgICBjb25zb2xlLmxvZyhgRmluaXNoZWQgZmV0Y2hpbmcgJHthbGxJc3N1ZXMubGVuZ3RofSBKaXJhIGlzc3Vlc2ApO1xuXG4gICAgaWYgKGFsbElzc3Vlcy5sZW5ndGggPT09IDApIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIHN5bmNlZDogMCxcbiAgICAgICAgbGlua3NfY3JlYXRlZDogMCxcbiAgICAgICAgbWVzc2FnZTogJ05vIEppcmEgaXNzdWVzIGZvdW5kIGluIHRoZSBsYXN0IDkwIGRheXMnLFxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gVHJhbnNmb3JtIGFuZCBzdG9yZSBKaXJhIGlzc3Vlc1xuICAgIGNvbnN0IGppcmFJc3N1ZXMgPSBhbGxJc3N1ZXMubWFwKChpc3N1ZTogYW55KSA9PiAoe1xuICAgICAgdXNlcl9pZDogdXNlci5pZCxcbiAgICAgIGludGVncmF0aW9uX2lkOiBpbnRlZ3JhdGlvbi5pZCxcbiAgICAgIGppcmFfaWQ6IGlzc3VlLmlkLFxuICAgICAgamlyYV9rZXk6IGlzc3VlLmtleSxcbiAgICAgIHN1bW1hcnk6IGlzc3VlLmZpZWxkcy5zdW1tYXJ5LFxuICAgICAgZGVzY3JpcHRpb246IGlzc3VlLmZpZWxkcy5kZXNjcmlwdGlvbiB8fCAnJyxcbiAgICAgIHN0YXR1czogaXNzdWUuZmllbGRzLnN0YXR1cz8ubmFtZSB8fCAnVW5rbm93bicsXG4gICAgICBwcmlvcml0eTogaXNzdWUuZmllbGRzLnByaW9yaXR5Py5uYW1lIHx8IG51bGwsXG4gICAgICBhc3NpZ25lZV9uYW1lOiBpc3N1ZS5maWVsZHMuYXNzaWduZWU/LmRpc3BsYXlOYW1lIHx8IG51bGwsXG4gICAgICBhc3NpZ25lZV9lbWFpbDogaXNzdWUuZmllbGRzLmFzc2lnbmVlPy5lbWFpbEFkZHJlc3MgfHwgbnVsbCxcbiAgICAgIHNwcmludF9uYW1lOiBpc3N1ZS5maWVsZHMuc3ByaW50Py5uYW1lIHx8IG51bGwsXG4gICAgICBsYWJlbHM6IGlzc3VlLmZpZWxkcy5sYWJlbHMgfHwgW10sXG4gICAgICBjcmVhdGVkX2RhdGU6IGlzc3VlLmZpZWxkcy5jcmVhdGVkLFxuICAgICAgdXBkYXRlZF9kYXRlOiBpc3N1ZS5maWVsZHMudXBkYXRlZCxcbiAgICAgIHJlc29sdXRpb25fZGF0ZTogaXNzdWUuZmllbGRzLnJlc29sdXRpb25kYXRlIHx8IG51bGwsXG4gICAgICBpc3N1ZV91cmw6IGAke2ludGVncmF0aW9uLmluc3RhbmNlX3VybH0vYnJvd3NlLyR7aXNzdWUua2V5fWAsXG4gICAgICBtZXRhZGF0YToge1xuICAgICAgICBjb21tZW50X2NvdW50OiBpc3N1ZS5maWVsZHMuY29tbWVudD8udG90YWwgfHwgMCxcbiAgICAgICAgaXNzdWVfdHlwZTogaXNzdWUuZmllbGRzLmlzc3VldHlwZT8ubmFtZSB8fCAnVW5rbm93bicsXG4gICAgICB9LFxuICAgICAgbGFzdF9zeW5jZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICB9KSk7XG5cbiAgICAvLyBVcHNlcnQgaXNzdWVzXG4gICAgY29uc3QgeyBkYXRhOiBpbnNlcnRlZElzc3VlcywgZXJyb3I6IGluc2VydEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgLmZyb20oJ2ppcmFfaXNzdWVzJylcbiAgICAgIC51cHNlcnQoamlyYUlzc3Vlcywge1xuICAgICAgICBvbkNvbmZsaWN0OiAndXNlcl9pZCxqaXJhX2tleScsXG4gICAgICAgIGlnbm9yZUR1cGxpY2F0ZXM6IGZhbHNlXG4gICAgICB9KVxuICAgICAgLnNlbGVjdCgpO1xuXG4gICAgaWYgKGluc2VydEVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdJbnNlcnQgZXJyb3I6JywgaW5zZXJ0RXJyb3IpO1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgICAgZXJyb3I6ICdGYWlsZWQgdG8gc3RvcmUgSmlyYSBpc3N1ZXMnLFxuICAgICAgICBkZXRhaWxzOiBpbnNlcnRFcnJvci5tZXNzYWdlXG4gICAgICB9LCB7IHN0YXR1czogNTAwIH0pO1xuICAgIH1cblxuICAgIGNvbnNvbGUubG9nKGBTdG9yZWQgJHtpbnNlcnRlZElzc3Vlcz8ubGVuZ3RoIHx8IDB9IEppcmEgaXNzdWVzYCk7XG5cbiAgICAvLyBDcmVhdGUgdGhlbWUgbGlua3MgdXNpbmcga2V5d29yZCBtYXRjaGluZ1xuICAgIGxldCBsaW5rc0NyZWF0ZWQgPSAwO1xuXG4gICAgZm9yIChjb25zdCBpc3N1ZSBvZiBpbnNlcnRlZElzc3VlcyB8fCBbXSkge1xuICAgICAgY29uc3QgbGlua2VkVGhlbWVzID0gYXdhaXQgbGlua0lzc3VlVG9UaGVtZXMoc3VwYWJhc2UsIHVzZXIuaWQsIGlzc3VlKTtcbiAgICAgIGxpbmtzQ3JlYXRlZCArPSBsaW5rZWRUaGVtZXMubGVuZ3RoO1xuICAgIH1cblxuICAgIC8vIFVwZGF0ZSBpbnRlZ3JhdGlvbiBsYXN0X3N5bmNlZF9hdFxuICAgIGF3YWl0IHN1cGFiYXNlXG4gICAgICAuZnJvbSgnaW50ZWdyYXRpb25zJylcbiAgICAgIC51cGRhdGUoeyBsYXN0X3N5bmNlZF9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpIH0pXG4gICAgICAuZXEoJ2lkJywgaW50ZWdyYXRpb24uaWQpO1xuXG4gICAgY29uc29sZS5sb2coYFN5bmMgY29tcGxldGU6ICR7aW5zZXJ0ZWRJc3N1ZXM/Lmxlbmd0aH0gaXNzdWVzLCAke2xpbmtzQ3JlYXRlZH0gdGhlbWUgbGlua3MgY3JlYXRlZGApO1xuXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICBzeW5jZWQ6IGluc2VydGVkSXNzdWVzPy5sZW5ndGggfHwgMCxcbiAgICAgIHRvdGFsX2F2YWlsYWJsZTogdG90YWxJc3N1ZXMsXG4gICAgICBsaW5rc19jcmVhdGVkOiBsaW5rc0NyZWF0ZWQsXG4gICAgICBtZXNzYWdlOiBgU3luY2VkICR7aW5zZXJ0ZWRJc3N1ZXM/Lmxlbmd0aH0gb2YgJHt0b3RhbElzc3Vlc30gdG90YWwgaXNzdWVzIGF2YWlsYWJsZWAsXG4gICAgfSk7XG5cbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdKaXJhIHN5bmMgZXJyb3I6JywgZXJyb3IpO1xuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICBlcnJvcjogJ0ppcmEgc3luYyBmYWlsZWQnLFxuICAgICAgZGV0YWlsczogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93bidcbiAgICB9LCB7IHN0YXR1czogNTAwIH0pO1xuICB9XG59XG5cbi8vIEhlbHBlcjogTGluayBhIEppcmEgaXNzdWUgdG8gZnJpY3Rpb24gdGhlbWVzXG5hc3luYyBmdW5jdGlvbiBsaW5rSXNzdWVUb1RoZW1lcyhzdXBhYmFzZTogYW55LCB1c2VySWQ6IHN0cmluZywgaXNzdWU6IGFueSk6IFByb21pc2U8c3RyaW5nW10+IHtcbiAgY29uc3QgbGlua2VkVGhlbWVzOiBzdHJpbmdbXSA9IFtdO1xuICBjb25zdCBzZWFyY2hUZXh0ID0gYCR7aXNzdWUuc3VtbWFyeX0gJHtpc3N1ZS5kZXNjcmlwdGlvbiB8fCAnJ31gLnRvTG93ZXJDYXNlKCk7XG5cbiAgLy8gU3RyYXRlZ3kgMTogTGFiZWwtYmFzZWQgbWF0Y2hpbmcgKGhpZ2hlc3QgY29uZmlkZW5jZSlcbiAgZm9yIChjb25zdCBsYWJlbCBvZiBpc3N1ZS5sYWJlbHMgfHwgW10pIHtcbiAgICBjb25zdCBsYWJlbExvd2VyID0gbGFiZWwudG9Mb3dlckNhc2UoKS5yZXBsYWNlKC9bXy1cXHNdL2csICdfJyk7XG5cbiAgICAvLyBDaGVjayBpZiBsYWJlbCBtYXRjaGVzIGEgdGhlbWUga2V5IGV4YWN0bHlcbiAgICBpZiAoVEhFTUVfS0VZV09SRFNbbGFiZWxMb3dlcl0pIHtcbiAgICAgIGF3YWl0IGNyZWF0ZVRoZW1lTGluayhzdXBhYmFzZSwgdXNlcklkLCBpc3N1ZS5pZCwgbGFiZWxMb3dlciwgJ2xhYmVsJywgMS4wKTtcbiAgICAgIGxpbmtlZFRoZW1lcy5wdXNoKGxhYmVsTG93ZXIpO1xuICAgIH1cbiAgfVxuXG4gIC8vIFN0cmF0ZWd5IDI6IEtleXdvcmQtYmFzZWQgbWF0Y2hpbmcgKG1lZGl1bSBjb25maWRlbmNlKVxuICBmb3IgKGNvbnN0IFt0aGVtZUtleSwga2V5d29yZHNdIG9mIE9iamVjdC5lbnRyaWVzKFRIRU1FX0tFWVdPUkRTKSkge1xuICAgIC8vIFNraXAgaWYgYWxyZWFkeSBsaW5rZWQgdmlhIGxhYmVsXG4gICAgaWYgKGxpbmtlZFRoZW1lcy5pbmNsdWRlcyh0aGVtZUtleSkpIGNvbnRpbnVlO1xuXG4gICAgLy8gQ291bnQga2V5d29yZCBtYXRjaGVzXG4gICAgY29uc3QgbWF0Y2hDb3VudCA9IGtleXdvcmRzLmZpbHRlcihrZXl3b3JkID0+XG4gICAgICBzZWFyY2hUZXh0LmluY2x1ZGVzKGtleXdvcmQudG9Mb3dlckNhc2UoKSlcbiAgICApLmxlbmd0aDtcblxuICAgIGlmIChtYXRjaENvdW50ID49IDIpIHtcbiAgICAgIC8vIEF0IGxlYXN0IDIga2V5d29yZHMgbWF0Y2gg4oaSIGhpZ2ggY29uZmlkZW5jZVxuICAgICAgYXdhaXQgY3JlYXRlVGhlbWVMaW5rKHN1cGFiYXNlLCB1c2VySWQsIGlzc3VlLmlkLCB0aGVtZUtleSwgJ2tleXdvcmQnLCAwLjgpO1xuICAgICAgbGlua2VkVGhlbWVzLnB1c2godGhlbWVLZXkpO1xuICAgIH0gZWxzZSBpZiAobWF0Y2hDb3VudCA9PT0gMSkge1xuICAgICAgLy8gMSBrZXl3b3JkIG1hdGNoIOKGkiBtZWRpdW0gY29uZmlkZW5jZVxuICAgICAgYXdhaXQgY3JlYXRlVGhlbWVMaW5rKHN1cGFiYXNlLCB1c2VySWQsIGlzc3VlLmlkLCB0aGVtZUtleSwgJ2tleXdvcmQnLCAwLjUpO1xuICAgICAgbGlua2VkVGhlbWVzLnB1c2godGhlbWVLZXkpO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiBsaW5rZWRUaGVtZXM7XG59XG5cbi8vIEhlbHBlcjogQ3JlYXRlIHRoZW1lLWppcmEgbGlua1xuYXN5bmMgZnVuY3Rpb24gY3JlYXRlVGhlbWVMaW5rKFxuICBzdXBhYmFzZTogYW55LFxuICB1c2VySWQ6IHN0cmluZyxcbiAgamlyYUlzc3VlSWQ6IHN0cmluZyxcbiAgdGhlbWVLZXk6IHN0cmluZyxcbiAgbWF0Y2hUeXBlOiAnbGFiZWwnIHwgJ2tleXdvcmQnLFxuICBjb25maWRlbmNlOiBudW1iZXJcbikge1xuICB0cnkge1xuICAgIGF3YWl0IHN1cGFiYXNlXG4gICAgICAuZnJvbSgndGhlbWVfamlyYV9saW5rcycpXG4gICAgICAudXBzZXJ0KHtcbiAgICAgICAgdXNlcl9pZDogdXNlcklkLFxuICAgICAgICBqaXJhX2lzc3VlX2lkOiBqaXJhSXNzdWVJZCxcbiAgICAgICAgdGhlbWVfa2V5OiB0aGVtZUtleSxcbiAgICAgICAgbWF0Y2hfdHlwZTogbWF0Y2hUeXBlLFxuICAgICAgICBtYXRjaF9jb25maWRlbmNlOiBjb25maWRlbmNlLFxuICAgICAgfSwge1xuICAgICAgICBvbkNvbmZsaWN0OiAnamlyYV9pc3N1ZV9pZCx0aGVtZV9rZXknLFxuICAgICAgICBpZ25vcmVEdXBsaWNhdGVzOiB0cnVlXG4gICAgICB9KTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKGBGYWlsZWQgdG8gY3JlYXRlIHRoZW1lIGxpbmsgZm9yICR7dGhlbWVLZXl9OmAsIGVycm9yKTtcbiAgfVxufVxuIl0sIm5hbWVzIjpbIk5leHRSZXNwb25zZSIsImNyZWF0ZVJvdXRlSGFuZGxlckNsaWVudCIsImNyZWF0ZUNsaWVudCIsImNvb2tpZXMiLCJnZXREZWNyeXB0ZWRUb2tlbiIsIm1heER1cmF0aW9uIiwiVEhFTUVfS0VZV09SRFMiLCJQT1NUIiwicmVxdWVzdCIsInN1cGFiYXNlIiwiZGF0YSIsInVzZXIiLCJhdXRoIiwiZ2V0VXNlciIsImpzb24iLCJlcnJvciIsInN0YXR1cyIsImludGVncmF0aW9uIiwiZnJvbSIsInNlbGVjdCIsImVxIiwiaWQiLCJzaW5nbGUiLCJzdXBhYmFzZUFkbWluIiwicHJvY2VzcyIsImVudiIsIk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCIsIlNVUEFCQVNFX1NFUlZJQ0VfUk9MRV9LRVkiLCJhdXRvUmVmcmVzaFRva2VuIiwicGVyc2lzdFNlc3Npb24iLCJ0b2tlbnMiLCJjb25zb2xlIiwiZGV0YWlscyIsImVtYWlsIiwibWV0YWRhdGEiLCJhdXRoSGVhZGVyIiwiQnVmZmVyIiwiYWNjZXNzX3Rva2VuIiwidG9TdHJpbmciLCJqcWwiLCJtYXhSZXN1bHRzIiwic3RhcnRBdCIsImFsbElzc3VlcyIsInRvdGFsSXNzdWVzIiwibG9nIiwiamlyYVJlc3BvbnNlIiwiZmV0Y2giLCJpbnN0YW5jZV91cmwiLCJlbmNvZGVVUklDb21wb25lbnQiLCJoZWFkZXJzIiwib2siLCJlcnJvclRleHQiLCJ0ZXh0IiwiamlyYURhdGEiLCJ0b3RhbCIsImlzc3VlcyIsImxlbmd0aCIsImNvbmNhdCIsInN1Y2Nlc3MiLCJzeW5jZWQiLCJsaW5rc19jcmVhdGVkIiwibWVzc2FnZSIsImppcmFJc3N1ZXMiLCJtYXAiLCJpc3N1ZSIsInVzZXJfaWQiLCJpbnRlZ3JhdGlvbl9pZCIsImppcmFfaWQiLCJqaXJhX2tleSIsImtleSIsInN1bW1hcnkiLCJmaWVsZHMiLCJkZXNjcmlwdGlvbiIsIm5hbWUiLCJwcmlvcml0eSIsImFzc2lnbmVlX25hbWUiLCJhc3NpZ25lZSIsImRpc3BsYXlOYW1lIiwiYXNzaWduZWVfZW1haWwiLCJlbWFpbEFkZHJlc3MiLCJzcHJpbnRfbmFtZSIsInNwcmludCIsImxhYmVscyIsImNyZWF0ZWRfZGF0ZSIsImNyZWF0ZWQiLCJ1cGRhdGVkX2RhdGUiLCJ1cGRhdGVkIiwicmVzb2x1dGlvbl9kYXRlIiwicmVzb2x1dGlvbmRhdGUiLCJpc3N1ZV91cmwiLCJjb21tZW50X2NvdW50IiwiY29tbWVudCIsImlzc3VlX3R5cGUiLCJpc3N1ZXR5cGUiLCJsYXN0X3N5bmNlZF9hdCIsIkRhdGUiLCJ0b0lTT1N0cmluZyIsImluc2VydGVkSXNzdWVzIiwiaW5zZXJ0RXJyb3IiLCJ1cHNlcnQiLCJvbkNvbmZsaWN0IiwiaWdub3JlRHVwbGljYXRlcyIsImxpbmtzQ3JlYXRlZCIsImxpbmtlZFRoZW1lcyIsImxpbmtJc3N1ZVRvVGhlbWVzIiwidXBkYXRlIiwidG90YWxfYXZhaWxhYmxlIiwiRXJyb3IiLCJ1c2VySWQiLCJzZWFyY2hUZXh0IiwidG9Mb3dlckNhc2UiLCJsYWJlbCIsImxhYmVsTG93ZXIiLCJyZXBsYWNlIiwiY3JlYXRlVGhlbWVMaW5rIiwicHVzaCIsInRoZW1lS2V5Iiwia2V5d29yZHMiLCJPYmplY3QiLCJlbnRyaWVzIiwiaW5jbHVkZXMiLCJtYXRjaENvdW50IiwiZmlsdGVyIiwia2V5d29yZCIsImppcmFJc3N1ZUlkIiwibWF0Y2hUeXBlIiwiY29uZmlkZW5jZSIsImppcmFfaXNzdWVfaWQiLCJ0aGVtZV9rZXkiLCJtYXRjaF90eXBlIiwibWF0Y2hfY29uZmlkZW5jZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./app/api/jira/sync/route.ts\n");

/***/ }),

/***/ "(rsc)/./lib/encryption.ts":
/*!***************************!*\
  !*** ./lib/encryption.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   checkEncryptionStatus: () => (/* binding */ checkEncryptionStatus),\n/* harmony export */   getDecryptedToken: () => (/* binding */ getDecryptedToken),\n/* harmony export */   getEncryptionKey: () => (/* binding */ getEncryptionKey),\n/* harmony export */   updateEncryptedAccessToken: () => (/* binding */ updateEncryptedAccessToken),\n/* harmony export */   upsertEncryptedToken: () => (/* binding */ upsertEncryptedToken)\n/* harmony export */ });\n/**\n * Encryption Utility Module\n *\n * Provides helper functions for column-level encryption of OAuth tokens\n * using Supabase pgcrypto extension (symmetric encryption).\n *\n * Security Notes:\n * - Encryption key stored in ENCRYPTION_KEY environment variable\n * - Only server-side code (API routes) should import this module\n * - Never expose encryption key to client-side code\n * - All encryption/decryption happens in PostgreSQL using pgp_sym_* functions\n */ /**\n * Get encryption key from environment variables\n *\n * @throws {Error} If ENCRYPTION_KEY is not set or too short\n * @returns Encryption key string\n */ function getEncryptionKey() {\n    const key = process.env.ENCRYPTION_KEY;\n    if (!key) {\n        throw new Error(\"ENCRYPTION_KEY environment variable is not set. \" + \"Generate one with: openssl rand -base64 32\");\n    }\n    if (key.length < 32) {\n        throw new Error(\"ENCRYPTION_KEY must be at least 32 characters for security. \" + \"Current length: \" + key.length);\n    }\n    return key;\n}\n/**\n * Insert or update OAuth token with encryption (UPSERT)\n *\n * Uses PostgreSQL function `insert_encrypted_token` to handle encryption\n * at the database layer. If a token already exists for the integration,\n * it will be updated.\n *\n * @param supabase - Supabase client (must have service role access)\n * @param data - Token data to encrypt and store\n * @returns Token ID if successful\n * @throws {Error} If encryption or database operation fails\n *\n * @example\n * ```typescript\n * const tokenId = await upsertEncryptedToken(supabaseAdmin, {\n *   integration_id: '123e4567-e89b-12d3-a456-426614174000',\n *   access_token: 'salesforce_access_token_here',\n *   refresh_token: 'salesforce_refresh_token_here',\n *   token_type: 'Bearer',\n *   expires_at: '2024-12-31T23:59:59Z'\n * });\n * ```\n */ async function upsertEncryptedToken(supabase, data) {\n    const encryptionKey = getEncryptionKey();\n    try {\n        const { data: result, error } = await supabase.rpc(\"insert_encrypted_token\", {\n            p_integration_id: data.integration_id,\n            p_access_token: data.access_token,\n            p_refresh_token: data.refresh_token,\n            p_token_type: data.token_type,\n            p_expires_at: data.expires_at,\n            p_encryption_key: encryptionKey\n        });\n        if (error) {\n            console.error(\"Failed to upsert encrypted token:\", error);\n            throw new Error(`Token encryption failed: ${error.message}`);\n        }\n        if (!result) {\n            throw new Error(\"Token insertion returned no ID\");\n        }\n        console.log(\"Token stored successfully (encrypted)\");\n        return result;\n    } catch (error) {\n        console.error(\"Encryption error:\", error);\n        throw error;\n    }\n}\n/**\n * Update access token only (for token refresh operations)\n *\n * Used when refreshing Salesforce OAuth tokens. Only updates the\n * access_token and expires_at fields, preserving the refresh_token.\n *\n * @param supabase - Supabase client (must have service role access)\n * @param tokenId - UUID of the token record to update\n * @param accessToken - New access token value\n * @param expiresAt - New expiration timestamp\n * @returns True if update successful\n * @throws {Error} If encryption or database operation fails\n *\n * @example\n * ```typescript\n * await updateEncryptedAccessToken(\n *   supabaseAdmin,\n *   'token-uuid',\n *   'new_access_token',\n *   '2024-12-31T23:59:59Z'\n * );\n * ```\n */ async function updateEncryptedAccessToken(supabase, tokenId, accessToken, expiresAt) {\n    const encryptionKey = getEncryptionKey();\n    try {\n        const { data: result, error } = await supabase.rpc(\"update_encrypted_token\", {\n            p_token_id: tokenId,\n            p_access_token: accessToken,\n            p_expires_at: expiresAt,\n            p_encryption_key: encryptionKey\n        });\n        if (error) {\n            console.error(\"Failed to update encrypted token:\", error);\n            throw new Error(`Token update failed: ${error.message}`);\n        }\n        if (!result) {\n            console.warn(\"Token update returned false - token may not exist\");\n            return false;\n        }\n        console.log(\"Token refreshed successfully (encrypted)\");\n        return result;\n    } catch (error) {\n        console.error(\"Token update error:\", error);\n        throw error;\n    }\n}\n/**\n * Retrieve and decrypt OAuth token for a given integration\n *\n * Fetches encrypted token from database and decrypts it using the\n * PostgreSQL function `get_decrypted_token`. Returns null if token\n * not found.\n *\n * @param supabase - Supabase client (must have service role access)\n * @param integrationId - UUID of the integration\n * @returns Decrypted token data or null if not found\n * @throws {Error} If decryption fails (wrong key, corrupted data, etc.)\n *\n * @example\n * ```typescript\n * const token = await getDecryptedToken(\n *   supabaseAdmin,\n *   '123e4567-e89b-12d3-a456-426614174000'\n * );\n *\n * if (token) {\n *   // Use token.access_token for API calls\n *   fetch(apiUrl, {\n *     headers: { Authorization: `Bearer ${token.access_token}` }\n *   });\n * }\n * ```\n */ async function getDecryptedToken(supabase, integrationId) {\n    const encryptionKey = getEncryptionKey();\n    try {\n        const { data, error } = await supabase.rpc(\"get_decrypted_token\", {\n            p_integration_id: integrationId,\n            p_encryption_key: encryptionKey\n        });\n        if (error) {\n            console.error(\"Failed to fetch/decrypt token:\", error);\n            // Provide helpful error messages\n            if (error.message.includes(\"decrypt\") || error.message.includes(\"Wrong key\")) {\n                throw new Error(\"Token decryption failed - ENCRYPTION_KEY may be incorrect or changed. \" + \"Verify the key matches what was used during encryption.\");\n            }\n            throw new Error(`Token retrieval failed: ${error.message}`);\n        }\n        if (!data || Array.isArray(data) && data.length === 0) {\n            console.warn(`No token found for integration: ${integrationId}`);\n            return null;\n        }\n        // RPC returns an array, get first item\n        const token = Array.isArray(data) ? data[0] : data;\n        // Validate decrypted token structure\n        if (!token.access_token) {\n            throw new Error(\"Decrypted token is missing access_token - data may be corrupted\");\n        }\n        return token;\n    } catch (error) {\n        console.error(\"Token decryption error:\", error);\n        throw error;\n    }\n}\n/**\n * Check encryption status of oauth_tokens table\n *\n * Utility function to verify encryption migration status.\n * Returns statistics about encrypted vs plaintext tokens.\n *\n * @param supabase - Supabase client (must have service role access)\n * @returns Encryption status statistics\n *\n * @example\n * ```typescript\n * const status = await checkEncryptionStatus(supabaseAdmin);\n * console.log(`Encryption rate: ${status.encryption_percentage}%`);\n * ```\n */ async function checkEncryptionStatus(supabase) {\n    try {\n        const { data, error } = await supabase.rpc(\"check_encryption_status\");\n        if (error) {\n            console.error(\"Failed to check encryption status:\", error);\n            throw new Error(`Encryption status check failed: ${error.message}`);\n        }\n        // RPC returns an array with one result\n        const status = Array.isArray(data) ? data[0] : data;\n        return {\n            total_tokens: Number(status.total_tokens || 0),\n            encrypted_access_tokens: Number(status.encrypted_access_tokens || 0),\n            encrypted_refresh_tokens: Number(status.encrypted_refresh_tokens || 0),\n            plaintext_access_tokens: Number(status.plaintext_access_tokens || 0),\n            plaintext_refresh_tokens: Number(status.plaintext_refresh_tokens || 0),\n            encryption_percentage: Number(status.encryption_percentage || 0)\n        };\n    } catch (error) {\n        console.error(\"Encryption status check error:\", error);\n        throw error;\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QkFBd0IsSUFBSTtZQUNwRUMseUJBQXlCSCxPQUFPRixPQUFPSyx1QkFBdUIsSUFBSTtZQUNsRUMsMEJBQTBCSixPQUFPRixPQUFPTSx3QkFBd0IsSUFBSTtZQUNwRUMsdUJBQXVCTCxPQUFPRixPQUFPTyxxQkFBcUIsSUFBSTtRQUNoRTtJQUNGLEVBQUUsT0FBT3BDLE9BQU87UUFDZGEsUUFBUWIsS0FBSyxDQUFDLGtDQUFrQ0E7UUFDaEQsTUFBTUE7SUFDUjtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZnJpY3Rpb24taW50ZWxsaWdlbmNlLy4vbGliL2VuY3J5cHRpb24udHM/MzM3NSJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEVuY3J5cHRpb24gVXRpbGl0eSBNb2R1bGVcbiAqXG4gKiBQcm92aWRlcyBoZWxwZXIgZnVuY3Rpb25zIGZvciBjb2x1bW4tbGV2ZWwgZW5jcnlwdGlvbiBvZiBPQXV0aCB0b2tlbnNcbiAqIHVzaW5nIFN1cGFiYXNlIHBnY3J5cHRvIGV4dGVuc2lvbiAoc3ltbWV0cmljIGVuY3J5cHRpb24pLlxuICpcbiAqIFNlY3VyaXR5IE5vdGVzOlxuICogLSBFbmNyeXB0aW9uIGtleSBzdG9yZWQgaW4gRU5DUllQVElPTl9LRVkgZW52aXJvbm1lbnQgdmFyaWFibGVcbiAqIC0gT25seSBzZXJ2ZXItc2lkZSBjb2RlIChBUEkgcm91dGVzKSBzaG91bGQgaW1wb3J0IHRoaXMgbW9kdWxlXG4gKiAtIE5ldmVyIGV4cG9zZSBlbmNyeXB0aW9uIGtleSB0byBjbGllbnQtc2lkZSBjb2RlXG4gKiAtIEFsbCBlbmNyeXB0aW9uL2RlY3J5cHRpb24gaGFwcGVucyBpbiBQb3N0Z3JlU1FMIHVzaW5nIHBncF9zeW1fKiBmdW5jdGlvbnNcbiAqL1xuXG5pbXBvcnQgeyBTdXBhYmFzZUNsaWVudCB9IGZyb20gJ0BzdXBhYmFzZS9zdXBhYmFzZS1qcyc7XG5cbi8qKlxuICogVG9rZW4gZGF0YSBzdHJ1Y3R1cmUgZm9yIGVuY3J5cHRpb24gb3BlcmF0aW9uc1xuICovXG5leHBvcnQgaW50ZXJmYWNlIFRva2VuRGF0YSB7XG4gIGludGVncmF0aW9uX2lkOiBzdHJpbmc7XG4gIGFjY2Vzc190b2tlbjogc3RyaW5nO1xuICByZWZyZXNoX3Rva2VuOiBzdHJpbmcgfCBudWxsO1xuICB0b2tlbl90eXBlOiBzdHJpbmc7XG4gIGV4cGlyZXNfYXQ6IHN0cmluZyB8IG51bGw7XG59XG5cbi8qKlxuICogRGVjcnlwdGVkIHRva2VuIHN0cnVjdHVyZSByZXR1cm5lZCBmcm9tIGRhdGFiYXNlXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgRGVjcnlwdGVkVG9rZW4ge1xuICBpZDogc3RyaW5nO1xuICBpbnRlZ3JhdGlvbl9pZDogc3RyaW5nO1xuICBhY2Nlc3NfdG9rZW46IHN0cmluZztcbiAgcmVmcmVzaF90b2tlbjogc3RyaW5nIHwgbnVsbDtcbiAgdG9rZW5fdHlwZTogc3RyaW5nO1xuICBleHBpcmVzX2F0OiBzdHJpbmcgfCBudWxsO1xuICBjcmVhdGVkX2F0OiBzdHJpbmc7XG4gIHVwZGF0ZWRfYXQ6IHN0cmluZztcbn1cblxuLyoqXG4gKiBHZXQgZW5jcnlwdGlvbiBrZXkgZnJvbSBlbnZpcm9ubWVudCB2YXJpYWJsZXNcbiAqXG4gKiBAdGhyb3dzIHtFcnJvcn0gSWYgRU5DUllQVElPTl9LRVkgaXMgbm90IHNldCBvciB0b28gc2hvcnRcbiAqIEByZXR1cm5zIEVuY3J5cHRpb24ga2V5IHN0cmluZ1xuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0RW5jcnlwdGlvbktleSgpOiBzdHJpbmcge1xuICBjb25zdCBrZXkgPSBwcm9jZXNzLmVudi5FTkNSWVBUSU9OX0tFWTtcblxuICBpZiAoIWtleSkge1xuICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICdFTkNSWVBUSU9OX0tFWSBlbnZpcm9ubWVudCB2YXJpYWJsZSBpcyBub3Qgc2V0LiAnICtcbiAgICAgICAgJ0dlbmVyYXRlIG9uZSB3aXRoOiBvcGVuc3NsIHJhbmQgLWJhc2U2NCAzMidcbiAgICApO1xuICB9XG5cbiAgaWYgKGtleS5sZW5ndGggPCAzMikge1xuICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICdFTkNSWVBUSU9OX0tFWSBtdXN0IGJlIGF0IGxlYXN0IDMyIGNoYXJhY3RlcnMgZm9yIHNlY3VyaXR5LiAnICtcbiAgICAgICAgJ0N1cnJlbnQgbGVuZ3RoOiAnICtcbiAgICAgICAga2V5Lmxlbmd0aFxuICAgICk7XG4gIH1cblxuICByZXR1cm4ga2V5O1xufVxuXG4vKipcbiAqIEluc2VydCBvciB1cGRhdGUgT0F1dGggdG9rZW4gd2l0aCBlbmNyeXB0aW9uIChVUFNFUlQpXG4gKlxuICogVXNlcyBQb3N0Z3JlU1FMIGZ1bmN0aW9uIGBpbnNlcnRfZW5jcnlwdGVkX3Rva2VuYCB0byBoYW5kbGUgZW5jcnlwdGlvblxuICogYXQgdGhlIGRhdGFiYXNlIGxheWVyLiBJZiBhIHRva2VuIGFscmVhZHkgZXhpc3RzIGZvciB0aGUgaW50ZWdyYXRpb24sXG4gKiBpdCB3aWxsIGJlIHVwZGF0ZWQuXG4gKlxuICogQHBhcmFtIHN1cGFiYXNlIC0gU3VwYWJhc2UgY2xpZW50IChtdXN0IGhhdmUgc2VydmljZSByb2xlIGFjY2VzcylcbiAqIEBwYXJhbSBkYXRhIC0gVG9rZW4gZGF0YSB0byBlbmNyeXB0IGFuZCBzdG9yZVxuICogQHJldHVybnMgVG9rZW4gSUQgaWYgc3VjY2Vzc2Z1bFxuICogQHRocm93cyB7RXJyb3J9IElmIGVuY3J5cHRpb24gb3IgZGF0YWJhc2Ugb3BlcmF0aW9uIGZhaWxzXG4gKlxuICogQGV4YW1wbGVcbiAqIGBgYHR5cGVzY3JpcHRcbiAqIGNvbnN0IHRva2VuSWQgPSBhd2FpdCB1cHNlcnRFbmNyeXB0ZWRUb2tlbihzdXBhYmFzZUFkbWluLCB7XG4gKiAgIGludGVncmF0aW9uX2lkOiAnMTIzZTQ1NjctZTg5Yi0xMmQzLWE0NTYtNDI2NjE0MTc0MDAwJyxcbiAqICAgYWNjZXNzX3Rva2VuOiAnc2FsZXNmb3JjZV9hY2Nlc3NfdG9rZW5faGVyZScsXG4gKiAgIHJlZnJlc2hfdG9rZW46ICdzYWxlc2ZvcmNlX3JlZnJlc2hfdG9rZW5faGVyZScsXG4gKiAgIHRva2VuX3R5cGU6ICdCZWFyZXInLFxuICogICBleHBpcmVzX2F0OiAnMjAyNC0xMi0zMVQyMzo1OTo1OVonXG4gKiB9KTtcbiAqIGBgYFxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdXBzZXJ0RW5jcnlwdGVkVG9rZW4oXG4gIHN1cGFiYXNlOiBTdXBhYmFzZUNsaWVudCxcbiAgZGF0YTogVG9rZW5EYXRhXG4pOiBQcm9taXNlPHN0cmluZz4ge1xuICBjb25zdCBlbmNyeXB0aW9uS2V5ID0gZ2V0RW5jcnlwdGlvbktleSgpO1xuXG4gIHRyeSB7XG4gICAgY29uc3QgeyBkYXRhOiByZXN1bHQsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZS5ycGMoJ2luc2VydF9lbmNyeXB0ZWRfdG9rZW4nLCB7XG4gICAgICBwX2ludGVncmF0aW9uX2lkOiBkYXRhLmludGVncmF0aW9uX2lkLFxuICAgICAgcF9hY2Nlc3NfdG9rZW46IGRhdGEuYWNjZXNzX3Rva2VuLFxuICAgICAgcF9yZWZyZXNoX3Rva2VuOiBkYXRhLnJlZnJlc2hfdG9rZW4sXG4gICAgICBwX3Rva2VuX3R5cGU6IGRhdGEudG9rZW5fdHlwZSxcbiAgICAgIHBfZXhwaXJlc19hdDogZGF0YS5leHBpcmVzX2F0LFxuICAgICAgcF9lbmNyeXB0aW9uX2tleTogZW5jcnlwdGlvbktleSxcbiAgICB9KTtcblxuICAgIGlmIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIHVwc2VydCBlbmNyeXB0ZWQgdG9rZW46JywgZXJyb3IpO1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBUb2tlbiBlbmNyeXB0aW9uIGZhaWxlZDogJHtlcnJvci5tZXNzYWdlfWApO1xuICAgIH1cblxuICAgIGlmICghcmVzdWx0KSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1Rva2VuIGluc2VydGlvbiByZXR1cm5lZCBubyBJRCcpO1xuICAgIH1cblxuICAgIGNvbnNvbGUubG9nKCdUb2tlbiBzdG9yZWQgc3VjY2Vzc2Z1bGx5IChlbmNyeXB0ZWQpJyk7XG4gICAgcmV0dXJuIHJlc3VsdCBhcyBzdHJpbmc7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRW5jcnlwdGlvbiBlcnJvcjonLCBlcnJvcik7XG4gICAgdGhyb3cgZXJyb3I7XG4gIH1cbn1cblxuLyoqXG4gKiBVcGRhdGUgYWNjZXNzIHRva2VuIG9ubHkgKGZvciB0b2tlbiByZWZyZXNoIG9wZXJhdGlvbnMpXG4gKlxuICogVXNlZCB3aGVuIHJlZnJlc2hpbmcgU2FsZXNmb3JjZSBPQXV0aCB0b2tlbnMuIE9ubHkgdXBkYXRlcyB0aGVcbiAqIGFjY2Vzc190b2tlbiBhbmQgZXhwaXJlc19hdCBmaWVsZHMsIHByZXNlcnZpbmcgdGhlIHJlZnJlc2hfdG9rZW4uXG4gKlxuICogQHBhcmFtIHN1cGFiYXNlIC0gU3VwYWJhc2UgY2xpZW50IChtdXN0IGhhdmUgc2VydmljZSByb2xlIGFjY2VzcylcbiAqIEBwYXJhbSB0b2tlbklkIC0gVVVJRCBvZiB0aGUgdG9rZW4gcmVjb3JkIHRvIHVwZGF0ZVxuICogQHBhcmFtIGFjY2Vzc1Rva2VuIC0gTmV3IGFjY2VzcyB0b2tlbiB2YWx1ZVxuICogQHBhcmFtIGV4cGlyZXNBdCAtIE5ldyBleHBpcmF0aW9uIHRpbWVzdGFtcFxuICogQHJldHVybnMgVHJ1ZSBpZiB1cGRhdGUgc3VjY2Vzc2Z1bFxuICogQHRocm93cyB7RXJyb3J9IElmIGVuY3J5cHRpb24gb3IgZGF0YWJhc2Ugb3BlcmF0aW9uIGZhaWxzXG4gKlxuICogQGV4YW1wbGVcbiAqIGBgYHR5cGVzY3JpcHRcbiAqIGF3YWl0IHVwZGF0ZUVuY3J5cHRlZEFjY2Vzc1Rva2VuKFxuICogICBzdXBhYmFzZUFkbWluLFxuICogICAndG9rZW4tdXVpZCcsXG4gKiAgICduZXdfYWNjZXNzX3Rva2VuJyxcbiAqICAgJzIwMjQtMTItMzFUMjM6NTk6NTlaJ1xuICogKTtcbiAqIGBgYFxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdXBkYXRlRW5jcnlwdGVkQWNjZXNzVG9rZW4oXG4gIHN1cGFiYXNlOiBTdXBhYmFzZUNsaWVudCxcbiAgdG9rZW5JZDogc3RyaW5nLFxuICBhY2Nlc3NUb2tlbjogc3RyaW5nLFxuICBleHBpcmVzQXQ6IHN0cmluZ1xuKTogUHJvbWlzZTxib29sZWFuPiB7XG4gIGNvbnN0IGVuY3J5cHRpb25LZXkgPSBnZXRFbmNyeXB0aW9uS2V5KCk7XG5cbiAgdHJ5IHtcbiAgICBjb25zdCB7IGRhdGE6IHJlc3VsdCwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlLnJwYygndXBkYXRlX2VuY3J5cHRlZF90b2tlbicsIHtcbiAgICAgIHBfdG9rZW5faWQ6IHRva2VuSWQsXG4gICAgICBwX2FjY2Vzc190b2tlbjogYWNjZXNzVG9rZW4sXG4gICAgICBwX2V4cGlyZXNfYXQ6IGV4cGlyZXNBdCxcbiAgICAgIHBfZW5jcnlwdGlvbl9rZXk6IGVuY3J5cHRpb25LZXksXG4gICAgfSk7XG5cbiAgICBpZiAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byB1cGRhdGUgZW5jcnlwdGVkIHRva2VuOicsIGVycm9yKTtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgVG9rZW4gdXBkYXRlIGZhaWxlZDogJHtlcnJvci5tZXNzYWdlfWApO1xuICAgIH1cblxuICAgIGlmICghcmVzdWx0KSB7XG4gICAgICBjb25zb2xlLndhcm4oJ1Rva2VuIHVwZGF0ZSByZXR1cm5lZCBmYWxzZSAtIHRva2VuIG1heSBub3QgZXhpc3QnKTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBjb25zb2xlLmxvZygnVG9rZW4gcmVmcmVzaGVkIHN1Y2Nlc3NmdWxseSAoZW5jcnlwdGVkKScpO1xuICAgIHJldHVybiByZXN1bHQgYXMgYm9vbGVhbjtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdUb2tlbiB1cGRhdGUgZXJyb3I6JywgZXJyb3IpO1xuICAgIHRocm93IGVycm9yO1xuICB9XG59XG5cbi8qKlxuICogUmV0cmlldmUgYW5kIGRlY3J5cHQgT0F1dGggdG9rZW4gZm9yIGEgZ2l2ZW4gaW50ZWdyYXRpb25cbiAqXG4gKiBGZXRjaGVzIGVuY3J5cHRlZCB0b2tlbiBmcm9tIGRhdGFiYXNlIGFuZCBkZWNyeXB0cyBpdCB1c2luZyB0aGVcbiAqIFBvc3RncmVTUUwgZnVuY3Rpb24gYGdldF9kZWNyeXB0ZWRfdG9rZW5gLiBSZXR1cm5zIG51bGwgaWYgdG9rZW5cbiAqIG5vdCBmb3VuZC5cbiAqXG4gKiBAcGFyYW0gc3VwYWJhc2UgLSBTdXBhYmFzZSBjbGllbnQgKG11c3QgaGF2ZSBzZXJ2aWNlIHJvbGUgYWNjZXNzKVxuICogQHBhcmFtIGludGVncmF0aW9uSWQgLSBVVUlEIG9mIHRoZSBpbnRlZ3JhdGlvblxuICogQHJldHVybnMgRGVjcnlwdGVkIHRva2VuIGRhdGEgb3IgbnVsbCBpZiBub3QgZm91bmRcbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiBkZWNyeXB0aW9uIGZhaWxzICh3cm9uZyBrZXksIGNvcnJ1cHRlZCBkYXRhLCBldGMuKVxuICpcbiAqIEBleGFtcGxlXG4gKiBgYGB0eXBlc2NyaXB0XG4gKiBjb25zdCB0b2tlbiA9IGF3YWl0IGdldERlY3J5cHRlZFRva2VuKFxuICogICBzdXBhYmFzZUFkbWluLFxuICogICAnMTIzZTQ1NjctZTg5Yi0xMmQzLWE0NTYtNDI2NjE0MTc0MDAwJ1xuICogKTtcbiAqXG4gKiBpZiAodG9rZW4pIHtcbiAqICAgLy8gVXNlIHRva2VuLmFjY2Vzc190b2tlbiBmb3IgQVBJIGNhbGxzXG4gKiAgIGZldGNoKGFwaVVybCwge1xuICogICAgIGhlYWRlcnM6IHsgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3Rva2VuLmFjY2Vzc190b2tlbn1gIH1cbiAqICAgfSk7XG4gKiB9XG4gKiBgYGBcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldERlY3J5cHRlZFRva2VuKFxuICBzdXBhYmFzZTogU3VwYWJhc2VDbGllbnQsXG4gIGludGVncmF0aW9uSWQ6IHN0cmluZ1xuKTogUHJvbWlzZTxEZWNyeXB0ZWRUb2tlbiB8IG51bGw+IHtcbiAgY29uc3QgZW5jcnlwdGlvbktleSA9IGdldEVuY3J5cHRpb25LZXkoKTtcblxuICB0cnkge1xuICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlLnJwYygnZ2V0X2RlY3J5cHRlZF90b2tlbicsIHtcbiAgICAgIHBfaW50ZWdyYXRpb25faWQ6IGludGVncmF0aW9uSWQsXG4gICAgICBwX2VuY3J5cHRpb25fa2V5OiBlbmNyeXB0aW9uS2V5LFxuICAgIH0pO1xuXG4gICAgaWYgKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gZmV0Y2gvZGVjcnlwdCB0b2tlbjonLCBlcnJvcik7XG5cbiAgICAgIC8vIFByb3ZpZGUgaGVscGZ1bCBlcnJvciBtZXNzYWdlc1xuICAgICAgaWYgKGVycm9yLm1lc3NhZ2UuaW5jbHVkZXMoJ2RlY3J5cHQnKSB8fCBlcnJvci5tZXNzYWdlLmluY2x1ZGVzKCdXcm9uZyBrZXknKSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgJ1Rva2VuIGRlY3J5cHRpb24gZmFpbGVkIC0gRU5DUllQVElPTl9LRVkgbWF5IGJlIGluY29ycmVjdCBvciBjaGFuZ2VkLiAnICtcbiAgICAgICAgICAgICdWZXJpZnkgdGhlIGtleSBtYXRjaGVzIHdoYXQgd2FzIHVzZWQgZHVyaW5nIGVuY3J5cHRpb24uJ1xuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYFRva2VuIHJldHJpZXZhbCBmYWlsZWQ6ICR7ZXJyb3IubWVzc2FnZX1gKTtcbiAgICB9XG5cbiAgICBpZiAoIWRhdGEgfHwgKEFycmF5LmlzQXJyYXkoZGF0YSkgJiYgZGF0YS5sZW5ndGggPT09IDApKSB7XG4gICAgICBjb25zb2xlLndhcm4oYE5vIHRva2VuIGZvdW5kIGZvciBpbnRlZ3JhdGlvbjogJHtpbnRlZ3JhdGlvbklkfWApO1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgLy8gUlBDIHJldHVybnMgYW4gYXJyYXksIGdldCBmaXJzdCBpdGVtXG4gICAgY29uc3QgdG9rZW4gPSBBcnJheS5pc0FycmF5KGRhdGEpID8gZGF0YVswXSA6IGRhdGE7XG5cbiAgICAvLyBWYWxpZGF0ZSBkZWNyeXB0ZWQgdG9rZW4gc3RydWN0dXJlXG4gICAgaWYgKCF0b2tlbi5hY2Nlc3NfdG9rZW4pIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignRGVjcnlwdGVkIHRva2VuIGlzIG1pc3NpbmcgYWNjZXNzX3Rva2VuIC0gZGF0YSBtYXkgYmUgY29ycnVwdGVkJyk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRva2VuIGFzIERlY3J5cHRlZFRva2VuO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ1Rva2VuIGRlY3J5cHRpb24gZXJyb3I6JywgZXJyb3IpO1xuICAgIHRocm93IGVycm9yO1xuICB9XG59XG5cbi8qKlxuICogQ2hlY2sgZW5jcnlwdGlvbiBzdGF0dXMgb2Ygb2F1dGhfdG9rZW5zIHRhYmxlXG4gKlxuICogVXRpbGl0eSBmdW5jdGlvbiB0byB2ZXJpZnkgZW5jcnlwdGlvbiBtaWdyYXRpb24gc3RhdHVzLlxuICogUmV0dXJucyBzdGF0aXN0aWNzIGFib3V0IGVuY3J5cHRlZCB2cyBwbGFpbnRleHQgdG9rZW5zLlxuICpcbiAqIEBwYXJhbSBzdXBhYmFzZSAtIFN1cGFiYXNlIGNsaWVudCAobXVzdCBoYXZlIHNlcnZpY2Ugcm9sZSBhY2Nlc3MpXG4gKiBAcmV0dXJucyBFbmNyeXB0aW9uIHN0YXR1cyBzdGF0aXN0aWNzXG4gKlxuICogQGV4YW1wbGVcbiAqIGBgYHR5cGVzY3JpcHRcbiAqIGNvbnN0IHN0YXR1cyA9IGF3YWl0IGNoZWNrRW5jcnlwdGlvblN0YXR1cyhzdXBhYmFzZUFkbWluKTtcbiAqIGNvbnNvbGUubG9nKGBFbmNyeXB0aW9uIHJhdGU6ICR7c3RhdHVzLmVuY3J5cHRpb25fcGVyY2VudGFnZX0lYCk7XG4gKiBgYGBcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNoZWNrRW5jcnlwdGlvblN0YXR1cyhzdXBhYmFzZTogU3VwYWJhc2VDbGllbnQpOiBQcm9taXNlPHtcbiAgdG90YWxfdG9rZW5zOiBudW1iZXI7XG4gIGVuY3J5cHRlZF9hY2Nlc3NfdG9rZW5zOiBudW1iZXI7XG4gIGVuY3J5cHRlZF9yZWZyZXNoX3Rva2VuczogbnVtYmVyO1xuICBwbGFpbnRleHRfYWNjZXNzX3Rva2VuczogbnVtYmVyO1xuICBwbGFpbnRleHRfcmVmcmVzaF90b2tlbnM6IG51bWJlcjtcbiAgZW5jcnlwdGlvbl9wZXJjZW50YWdlOiBudW1iZXI7XG59PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2UucnBjKCdjaGVja19lbmNyeXB0aW9uX3N0YXR1cycpO1xuXG4gICAgaWYgKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gY2hlY2sgZW5jcnlwdGlvbiBzdGF0dXM6JywgZXJyb3IpO1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBFbmNyeXB0aW9uIHN0YXR1cyBjaGVjayBmYWlsZWQ6ICR7ZXJyb3IubWVzc2FnZX1gKTtcbiAgICB9XG5cbiAgICAvLyBSUEMgcmV0dXJucyBhbiBhcnJheSB3aXRoIG9uZSByZXN1bHRcbiAgICBjb25zdCBzdGF0dXMgPSBBcnJheS5pc0FycmF5KGRhdGEpID8gZGF0YVswXSA6IGRhdGE7XG5cbiAgICByZXR1cm4ge1xuICAgICAgdG90YWxfdG9rZW5zOiBOdW1iZXIoc3RhdHVzLnRvdGFsX3Rva2VucyB8fCAwKSxcbiAgICAgIGVuY3J5cHRlZF9hY2Nlc3NfdG9rZW5zOiBOdW1iZXIoc3RhdHVzLmVuY3J5cHRlZF9hY2Nlc3NfdG9rZW5zIHx8IDApLFxuICAgICAgZW5jcnlwdGVkX3JlZnJlc2hfdG9rZW5zOiBOdW1iZXIoc3RhdHVzLmVuY3J5cHRlZF9yZWZyZXNoX3Rva2VucyB8fCAwKSxcbiAgICAgIHBsYWludGV4dF9hY2Nlc3NfdG9rZW5zOiBOdW1iZXIoc3RhdHVzLnBsYWludGV4dF9hY2Nlc3NfdG9rZW5zIHx8IDApLFxuICAgICAgcGxhaW50ZXh0X3JlZnJlc2hfdG9rZW5zOiBOdW1iZXIoc3RhdHVzLnBsYWludGV4dF9yZWZyZXNoX3Rva2VucyB8fCAwKSxcbiAgICAgIGVuY3J5cHRpb25fcGVyY2VudGFnZTogTnVtYmVyKHN0YXR1cy5lbmNyeXB0aW9uX3BlcmNlbnRhZ2UgfHwgMCksXG4gICAgfTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFbmNyeXB0aW9uIHN0YXR1cyBjaGVjayBlcnJvcjonLCBlcnJvcik7XG4gICAgdGhyb3cgZXJyb3I7XG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJnZXRFbmNyeXB0aW9uS2V5Iiwia2V5IiwicHJvY2VzcyIsImVudiIsIkVOQ1JZUFRJT05fS0VZIiwiRXJyb3IiLCJsZW5ndGgiLCJ1cHNlcnRFbmNyeXB0ZWRUb2tlbiIsInN1cGFiYXNlIiwiZGF0YSIsImVuY3J5cHRpb25LZXkiLCJyZXN1bHQiLCJlcnJvciIsInJwYyIsInBfaW50ZWdyYXRpb25faWQiLCJpbnRlZ3JhdGlvbl9pZCIsInBfYWNjZXNzX3Rva2VuIiwiYWNjZXNzX3Rva2VuIiwicF9yZWZyZXNoX3Rva2VuIiwicmVmcmVzaF90b2tlbiIsInBfdG9rZW5fdHlwZSIsInRva2VuX3R5cGUiLCJwX2V4cGlyZXNfYXQiLCJleHBpcmVzX2F0IiwicF9lbmNyeXB0aW9uX2tleSIsImNvbnNvbGUiLCJtZXNzYWdlIiwibG9nIiwidXBkYXRlRW5jcnlwdGVkQWNjZXNzVG9rZW4iLCJ0b2tlbklkIiwiYWNjZXNzVG9rZW4iLCJleHBpcmVzQXQiLCJwX3Rva2VuX2lkIiwid2FybiIsImdldERlY3J5cHRlZFRva2VuIiwiaW50ZWdyYXRpb25JZCIsImluY2x1ZGVzIiwiQXJyYXkiLCJpc0FycmF5IiwidG9rZW4iLCJjaGVja0VuY3J5cHRpb25TdGF0dXMiLCJzdGF0dXMiLCJ0b3RhbF90b2tlbnMiLCJOdW1iZXIiLCJlbmNyeXB0ZWRfYWNjZXNzX3Rva2VucyIsImVuY3J5cHRlZF9yZWZyZXNoX3Rva2VucyIsInBsYWludGV4dF9hY2Nlc3NfdG9rZW5zIiwicGxhaW50ZXh0X3JlZnJlc2hfdG9rZW5zIiwiZW5jcnlwdGlvbl9wZXJjZW50YWdlIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/encryption.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/@supabase","vendor-chunks/next","vendor-chunks/tslib","vendor-chunks/iceberg-js","vendor-chunks/set-cookie-parser","vendor-chunks/jose"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fjira%2Fsync%2Froute&page=%2Fapi%2Fjira%2Fsync%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fjira%2Fsync%2Froute.ts&appDir=%2FUsers%2Fmario%2Ffriction-intelligence%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fmario%2Ffriction-intelligence&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();