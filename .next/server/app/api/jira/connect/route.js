"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/jira/connect/route";
exports.ids = ["app/api/jira/connect/route"];
exports.modules = {

/***/ "../../client/components/action-async-storage.external":
/*!*******************************************************************************!*\
  !*** external "next/dist/client/components/action-async-storage.external.js" ***!
  \*******************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/action-async-storage.external.js");

/***/ }),

/***/ "../../client/components/request-async-storage.external":
/*!********************************************************************************!*\
  !*** external "next/dist/client/components/request-async-storage.external.js" ***!
  \********************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/request-async-storage.external.js");

/***/ }),

/***/ "../../client/components/static-generation-async-storage.external":
/*!******************************************************************************************!*\
  !*** external "next/dist/client/components/static-generation-async-storage.external.js" ***!
  \******************************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/static-generation-async-storage.external.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "buffer":
/*!*************************!*\
  !*** external "buffer" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("buffer");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("crypto");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fjira%2Fconnect%2Froute&page=%2Fapi%2Fjira%2Fconnect%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fjira%2Fconnect%2Froute.ts&appDir=%2FUsers%2Fmario%2Ffriction-intelligence%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fmario%2Ffriction-intelligence&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!******************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fjira%2Fconnect%2Froute&page=%2Fapi%2Fjira%2Fconnect%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fjira%2Fconnect%2Froute.ts&appDir=%2FUsers%2Fmario%2Ffriction-intelligence%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fmario%2Ffriction-intelligence&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \******************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   headerHooks: () => (/* binding */ headerHooks),\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage),\n/* harmony export */   staticGenerationBailout: () => (/* binding */ staticGenerationBailout)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _Users_mario_friction_intelligence_app_api_jira_connect_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./app/api/jira/connect/route.ts */ \"(rsc)/./app/api/jira/connect/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/jira/connect/route\",\n        pathname: \"/api/jira/connect\",\n        filename: \"route\",\n        bundlePath: \"app/api/jira/connect/route\"\n    },\n    resolvedPagePath: \"/Users/mario/friction-intelligence/app/api/jira/connect/route.ts\",\n    nextConfigOutput,\n    userland: _Users_mario_friction_intelligence_app_api_jira_connect_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks, headerHooks, staticGenerationBailout } = routeModule;\nconst originalPathname = \"/api/jira/connect/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZqaXJhJTJGY29ubmVjdCUyRnJvdXRlJnBhZ2U9JTJGYXBpJTJGamlyYSUyRmNvbm5lY3QlMkZyb3V0ZSZhcHBQYXRocz0mcGFnZVBhdGg9cHJpdmF0ZS1uZXh0LWFwcC1kaXIlMkZhcGklMkZqaXJhJTJGY29ubmVjdCUyRnJvdXRlLnRzJmFwcERpcj0lMkZVc2VycyUyRm1hcmlvJTJGZnJpY3Rpb24taW50ZWxsaWdlbmNlJTJGYXBwJnBhZ2VFeHRlbnNpb25zPXRzeCZwYWdlRXh0ZW5zaW9ucz10cyZwYWdlRXh0ZW5zaW9ucz1qc3gmcGFnZUV4dGVuc2lvbnM9anMmcm9vdERpcj0lMkZVc2VycyUyRm1hcmlvJTJGZnJpY3Rpb24taW50ZWxsaWdlbmNlJmlzRGV2PXRydWUmdHNjb25maWdQYXRoPXRzY29uZmlnLmpzb24mYmFzZVBhdGg9JmFzc2V0UHJlZml4PSZuZXh0Q29uZmlnT3V0cHV0PSZwcmVmZXJyZWRSZWdpb249Jm1pZGRsZXdhcmVDb25maWc9ZTMwJTNEISIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7OztBQUFzRztBQUN2QztBQUNjO0FBQ2dCO0FBQzdGO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QixnSEFBbUI7QUFDM0M7QUFDQSxjQUFjLHlFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxZQUFZO0FBQ1osQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBLFFBQVEsdUdBQXVHO0FBQy9HO0FBQ0E7QUFDQSxXQUFXLDRFQUFXO0FBQ3RCO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDNko7O0FBRTdKIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZnJpY3Rpb24taW50ZWxsaWdlbmNlLz82ZWRjIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFwcFJvdXRlUm91dGVNb2R1bGUgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUtbW9kdWxlcy9hcHAtcm91dGUvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgcGF0Y2hGZXRjaCBhcyBfcGF0Y2hGZXRjaCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2xpYi9wYXRjaC1mZXRjaFwiO1xuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIi9Vc2Vycy9tYXJpby9mcmljdGlvbi1pbnRlbGxpZ2VuY2UvYXBwL2FwaS9qaXJhL2Nvbm5lY3Qvcm91dGUudHNcIjtcbi8vIFdlIGluamVjdCB0aGUgbmV4dENvbmZpZ091dHB1dCBoZXJlIHNvIHRoYXQgd2UgY2FuIHVzZSB0aGVtIGluIHRoZSByb3V0ZVxuLy8gbW9kdWxlLlxuY29uc3QgbmV4dENvbmZpZ091dHB1dCA9IFwiXCJcbmNvbnN0IHJvdXRlTW9kdWxlID0gbmV3IEFwcFJvdXRlUm91dGVNb2R1bGUoe1xuICAgIGRlZmluaXRpb246IHtcbiAgICAgICAga2luZDogUm91dGVLaW5kLkFQUF9ST1VURSxcbiAgICAgICAgcGFnZTogXCIvYXBpL2ppcmEvY29ubmVjdC9yb3V0ZVwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL2ppcmEvY29ubmVjdFwiLFxuICAgICAgICBmaWxlbmFtZTogXCJyb3V0ZVwiLFxuICAgICAgICBidW5kbGVQYXRoOiBcImFwcC9hcGkvamlyYS9jb25uZWN0L3JvdXRlXCJcbiAgICB9LFxuICAgIHJlc29sdmVkUGFnZVBhdGg6IFwiL1VzZXJzL21hcmlvL2ZyaWN0aW9uLWludGVsbGlnZW5jZS9hcHAvYXBpL2ppcmEvY29ubmVjdC9yb3V0ZS50c1wiLFxuICAgIG5leHRDb25maWdPdXRwdXQsXG4gICAgdXNlcmxhbmRcbn0pO1xuLy8gUHVsbCBvdXQgdGhlIGV4cG9ydHMgdGhhdCB3ZSBuZWVkIHRvIGV4cG9zZSBmcm9tIHRoZSBtb2R1bGUuIFRoaXMgc2hvdWxkXG4vLyBiZSBlbGltaW5hdGVkIHdoZW4gd2UndmUgbW92ZWQgdGhlIG90aGVyIHJvdXRlcyB0byB0aGUgbmV3IGZvcm1hdC4gVGhlc2Vcbi8vIGFyZSB1c2VkIHRvIGhvb2sgaW50byB0aGUgcm91dGUuXG5jb25zdCB7IHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzLCBoZWFkZXJIb29rcywgc3RhdGljR2VuZXJhdGlvbkJhaWxvdXQgfSA9IHJvdXRlTW9kdWxlO1xuY29uc3Qgb3JpZ2luYWxQYXRobmFtZSA9IFwiL2FwaS9qaXJhL2Nvbm5lY3Qvcm91dGVcIjtcbmZ1bmN0aW9uIHBhdGNoRmV0Y2goKSB7XG4gICAgcmV0dXJuIF9wYXRjaEZldGNoKHtcbiAgICAgICAgc2VydmVySG9va3MsXG4gICAgICAgIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2VcbiAgICB9KTtcbn1cbmV4cG9ydCB7IHJvdXRlTW9kdWxlLCByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcywgaGVhZGVySG9va3MsIHN0YXRpY0dlbmVyYXRpb25CYWlsb3V0LCBvcmlnaW5hbFBhdGhuYW1lLCBwYXRjaEZldGNoLCAgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXBwLXJvdXRlLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fjira%2Fconnect%2Froute&page=%2Fapi%2Fjira%2Fconnect%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fjira%2Fconnect%2Froute.ts&appDir=%2FUsers%2Fmario%2Ffriction-intelligence%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fmario%2Ffriction-intelligence&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./app/api/jira/connect/route.ts":
/*!***************************************!*\
  !*** ./app/api/jira/connect/route.ts ***!
  \***************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/web/exports/next-response */ \"(rsc)/./node_modules/next/dist/server/web/exports/next-response.js\");\n/* harmony import */ var _supabase_auth_helpers_nextjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @supabase/auth-helpers-nextjs */ \"(rsc)/./node_modules/@supabase/auth-helpers-nextjs/dist/index.js\");\n/* harmony import */ var _supabase_auth_helpers_nextjs__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_supabase_auth_helpers_nextjs__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @supabase/supabase-js */ \"(rsc)/./node_modules/@supabase/supabase-js/dist/index.mjs\");\n/* harmony import */ var next_headers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/headers */ \"(rsc)/./node_modules/next/dist/api/headers.js\");\n/* harmony import */ var _lib_encryption__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/lib/encryption */ \"(rsc)/./lib/encryption.ts\");\n\n\n\n\n\nasync function POST(request) {\n    try {\n        const supabase = (0,_supabase_auth_helpers_nextjs__WEBPACK_IMPORTED_MODULE_1__.createRouteHandlerClient)({\n            cookies: next_headers__WEBPACK_IMPORTED_MODULE_2__.cookies\n        });\n        const { data: { user } } = await supabase.auth.getUser();\n        if (!user) {\n            return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                error: \"Not authenticated\"\n            }, {\n                status: 401\n            });\n        }\n        const { jiraUrl, email, apiToken } = await request.json();\n        // Validate inputs\n        if (!jiraUrl || !email || !apiToken) {\n            return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                error: \"Missing required fields. Please provide Jira URL, email, and API token.\"\n            }, {\n                status: 400\n            });\n        }\n        // Clean URL (remove https:// if present, ensure proper format)\n        const cleanUrl = jiraUrl.replace(/^https?:\\/\\//, \"\").replace(/\\/$/, \"\");\n        const baseUrl = `https://${cleanUrl}`;\n        // Test connection by fetching user info\n        const testResponse = await fetch(`${baseUrl}/rest/api/3/myself`, {\n            headers: {\n                \"Authorization\": `Basic ${Buffer.from(`${email}:${apiToken}`).toString(\"base64\")}`,\n                \"Accept\": \"application/json\"\n            }\n        });\n        if (!testResponse.ok) {\n            const errorText = await testResponse.text();\n            console.error(\"Jira connection test failed:\", errorText);\n            return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                error: \"Failed to connect to Jira. Please check your URL, email, and API token.\",\n                details: errorText\n            }, {\n                status: 400\n            });\n        }\n        const jiraUser = await testResponse.json();\n        console.log(\"Jira connection successful:\", jiraUser.displayName);\n        // Store integration\n        const { data: integration, error: integrationError } = await supabase.from(\"integrations\").upsert({\n            user_id: user.id,\n            integration_type: \"jira\",\n            status: \"active\",\n            instance_url: baseUrl,\n            metadata: {\n                email: email,\n                jira_user_name: jiraUser.displayName,\n                jira_account_id: jiraUser.accountId\n            },\n            connected_at: new Date().toISOString()\n        }, {\n            onConflict: \"user_id,integration_type\",\n            ignoreDuplicates: false\n        }).select().single();\n        if (integrationError) {\n            console.error(\"Integration storage error:\", integrationError);\n            throw integrationError;\n        }\n        // Store API token in oauth_tokens table (admin-only access)\n        const supabaseAdmin = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_4__.createClient)(\"https://skoknvludvonitgekwno.supabase.co\", process.env.SUPABASE_SERVICE_ROLE_KEY, {\n            auth: {\n                autoRefreshToken: false,\n                persistSession: false\n            }\n        });\n        // Store encrypted API token\n        try {\n            const tokenId = await (0,_lib_encryption__WEBPACK_IMPORTED_MODULE_3__.upsertEncryptedToken)(supabaseAdmin, {\n                integration_id: integration.id,\n                access_token: apiToken,\n                refresh_token: null,\n                token_type: \"api_token\",\n                expires_at: null\n            });\n            console.log(\"Jira integration and encrypted token stored successfully:\", tokenId);\n        } catch (tokenError) {\n            console.error(\"Failed to store encrypted API token:\", tokenError);\n            throw new Error(`Token storage failed: ${tokenError instanceof Error ? tokenError.message : \"Unknown error\"}`);\n        }\n        return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n            success: true,\n            integration: {\n                id: integration.id,\n                instance_url: integration.instance_url,\n                connected_at: integration.connected_at\n            }\n        });\n    } catch (err) {\n        console.error(\"Jira connection error:\", err);\n        return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n            error: \"Failed to connect to Jira\",\n            details: err instanceof Error ? err.message : \"Unknown error\"\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFVLE1BQU14RCxxRUFBb0JBLENBQUNpRCxlQUFlO2dCQUN4RFEsZ0JBQWdCMUIsWUFBWUksRUFBRTtnQkFDOUJ1QixjQUFjN0M7Z0JBQ2Q4QyxlQUFlO2dCQUNmQyxZQUFZO2dCQUNaQyxZQUFZO1lBQ2Q7WUFFQW5DLFFBQVFHLEdBQUcsQ0FBQyw2REFBNkQyQjtRQUMzRSxFQUFFLE9BQU9NLFlBQVk7WUFDbkJwQyxRQUFRakIsS0FBSyxDQUFDLHdDQUF3Q3FEO1lBQ3RELE1BQU0sSUFBSUMsTUFBTSxDQUFDLHNCQUFzQixFQUFFRCxzQkFBc0JDLFFBQVFELFdBQVdFLE9BQU8sR0FBRyxnQkFBZ0IsQ0FBQztRQUMvRztRQUVBLE9BQU9wRSxrRkFBWUEsQ0FBQ1ksSUFBSSxDQUFDO1lBQ3ZCeUQsU0FBUztZQUNUbEMsYUFBYTtnQkFDWEksSUFBSUosWUFBWUksRUFBRTtnQkFDbEJFLGNBQWNOLFlBQVlNLFlBQVk7Z0JBQ3RDSyxjQUFjWCxZQUFZVyxZQUFZO1lBQ3hDO1FBQ0Y7SUFFRixFQUFFLE9BQU93QixLQUFLO1FBQ1p4QyxRQUFRakIsS0FBSyxDQUFDLDBCQUEwQnlEO1FBQ3hDLE9BQU90RSxrRkFBWUEsQ0FBQ1ksSUFBSSxDQUFDO1lBQ3ZCQyxPQUFPO1lBQ1BrQixTQUFTdUMsZUFBZUgsUUFBUUcsSUFBSUYsT0FBTyxHQUFHO1FBQ2hELEdBQUc7WUFBRXRELFFBQVE7UUFBSTtJQUNuQjtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZnJpY3Rpb24taW50ZWxsaWdlbmNlLy4vYXBwL2FwaS9qaXJhL2Nvbm5lY3Qvcm91dGUudHM/ZWVjZSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZXh0UmVxdWVzdCwgTmV4dFJlc3BvbnNlIH0gZnJvbSAnbmV4dC9zZXJ2ZXInO1xuaW1wb3J0IHsgY3JlYXRlUm91dGVIYW5kbGVyQ2xpZW50IH0gZnJvbSAnQHN1cGFiYXNlL2F1dGgtaGVscGVycy1uZXh0anMnO1xuaW1wb3J0IHsgY3JlYXRlQ2xpZW50IH0gZnJvbSAnQHN1cGFiYXNlL3N1cGFiYXNlLWpzJztcbmltcG9ydCB7IGNvb2tpZXMgfSBmcm9tICduZXh0L2hlYWRlcnMnO1xuaW1wb3J0IHsgdXBzZXJ0RW5jcnlwdGVkVG9rZW4gfSBmcm9tICdAL2xpYi9lbmNyeXB0aW9uJztcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIFBPU1QocmVxdWVzdDogTmV4dFJlcXVlc3QpIHtcbiAgdHJ5IHtcbiAgICBjb25zdCBzdXBhYmFzZSA9IGNyZWF0ZVJvdXRlSGFuZGxlckNsaWVudCh7IGNvb2tpZXMgfSk7XG5cbiAgICBjb25zdCB7IGRhdGE6IHsgdXNlciB9IH0gPSBhd2FpdCBzdXBhYmFzZS5hdXRoLmdldFVzZXIoKTtcbiAgICBpZiAoIXVzZXIpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiAnTm90IGF1dGhlbnRpY2F0ZWQnIH0sIHsgc3RhdHVzOiA0MDEgfSk7XG4gICAgfVxuXG4gICAgY29uc3QgeyBqaXJhVXJsLCBlbWFpbCwgYXBpVG9rZW4gfSA9IGF3YWl0IHJlcXVlc3QuanNvbigpO1xuXG4gICAgLy8gVmFsaWRhdGUgaW5wdXRzXG4gICAgaWYgKCFqaXJhVXJsIHx8ICFlbWFpbCB8fCAhYXBpVG9rZW4pIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICAgIGVycm9yOiAnTWlzc2luZyByZXF1aXJlZCBmaWVsZHMuIFBsZWFzZSBwcm92aWRlIEppcmEgVVJMLCBlbWFpbCwgYW5kIEFQSSB0b2tlbi4nXG4gICAgICB9LCB7IHN0YXR1czogNDAwIH0pO1xuICAgIH1cblxuICAgIC8vIENsZWFuIFVSTCAocmVtb3ZlIGh0dHBzOi8vIGlmIHByZXNlbnQsIGVuc3VyZSBwcm9wZXIgZm9ybWF0KVxuICAgIGNvbnN0IGNsZWFuVXJsID0gamlyYVVybC5yZXBsYWNlKC9eaHR0cHM/OlxcL1xcLy8sICcnKS5yZXBsYWNlKC9cXC8kLywgJycpO1xuICAgIGNvbnN0IGJhc2VVcmwgPSBgaHR0cHM6Ly8ke2NsZWFuVXJsfWA7XG5cbiAgICAvLyBUZXN0IGNvbm5lY3Rpb24gYnkgZmV0Y2hpbmcgdXNlciBpbmZvXG4gICAgY29uc3QgdGVzdFJlc3BvbnNlID0gYXdhaXQgZmV0Y2goYCR7YmFzZVVybH0vcmVzdC9hcGkvMy9teXNlbGZgLCB7XG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgICdBdXRob3JpemF0aW9uJzogYEJhc2ljICR7QnVmZmVyLmZyb20oYCR7ZW1haWx9OiR7YXBpVG9rZW59YCkudG9TdHJpbmcoJ2Jhc2U2NCcpfWAsXG4gICAgICAgICdBY2NlcHQnOiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgaWYgKCF0ZXN0UmVzcG9uc2Uub2spIHtcbiAgICAgIGNvbnN0IGVycm9yVGV4dCA9IGF3YWl0IHRlc3RSZXNwb25zZS50ZXh0KCk7XG4gICAgICBjb25zb2xlLmVycm9yKCdKaXJhIGNvbm5lY3Rpb24gdGVzdCBmYWlsZWQ6JywgZXJyb3JUZXh0KTtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICAgIGVycm9yOiAnRmFpbGVkIHRvIGNvbm5lY3QgdG8gSmlyYS4gUGxlYXNlIGNoZWNrIHlvdXIgVVJMLCBlbWFpbCwgYW5kIEFQSSB0b2tlbi4nLFxuICAgICAgICBkZXRhaWxzOiBlcnJvclRleHRcbiAgICAgIH0sIHsgc3RhdHVzOiA0MDAgfSk7XG4gICAgfVxuXG4gICAgY29uc3QgamlyYVVzZXIgPSBhd2FpdCB0ZXN0UmVzcG9uc2UuanNvbigpO1xuICAgIGNvbnNvbGUubG9nKCdKaXJhIGNvbm5lY3Rpb24gc3VjY2Vzc2Z1bDonLCBqaXJhVXNlci5kaXNwbGF5TmFtZSk7XG5cbiAgICAvLyBTdG9yZSBpbnRlZ3JhdGlvblxuICAgIGNvbnN0IHsgZGF0YTogaW50ZWdyYXRpb24sIGVycm9yOiBpbnRlZ3JhdGlvbkVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgLmZyb20oJ2ludGVncmF0aW9ucycpXG4gICAgICAudXBzZXJ0KHtcbiAgICAgICAgdXNlcl9pZDogdXNlci5pZCxcbiAgICAgICAgaW50ZWdyYXRpb25fdHlwZTogJ2ppcmEnLFxuICAgICAgICBzdGF0dXM6ICdhY3RpdmUnLFxuICAgICAgICBpbnN0YW5jZV91cmw6IGJhc2VVcmwsXG4gICAgICAgIG1ldGFkYXRhOiB7XG4gICAgICAgICAgZW1haWw6IGVtYWlsLFxuICAgICAgICAgIGppcmFfdXNlcl9uYW1lOiBqaXJhVXNlci5kaXNwbGF5TmFtZSxcbiAgICAgICAgICBqaXJhX2FjY291bnRfaWQ6IGppcmFVc2VyLmFjY291bnRJZCxcbiAgICAgICAgfSxcbiAgICAgICAgY29ubmVjdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICB9LCB7XG4gICAgICAgIG9uQ29uZmxpY3Q6ICd1c2VyX2lkLGludGVncmF0aW9uX3R5cGUnLFxuICAgICAgICBpZ25vcmVEdXBsaWNhdGVzOiBmYWxzZVxuICAgICAgfSlcbiAgICAgIC5zZWxlY3QoKVxuICAgICAgLnNpbmdsZSgpO1xuXG4gICAgaWYgKGludGVncmF0aW9uRXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0ludGVncmF0aW9uIHN0b3JhZ2UgZXJyb3I6JywgaW50ZWdyYXRpb25FcnJvcik7XG4gICAgICB0aHJvdyBpbnRlZ3JhdGlvbkVycm9yO1xuICAgIH1cblxuICAgIC8vIFN0b3JlIEFQSSB0b2tlbiBpbiBvYXV0aF90b2tlbnMgdGFibGUgKGFkbWluLW9ubHkgYWNjZXNzKVxuICAgIGNvbnN0IHN1cGFiYXNlQWRtaW4gPSBjcmVhdGVDbGllbnQoXG4gICAgICBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwhLFxuICAgICAgcHJvY2Vzcy5lbnYuU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWSEsXG4gICAgICB7XG4gICAgICAgIGF1dGg6IHtcbiAgICAgICAgICBhdXRvUmVmcmVzaFRva2VuOiBmYWxzZSxcbiAgICAgICAgICBwZXJzaXN0U2Vzc2lvbjogZmFsc2VcbiAgICAgICAgfVxuICAgICAgfVxuICAgICk7XG5cbiAgICAvLyBTdG9yZSBlbmNyeXB0ZWQgQVBJIHRva2VuXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHRva2VuSWQgPSBhd2FpdCB1cHNlcnRFbmNyeXB0ZWRUb2tlbihzdXBhYmFzZUFkbWluLCB7XG4gICAgICAgIGludGVncmF0aW9uX2lkOiBpbnRlZ3JhdGlvbi5pZCxcbiAgICAgICAgYWNjZXNzX3Rva2VuOiBhcGlUb2tlbiwgLy8gU3RvcmUgQVBJIHRva2VuXG4gICAgICAgIHJlZnJlc2hfdG9rZW46IG51bGwsIC8vIEppcmEgdG9rZW5zIGRvbid0IGV4cGlyZVxuICAgICAgICB0b2tlbl90eXBlOiAnYXBpX3Rva2VuJyxcbiAgICAgICAgZXhwaXJlc19hdDogbnVsbCwgLy8gTm8gZXhwaXJhdGlvblxuICAgICAgfSk7XG5cbiAgICAgIGNvbnNvbGUubG9nKCdKaXJhIGludGVncmF0aW9uIGFuZCBlbmNyeXB0ZWQgdG9rZW4gc3RvcmVkIHN1Y2Nlc3NmdWxseTonLCB0b2tlbklkKTtcbiAgICB9IGNhdGNoICh0b2tlbkVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gc3RvcmUgZW5jcnlwdGVkIEFQSSB0b2tlbjonLCB0b2tlbkVycm9yKTtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgVG9rZW4gc3RvcmFnZSBmYWlsZWQ6ICR7dG9rZW5FcnJvciBpbnN0YW5jZW9mIEVycm9yID8gdG9rZW5FcnJvci5tZXNzYWdlIDogJ1Vua25vd24gZXJyb3InfWApO1xuICAgIH1cblxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgaW50ZWdyYXRpb246IHtcbiAgICAgICAgaWQ6IGludGVncmF0aW9uLmlkLFxuICAgICAgICBpbnN0YW5jZV91cmw6IGludGVncmF0aW9uLmluc3RhbmNlX3VybCxcbiAgICAgICAgY29ubmVjdGVkX2F0OiBpbnRlZ3JhdGlvbi5jb25uZWN0ZWRfYXQsXG4gICAgICB9XG4gICAgfSk7XG5cbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgY29uc29sZS5lcnJvcignSmlyYSBjb25uZWN0aW9uIGVycm9yOicsIGVycik7XG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgIGVycm9yOiAnRmFpbGVkIHRvIGNvbm5lY3QgdG8gSmlyYScsXG4gICAgICBkZXRhaWxzOiBlcnIgaW5zdGFuY2VvZiBFcnJvciA/IGVyci5tZXNzYWdlIDogJ1Vua25vd24gZXJyb3InXG4gICAgfSwgeyBzdGF0dXM6IDUwMCB9KTtcbiAgfVxufVxuIl0sIm5hbWVzIjpbIk5leHRSZXNwb25zZSIsImNyZWF0ZVJvdXRlSGFuZGxlckNsaWVudCIsImNyZWF0ZUNsaWVudCIsImNvb2tpZXMiLCJ1cHNlcnRFbmNyeXB0ZWRUb2tlbiIsIlBPU1QiLCJyZXF1ZXN0Iiwic3VwYWJhc2UiLCJkYXRhIiwidXNlciIsImF1dGgiLCJnZXRVc2VyIiwianNvbiIsImVycm9yIiwic3RhdHVzIiwiamlyYVVybCIsImVtYWlsIiwiYXBpVG9rZW4iLCJjbGVhblVybCIsInJlcGxhY2UiLCJiYXNlVXJsIiwidGVzdFJlc3BvbnNlIiwiZmV0Y2giLCJoZWFkZXJzIiwiQnVmZmVyIiwiZnJvbSIsInRvU3RyaW5nIiwib2siLCJlcnJvclRleHQiLCJ0ZXh0IiwiY29uc29sZSIsImRldGFpbHMiLCJqaXJhVXNlciIsImxvZyIsImRpc3BsYXlOYW1lIiwiaW50ZWdyYXRpb24iLCJpbnRlZ3JhdGlvbkVycm9yIiwidXBzZXJ0IiwidXNlcl9pZCIsImlkIiwiaW50ZWdyYXRpb25fdHlwZSIsImluc3RhbmNlX3VybCIsIm1ldGFkYXRhIiwiamlyYV91c2VyX25hbWUiLCJqaXJhX2FjY291bnRfaWQiLCJhY2NvdW50SWQiLCJjb25uZWN0ZWRfYXQiLCJEYXRlIiwidG9JU09TdHJpbmciLCJvbkNvbmZsaWN0IiwiaWdub3JlRHVwbGljYXRlcyIsInNlbGVjdCIsInNpbmdsZSIsInN1cGFiYXNlQWRtaW4iLCJwcm9jZXNzIiwiZW52IiwiTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMIiwiU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWSIsImF1dG9SZWZyZXNoVG9rZW4iLCJwZXJzaXN0U2Vzc2lvbiIsInRva2VuSWQiLCJpbnRlZ3JhdGlvbl9pZCIsImFjY2Vzc190b2tlbiIsInJlZnJlc2hfdG9rZW4iLCJ0b2tlbl90eXBlIiwiZXhwaXJlc19hdCIsInRva2VuRXJyb3IiLCJFcnJvciIsIm1lc3NhZ2UiLCJzdWNjZXNzIiwiZXJyIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./app/api/jira/connect/route.ts\n");

/***/ }),

/***/ "(rsc)/./lib/encryption.ts":
/*!***************************!*\
  !*** ./lib/encryption.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   checkEncryptionStatus: () => (/* binding */ checkEncryptionStatus),\n/* harmony export */   getDecryptedToken: () => (/* binding */ getDecryptedToken),\n/* harmony export */   getEncryptionKey: () => (/* binding */ getEncryptionKey),\n/* harmony export */   updateEncryptedAccessToken: () => (/* binding */ updateEncryptedAccessToken),\n/* harmony export */   upsertEncryptedToken: () => (/* binding */ upsertEncryptedToken)\n/* harmony export */ });\n/**\n * Encryption Utility Module\n *\n * Provides helper functions for column-level encryption of OAuth tokens\n * using Supabase pgcrypto extension (symmetric encryption).\n *\n * Security Notes:\n * - Encryption key stored in ENCRYPTION_KEY environment variable\n * - Only server-side code (API routes) should import this module\n * - Never expose encryption key to client-side code\n * - All encryption/decryption happens in PostgreSQL using pgp_sym_* functions\n */ /**\n * Get encryption key from environment variables\n *\n * @throws {Error} If ENCRYPTION_KEY is not set or too short\n * @returns Encryption key string\n */ function getEncryptionKey() {\n    const key = process.env.ENCRYPTION_KEY;\n    if (!key) {\n        throw new Error(\"ENCRYPTION_KEY environment variable is not set. \" + \"Generate one with: openssl rand -base64 32\");\n    }\n    if (key.length < 32) {\n        throw new Error(\"ENCRYPTION_KEY must be at least 32 characters for security. \" + \"Current length: \" + key.length);\n    }\n    return key;\n}\n/**\n * Insert or update OAuth token with encryption (UPSERT)\n *\n * Uses PostgreSQL function `insert_encrypted_token` to handle encryption\n * at the database layer. If a token already exists for the integration,\n * it will be updated.\n *\n * @param supabase - Supabase client (must have service role access)\n * @param data - Token data to encrypt and store\n * @returns Token ID if successful\n * @throws {Error} If encryption or database operation fails\n *\n * @example\n * ```typescript\n * const tokenId = await upsertEncryptedToken(supabaseAdmin, {\n *   integration_id: '123e4567-e89b-12d3-a456-426614174000',\n *   access_token: 'salesforce_access_token_here',\n *   refresh_token: 'salesforce_refresh_token_here',\n *   token_type: 'Bearer',\n *   expires_at: '2024-12-31T23:59:59Z'\n * });\n * ```\n */ async function upsertEncryptedToken(supabase, data) {\n    const encryptionKey = getEncryptionKey();\n    try {\n        const { data: result, error } = await supabase.rpc(\"insert_encrypted_token\", {\n            p_integration_id: data.integration_id,\n            p_access_token: data.access_token,\n            p_refresh_token: data.refresh_token,\n            p_token_type: data.token_type,\n            p_expires_at: data.expires_at,\n            p_encryption_key: encryptionKey\n        });\n        if (error) {\n            console.error(\"Failed to upsert encrypted token:\", error);\n            throw new Error(`Token encryption failed: ${error.message}`);\n        }\n        if (!result) {\n            throw new Error(\"Token insertion returned no ID\");\n        }\n        console.log(\"Token stored successfully (encrypted)\");\n        return result;\n    } catch (error) {\n        console.error(\"Encryption error:\", error);\n        throw error;\n    }\n}\n/**\n * Update access token only (for token refresh operations)\n *\n * Used when refreshing Salesforce OAuth tokens. Only updates the\n * access_token and expires_at fields, preserving the refresh_token.\n *\n * @param supabase - Supabase client (must have service role access)\n * @param tokenId - UUID of the token record to update\n * @param accessToken - New access token value\n * @param expiresAt - New expiration timestamp\n * @returns True if update successful\n * @throws {Error} If encryption or database operation fails\n *\n * @example\n * ```typescript\n * await updateEncryptedAccessToken(\n *   supabaseAdmin,\n *   'token-uuid',\n *   'new_access_token',\n *   '2024-12-31T23:59:59Z'\n * );\n * ```\n */ async function updateEncryptedAccessToken(supabase, tokenId, accessToken, expiresAt) {\n    const encryptionKey = getEncryptionKey();\n    try {\n        const { data: result, error } = await supabase.rpc(\"update_encrypted_token\", {\n            p_token_id: tokenId,\n            p_access_token: accessToken,\n            p_expires_at: expiresAt,\n            p_encryption_key: encryptionKey\n        });\n        if (error) {\n            console.error(\"Failed to update encrypted token:\", error);\n            throw new Error(`Token update failed: ${error.message}`);\n        }\n        if (!result) {\n            console.warn(\"Token update returned false - token may not exist\");\n            return false;\n        }\n        console.log(\"Token refreshed successfully (encrypted)\");\n        return result;\n    } catch (error) {\n        console.error(\"Token update error:\", error);\n        throw error;\n    }\n}\n/**\n * Retrieve and decrypt OAuth token for a given integration\n *\n * Fetches encrypted token from database and decrypts it using the\n * PostgreSQL function `get_decrypted_token`. Returns null if token\n * not found.\n *\n * @param supabase - Supabase client (must have service role access)\n * @param integrationId - UUID of the integration\n * @returns Decrypted token data or null if not found\n * @throws {Error} If decryption fails (wrong key, corrupted data, etc.)\n *\n * @example\n * ```typescript\n * const token = await getDecryptedToken(\n *   supabaseAdmin,\n *   '123e4567-e89b-12d3-a456-426614174000'\n * );\n *\n * if (token) {\n *   // Use token.access_token for API calls\n *   fetch(apiUrl, {\n *     headers: { Authorization: `Bearer ${token.access_token}` }\n *   });\n * }\n * ```\n */ async function getDecryptedToken(supabase, integrationId) {\n    const encryptionKey = getEncryptionKey();\n    try {\n        const { data, error } = await supabase.rpc(\"get_decrypted_token\", {\n            p_integration_id: integrationId,\n            p_encryption_key: encryptionKey\n        });\n        if (error) {\n            console.error(\"Failed to fetch/decrypt token:\", error);\n            // Provide helpful error messages\n            if (error.message.includes(\"decrypt\") || error.message.includes(\"Wrong key\")) {\n                throw new Error(\"Token decryption failed - ENCRYPTION_KEY may be incorrect or changed. \" + \"Verify the key matches what was used during encryption.\");\n            }\n            throw new Error(`Token retrieval failed: ${error.message}`);\n        }\n        if (!data || Array.isArray(data) && data.length === 0) {\n            console.warn(`No token found for integration: ${integrationId}`);\n            return null;\n        }\n        // RPC returns an array, get first item\n        const token = Array.isArray(data) ? data[0] : data;\n        // Validate decrypted token structure\n        if (!token.access_token) {\n            throw new Error(\"Decrypted token is missing access_token - data may be corrupted\");\n        }\n        return token;\n    } catch (error) {\n        console.error(\"Token decryption error:\", error);\n        throw error;\n    }\n}\n/**\n * Check encryption status of oauth_tokens table\n *\n * Utility function to verify encryption migration status.\n * Returns statistics about encrypted vs plaintext tokens.\n *\n * @param supabase - Supabase client (must have service role access)\n * @returns Encryption status statistics\n *\n * @example\n * ```typescript\n * const status = await checkEncryptionStatus(supabaseAdmin);\n * console.log(`Encryption rate: ${status.encryption_percentage}%`);\n * ```\n */ async function checkEncryptionStatus(supabase) {\n    try {\n        const { data, error } = await supabase.rpc(\"check_encryption_status\");\n        if (error) {\n            console.error(\"Failed to check encryption status:\", error);\n            throw new Error(`Encryption status check failed: ${error.message}`);\n        }\n        // RPC returns an array with one result\n        const status = Array.isArray(data) ? data[0] : data;\n        return {\n            total_tokens: Number(status.total_tokens || 0),\n            encrypted_access_tokens: Number(status.encrypted_access_tokens || 0),\n            encrypted_refresh_tokens: Number(status.encrypted_refresh_tokens || 0),\n            plaintext_access_tokens: Number(status.plaintext_access_tokens || 0),\n            plaintext_refresh_tokens: Number(status.plaintext_refresh_tokens || 0),\n            encryption_percentage: Number(status.encryption_percentage || 0)\n        };\n    } catch (error) {\n        console.error(\"Encryption status check error:\", error);\n        throw error;\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QkFBd0IsSUFBSTtZQUNwRUMseUJBQXlCSCxPQUFPRixPQUFPSyx1QkFBdUIsSUFBSTtZQUNsRUMsMEJBQTBCSixPQUFPRixPQUFPTSx3QkFBd0IsSUFBSTtZQUNwRUMsdUJBQXVCTCxPQUFPRixPQUFPTyxxQkFBcUIsSUFBSTtRQUNoRTtJQUNGLEVBQUUsT0FBT3BDLE9BQU87UUFDZGEsUUFBUWIsS0FBSyxDQUFDLGtDQUFrQ0E7UUFDaEQsTUFBTUE7SUFDUjtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZnJpY3Rpb24taW50ZWxsaWdlbmNlLy4vbGliL2VuY3J5cHRpb24udHM/MzM3NSJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEVuY3J5cHRpb24gVXRpbGl0eSBNb2R1bGVcbiAqXG4gKiBQcm92aWRlcyBoZWxwZXIgZnVuY3Rpb25zIGZvciBjb2x1bW4tbGV2ZWwgZW5jcnlwdGlvbiBvZiBPQXV0aCB0b2tlbnNcbiAqIHVzaW5nIFN1cGFiYXNlIHBnY3J5cHRvIGV4dGVuc2lvbiAoc3ltbWV0cmljIGVuY3J5cHRpb24pLlxuICpcbiAqIFNlY3VyaXR5IE5vdGVzOlxuICogLSBFbmNyeXB0aW9uIGtleSBzdG9yZWQgaW4gRU5DUllQVElPTl9LRVkgZW52aXJvbm1lbnQgdmFyaWFibGVcbiAqIC0gT25seSBzZXJ2ZXItc2lkZSBjb2RlIChBUEkgcm91dGVzKSBzaG91bGQgaW1wb3J0IHRoaXMgbW9kdWxlXG4gKiAtIE5ldmVyIGV4cG9zZSBlbmNyeXB0aW9uIGtleSB0byBjbGllbnQtc2lkZSBjb2RlXG4gKiAtIEFsbCBlbmNyeXB0aW9uL2RlY3J5cHRpb24gaGFwcGVucyBpbiBQb3N0Z3JlU1FMIHVzaW5nIHBncF9zeW1fKiBmdW5jdGlvbnNcbiAqL1xuXG5pbXBvcnQgeyBTdXBhYmFzZUNsaWVudCB9IGZyb20gJ0BzdXBhYmFzZS9zdXBhYmFzZS1qcyc7XG5cbi8qKlxuICogVG9rZW4gZGF0YSBzdHJ1Y3R1cmUgZm9yIGVuY3J5cHRpb24gb3BlcmF0aW9uc1xuICovXG5leHBvcnQgaW50ZXJmYWNlIFRva2VuRGF0YSB7XG4gIGludGVncmF0aW9uX2lkOiBzdHJpbmc7XG4gIGFjY2Vzc190b2tlbjogc3RyaW5nO1xuICByZWZyZXNoX3Rva2VuOiBzdHJpbmcgfCBudWxsO1xuICB0b2tlbl90eXBlOiBzdHJpbmc7XG4gIGV4cGlyZXNfYXQ6IHN0cmluZyB8IG51bGw7XG59XG5cbi8qKlxuICogRGVjcnlwdGVkIHRva2VuIHN0cnVjdHVyZSByZXR1cm5lZCBmcm9tIGRhdGFiYXNlXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgRGVjcnlwdGVkVG9rZW4ge1xuICBpZDogc3RyaW5nO1xuICBpbnRlZ3JhdGlvbl9pZDogc3RyaW5nO1xuICBhY2Nlc3NfdG9rZW46IHN0cmluZztcbiAgcmVmcmVzaF90b2tlbjogc3RyaW5nIHwgbnVsbDtcbiAgdG9rZW5fdHlwZTogc3RyaW5nO1xuICBleHBpcmVzX2F0OiBzdHJpbmcgfCBudWxsO1xuICBjcmVhdGVkX2F0OiBzdHJpbmc7XG4gIHVwZGF0ZWRfYXQ6IHN0cmluZztcbn1cblxuLyoqXG4gKiBHZXQgZW5jcnlwdGlvbiBrZXkgZnJvbSBlbnZpcm9ubWVudCB2YXJpYWJsZXNcbiAqXG4gKiBAdGhyb3dzIHtFcnJvcn0gSWYgRU5DUllQVElPTl9LRVkgaXMgbm90IHNldCBvciB0b28gc2hvcnRcbiAqIEByZXR1cm5zIEVuY3J5cHRpb24ga2V5IHN0cmluZ1xuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0RW5jcnlwdGlvbktleSgpOiBzdHJpbmcge1xuICBjb25zdCBrZXkgPSBwcm9jZXNzLmVudi5FTkNSWVBUSU9OX0tFWTtcblxuICBpZiAoIWtleSkge1xuICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICdFTkNSWVBUSU9OX0tFWSBlbnZpcm9ubWVudCB2YXJpYWJsZSBpcyBub3Qgc2V0LiAnICtcbiAgICAgICAgJ0dlbmVyYXRlIG9uZSB3aXRoOiBvcGVuc3NsIHJhbmQgLWJhc2U2NCAzMidcbiAgICApO1xuICB9XG5cbiAgaWYgKGtleS5sZW5ndGggPCAzMikge1xuICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICdFTkNSWVBUSU9OX0tFWSBtdXN0IGJlIGF0IGxlYXN0IDMyIGNoYXJhY3RlcnMgZm9yIHNlY3VyaXR5LiAnICtcbiAgICAgICAgJ0N1cnJlbnQgbGVuZ3RoOiAnICtcbiAgICAgICAga2V5Lmxlbmd0aFxuICAgICk7XG4gIH1cblxuICByZXR1cm4ga2V5O1xufVxuXG4vKipcbiAqIEluc2VydCBvciB1cGRhdGUgT0F1dGggdG9rZW4gd2l0aCBlbmNyeXB0aW9uIChVUFNFUlQpXG4gKlxuICogVXNlcyBQb3N0Z3JlU1FMIGZ1bmN0aW9uIGBpbnNlcnRfZW5jcnlwdGVkX3Rva2VuYCB0byBoYW5kbGUgZW5jcnlwdGlvblxuICogYXQgdGhlIGRhdGFiYXNlIGxheWVyLiBJZiBhIHRva2VuIGFscmVhZHkgZXhpc3RzIGZvciB0aGUgaW50ZWdyYXRpb24sXG4gKiBpdCB3aWxsIGJlIHVwZGF0ZWQuXG4gKlxuICogQHBhcmFtIHN1cGFiYXNlIC0gU3VwYWJhc2UgY2xpZW50IChtdXN0IGhhdmUgc2VydmljZSByb2xlIGFjY2VzcylcbiAqIEBwYXJhbSBkYXRhIC0gVG9rZW4gZGF0YSB0byBlbmNyeXB0IGFuZCBzdG9yZVxuICogQHJldHVybnMgVG9rZW4gSUQgaWYgc3VjY2Vzc2Z1bFxuICogQHRocm93cyB7RXJyb3J9IElmIGVuY3J5cHRpb24gb3IgZGF0YWJhc2Ugb3BlcmF0aW9uIGZhaWxzXG4gKlxuICogQGV4YW1wbGVcbiAqIGBgYHR5cGVzY3JpcHRcbiAqIGNvbnN0IHRva2VuSWQgPSBhd2FpdCB1cHNlcnRFbmNyeXB0ZWRUb2tlbihzdXBhYmFzZUFkbWluLCB7XG4gKiAgIGludGVncmF0aW9uX2lkOiAnMTIzZTQ1NjctZTg5Yi0xMmQzLWE0NTYtNDI2NjE0MTc0MDAwJyxcbiAqICAgYWNjZXNzX3Rva2VuOiAnc2FsZXNmb3JjZV9hY2Nlc3NfdG9rZW5faGVyZScsXG4gKiAgIHJlZnJlc2hfdG9rZW46ICdzYWxlc2ZvcmNlX3JlZnJlc2hfdG9rZW5faGVyZScsXG4gKiAgIHRva2VuX3R5cGU6ICdCZWFyZXInLFxuICogICBleHBpcmVzX2F0OiAnMjAyNC0xMi0zMVQyMzo1OTo1OVonXG4gKiB9KTtcbiAqIGBgYFxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdXBzZXJ0RW5jcnlwdGVkVG9rZW4oXG4gIHN1cGFiYXNlOiBTdXBhYmFzZUNsaWVudCxcbiAgZGF0YTogVG9rZW5EYXRhXG4pOiBQcm9taXNlPHN0cmluZz4ge1xuICBjb25zdCBlbmNyeXB0aW9uS2V5ID0gZ2V0RW5jcnlwdGlvbktleSgpO1xuXG4gIHRyeSB7XG4gICAgY29uc3QgeyBkYXRhOiByZXN1bHQsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZS5ycGMoJ2luc2VydF9lbmNyeXB0ZWRfdG9rZW4nLCB7XG4gICAgICBwX2ludGVncmF0aW9uX2lkOiBkYXRhLmludGVncmF0aW9uX2lkLFxuICAgICAgcF9hY2Nlc3NfdG9rZW46IGRhdGEuYWNjZXNzX3Rva2VuLFxuICAgICAgcF9yZWZyZXNoX3Rva2VuOiBkYXRhLnJlZnJlc2hfdG9rZW4sXG4gICAgICBwX3Rva2VuX3R5cGU6IGRhdGEudG9rZW5fdHlwZSxcbiAgICAgIHBfZXhwaXJlc19hdDogZGF0YS5leHBpcmVzX2F0LFxuICAgICAgcF9lbmNyeXB0aW9uX2tleTogZW5jcnlwdGlvbktleSxcbiAgICB9KTtcblxuICAgIGlmIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIHVwc2VydCBlbmNyeXB0ZWQgdG9rZW46JywgZXJyb3IpO1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBUb2tlbiBlbmNyeXB0aW9uIGZhaWxlZDogJHtlcnJvci5tZXNzYWdlfWApO1xuICAgIH1cblxuICAgIGlmICghcmVzdWx0KSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1Rva2VuIGluc2VydGlvbiByZXR1cm5lZCBubyBJRCcpO1xuICAgIH1cblxuICAgIGNvbnNvbGUubG9nKCdUb2tlbiBzdG9yZWQgc3VjY2Vzc2Z1bGx5IChlbmNyeXB0ZWQpJyk7XG4gICAgcmV0dXJuIHJlc3VsdCBhcyBzdHJpbmc7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRW5jcnlwdGlvbiBlcnJvcjonLCBlcnJvcik7XG4gICAgdGhyb3cgZXJyb3I7XG4gIH1cbn1cblxuLyoqXG4gKiBVcGRhdGUgYWNjZXNzIHRva2VuIG9ubHkgKGZvciB0b2tlbiByZWZyZXNoIG9wZXJhdGlvbnMpXG4gKlxuICogVXNlZCB3aGVuIHJlZnJlc2hpbmcgU2FsZXNmb3JjZSBPQXV0aCB0b2tlbnMuIE9ubHkgdXBkYXRlcyB0aGVcbiAqIGFjY2Vzc190b2tlbiBhbmQgZXhwaXJlc19hdCBmaWVsZHMsIHByZXNlcnZpbmcgdGhlIHJlZnJlc2hfdG9rZW4uXG4gKlxuICogQHBhcmFtIHN1cGFiYXNlIC0gU3VwYWJhc2UgY2xpZW50IChtdXN0IGhhdmUgc2VydmljZSByb2xlIGFjY2VzcylcbiAqIEBwYXJhbSB0b2tlbklkIC0gVVVJRCBvZiB0aGUgdG9rZW4gcmVjb3JkIHRvIHVwZGF0ZVxuICogQHBhcmFtIGFjY2Vzc1Rva2VuIC0gTmV3IGFjY2VzcyB0b2tlbiB2YWx1ZVxuICogQHBhcmFtIGV4cGlyZXNBdCAtIE5ldyBleHBpcmF0aW9uIHRpbWVzdGFtcFxuICogQHJldHVybnMgVHJ1ZSBpZiB1cGRhdGUgc3VjY2Vzc2Z1bFxuICogQHRocm93cyB7RXJyb3J9IElmIGVuY3J5cHRpb24gb3IgZGF0YWJhc2Ugb3BlcmF0aW9uIGZhaWxzXG4gKlxuICogQGV4YW1wbGVcbiAqIGBgYHR5cGVzY3JpcHRcbiAqIGF3YWl0IHVwZGF0ZUVuY3J5cHRlZEFjY2Vzc1Rva2VuKFxuICogICBzdXBhYmFzZUFkbWluLFxuICogICAndG9rZW4tdXVpZCcsXG4gKiAgICduZXdfYWNjZXNzX3Rva2VuJyxcbiAqICAgJzIwMjQtMTItMzFUMjM6NTk6NTlaJ1xuICogKTtcbiAqIGBgYFxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdXBkYXRlRW5jcnlwdGVkQWNjZXNzVG9rZW4oXG4gIHN1cGFiYXNlOiBTdXBhYmFzZUNsaWVudCxcbiAgdG9rZW5JZDogc3RyaW5nLFxuICBhY2Nlc3NUb2tlbjogc3RyaW5nLFxuICBleHBpcmVzQXQ6IHN0cmluZ1xuKTogUHJvbWlzZTxib29sZWFuPiB7XG4gIGNvbnN0IGVuY3J5cHRpb25LZXkgPSBnZXRFbmNyeXB0aW9uS2V5KCk7XG5cbiAgdHJ5IHtcbiAgICBjb25zdCB7IGRhdGE6IHJlc3VsdCwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlLnJwYygndXBkYXRlX2VuY3J5cHRlZF90b2tlbicsIHtcbiAgICAgIHBfdG9rZW5faWQ6IHRva2VuSWQsXG4gICAgICBwX2FjY2Vzc190b2tlbjogYWNjZXNzVG9rZW4sXG4gICAgICBwX2V4cGlyZXNfYXQ6IGV4cGlyZXNBdCxcbiAgICAgIHBfZW5jcnlwdGlvbl9rZXk6IGVuY3J5cHRpb25LZXksXG4gICAgfSk7XG5cbiAgICBpZiAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byB1cGRhdGUgZW5jcnlwdGVkIHRva2VuOicsIGVycm9yKTtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgVG9rZW4gdXBkYXRlIGZhaWxlZDogJHtlcnJvci5tZXNzYWdlfWApO1xuICAgIH1cblxuICAgIGlmICghcmVzdWx0KSB7XG4gICAgICBjb25zb2xlLndhcm4oJ1Rva2VuIHVwZGF0ZSByZXR1cm5lZCBmYWxzZSAtIHRva2VuIG1heSBub3QgZXhpc3QnKTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBjb25zb2xlLmxvZygnVG9rZW4gcmVmcmVzaGVkIHN1Y2Nlc3NmdWxseSAoZW5jcnlwdGVkKScpO1xuICAgIHJldHVybiByZXN1bHQgYXMgYm9vbGVhbjtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdUb2tlbiB1cGRhdGUgZXJyb3I6JywgZXJyb3IpO1xuICAgIHRocm93IGVycm9yO1xuICB9XG59XG5cbi8qKlxuICogUmV0cmlldmUgYW5kIGRlY3J5cHQgT0F1dGggdG9rZW4gZm9yIGEgZ2l2ZW4gaW50ZWdyYXRpb25cbiAqXG4gKiBGZXRjaGVzIGVuY3J5cHRlZCB0b2tlbiBmcm9tIGRhdGFiYXNlIGFuZCBkZWNyeXB0cyBpdCB1c2luZyB0aGVcbiAqIFBvc3RncmVTUUwgZnVuY3Rpb24gYGdldF9kZWNyeXB0ZWRfdG9rZW5gLiBSZXR1cm5zIG51bGwgaWYgdG9rZW5cbiAqIG5vdCBmb3VuZC5cbiAqXG4gKiBAcGFyYW0gc3VwYWJhc2UgLSBTdXBhYmFzZSBjbGllbnQgKG11c3QgaGF2ZSBzZXJ2aWNlIHJvbGUgYWNjZXNzKVxuICogQHBhcmFtIGludGVncmF0aW9uSWQgLSBVVUlEIG9mIHRoZSBpbnRlZ3JhdGlvblxuICogQHJldHVybnMgRGVjcnlwdGVkIHRva2VuIGRhdGEgb3IgbnVsbCBpZiBub3QgZm91bmRcbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiBkZWNyeXB0aW9uIGZhaWxzICh3cm9uZyBrZXksIGNvcnJ1cHRlZCBkYXRhLCBldGMuKVxuICpcbiAqIEBleGFtcGxlXG4gKiBgYGB0eXBlc2NyaXB0XG4gKiBjb25zdCB0b2tlbiA9IGF3YWl0IGdldERlY3J5cHRlZFRva2VuKFxuICogICBzdXBhYmFzZUFkbWluLFxuICogICAnMTIzZTQ1NjctZTg5Yi0xMmQzLWE0NTYtNDI2NjE0MTc0MDAwJ1xuICogKTtcbiAqXG4gKiBpZiAodG9rZW4pIHtcbiAqICAgLy8gVXNlIHRva2VuLmFjY2Vzc190b2tlbiBmb3IgQVBJIGNhbGxzXG4gKiAgIGZldGNoKGFwaVVybCwge1xuICogICAgIGhlYWRlcnM6IHsgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3Rva2VuLmFjY2Vzc190b2tlbn1gIH1cbiAqICAgfSk7XG4gKiB9XG4gKiBgYGBcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldERlY3J5cHRlZFRva2VuKFxuICBzdXBhYmFzZTogU3VwYWJhc2VDbGllbnQsXG4gIGludGVncmF0aW9uSWQ6IHN0cmluZ1xuKTogUHJvbWlzZTxEZWNyeXB0ZWRUb2tlbiB8IG51bGw+IHtcbiAgY29uc3QgZW5jcnlwdGlvbktleSA9IGdldEVuY3J5cHRpb25LZXkoKTtcblxuICB0cnkge1xuICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlLnJwYygnZ2V0X2RlY3J5cHRlZF90b2tlbicsIHtcbiAgICAgIHBfaW50ZWdyYXRpb25faWQ6IGludGVncmF0aW9uSWQsXG4gICAgICBwX2VuY3J5cHRpb25fa2V5OiBlbmNyeXB0aW9uS2V5LFxuICAgIH0pO1xuXG4gICAgaWYgKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gZmV0Y2gvZGVjcnlwdCB0b2tlbjonLCBlcnJvcik7XG5cbiAgICAgIC8vIFByb3ZpZGUgaGVscGZ1bCBlcnJvciBtZXNzYWdlc1xuICAgICAgaWYgKGVycm9yLm1lc3NhZ2UuaW5jbHVkZXMoJ2RlY3J5cHQnKSB8fCBlcnJvci5tZXNzYWdlLmluY2x1ZGVzKCdXcm9uZyBrZXknKSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgJ1Rva2VuIGRlY3J5cHRpb24gZmFpbGVkIC0gRU5DUllQVElPTl9LRVkgbWF5IGJlIGluY29ycmVjdCBvciBjaGFuZ2VkLiAnICtcbiAgICAgICAgICAgICdWZXJpZnkgdGhlIGtleSBtYXRjaGVzIHdoYXQgd2FzIHVzZWQgZHVyaW5nIGVuY3J5cHRpb24uJ1xuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYFRva2VuIHJldHJpZXZhbCBmYWlsZWQ6ICR7ZXJyb3IubWVzc2FnZX1gKTtcbiAgICB9XG5cbiAgICBpZiAoIWRhdGEgfHwgKEFycmF5LmlzQXJyYXkoZGF0YSkgJiYgZGF0YS5sZW5ndGggPT09IDApKSB7XG4gICAgICBjb25zb2xlLndhcm4oYE5vIHRva2VuIGZvdW5kIGZvciBpbnRlZ3JhdGlvbjogJHtpbnRlZ3JhdGlvbklkfWApO1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgLy8gUlBDIHJldHVybnMgYW4gYXJyYXksIGdldCBmaXJzdCBpdGVtXG4gICAgY29uc3QgdG9rZW4gPSBBcnJheS5pc0FycmF5KGRhdGEpID8gZGF0YVswXSA6IGRhdGE7XG5cbiAgICAvLyBWYWxpZGF0ZSBkZWNyeXB0ZWQgdG9rZW4gc3RydWN0dXJlXG4gICAgaWYgKCF0b2tlbi5hY2Nlc3NfdG9rZW4pIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignRGVjcnlwdGVkIHRva2VuIGlzIG1pc3NpbmcgYWNjZXNzX3Rva2VuIC0gZGF0YSBtYXkgYmUgY29ycnVwdGVkJyk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRva2VuIGFzIERlY3J5cHRlZFRva2VuO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ1Rva2VuIGRlY3J5cHRpb24gZXJyb3I6JywgZXJyb3IpO1xuICAgIHRocm93IGVycm9yO1xuICB9XG59XG5cbi8qKlxuICogQ2hlY2sgZW5jcnlwdGlvbiBzdGF0dXMgb2Ygb2F1dGhfdG9rZW5zIHRhYmxlXG4gKlxuICogVXRpbGl0eSBmdW5jdGlvbiB0byB2ZXJpZnkgZW5jcnlwdGlvbiBtaWdyYXRpb24gc3RhdHVzLlxuICogUmV0dXJucyBzdGF0aXN0aWNzIGFib3V0IGVuY3J5cHRlZCB2cyBwbGFpbnRleHQgdG9rZW5zLlxuICpcbiAqIEBwYXJhbSBzdXBhYmFzZSAtIFN1cGFiYXNlIGNsaWVudCAobXVzdCBoYXZlIHNlcnZpY2Ugcm9sZSBhY2Nlc3MpXG4gKiBAcmV0dXJucyBFbmNyeXB0aW9uIHN0YXR1cyBzdGF0aXN0aWNzXG4gKlxuICogQGV4YW1wbGVcbiAqIGBgYHR5cGVzY3JpcHRcbiAqIGNvbnN0IHN0YXR1cyA9IGF3YWl0IGNoZWNrRW5jcnlwdGlvblN0YXR1cyhzdXBhYmFzZUFkbWluKTtcbiAqIGNvbnNvbGUubG9nKGBFbmNyeXB0aW9uIHJhdGU6ICR7c3RhdHVzLmVuY3J5cHRpb25fcGVyY2VudGFnZX0lYCk7XG4gKiBgYGBcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNoZWNrRW5jcnlwdGlvblN0YXR1cyhzdXBhYmFzZTogU3VwYWJhc2VDbGllbnQpOiBQcm9taXNlPHtcbiAgdG90YWxfdG9rZW5zOiBudW1iZXI7XG4gIGVuY3J5cHRlZF9hY2Nlc3NfdG9rZW5zOiBudW1iZXI7XG4gIGVuY3J5cHRlZF9yZWZyZXNoX3Rva2VuczogbnVtYmVyO1xuICBwbGFpbnRleHRfYWNjZXNzX3Rva2VuczogbnVtYmVyO1xuICBwbGFpbnRleHRfcmVmcmVzaF90b2tlbnM6IG51bWJlcjtcbiAgZW5jcnlwdGlvbl9wZXJjZW50YWdlOiBudW1iZXI7XG59PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2UucnBjKCdjaGVja19lbmNyeXB0aW9uX3N0YXR1cycpO1xuXG4gICAgaWYgKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gY2hlY2sgZW5jcnlwdGlvbiBzdGF0dXM6JywgZXJyb3IpO1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBFbmNyeXB0aW9uIHN0YXR1cyBjaGVjayBmYWlsZWQ6ICR7ZXJyb3IubWVzc2FnZX1gKTtcbiAgICB9XG5cbiAgICAvLyBSUEMgcmV0dXJucyBhbiBhcnJheSB3aXRoIG9uZSByZXN1bHRcbiAgICBjb25zdCBzdGF0dXMgPSBBcnJheS5pc0FycmF5KGRhdGEpID8gZGF0YVswXSA6IGRhdGE7XG5cbiAgICByZXR1cm4ge1xuICAgICAgdG90YWxfdG9rZW5zOiBOdW1iZXIoc3RhdHVzLnRvdGFsX3Rva2VucyB8fCAwKSxcbiAgICAgIGVuY3J5cHRlZF9hY2Nlc3NfdG9rZW5zOiBOdW1iZXIoc3RhdHVzLmVuY3J5cHRlZF9hY2Nlc3NfdG9rZW5zIHx8IDApLFxuICAgICAgZW5jcnlwdGVkX3JlZnJlc2hfdG9rZW5zOiBOdW1iZXIoc3RhdHVzLmVuY3J5cHRlZF9yZWZyZXNoX3Rva2VucyB8fCAwKSxcbiAgICAgIHBsYWludGV4dF9hY2Nlc3NfdG9rZW5zOiBOdW1iZXIoc3RhdHVzLnBsYWludGV4dF9hY2Nlc3NfdG9rZW5zIHx8IDApLFxuICAgICAgcGxhaW50ZXh0X3JlZnJlc2hfdG9rZW5zOiBOdW1iZXIoc3RhdHVzLnBsYWludGV4dF9yZWZyZXNoX3Rva2VucyB8fCAwKSxcbiAgICAgIGVuY3J5cHRpb25fcGVyY2VudGFnZTogTnVtYmVyKHN0YXR1cy5lbmNyeXB0aW9uX3BlcmNlbnRhZ2UgfHwgMCksXG4gICAgfTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFbmNyeXB0aW9uIHN0YXR1cyBjaGVjayBlcnJvcjonLCBlcnJvcik7XG4gICAgdGhyb3cgZXJyb3I7XG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJnZXRFbmNyeXB0aW9uS2V5Iiwia2V5IiwicHJvY2VzcyIsImVudiIsIkVOQ1JZUFRJT05fS0VZIiwiRXJyb3IiLCJsZW5ndGgiLCJ1cHNlcnRFbmNyeXB0ZWRUb2tlbiIsInN1cGFiYXNlIiwiZGF0YSIsImVuY3J5cHRpb25LZXkiLCJyZXN1bHQiLCJlcnJvciIsInJwYyIsInBfaW50ZWdyYXRpb25faWQiLCJpbnRlZ3JhdGlvbl9pZCIsInBfYWNjZXNzX3Rva2VuIiwiYWNjZXNzX3Rva2VuIiwicF9yZWZyZXNoX3Rva2VuIiwicmVmcmVzaF90b2tlbiIsInBfdG9rZW5fdHlwZSIsInRva2VuX3R5cGUiLCJwX2V4cGlyZXNfYXQiLCJleHBpcmVzX2F0IiwicF9lbmNyeXB0aW9uX2tleSIsImNvbnNvbGUiLCJtZXNzYWdlIiwibG9nIiwidXBkYXRlRW5jcnlwdGVkQWNjZXNzVG9rZW4iLCJ0b2tlbklkIiwiYWNjZXNzVG9rZW4iLCJleHBpcmVzQXQiLCJwX3Rva2VuX2lkIiwid2FybiIsImdldERlY3J5cHRlZFRva2VuIiwiaW50ZWdyYXRpb25JZCIsImluY2x1ZGVzIiwiQXJyYXkiLCJpc0FycmF5IiwidG9rZW4iLCJjaGVja0VuY3J5cHRpb25TdGF0dXMiLCJzdGF0dXMiLCJ0b3RhbF90b2tlbnMiLCJOdW1iZXIiLCJlbmNyeXB0ZWRfYWNjZXNzX3Rva2VucyIsImVuY3J5cHRlZF9yZWZyZXNoX3Rva2VucyIsInBsYWludGV4dF9hY2Nlc3NfdG9rZW5zIiwicGxhaW50ZXh0X3JlZnJlc2hfdG9rZW5zIiwiZW5jcnlwdGlvbl9wZXJjZW50YWdlIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/encryption.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/@supabase","vendor-chunks/next","vendor-chunks/tslib","vendor-chunks/iceberg-js","vendor-chunks/set-cookie-parser","vendor-chunks/jose"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fjira%2Fconnect%2Froute&page=%2Fapi%2Fjira%2Fconnect%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fjira%2Fconnect%2Froute.ts&appDir=%2FUsers%2Fmario%2Ffriction-intelligence%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fmario%2Ffriction-intelligence&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();