"use strict";(()=>{var e={};e.id=368,e.ids=[368],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{e.exports=require("buffer")},93087:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>y,originalPathname:()=>g,patchFetch:()=>_,requestAsyncStorage:()=>p,routeModule:()=>d,serverHooks:()=>f,staticGenerationAsyncStorage:()=>m,staticGenerationBailout:()=>h});var n={};r.r(n),r.d(n,{POST:()=>l});var s=r(95419),a=r(69108),o=r(99678),i=r(78070),c=r(57699),u=r(7439);async function l(e){try{let t=(0,c.createRouteHandlerClient)({cookies:u.cookies}),{data:{user:r}}=await t.auth.getUser();if(!r)return i.Z.json({error:"Not authenticated"},{status:401});let{accountId:n}=await e.json();if(!n)return i.Z.json({error:"Account ID required"},{status:400});let{data:s}=await t.from("raw_inputs").select("*").eq("account_id",n).eq("user_id",r.id).eq("processed",!1).limit(25);if(!s||0===s.length)return i.Z.json({message:"No unprocessed cases found",analyzed:0});let a=[];for(let e of s){let t=`Analyze this support case and respond with ONLY valid JSON (no markdown):

${e.text_content}

Return a single JSON object with: summary, theme_key (from: billing_confusion, integration_failures, ui_confusion, performance_issues, missing_features, training_gaps, support_response_time, other), severity (1-5), sentiment (frustrated, confused, angry, neutral, satisfied), root_cause, evidence (array of max 2 short quotes)`,s=await fetch("https://api.anthropic.com/v1/messages",{method:"POST",headers:{"Content-Type":"application/json","x-api-key":process.env.ANTHROPIC_API_KEY,"anthropic-version":"2023-06-01"},body:JSON.stringify({model:"claude-sonnet-4-20250514",max_tokens:500,messages:[{role:"user",content:t}]})});if(!s.ok)continue;let o=(await s.json()).content[0].text.replace(/```json\n?/g,"").replace(/```\n?/g,"").trim();try{let t=JSON.parse(o);a.push({user_id:r.id,account_id:n,raw_input_id:e.id,summary:t.summary,theme_key:t.theme_key||"other",product_area:null,severity:Math.min(5,Math.max(1,t.severity)),sentiment:t.sentiment||"neutral",root_cause_hypothesis:t.root_cause||"Unknown",evidence_snippets:t.evidence||[],confidence_score:.8,reasoning:"Analyzed by Claude Sonnet",lifecycle_stage:null,is_new_theme:!1})}catch(t){console.error("Parse error for case:",e.id)}}if(0===a.length)return i.Z.json({error:"No cases could be analyzed"},{status:500});let{data:o,error:l}=await t.from("friction_cards").insert(a).select();if(l)return console.error("Card insert error:",JSON.stringify(l)),i.Z.json({error:"Failed to create friction cards",details:l.message,code:l.code},{status:500});return await t.from("raw_inputs").update({processed:!0}).in("id",s.map(e=>e.id)),i.Z.json({success:!0,analyzed:o?.length||0,message:`Created ${o?.length} friction cards`})}catch(e){return console.error("Analysis error:",e),i.Z.json({error:"Analysis failed",details:e instanceof Error?e.message:"Unknown"},{status:500})}}let d=new s.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/analyze-friction/route",pathname:"/api/analyze-friction",filename:"route",bundlePath:"app/api/analyze-friction/route"},resolvedPagePath:"/Users/mario/friction-intelligence/app/api/analyze-friction/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:p,staticGenerationAsyncStorage:m,serverHooks:f,headerHooks:y,staticGenerationBailout:h}=d,g="/api/analyze-friction/route";function _(){return(0,o.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:m})}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[456,552,421],()=>r(93087));module.exports=n})();