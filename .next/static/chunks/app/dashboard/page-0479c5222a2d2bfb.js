(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[702],{30646:function(e,t,s){Promise.resolve().then(s.bind(s,74375))},74375:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return W}});var a=s(3827),r=s(64090),n=s(58714),l=s(47907),i=s(60585),o=s(28904),c=s(14314),d=s(29733),x=s(10775),m=s(29910),u=s(95032),h=s(98998),g=s(22071),p=s(28814),y=s(52235);function f(e){let{top25:t,singleOperator:s}=e,[n,i]=(0,r.useState)(!1),[o,c]=(0,r.useState)(!1),[m,f]=(0,r.useState)(!1),[v,b]=(0,r.useState)(null),j=(0,l.useRouter)(),N=[...t,...s],w=N.length,_=N.reduce((e,t)=>{var s;return e+((null===(s=t.current_snapshot)||void 0===s?void 0:s.ofi_score)||0)},0)/(w||1),k=N.filter(e=>{var t;return(null===(t=e.current_snapshot)||void 0===t?void 0:t.trend_direction)==="worsening"}).length,S=N.filter(e=>{var t;return(null===(t=e.current_snapshot)||void 0===t?void 0:t.trend_direction)==="improving"}).length,C=N.reduce((e,t)=>e+(t.alert_count||0),0),A=N.filter(e=>(e.alert_count||0)>0).sort((e,t)=>(t.alert_count||0)-(e.alert_count||0)),D=N.filter(e=>{var t;return(null===(t=e.current_snapshot)||void 0===t?void 0:t.case_volume)!==void 0}),L=D.length>0?D.reduce((e,t)=>{var s;return e+((null===(s=t.current_snapshot)||void 0===s?void 0:s.case_volume)||0)},0)/D.length:0,E=D.filter(e=>{var t;let s=(null===(t=e.current_snapshot)||void 0===t?void 0:t.case_volume)||0;return s>1.5*L||s<.5*L}).map(e=>{var t;let s=(null===(t=e.current_snapshot)||void 0===t?void 0:t.case_volume)||0;return{...e,reason:s>1.5*L?"high":"low",percentDiff:Math.round(L>0?(s-L)/L*100:0)}}).sort((e,t)=>Math.abs(t.percentDiff)-Math.abs(e.percentDiff)),M=E.length,F=[{name:"Total Accounts",value:w,icon:u.Z,color:"text-blue-600",bg:"bg-blue-50"},{name:"Avg. Friction Score",value:_.toFixed(1),icon:u.Z,color:_>=50?"text-red-600":"text-green-600",bg:_>=50?"bg-red-50":"bg-green-50"},{name:"Trending Up",value:k,icon:d.Z,color:"text-red-600",bg:"bg-red-50",subtext:"".concat(k," worsening"),tooltip:"Accounts where OFI score is increasing (friction getting worse over time)"},{name:"Trending Down",value:S,icon:x.Z,color:"text-green-600",bg:"bg-green-50",subtext:"".concat(S," improving"),tooltip:"Accounts where OFI score is decreasing (friction improving over time)"},{name:"Active Alerts",value:C,icon:h.Z,color:C>0?"text-yellow-600":"text-gray-600",bg:C>0?"bg-yellow-50":"bg-gray-50",subtext:C>0?"".concat(C," active"):"None active",tooltip:"Automated alerts for: High Friction (OFI ≥ 70), Critical Issues (3+ high-severity cases), and Abnormal Volume Spikes. Alerts expire after 7 days."},{name:"Abnormal Volume",value:M,icon:g.Z,color:M>0?"text-orange-600":"text-gray-600",bg:M>0?"bg-orange-50":"bg-gray-50",subtext:"".concat(M," accounts"),tooltip:"Accounts with case volumes 50%+ higher or lower than portfolio average"}];return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 mb-8",children:F.map(e=>{let t=e.icon,s="Avg. Friction Score"===e.name,r="Abnormal Volume"===e.name,l="Active Alerts"===e.name,o=r&&E.length>0||l&&C>0;return(0,a.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 relative ".concat(o?"cursor-pointer hover:shadow-md transition-shadow":""),style:{overflow:"visible"},onClick:()=>{r&&E.length>0&&c(!0),l&&C>0&&f(!0)},onMouseEnter:()=>b(e.name),onMouseLeave:()=>b(null),children:[(0,a.jsx)("div",{className:"p-5",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"flex-shrink-0 ".concat(e.bg," rounded-md p-3"),children:(0,a.jsx)(t,{className:"h-6 w-6 ".concat(e.color),"aria-hidden":"true"})}),(0,a.jsx)("div",{className:"ml-5 flex-1 min-w-0",children:(0,a.jsxs)("dl",{children:[(0,a.jsxs)("dt",{className:"text-sm font-medium text-gray-500 flex items-center gap-1.5",children:[e.name,s&&(0,a.jsxs)("div",{className:"relative inline-block",children:[(0,a.jsx)("button",{onMouseEnter:()=>i(!0),onMouseLeave:()=>i(!1),className:"text-blue-400 hover:text-blue-600 transition-colors cursor-help p-0.5","aria-label":"Show OFI calculation details",type:"button",children:(0,a.jsx)(p.Z,{className:"w-4 h-4"})}),n&&(0,a.jsxs)("div",{className:"absolute left-0 top-6 w-80 bg-white border border-gray-300 rounded-lg shadow-2xl p-4 z-[9999]",onMouseEnter:()=>i(!0),onMouseLeave:()=>i(!1),children:[(0,a.jsx)("h4",{className:"text-sm font-semibold text-gray-900 mb-2",children:"OFI Score Calculation"}),(0,a.jsxs)("div",{className:"text-xs text-gray-600 space-y-2",children:[(0,a.jsx)("p",{className:"font-medium",children:"The Operational Friction Index (0-100) measures customer friction based on:"}),(0,a.jsxs)("ul",{className:"space-y-1 ml-3",children:[(0,a.jsxs)("li",{children:["• ",(0,a.jsx)("strong",{children:"Severity weights:"})," Issues are weighted 1-8 based on severity (1-5)"]}),(0,a.jsxs)("li",{children:["• ",(0,a.jsx)("strong",{children:"Base score:"})," Logarithmic scale of weighted issues prevents easy maxing out"]}),(0,a.jsxs)("li",{children:["• ",(0,a.jsx)("strong",{children:"Friction density:"})," Percentage of cases with friction (0.5x-1.5x multiplier)"]}),(0,a.jsxs)("li",{children:["• ",(0,a.jsx)("strong",{children:"High severity boost:"})," Critical issues (severity 4-5) add bonus points"]})]}),(0,a.jsx)("div",{className:"pt-2 mt-2 border-t border-gray-100",children:(0,a.jsxs)("p",{className:"text-xs italic text-gray-500",children:[(0,a.jsx)("strong",{children:"Scores:"})," 70+ = High Friction, 40-69 = Medium, 0-39 = Low"]})})]})]})]})]}),(0,a.jsxs)("dd",{className:"flex items-baseline flex-wrap gap-1",children:[(0,a.jsx)("div",{className:"text-2xl font-semibold ".concat(e.color),children:e.value}),e.subtext&&(0,a.jsx)("div",{className:"text-xs text-gray-500 whitespace-nowrap",children:e.subtext})]})]})})]})}),e.tooltip&&v===e.name&&(0,a.jsxs)("div",{className:"absolute left-0 top-full mt-2 w-64 bg-gray-900 text-white text-xs rounded-lg shadow-xl p-3 z-50",children:[e.tooltip,(0,a.jsx)("div",{className:"absolute -top-1 left-6 w-2 h-2 bg-gray-900 transform rotate-45"})]})]},e.name)})}),m&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:()=>f(!1),children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-3xl w-full max-h-[80vh] overflow-hidden",onClick:e=>e.stopPropagation(),children:[(0,a.jsxs)("div",{className:"p-6 border-b border-gray-200 flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Active Alerts"}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"Accounts with active alerts requiring attention"})]}),(0,a.jsx)("button",{onClick:()=>f(!1),className:"text-gray-400 hover:text-gray-600",children:(0,a.jsx)(y.Z,{className:"w-6 h-6"})})]}),(0,a.jsx)("div",{className:"p-6 overflow-y-auto max-h-[calc(80vh-120px)]",children:(0,a.jsx)("div",{className:"space-y-4",children:A.map(e=>{var t;return(0,a.jsxs)("div",{className:"border border-gray-200 rounded-lg p-4 hover:bg-gray-50 cursor-pointer transition-colors",onClick:()=>{f(!1),j.push("/account/".concat(e.id))},children:[(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h3",{className:"font-semibold text-gray-900",children:e.name}),(0,a.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:["$",(e.arr||0).toLocaleString()," ARR • ",e.products||"N/A"]})]}),(0,a.jsxs)("div",{className:"text-right ml-4",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-yellow-600",children:e.alert_count||0}),(0,a.jsxs)("div",{className:"text-sm text-gray-600",children:["active ",1===e.alert_count?"alert":"alerts"]})]})]}),(0,a.jsxs)("div",{className:"mt-3 flex items-center gap-2",children:[(0,a.jsx)("span",{className:"inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:"⚠️ Needs Attention"}),(null===(t=e.current_snapshot)||void 0===t?void 0:t.ofi_score)&&(0,a.jsxs)("span",{className:"text-sm text-gray-600",children:["OFI Score: ",e.current_snapshot.ofi_score]})]})]},e.id)})})})]})}),o&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:()=>c(!1),children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-3xl w-full max-h-[80vh] overflow-hidden",onClick:e=>e.stopPropagation(),children:[(0,a.jsxs)("div",{className:"p-6 border-b border-gray-200 flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Abnormal Case Volume Accounts"}),(0,a.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:["Accounts with case volumes significantly higher or lower than portfolio average (",Math.round(L)," cases)"]})]}),(0,a.jsx)("button",{onClick:()=>c(!1),className:"text-gray-400 hover:text-gray-600",children:(0,a.jsx)(y.Z,{className:"w-6 h-6"})})]}),(0,a.jsx)("div",{className:"p-6 overflow-y-auto max-h-[calc(80vh-120px)]",children:(0,a.jsx)("div",{className:"space-y-4",children:E.map(e=>{var t;return(0,a.jsxs)("div",{className:"border border-gray-200 rounded-lg p-4 hover:bg-gray-50 cursor-pointer transition-colors",onClick:()=>{c(!1),j.push("/account/".concat(e.id))},children:[(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h3",{className:"font-semibold text-gray-900",children:e.name}),(0,a.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:["$",(e.arr||0).toLocaleString()," ARR • ",e.products||"N/A"]})]}),(0,a.jsxs)("div",{className:"text-right ml-4",children:[(0,a.jsx)("div",{className:"text-2xl font-bold ".concat("high"===e.reason?"text-red-600":"text-yellow-600"),children:(null===(t=e.current_snapshot)||void 0===t?void 0:t.case_volume)||0}),(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"cases (90d)"})]})]}),(0,a.jsxs)("div",{className:"mt-3 flex items-center gap-2",children:[(0,a.jsx)("span",{className:"inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium ".concat("high"===e.reason?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"),children:"high"===e.reason?"⚠️ High Volume":"⬇️ Low Volume"}),(0,a.jsxs)("span",{className:"text-sm text-gray-600",children:[e.percentDiff>0?"+":"",e.percentDiff,"% vs portfolio avg"]})]})]},e.id)})})})]})})]})}var v=s(28670),b=s(75879);function j(e){var t,s,r;let{account:n}=e,i=(0,l.useRouter)(),o=n.arr?Math.round(n.arr/12):null,c=(null===(t=n.current_snapshot)||void 0===t?void 0:t.ofi_score)||0;return(0,a.jsxs)("button",{onClick:()=>i.push("/account/".concat(n.id)),className:"w-full text-left p-4 bg-white rounded-lg border border-gray-200 hover:border-blue-500 hover:shadow-md transition-all",children:[(0,a.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h3",{className:"font-semibold text-gray-900 mb-1",children:n.name}),(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[(0,a.jsx)("span",{children:o?"$".concat(o.toLocaleString(),"/mo"):"No MRR"}),n.products&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{children:"•"}),(0,a.jsx)("span",{children:n.products})]})]})]}),n.current_snapshot&&(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"text-lg font-bold ".concat(c>=70?"text-red-600":c>=40?"text-yellow-600":"text-green-600"),children:Math.round(c)}),n.current_snapshot.trend_direction&&(0,a.jsx)("div",{className:"worsening"===(s=n.current_snapshot.trend_direction)?"text-red-600":"improving"===s?"text-green-600":"text-gray-400",children:"worsening"===(r=n.current_snapshot.trend_direction)?(0,a.jsx)(d.Z,{className:"w-4 h-4"}):"improving"===r?(0,a.jsx)(x.Z,{className:"w-4 h-4"}):null})]})]}),n.alert_count>0&&(0,a.jsxs)("div",{className:"flex items-center gap-1 text-sm text-red-600 mt-2",children:[(0,a.jsx)(h.Z,{className:"w-4 h-4"}),(0,a.jsxs)("span",{children:[n.alert_count," active alert",1!==n.alert_count?"s":""]})]}),n.recent_friction_cards&&n.recent_friction_cards.length>0&&(0,a.jsx)("div",{className:"mt-3 pt-3 border-t border-gray-100",children:(0,a.jsxs)("p",{className:"text-xs text-gray-600 line-clamp-2",children:["Latest: ",n.recent_friction_cards[0].summary]})})]})}function N(e){let{favorites:t,onUpdate:s}=e,[l,i]=(0,r.useState)(""),[o,c]=(0,r.useState)([]),[d,x]=(0,r.useState)([]),[m,u]=(0,r.useState)(!1),h=(0,n.createClientComponentClient)();async function g(){let{data:e}=await h.from("accounts").select("*").order("arr",{ascending:!1}).limit(200);x(e||[])}(0,r.useEffect)(()=>{g()},[]);let p=(0,r.useMemo)(()=>{if(!l)return t;let e=l.toLowerCase();return t.filter(t=>t.account.name.toLowerCase().includes(e))},[t,l]);async function f(e){console.log("Adding favorite:",e);try{let{data:{user:t}}=await h.auth.getUser();if(!t)return;await h.from("favorites").insert({user_id:t.id,account_id:e}),i(""),u(!1),c([]),s()}catch(e){console.error("Error adding favorite:",e)}}async function N(e){try{await h.from("favorites").delete().eq("id",e),s()}catch(e){console.error("Error removing favorite:",e)}}let w=l.length>=2?o:d.filter(e=>!t.some(t=>t.account_id===e.id)).slice(0,50);return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:"Favorites"}),(0,a.jsxs)("button",{onClick:()=>u(!m),className:"flex items-center gap-2 px-3 py-2 text-sm bg-purple-600 text-white rounded-lg hover:bg-purple-700",children:[(0,a.jsx)(v.Z,{className:"w-4 h-4"}),m?"Close":"Add Account"]})]}),m&&(0,a.jsxs)("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(v.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),(0,a.jsx)("input",{type:"text",value:l,onChange:e=>{i(e.target.value),function(e){if(e.length<2){c([]);return}let s=new Set(t.map(e=>e.account_id));c(d.filter(t=>!s.has(t.id)&&t.name.toLowerCase().includes(e.toLowerCase())).slice(0,20))}(e.target.value)},placeholder:"Search accounts by name...",className:"w-full pl-10 pr-10 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"}),l&&(0,a.jsx)("button",{onClick:()=>{i(""),c([])},className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:(0,a.jsx)(y.Z,{className:"w-5 h-5"})})]}),w.length>0&&(0,a.jsxs)("div",{className:"mt-4 space-y-2 max-h-96 overflow-y-auto",children:[(0,a.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:l.length>=2?"Search results:":"All accounts (top 50):"}),w.map(e=>(0,a.jsx)("button",{onClick:()=>f(e.id),className:"w-full text-left p-3 bg-white rounded-lg border border-gray-200 hover:border-purple-500 hover:bg-purple-50 transition-all",children:(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-semibold text-gray-900",children:e.name}),(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:["$",Math.round((e.arr||0)/12).toLocaleString(),"/mo",e.products&&" • ".concat(e.products)]})]}),(0,a.jsx)(b.Z,{className:"w-5 h-5 text-gray-400"})]})},e.id))]})]}),!m&&t.length>5&&(0,a.jsxs)("div",{className:"relative mb-4",children:[(0,a.jsx)(v.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),(0,a.jsx)("input",{type:"text",value:l,onChange:e=>i(e.target.value),placeholder:"Filter your favorites...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]})]}),0===p.length?(0,a.jsxs)("div",{className:"text-center py-12 bg-white rounded-lg border border-gray-200",children:[(0,a.jsx)(b.Z,{className:"w-12 h-12 text-gray-300 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-600",children:l?"No favorites match your search":'No favorites yet. Click "Add Account" to get started!'})]}):(0,a.jsx)("div",{className:"grid grid-cols-1 gap-4",children:p.map(e=>(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(j,{account:e.account}),(0,a.jsx)("button",{onClick:()=>N(e.id),className:"absolute top-2 right-2 px-3 py-1 bg-white text-red-600 text-sm font-medium rounded-lg border border-gray-200 shadow hover:bg-red-50 transition-colors",title:"Remove from favorites",children:"Remove"})]},e.id))})]})}var w=s(81006),_=s(63280),k=s(27271),S=s(44715),C=s(85159),A=s(23441),D=s(30553);function L(e){let{allAccounts:t}=e,s=(0,l.useRouter)(),[n,i]=(0,r.useState)([]),[o,c]=(0,r.useState)([{id:"ofi_score",desc:!0}]),[m,u]=(0,r.useState)(""),[h,g]=(0,r.useState)(null),p=(0,r.useMemo)(()=>t.map(e=>{var t,s,a,r,n,l,i,o,c,d;let x="Other";return(null===(t=e.products)||void 0===t?void 0:t.includes("EDGE"))?x="EDGE":(null===(s=e.products)||void 0===s?void 0:s.includes("SiteLink"))&&(x="SiteLink"),{id:e.id,name:e.name,arr:e.arr,vertical:e.vertical,products:e.products,segment:e.segment,ofi_score:null!==(i=null===(a=e.current_snapshot)||void 0===a?void 0:a.ofi_score)&&void 0!==i?i:null,case_volume:null!==(o=null===(r=e.current_snapshot)||void 0===r?void 0:r.case_volume)&&void 0!==o?o:null,trend_direction:null!==(c=null===(n=e.current_snapshot)||void 0===n?void 0:n.trend_direction)&&void 0!==c?c:null,last_analyzed:null!==(d=null===(l=e.current_snapshot)||void 0===l?void 0:l.created_at)&&void 0!==d?d:null,product:x}}),[t]),f=(0,r.useMemo)(()=>[{accessorKey:"name",header:"Account Name",cell:e=>{let{row:t}=e;return(0,a.jsx)("button",{onClick:()=>s.push("/account/".concat(t.original.id)),className:"text-left font-medium text-blue-600 hover:text-blue-800 hover:underline",children:t.original.name})}},{accessorKey:"arr",header:"ARR",cell:e=>{let{row:t}=e;return(0,a.jsx)("span",{children:t.original.arr?"$".concat(t.original.arr.toLocaleString()):"-"})},filterFn:"inNumberRange"},{accessorKey:"product",header:"Product",filterFn:"equalsString"},{accessorKey:"segment",header:"Segment",cell:e=>{var t;let{row:s}=e;return(0,a.jsx)("span",{className:"capitalize",children:(null===(t=s.original.segment)||void 0===t?void 0:t.replace("_"," "))||"-"})},filterFn:"equalsString"},{accessorKey:"ofi_score",header:"OFI Score",cell:e=>{let{row:t}=e,s=t.original.ofi_score;if(null===s)return(0,a.jsx)("span",{className:"text-gray-400",children:"-"});let r=s>=70?"bg-red-100 text-red-800":s>=40?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800";return(0,a.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(r),children:s})},filterFn:"inNumberRange"},{accessorKey:"case_volume",header:()=>(0,a.jsxs)("div",{className:"relative",onMouseEnter:()=>g("case_volume"),onMouseLeave:()=>g(null),children:["Cases (90d)","case_volume"===h&&(0,a.jsxs)("div",{className:"absolute left-0 top-full mt-2 w-64 bg-gray-900 text-white text-xs rounded-lg shadow-xl p-3 z-50 whitespace-normal font-normal",children:["Total number of Salesforce cases for this account in the last 90 days",(0,a.jsx)("div",{className:"absolute -top-1 left-6 w-2 h-2 bg-gray-900 transform rotate-45"})]})]}),cell:e=>{var t;let{row:s}=e;return(0,a.jsx)("span",{children:null!==(t=s.original.case_volume)&&void 0!==t?t:"-"})},filterFn:"inNumberRange"},{accessorKey:"trend_direction",header:"Trend",cell:e=>{let{row:t}=e,s=t.original.trend_direction;return"worsening"===s?(0,a.jsx)(d.Z,{className:"w-4 h-4 text-red-500"}):"improving"===s?(0,a.jsx)(x.Z,{className:"w-4 h-4 text-green-500"}):(0,a.jsx)(k.Z,{className:"w-4 h-4 text-gray-400"})},filterFn:"equalsString"},{accessorKey:"last_analyzed",header:"Last Analyzed",cell:e=>{let{row:t}=e;return(0,a.jsx)("span",{className:"text-sm text-gray-600",children:t.original.last_analyzed?new Date(t.original.last_analyzed).toLocaleDateString():"Never"})}}],[s]),v=(0,w.b7)({data:p,columns:f,state:{columnFilters:n,sorting:o,globalFilter:m},onColumnFiltersChange:i,onSortingChange:c,onGlobalFilterChange:u,getCoreRowModel:(0,_.sC)(),getFilteredRowModel:(0,_.vL)(),getSortedRowModel:(0,_.tj)(),getPaginationRowModel:(0,_.G_)(),initialState:{pagination:{pageSize:25}}}),b=(0,r.useMemo)(()=>Array.from(new Set(p.map(e=>e.product))).sort(),[p]),j=(0,r.useMemo)(()=>Array.from(new Set(p.map(e=>e.segment).filter(Boolean))).sort(),[p]),N=(0,r.useMemo)(()=>Array.from(new Set(p.map(e=>e.trend_direction).filter(Boolean))).sort(),[p]);return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsx)("input",{type:"text",value:null!=m?m:"",onChange:e=>u(e.target.value),placeholder:"Search accounts...",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})}),(0,a.jsxs)("button",{onClick:()=>{let e=[["Account Name","ARR","Product","Segment","OFI Score","Cases (90d)","Trend","Last Analyzed"],...v.getFilteredRowModel().rows.map(e=>e.original).map(e=>[e.name,e.arr||"",e.product,e.segment||"",e.ofi_score||"",e.case_volume||"",e.trend_direction||"",e.last_analyzed?new Date(e.last_analyzed).toLocaleDateString():""])].map(e=>e.map(e=>'"'.concat(e,'"')).join(",")).join("\n"),t=new Blob([e],{type:"text/csv"}),s=URL.createObjectURL(t),a=document.createElement("a");a.href=s,a.download="friction-report-".concat(new Date().toISOString().split("T")[0],".csv"),a.click(),URL.revokeObjectURL(s)},className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[(0,a.jsx)(S.Z,{className:"w-4 h-4"}),"Export CSV"]})]}),(0,a.jsxs)("div",{className:"mt-4 space-y-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-xs font-medium text-gray-700 uppercase tracking-wide mb-1 block",children:"Product"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:b.map(e=>{let t=n.some(t=>"product"===t.id&&t.value===e);return(0,a.jsx)("button",{onClick:()=>{t?i(e=>e.filter(e=>"product"!==e.id)):i(t=>[...t.filter(e=>"product"!==e.id),{id:"product",value:e}])},className:"px-3 py-1 text-sm rounded-full border transition-colors ".concat(t?"bg-blue-100 border-blue-300 text-blue-700":"bg-gray-50 border-gray-200 text-gray-600 hover:bg-gray-100"),children:e},e)})})]}),j.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-xs font-medium text-gray-700 uppercase tracking-wide mb-1 block",children:"Segment"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:j.map(e=>{let t=n.some(t=>"segment"===t.id&&t.value===e);return(0,a.jsx)("button",{onClick:()=>{t?i(e=>e.filter(e=>"segment"!==e.id)):i(t=>[...t.filter(e=>"segment"!==e.id),{id:"segment",value:e}])},className:"px-3 py-1 text-sm rounded-full border transition-colors capitalize ".concat(t?"bg-blue-100 border-blue-300 text-blue-700":"bg-gray-50 border-gray-200 text-gray-600 hover:bg-gray-100"),children:null==e?void 0:e.replace("_"," ")},e)})})]}),N.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-xs font-medium text-gray-700 uppercase tracking-wide mb-1 block",children:"Trend"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:N.map(e=>{let t=n.some(t=>"trend_direction"===t.id&&t.value===e);return(0,a.jsx)("button",{onClick:()=>{t?i(e=>e.filter(e=>"trend_direction"!==e.id)):i(t=>[...t.filter(e=>"trend_direction"!==e.id),{id:"trend_direction",value:e}])},className:"px-3 py-1 text-sm rounded-full border transition-colors capitalize ".concat(t?"bg-green-100 border-green-300 text-green-700":"bg-gray-50 border-gray-200 text-gray-600 hover:bg-gray-100"),children:e},e)})})]}),(n.length>0||m)&&(0,a.jsxs)("button",{onClick:()=>{i([]),u("")},className:"flex items-center gap-1 text-sm text-gray-600 hover:text-gray-900",children:[(0,a.jsx)(y.Z,{className:"w-4 h-4"}),"Clear all filters"]})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Report Summary"}),(0,a.jsxs)("div",{className:"grid grid-cols-4 gap-4",children:[(0,a.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Accounts"}),(0,a.jsx)("p",{className:"text-3xl font-bold text-gray-900",children:v.getFilteredRowModel().rows.length})]}),(0,a.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Avg OFI Score"}),(0,a.jsx)("p",{className:"text-3xl font-bold text-gray-900",children:(()=>{let e=v.getFilteredRowModel().rows.filter(e=>null!==e.original.ofi_score);return 0===e.length?"-":Math.round(e.reduce((e,t)=>e+(t.original.ofi_score||0),0)/e.length)})()})]}),(0,a.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"High Friction"}),(0,a.jsx)("p",{className:"text-3xl font-bold text-red-600",children:v.getFilteredRowModel().rows.filter(e=>(e.original.ofi_score||0)>=70).length})]}),(0,a.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Worsening"}),(0,a.jsx)("p",{className:"text-3xl font-bold text-orange-600",children:v.getFilteredRowModel().rows.filter(e=>"worsening"===e.original.trend_direction).length})]})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:[(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:v.getHeaderGroups().map(e=>(0,a.jsx)("tr",{children:e.headers.map(e=>(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100",onClick:e.column.getToggleSortingHandler(),children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,w.ie)(e.column.columnDef.header,e.getContext()),"asc"===e.column.getIsSorted()&&(0,a.jsx)(C.Z,{className:"w-4 h-4"}),"desc"===e.column.getIsSorted()&&(0,a.jsx)(A.Z,{className:"w-4 h-4"}),!e.column.getIsSorted()&&(0,a.jsx)(D.Z,{className:"w-4 h-4 text-gray-400"})]})},e.id))},e.id))}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:v.getRowModel().rows.map(e=>(0,a.jsx)("tr",{className:"hover:bg-gray-50",children:e.getVisibleCells().map(e=>(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:(0,w.ie)(e.column.columnDef.cell,e.getContext())},e.id))},e.id))})]})}),(0,a.jsxs)("div",{className:"bg-gray-50 px-6 py-3 flex items-center justify-between border-t border-gray-200",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("button",{onClick:()=>v.setPageIndex(0),disabled:!v.getCanPreviousPage(),className:"px-3 py-1 text-sm border border-gray-300 rounded bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"First"}),(0,a.jsx)("button",{onClick:()=>v.previousPage(),disabled:!v.getCanPreviousPage(),className:"px-3 py-1 text-sm border border-gray-300 rounded bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),(0,a.jsx)("button",{onClick:()=>v.nextPage(),disabled:!v.getCanNextPage(),className:"px-3 py-1 text-sm border border-gray-300 rounded bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"}),(0,a.jsx)("button",{onClick:()=>v.setPageIndex(v.getPageCount()-1),disabled:!v.getCanNextPage(),className:"px-3 py-1 text-sm border border-gray-300 rounded bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Last"})]}),(0,a.jsxs)("div",{className:"text-sm text-gray-700",children:["Page ",v.getState().pagination.pageIndex+1," of ",v.getPageCount()," ","(",v.getFilteredRowModel().rows.length," total accounts)"]})]})]})]})}var E=s(46578),M=s(61524),F=s(71483),R=s(81708);function T(){let[e,t]=(0,r.useState)([]),[s,l]=(0,r.useState)(!0),[i,o]=(0,r.useState)("all"),c=(0,n.createClientComponentClient)();async function d(){try{let{data:{user:e}}=await c.auth.getUser();if(!e){l(!1);return}let{data:s}=await c.from("friction_cards").select("theme_key").eq("user_id",e.id),a={};null==s||s.forEach(e=>{a[e.theme_key]=(a[e.theme_key]||0)+1});let{data:r}=await c.from("theme_jira_links").select("\n          theme_key,\n          jira_issue:jira_issues(id, jira_key, issue_url, status)\n        ").eq("user_id",e.id),n={};null==r||r.forEach(e=>{let t=e.theme_key;n[t]||(n[t]={todo:0,in_progress:0,done:0,issues:[]});let s=e.jira_issue,a=s.status.toLowerCase();a.includes("done")||a.includes("closed")||a.includes("resolved")?n[t].done++:a.includes("progress")||a.includes("review")||a.includes("development")?n[t].in_progress++:n[t].todo++,n[t].issues.push({jira_key:s.jira_key,issue_url:s.issue_url,status:s.status})});let i=Object.entries(a).map(e=>{let t,[s,a]=e,r=n[s]||{todo:0,in_progress:0,done:0,issues:[]},l=r.todo+r.in_progress+r.done;return t=0===l?"unaddressed":r.in_progress>0||r.done>0?"addressed":"partially_addressed",{theme_key:s,theme_label:s.split("_").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" "),friction_count:a,jira_todo:r.todo,jira_in_progress:r.in_progress,jira_done:r.done,status:t,jira_issues:r.issues}});i.sort((e,t)=>t.friction_count-e.friction_count),t(i)}catch(e){console.error("Error fetching report data:",e)}finally{l(!1)}}(0,r.useEffect)(()=>{d()},[]);let x=e.filter(e=>"all"===i||("unaddressed"===i?"unaddressed"===e.status:"addressed"!==i||"addressed"===e.status||"partially_addressed"===e.status));return s?(0,a.jsx)("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:(0,a.jsxs)("div",{className:"animate-pulse",children:[(0,a.jsx)("div",{className:"h-8 bg-gray-200 rounded w-1/3 mb-4"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("div",{className:"h-4 bg-gray-200 rounded"}),(0,a.jsx)("div",{className:"h-4 bg-gray-200 rounded"}),(0,a.jsx)("div",{className:"h-4 bg-gray-200 rounded"})]})]})}):(0,a.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Theme Resolution Status"}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"Track which friction themes are being addressed in Jira"})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:()=>o("all"),className:"px-3 py-1.5 text-sm rounded-lg font-medium transition-colors ".concat("all"===i?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:"All"}),(0,a.jsx)("button",{onClick:()=>o("unaddressed"),className:"px-3 py-1.5 text-sm rounded-lg font-medium transition-colors ".concat("unaddressed"===i?"bg-yellow-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:"Unaddressed"}),(0,a.jsx)("button",{onClick:()=>o("addressed"),className:"px-3 py-1.5 text-sm rounded-lg font-medium transition-colors ".concat("addressed"===i?"bg-green-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:"Addressed"})]})]}),0===x.length&&(0,a.jsx)("div",{className:"text-center py-12",children:(0,a.jsx)("p",{className:"text-gray-500",children:0===e.length?"No friction themes found. Sync your Salesforce cases first.":"No themes match the selected filter."})}),x.length>0&&(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Theme"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Friction Count"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"To Do"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"In Progress"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Done"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Jira Tickets"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:x.map(e=>(0,a.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,a.jsx)("td",{className:"px-4 py-3 text-sm font-medium text-gray-900",children:e.theme_label}),(0,a.jsx)("td",{className:"px-4 py-3 text-sm text-gray-900",children:(0,a.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:e.friction_count})}),(0,a.jsx)("td",{className:"px-4 py-3 text-sm text-gray-600",children:e.jira_todo}),(0,a.jsx)("td",{className:"px-4 py-3 text-sm",children:(0,a.jsx)("span",{className:e.jira_in_progress>0?"text-blue-600 font-medium":"text-gray-600",children:e.jira_in_progress})}),(0,a.jsx)("td",{className:"px-4 py-3 text-sm",children:(0,a.jsx)("span",{className:e.jira_done>0?"text-green-600 font-medium":"text-gray-600",children:e.jira_done})}),(0,a.jsxs)("td",{className:"px-4 py-3",children:["addressed"===e.status&&(0,a.jsxs)("span",{className:"inline-flex items-center gap-1 px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[(0,a.jsx)(E.Z,{className:"w-3 h-3"}),"Addressed"]}),"partially_addressed"===e.status&&(0,a.jsxs)("span",{className:"inline-flex items-center gap-1 px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:[(0,a.jsx)(M.Z,{className:"w-3 h-3"}),"Partial"]}),"unaddressed"===e.status&&(0,a.jsxs)("span",{className:"inline-flex items-center gap-1 px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800",children:[(0,a.jsx)(F.Z,{className:"w-3 h-3"}),"Unaddressed"]})]}),(0,a.jsx)("td",{className:"px-4 py-3 text-sm",children:e.jira_issues.length>0?(0,a.jsxs)("div",{className:"flex flex-wrap gap-1",children:[e.jira_issues.slice(0,3).map(e=>(0,a.jsxs)("a",{href:e.issue_url,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 px-2 py-0.5 bg-blue-50 text-blue-700 rounded text-xs hover:bg-blue-100 transition-colors",children:[e.jira_key,(0,a.jsx)(R.Z,{className:"w-3 h-3"})]},e.jira_key)),e.jira_issues.length>3&&(0,a.jsxs)("span",{className:"text-xs text-gray-500",children:["+",e.jira_issues.length-3," more"]})]}):(0,a.jsx)("span",{className:"text-xs text-gray-400",children:"No tickets"})})]},e.theme_key))})]})}),x.length>0&&(0,a.jsx)("div",{className:"mt-4 pt-4 border-t border-gray-200 text-sm text-gray-600",children:(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Summary:"})," ",x.filter(e=>"unaddressed"===e.status).length," unaddressed themes,"," ",x.filter(e=>"addressed"===e.status).length," addressed themes"]})})]})}function z(e){let{allAccounts:t}=e,[s,n]=(0,r.useState)("accounts");return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Report"}),(0,a.jsxs)("select",{value:s,onChange:e=>n(e.target.value),className:"w-full md:w-64 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,a.jsx)("option",{value:"accounts",children:"Account Friction Report"}),(0,a.jsx)("option",{value:"theme_resolution",children:"Theme Resolution Status (Jira)"})]})]}),"accounts"===s&&(0,a.jsx)(L,{allAccounts:t}),"theme_resolution"===s&&(0,a.jsx)(T,{})]})}var I=s(37805);function Z(e){if(!e)return"Other";let t=e.toUpperCase();return t.includes("EDGE")?"EDGE":t.includes("SITELINK")?"SiteLink":"Other"}function P(e){let{accounts:t,initialExpandedTheme:s}=e,[n,i]=(0,r.useState)("All"),[o,c]=(0,r.useState)(s||null),[d,x]=(0,r.useState)({}),[m,u]=(0,r.useState)({}),h=(0,l.useRouter)(),g=function(e,t){let s="All"===t?e:e.filter(e=>Z(e.products)===t),a=new Map;for(let e of s){var r;let t=null===(r=e.current_snapshot)||void 0===r?void 0:r.top_themes;if(t&&0!==t.length)for(let s of t){let t=a.get(s.theme_key);t||(t={theme_key:s.theme_key,total_count:0,total_severity:0,accounts:new Map,severity_counts:{low:0,medium:0,high:0}},a.set(s.theme_key,t)),t.total_count+=s.count,t.total_severity+=s.avg_severity*s.count,s.avg_severity<3?t.severity_counts.low+=s.count:s.avg_severity<4?t.severity_counts.medium+=s.count:t.severity_counts.high+=s.count;let r=t.accounts.get(e.id);r||(r={id:e.id,name:e.name,count:0,total_severity:0},t.accounts.set(e.id,r)),r.count+=s.count,r.total_severity+=s.avg_severity*s.count}}let n=[];for(let e of Array.from(a.values())){let t=Array.from(e.accounts.values()).map(e=>({id:e.id,name:e.name,count:e.count,avg_severity:e.total_severity/e.count}));t.sort((e,t)=>{let s=e.count*e.avg_severity;return t.count*t.avg_severity-s}),n.push({theme_key:e.theme_key,theme_label:e.theme_key.split("_").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" "),total_count:e.total_count,avg_severity:e.total_severity/e.total_count,affected_accounts:t,severity_distribution:e.severity_counts})}return n.sort((e,t)=>{let s=e.total_count*e.avg_severity;return t.total_count*t.avg_severity-s}),n}(t,n),p=g.reduce((e,t)=>e+t.total_count,0),y=("All"===n?t:t.filter(e=>Z(e.products)===n)).filter(e=>{var t;return(null===(t=e.current_snapshot)||void 0===t?void 0:t.top_themes)&&e.current_snapshot.top_themes.length>0}).length;async function f(e){u(t=>({...t,[e]:!0}));try{let t=await fetch("/api/jira/theme-tickets?theme=".concat(e));if(t.ok){let s=await t.json();x(t=>({...t,[e]:s.tickets||[]}))}}catch(t){console.error("Error fetching Jira tickets:",t),x(t=>({...t,[e]:[]}))}finally{u(t=>({...t,[e]:!1}))}}function v(e){return e>=4?"bg-red-100 text-red-800":e>=3?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"}return(0,r.useEffect)(()=>{!o||d[o]||m[o]||f(o)},[o]),(0,a.jsx)("div",{className:"space-y-6",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Key Friction Themes"}),(0,a.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:[p," total issues across ",y," accounts"]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("label",{htmlFor:"product-filter",className:"text-sm font-medium text-gray-700",children:"Filter by Product:"}),(0,a.jsxs)("select",{id:"product-filter",value:n,onChange:e=>i(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm",children:[(0,a.jsx)("option",{value:"All",children:"All Products"}),(0,a.jsx)("option",{value:"EDGE",children:"EDGE"}),(0,a.jsx)("option",{value:"SiteLink",children:"SiteLink"}),(0,a.jsx)("option",{value:"Other",children:"Other"})]})]})]}),0===g.length&&(0,a.jsx)("div",{className:"text-center py-12",children:(0,a.jsxs)("p",{className:"text-gray-500",children:["No friction data found for ","All"===n?"any accounts":"".concat(n," customers"),"."]})}),g.length>0&&(0,a.jsx)("div",{className:"space-y-3",children:g.map((e,t)=>(0,a.jsxs)("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[(0,a.jsxs)("button",{onClick:()=>{var t;c(o===(t=e.theme_key)?null:t)},className:"w-full px-4 py-3 flex items-center justify-between hover:bg-gray-50 transition-colors",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[o===e.theme_key?(0,a.jsx)(A.Z,{className:"w-5 h-5 text-gray-400"}):(0,a.jsx)(I.Z,{className:"w-5 h-5 text-gray-400"}),(0,a.jsxs)("span",{className:"text-sm font-medium text-gray-500",children:[t+1,"."]}),(0,a.jsx)("span",{className:"text-base font-semibold text-gray-900",children:e.theme_label})]}),(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsxs)("span",{className:"text-sm text-gray-600",children:[e.total_count," ",1===e.total_count?"issue":"issues"]}),(0,a.jsxs)("span",{className:"px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(v(e.avg_severity)),children:["Avg Severity: ",e.avg_severity.toFixed(1)]}),(0,a.jsxs)("span",{className:"text-sm text-gray-600",children:[e.affected_accounts.length," ",1===e.affected_accounts.length?"account":"accounts"]})]})]}),o===e.theme_key&&(0,a.jsxs)("div",{className:"px-4 py-4 bg-gray-50 border-t border-gray-200 space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h4",{className:"text-sm font-medium text-gray-700 mb-2 flex items-center gap-2",children:["Product Roadmap",d[e.theme_key]&&d[e.theme_key].length>0&&(0,a.jsxs)("span",{className:"text-xs bg-purple-100 text-purple-800 px-2 py-0.5 rounded font-medium",children:[d[e.theme_key].length," ",1===d[e.theme_key].length?"ticket":"tickets"]})]}),m[e.theme_key]&&(0,a.jsx)("div",{className:"text-sm text-gray-500",children:"Loading roadmap tickets..."}),!m[e.theme_key]&&d[e.theme_key]&&d[e.theme_key].length>0&&(0,a.jsx)("div",{className:"space-y-2",children:d[e.theme_key].map(e=>(0,a.jsx)("div",{className:"bg-white rounded border border-gray-200 p-3",children:(0,a.jsx)("div",{className:"flex items-start gap-2",children:(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,a.jsxs)("a",{href:e.issue_url,target:"_blank",rel:"noopener noreferrer",onClick:e=>e.stopPropagation(),className:"text-sm font-mono font-semibold text-blue-700 hover:text-blue-900 hover:underline flex items-center gap-1",children:[e.jira_key,(0,a.jsx)(R.Z,{className:"w-3 h-3"})]}),(0,a.jsx)("span",{className:"text-xs bg-gray-100 px-2 py-0.5 rounded border border-gray-300 text-gray-700",children:e.status}),e.priority&&(0,a.jsx)("span",{className:"text-xs bg-orange-100 text-orange-800 px-2 py-0.5 rounded font-medium",children:e.priority})]}),(0,a.jsx)("div",{className:"text-sm text-gray-700",children:e.summary})]})})},e.jira_key))}),!m[e.theme_key]&&d[e.theme_key]&&0===d[e.theme_key].length&&(0,a.jsx)("div",{className:"text-sm text-gray-500 italic",children:"No roadmap tickets linked to this theme yet."})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Severity Distribution"}),(0,a.jsxs)("div",{className:"flex items-center gap-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-xs font-medium text-red-800",children:"High (4-5):"}),(0,a.jsx)("span",{className:"text-sm text-gray-900",children:e.severity_distribution.high})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-xs font-medium text-yellow-800",children:"Medium (3):"}),(0,a.jsx)("span",{className:"text-sm text-gray-900",children:e.severity_distribution.medium})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-xs font-medium text-green-800",children:"Low (1-2):"}),(0,a.jsx)("span",{className:"text-sm text-gray-900",children:e.severity_distribution.low})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Affected Accounts"}),(0,a.jsx)("div",{className:"space-y-2",children:e.affected_accounts.map(t=>(0,a.jsx)("button",{onClick:()=>h.push("/account/".concat(t.id,"?theme=").concat(e.theme_key)),className:"w-full text-left px-3 py-2 bg-white rounded border border-gray-200 hover:border-blue-500 hover:bg-blue-50 transition-colors",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-gray-900",children:t.name}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsxs)("span",{className:"text-xs text-gray-600",children:[t.count," ",1===t.count?"issue":"issues"]}),(0,a.jsx)("span",{className:"px-2 py-0.5 rounded-full text-xs font-medium ".concat(v(t.avg_severity)),children:t.avg_severity.toFixed(1)}),(0,a.jsx)("span",{className:"text-xs text-blue-600 font-medium",children:"View →"})]})]})},t.id))})]})]})]},e.theme_key))})]})})}var O=s(40834);function q(){let[e,t]=(0,r.useState)(!0),[s,l]=(0,r.useState)(!1),[i,o]=(0,r.useState)(!1),[c,d]=(0,r.useState)({lastSynced:null,totalIssues:0,hasIntegration:!1}),x=(0,n.createClientComponentClient)();async function m(){try{let{data:e}=await x.from("integrations").select("last_synced_at").eq("integration_type","jira").eq("status","active").single();if(!e){d({lastSynced:null,totalIssues:0,hasIntegration:!1}),t(!1);return}let{count:s}=await x.from("jira_issues").select("*",{count:"exact",head:!0});d({lastSynced:e.last_synced_at,totalIssues:s||0,hasIntegration:!0})}catch(e){console.error("Error fetching sync stats:",e)}finally{t(!1)}}async function u(){l(!0);try{(await fetch("/api/jira/sync",{method:"POST"})).ok&&await m()}catch(e){console.error("Sync error:",e)}finally{l(!1)}}if((0,r.useEffect)(()=>{m()},[]),e||!c.hasIntegration)return null;let h=c.lastSynced?new Date(c.lastSynced).toLocaleString():"Never",g=c.lastSynced?(()=>{let e=Math.floor((Date.now()-new Date(c.lastSynced).getTime())/6e4),t=Math.floor(e/60),s=Math.floor(t/24);return s>0?"".concat(s,"d ago"):t>0?"".concat(t,"h ago"):e>0?"".concat(e,"m ago"):"just now"})():"never";return(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)("button",{onClick:u,disabled:s,onMouseEnter:()=>o(!0),onMouseLeave:()=>o(!1),className:"flex flex-col items-start px-4 py-2 text-sm font-medium text-purple-700 bg-purple-50 border border-purple-300 rounded-lg hover:bg-purple-100 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(O.Z,{className:"w-4 h-4 ".concat(s?"animate-spin":"")}),(0,a.jsx)("span",{children:s?"Syncing Jira...":"Sync Jira"})]}),!s&&(0,a.jsxs)("span",{className:"text-xs text-purple-600 mt-0.5 ml-6",children:["Last synced ",g]})]}),i&&(0,a.jsx)("div",{className:"absolute top-full right-0 mt-2 w-80 bg-white border border-gray-200 rounded-lg shadow-lg p-4 z-50",children:(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-sm font-semibold text-gray-900 mb-1",children:"Jira Integration"}),(0,a.jsx)("p",{className:"text-xs text-gray-600",children:"Automated daily sync at 3:00 AM UTC via Supabase cron job"})]}),(0,a.jsxs)("div",{className:"pt-3 border-t border-gray-200 space-y-2",children:[(0,a.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Last synced:"}),(0,a.jsx)("span",{className:"font-medium text-gray-900",children:h})]}),(0,a.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Total issues (90d):"}),(0,a.jsx)("span",{className:"font-medium text-gray-900",children:c.totalIssues.toLocaleString()})]})]}),(0,a.jsx)("div",{className:"pt-3 border-t border-gray-200",children:(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"Issues are automatically synced and linked to friction themes based on keywords and labels."})})]})})]})}var U=s(57976),G=s(51318),J=s(26490);function V(){let[e,t]=(0,r.useState)(!0),[s,l]=(0,r.useState)(null);async function i(){try{let e=await fetch("/api/jira/portfolio-stats");if(e.ok){let t=await e.json();l(t)}}catch(e){console.error("Failed to fetch Jira portfolio stats:",e)}finally{t(!1)}}return((0,n.createClientComponentClient)(),(0,r.useEffect)(()=>{i()},[]),e)?(0,a.jsx)("div",{className:"bg-white rounded-lg shadow p-6",children:(0,a.jsxs)("div",{className:"animate-pulse space-y-4",children:[(0,a.jsx)("div",{className:"h-6 bg-gray-200 rounded w-1/3"}),(0,a.jsx)("div",{className:"h-4 bg-gray-200 rounded w-1/2"})]})}):s&&0!==s.topThemes.length?(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:"Jira Roadmap Progress"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Product fixes and improvements across your Top 25 accounts"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-4 gap-4",children:[(0,a.jsxs)("div",{className:"bg-green-50 rounded-lg p-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,a.jsx)(U.Z,{className:"w-4 h-4 text-green-600"}),(0,a.jsx)("span",{className:"text-xs font-medium text-green-700",children:"Resolved (7d)"})]}),(0,a.jsx)("div",{className:"text-2xl font-bold text-green-900",children:s.portfolio.resolved_7d}),(0,a.jsx)("div",{className:"text-xs text-green-600 mt-1",children:"Quick wins"})]}),(0,a.jsxs)("div",{className:"bg-blue-50 rounded-lg p-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,a.jsx)(G.Z,{className:"w-4 h-4 text-blue-600"}),(0,a.jsx)("span",{className:"text-xs font-medium text-blue-700",children:"In Progress"})]}),(0,a.jsx)("div",{className:"text-2xl font-bold text-blue-900",children:s.portfolio.in_progress}),(0,a.jsx)("div",{className:"text-xs text-blue-600 mt-1",children:"Coming soon"})]}),(0,a.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,a.jsx)(J.Z,{className:"w-4 h-4 text-gray-600"}),(0,a.jsx)("span",{className:"text-xs font-medium text-gray-700",children:"On Radar"})]}),(0,a.jsx)("div",{className:"text-2xl font-bold text-gray-900",children:s.portfolio.open}),(0,a.jsx)("div",{className:"text-xs text-gray-600 mt-1",children:"Open tickets"})]}),(0,a.jsxs)("div",{className:"bg-purple-50 rounded-lg p-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,a.jsx)(d.Z,{className:"w-4 h-4 text-purple-600"}),(0,a.jsx)("span",{className:"text-xs font-medium text-purple-700",children:"30-Day Total"})]}),(0,a.jsx)("div",{className:"text-2xl font-bold text-purple-900",children:s.portfolio.resolved_30d}),(0,a.jsx)("div",{className:"text-xs text-purple-600 mt-1",children:"Recently resolved"})]})]}),(0,a.jsx)("div",{className:"mt-4 text-center",children:(0,a.jsx)("button",{onClick:()=>window.location.href="/dashboard?tab=themes",className:"text-sm text-purple-700 hover:text-purple-900 font-medium",children:"View all themes and roadmap details →"})})]}):null}function W(){let[e,t]=(0,r.useState)([]),[s,u]=(0,r.useState)([]),[h,g]=(0,r.useState)(!0),[p,y]=(0,r.useState)(!1),[v,b]=(0,r.useState)(""),[j,w]=(0,r.useState)(0),[_,k]=(0,r.useState)(0),[S,C]=(0,r.useState)(0),[A,D]=(0,r.useState)(0),[L,E]=(0,r.useState)("portfolios"),[M,F]=(0,r.useState)([]),[R,T]=(0,r.useState)([]),[I,Z]=(0,r.useState)(!1),[O,U]=(0,r.useState)(null),[G,J]=(0,r.useState)("arr"),[W,H]=(0,r.useState)("desc"),[K,B]=(0,r.useState)("all"),[Y,$]=(0,r.useState)("all"),[Q,X]=(0,r.useState)(!1),[ee,et]=(0,r.useState)(!0),[es,ea]=(0,r.useState)(null),[er,en]=(0,r.useState)(null),[el,ei]=(0,r.useState)({}),[eo,ec]=(0,r.useState)(null),ed=(0,n.createClientComponentClient)(),ex=(0,l.useRouter)();async function em(){try{let{data:e}=await ed.from("integrations").select("*").eq("integration_type","salesforce").eq("status","active").single();X(!!e)}catch(e){X(!1)}finally{et(!1)}}async function eu(){try{let{data:{user:e}}=await ed.auth.getUser();if(!e){ex.push("/");return}let{data:s}=await ed.from("portfolios").select("*").eq("user_id",e.id).order("created_at",{ascending:!1}),a=null==s?void 0:s.find(e=>"top_25_edge"===e.portfolio_type),r=null==s?void 0:s.find(e=>"top_25_marine"===e.portfolio_type),n=[...(null==a?void 0:a.account_ids)||[],...(null==r?void 0:r.account_ids)||[]],l=Array.from(new Set(n));if(l.length>0){let{data:e}=await ed.from("accounts").select("\n            *,\n            current_snapshot:account_snapshots!account_snapshots_account_id_fkey(\n              ofi_score,\n              trend_direction,\n              top_themes,\n              case_volume,\n              created_at\n            )\n          ").in("id",l).eq("status","active").order("arr",{ascending:!1});if(e){let s=e.map(e=>({...e,current_snapshot:Array.isArray(e.current_snapshot)?e.current_snapshot.sort((e,t)=>new Date(t.created_at).getTime()-new Date(e.created_at).getTime())[0]:e.current_snapshot})).filter(e=>"Test"!==e.name);t(s),k(s.length);let a=new Date().toISOString().split("T")[0],{data:r}=await ed.from("account_snapshots").select("account_id").in("account_id",l).eq("snapshot_date",a),n=new Set((null==r?void 0:r.map(e=>e.account_id))||[]),i=s.filter(e=>n.has(e.id)).map(e=>e.name),o=s.filter(e=>!n.has(e.id)).map(e=>e.name);if(w((null==r?void 0:r.length)||0),F(i),T(o),r&&r.length>0){let{data:e}=await ed.from("account_snapshots").select("created_at").in("account_id",l).eq("snapshot_date",a).order("created_at",{ascending:!1}).limit(1).single();e&&U(e.created_at)}let{data:c}=await ed.from("account_snapshots").select("case_volume").in("account_id",l).gte("snapshot_date",new Date(Date.now()-7776e6).toISOString());if(c&&c.length>0){let e=c.reduce((e,t)=>e+(t.case_volume||0),0)/c.length;C(e)}let d=s.filter(e=>{var t;return e.facility_count&&e.facility_count>0&&(null===(t=e.current_snapshot)||void 0===t?void 0:t.case_volume)!==void 0});if(d.length>0){let e=d.reduce((e,t)=>{var s;let a=((null===(s=t.current_snapshot)||void 0===s?void 0:s.case_volume)||0)/(t.facility_count||1);return e+a},0)/d.length;D(e)}let{data:x}=await ed.from("alerts").select("account_id").in("account_id",l).eq("dismissed",!1),m=(x||[]).reduce((e,t)=>(e[t.account_id]=(e[t.account_id]||0)+1,e),{});try{let e=await fetch("/api/jira/portfolio-stats");if(e.ok){let t=await e.json();ei(t.accountTicketCounts||{})}}catch(e){console.error("Error fetching Jira ticket counts:",e)}let u=s.map(e=>({...e,alert_count:m[e.id]||0}));t(u)}}await eh()}catch(e){console.error("Error loading dashboard:",e)}finally{g(!1)}}async function eh(){let{data:{user:e}}=await ed.auth.getUser();if(!e)return;let{data:t}=await ed.from("favorites").select("\n        *,\n        account:accounts(*)\n      ").eq("user_id",e.id).order("created_at",{ascending:!1});u(t||[])}async function eg(){let{data:e}=await ed.from("integrations").select("*").eq("integration_type","salesforce").eq("status","active").single();if(!e){alert('⚠️ Salesforce Not Connected\n\nYou need to connect your Salesforce account first.\n\n1. Click on Settings (top right)\n2. Connect to Salesforce\n3. Come back here and click "Sync from Salesforce"'),ex.push("/settings");return}y(!0),b("Syncing account data from Salesforce...");try{let e=await fetch("/api/salesforce/sync",{method:"POST"});if(!e.ok){let t;let s="";try{let a=await e.text();s=a,t=JSON.parse(a),console.error("Sync API error - Status:",e.status,"Data:",t)}catch(e){console.error("Failed to parse error response:",s),t={error:"Invalid error response from server"}}if("Salesforce not connected"===t.error||"No tokens found"===t.error){alert("⚠️ Salesforce Connection Issue\n\nYour Salesforce connection may have expired or is not properly configured.\n\n1. Go to Settings (top right)\n2. Reconnect to Salesforce\n3. Come back here and try syncing again"),ex.push("/settings"),y(!1);return}let a=t.error||t.message||"HTTP ".concat(e.status," error"),r=t.details||"";throw Error("".concat(a).concat(r?" - ".concat(r):""))}let t=await e.json();console.log("Sync result:",t),t.message&&b(t.message),t.analysisError&&(console.error("Analysis error:",t.analysisError),alert("⚠️ Analysis Failed\n\n".concat(t.analysisError,"\n\nCheck the console or Vercel logs for details."))),await eu(),y(!1),setTimeout(()=>b(""),1e4);return}catch(s){console.error("Sync error (full):",s),console.error("Error type:",typeof s),console.error("Error details:",{message:s instanceof Error?s.message:String(s),stack:s instanceof Error?s.stack:void 0});let e=s instanceof Error?s.message:String(s),t="❌ Failed to sync with Salesforce\n\n";e.toLowerCase().includes("401")||e.toLowerCase().includes("unauthorized")||e.toLowerCase().includes("not connected")?t+="\uD83D\uDD10 Authentication Issue\n\nYour Salesforce connection may have expired or is not set up.\n\n\uD83D\uDCDD Steps to fix:\n1. Click Settings (top right)\n2. Connect or reconnect to Salesforce\n3. Come back and try syncing again":e.toLowerCase().includes("timeout")||e.toLowerCase().includes("etimedout")?t+="⏱️ Connection Timeout\n\nThe request took too long - this can happen with large datasets.\n\n\uD83D\uDCDD What to do:\nJust click the sync button again to retry. Your progress is saved.":e.toLowerCase().includes("network")||e.toLowerCase().includes("econnrefused")||e.toLowerCase().includes("fetch")?t+="\uD83C\uDF10 Network Error\n\nUnable to reach the server or Salesforce.\n\n\uD83D\uDCDD What to do:\n• Check your internet connection\n• Click the sync button to try again\n• Check browser console for details":e.toLowerCase().includes("rate limit")?t+="⚠️ Rate Limit\n\nToo many requests to Salesforce API.\n\n\uD83D\uDCDD What to do:\nWait 2-3 minutes, then click sync again.":e.toLowerCase().includes("invalid")||e.toLowerCase().includes("parse")?t+="⚠️ Server Response Error\n\nThe server returned an unexpected response.\n\n\uD83D\uDCDD What to do:\n• Try clicking sync again\n• Check your Salesforce connection in Settings\n• Contact support if this persists":t+="Error Details:\n".concat(e,"\n\n\uD83D\uDCDD What to do:\n• Copy this error message\n• Try clicking sync again\n• If it fails again, go to Settings → Disconnect → Reconnect Salesforce\n• Open browser console (F12) for technical details"),alert(t),y(!1),b(""),await em()}}function ep(e){G===e?H("asc"===W?"desc":"asc"):(J(e),H("desc"))}function ey(e){return G!==e?(0,a.jsx)(i.Z,{className:"w-4 h-4 ml-1 inline"}):"asc"===W?(0,a.jsx)(o.Z,{className:"w-4 h-4 ml-1 inline"}):(0,a.jsx)(c.Z,{className:"w-4 h-4 ml-1 inline"})}(0,r.useEffect)(()=>{{let e=new URLSearchParams(window.location.search),t=e.get("tab"),s=e.get("theme");"themes"===t&&(E("themes"),s&&ec(s))}},[]),(0,r.useEffect)(()=>{eu(),em()},[]);let ef=e=>"worsening"===e?(0,a.jsx)(d.Z,{className:"w-4 h-4 text-red-500"}):"improving"===e?(0,a.jsx)(x.Z,{className:"w-4 h-4 text-green-500"}):"stable"===e?(0,a.jsx)("span",{className:"text-gray-500 text-xs",children:"Stable"}):(0,a.jsx)("span",{className:"text-gray-400 text-xs",children:"—"}),ev=e=>{let t=e.products||"",s=t.includes("EDGE")||t.includes("Storable Edge"),a=t.includes("SiteLink");return s&&a||s?"EDGE":a?"SiteLink":"N/A"},eb=e=>"all"===Y?e:e.filter(e=>e.vertical===Y),ej=e=>"all"===K?e:e.filter(e=>{let t=ev(e);return"edge"===K?"EDGE"===t:"sitelink"===K&&"SiteLink"===t});return h?(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),(0,a.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading your portfolio..."})]})}):(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsx)("header",{className:"bg-white border-b border-gray-200",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Friction Intelligence"}),(0,a.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"Early warning system for customer friction"})]}),(0,a.jsxs)("button",{onClick:()=>ex.push("/settings"),className:"flex items-center gap-2 px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50",children:[(0,a.jsx)(m.Z,{className:"w-4 h-4"}),"Settings"]})]})})}),(0,a.jsxs)("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,a.jsx)("div",{className:"mb-4",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Business Unit:"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:()=>$("all"),className:"px-4 py-1.5 text-sm rounded-lg font-medium transition-colors ".concat("all"===Y?"bg-indigo-600 text-white":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"),children:"All"}),(0,a.jsx)("button",{onClick:()=>$("storage"),className:"px-4 py-1.5 text-sm rounded-lg font-medium transition-colors ".concat("storage"===Y?"bg-indigo-600 text-white":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"),children:"Storage"}),(0,a.jsx)("button",{onClick:()=>$("marine"),className:"px-4 py-1.5 text-sm rounded-lg font-medium transition-colors ".concat("marine"===Y?"bg-indigo-600 text-white":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"),children:"Marine"})]})]})}),(0,a.jsxs)("div",{className:"mb-6 flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:()=>E("portfolios"),className:"px-4 py-2 rounded-lg font-medium ".concat("portfolios"===L?"bg-blue-600 text-white":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"),children:"Portfolios"}),(0,a.jsxs)("button",{onClick:()=>E("favorites"),className:"px-4 py-2 rounded-lg font-medium ".concat("favorites"===L?"bg-blue-600 text-white":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"),children:["Favorites (",s.length,")"]}),(0,a.jsx)("button",{onClick:()=>E("reports"),className:"px-4 py-2 rounded-lg font-medium ".concat("reports"===L?"bg-blue-600 text-white":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"),children:"Custom Reports"}),(0,a.jsx)("button",{onClick:()=>E("themes"),className:"px-4 py-2 rounded-lg font-medium ".concat("themes"===L?"bg-blue-600 text-white":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"),children:"Key Friction Themes"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(q,{}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)("button",{onClick:Q?eg:()=>ex.push("/settings"),disabled:p||ee,onMouseEnter:()=>Z(!0),onMouseLeave:()=>Z(!1),className:"px-4 py-2 rounded-lg font-medium flex flex-col items-start transition-colors ".concat(p||ee?"bg-gray-400 text-white cursor-not-allowed":Q?0===_?"bg-blue-600 text-white hover:bg-blue-700":j<_?"bg-blue-600 text-white hover:bg-blue-700":"bg-green-600 text-white hover:bg-green-700":"bg-orange-600 text-white hover:bg-orange-700"),children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[p&&(0,a.jsxs)("svg",{className:"animate-spin h-4 w-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),(0,a.jsx)("span",{children:ee?"Checking...":p?"Syncing Portfolio...":Q?0===_?"Sync from Salesforce":j<_?"Sync & Analyze All":"All Up to Date ✓":"Connect Salesforce"})]}),!p&&!ee&&Q&&j===_&&O&&(0,a.jsxs)("span",{className:"text-xs opacity-90 mt-0.5",children:["Last analyzed ",(()=>{let e=Math.floor((Date.now()-new Date(O).getTime())/6e4),t=Math.floor(e/60);return t>0?"".concat(t,"h ago"):e>0?"".concat(e,"m ago"):"just now"})()," • Click to re-sync"]})]}),!p&&j<_&&(0,a.jsx)("span",{className:"absolute -top-2 -right-2 bg-red-500 text-white text-xs font-bold px-2 py-1 rounded-full",children:_-j}),I&&!Q&&(0,a.jsx)("div",{className:"absolute top-full right-0 mt-2 w-80 bg-orange-50 border border-orange-200 rounded-lg shadow-lg p-4 z-50",children:(0,a.jsxs)("div",{className:"text-sm text-orange-900",children:[(0,a.jsx)("p",{className:"font-semibold mb-2",children:"⚠️ Salesforce Not Connected"}),(0,a.jsx)("p",{className:"text-xs",children:"Click to go to Settings and connect your Salesforce account."})]})}),I&&Q&&(M.length>0||R.length>0)&&(0,a.jsxs)("div",{className:"absolute top-full right-0 mt-2 w-80 bg-white border border-gray-200 rounded-lg shadow-lg p-4 z-50",children:[(0,a.jsxs)("div",{className:"space-y-3",children:[M.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"flex items-center gap-2 mb-2",children:(0,a.jsxs)("span",{className:"text-xs font-semibold text-green-700 uppercase tracking-wide",children:["✓ Analyzed Today (",M.length,")"]})}),(0,a.jsx)("div",{className:"max-h-32 overflow-y-auto space-y-1",children:M.map(e=>(0,a.jsxs)("div",{className:"text-xs text-gray-700 pl-3",children:["• ",e]},e))})]}),R.length>0&&(0,a.jsxs)("div",{className:"pt-3 border-t border-gray-200",children:[(0,a.jsx)("div",{className:"flex items-center gap-2 mb-2",children:(0,a.jsxs)("span",{className:"text-xs font-semibold text-orange-700 uppercase tracking-wide",children:["⏳ Needs Analysis (",R.length,")"]})}),(0,a.jsx)("div",{className:"max-h-32 overflow-y-auto space-y-1",children:R.map(e=>(0,a.jsxs)("div",{className:"text-xs text-gray-700 pl-3",children:["• ",e]},e))})]})]}),(0,a.jsx)("div",{className:"mt-3 pt-3 border-t border-gray-200 text-xs text-gray-500",children:'Click "Sync & Analyze All" to process all pending accounts. Runs automatically every hour.'})]})]})]})]}),v&&(0,a.jsx)("div",{className:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:(0,a.jsx)("p",{className:"text-sm text-blue-700",children:v})}),"portfolios"===L&&(0,a.jsxs)(a.Fragment,{children:[0===e.length&&(0,a.jsx)("div",{className:"max-w-2xl mx-auto",children:(0,a.jsxs)("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl border-2 border-blue-200 p-8 text-center",children:[(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-blue-600 rounded-full mb-4",children:(0,a.jsx)("svg",{className:"w-8 h-8 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})})}),(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Welcome to Friction Intelligence!"}),(0,a.jsx)("p",{className:"text-gray-600 mb-6",children:"Let's get your Salesforce accounts connected"})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg p-6 mb-6 text-left",children:[(0,a.jsx)("h3",{className:"font-semibold text-gray-900 mb-4",children:"Getting Started:"}),(0,a.jsxs)("ol",{className:"space-y-3",children:[(0,a.jsxs)("li",{className:"flex items-start gap-3",children:[(0,a.jsx)("span",{className:"flex-shrink-0 w-6 h-6 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-sm font-semibold",children:"1"}),(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsxs)("span",{className:"text-gray-700",children:["Go to ",(0,a.jsx)("strong",{children:"Settings"})," (top right) and connect your Salesforce account"]})})]}),(0,a.jsxs)("li",{className:"flex items-start gap-3",children:[(0,a.jsx)("span",{className:"flex-shrink-0 w-6 h-6 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-sm font-semibold",children:"2"}),(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsx)("span",{className:"text-gray-700",children:'Come back here and click "Sync from Salesforce" to import your accounts'})})]}),(0,a.jsxs)("li",{className:"flex items-start gap-3",children:[(0,a.jsx)("span",{className:"flex-shrink-0 w-6 h-6 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-sm font-semibold",children:"3"}),(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsx)("span",{className:"text-gray-700",children:"Your accounts will be automatically synced and analyzed by end of day"})})]})]}),(0,a.jsx)("div",{className:"mt-4 p-3 bg-blue-50 rounded-lg border border-blue-200",children:(0,a.jsxs)("p",{className:"text-sm text-blue-800",children:[(0,a.jsx)("strong",{children:"\uD83D\uDCA1 Want insights now?"}),' After syncing, visit any account page and click "Analyze Friction" to jumpstart the analysis for that specific account.']})})]}),(0,a.jsxs)("button",{onClick:()=>ex.push("/settings"),className:"inline-flex items-center gap-2 px-8 py-4 text-lg font-semibold text-white bg-blue-600 rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed shadow-lg hover:shadow-xl transition-all",children:[(0,a.jsxs)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]}),"Go to Settings to Connect"]}),(0,a.jsx)("p",{className:"text-sm text-gray-500 mt-4",children:"Once connected, your data syncs automatically • You control when to analyze"})]})}),e.length>0&&(0,a.jsx)(f,{top25:ej(eb(e)),singleOperator:[]}),(0,a.jsx)("div",{className:"mt-6",children:(0,a.jsx)(V,{})}),(0,a.jsxs)("section",{className:"mt-8",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,a.jsxs)("h2",{className:"text-2xl font-bold text-gray-900",children:["storage"===Y&&"Storage Accounts (EDGE & SiteLink)","marine"===Y&&"Marine Accounts","all"===Y&&"All Accounts"]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:["marine"!==Y&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("label",{htmlFor:"software-filter",className:"text-sm font-medium text-gray-700",children:"Filter by:"}),(0,a.jsxs)("select",{id:"software-filter",value:K,onChange:e=>B(e.target.value),className:"block w-40 px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500",children:[(0,a.jsx)("option",{value:"all",children:"All Software"}),(0,a.jsx)("option",{value:"edge",children:"EDGE Only"}),(0,a.jsx)("option",{value:"sitelink",children:"SiteLink Only"})]})]}),(0,a.jsxs)("span",{className:"text-sm text-gray-600",children:["Showing ",ej(eb(e)).length," of ",e.length," accounts"]})]})]}),(0,a.jsx)("div",{className:"bg-white rounded-lg border border-gray-200 overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsxs)("th",{onClick:()=>ep("name"),className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100",children:["Account ",ey("name")]}),(0,a.jsxs)("th",{onClick:()=>ep("arr"),className:"px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100",children:["ARR ",ey("arr")]}),(0,a.jsxs)("th",{onClick:()=>ep("software"),className:"px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100",children:["Software ",ey("software")]}),(0,a.jsxs)("th",{onClick:()=>ep("ofi"),className:"px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100",children:["OFI Score ",ey("ofi")]}),(0,a.jsxs)("th",{onClick:()=>ep("case_volume"),onMouseEnter:()=>ea("case_volume"),onMouseLeave:()=>ea(null),className:"px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 relative",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1",children:["Cases (90d) ",ey("case_volume")]}),"case_volume"===es&&(0,a.jsxs)("div",{className:"absolute left-0 top-full mt-2 w-64 bg-gray-900 text-white text-xs rounded-lg shadow-xl p-3 z-50 whitespace-normal normal-case font-normal",children:["Total number of Salesforce cases for this account in the last 90 days",(0,a.jsx)("div",{className:"absolute -top-1 left-6 w-2 h-2 bg-gray-900 transform rotate-45"})]})]}),(0,a.jsxs)("th",{onClick:()=>ep("cases_per_facility"),onMouseEnter:()=>ea("cases_per_facility"),onMouseLeave:()=>ea(null),className:"px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 relative",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1",children:["Per Location (90d) ",ey("cases_per_facility")]}),"cases_per_facility"===es&&(0,a.jsxs)("div",{className:"absolute left-0 top-full mt-2 w-64 bg-gray-900 text-white text-xs rounded-lg shadow-xl p-3 z-50 whitespace-normal normal-case font-normal",children:["Average cases per facility location over 90 days. Normalizes case volume across different-sized accounts. Anything above the portfolio average may indicate friction.",(0,a.jsx)("div",{className:"absolute -top-1 left-6 w-2 h-2 bg-gray-900 transform rotate-45"})]})]}),(0,a.jsxs)("th",{onClick:()=>ep("trend"),className:"px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100",children:["Trend ",ey("trend")]}),(0,a.jsxs)("th",{onClick:()=>ep("last_analyzed"),className:"px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100",children:["Last Analyzed ",ey("last_analyzed")]}),(0,a.jsxs)("th",{onMouseEnter:()=>ea("jira_tickets"),onMouseLeave:()=>ea(null),className:"px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider relative",children:[(0,a.jsx)("div",{className:"flex items-center gap-1",children:"Jira Tickets"}),"jira_tickets"===es&&(0,a.jsxs)("div",{className:"absolute left-0 top-full mt-2 w-64 bg-gray-900 text-white text-xs rounded-lg shadow-xl p-3 z-50 whitespace-normal normal-case font-normal",children:["Product roadmap tickets linked to this account's friction themes. Shows resolved (7d) / in progress / open.",(0,a.jsx)("div",{className:"absolute -top-1 left-6 w-2 h-2 bg-gray-900 transform rotate-45"})]})]})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:ej(eb(e)).sort((e,t)=>{var s,a,r,n,l,i,o,c,d,x;let m,u;switch(G){case"name":m=e.name.toLowerCase(),u=t.name.toLowerCase();break;case"arr":m=e.arr||0,u=t.arr||0;break;case"software":m=ev(e),u=ev(t);break;case"ofi":m=(null===(s=e.current_snapshot)||void 0===s?void 0:s.ofi_score)||0,u=(null===(a=t.current_snapshot)||void 0===a?void 0:a.ofi_score)||0;break;case"case_volume":m=(null===(r=e.current_snapshot)||void 0===r?void 0:r.case_volume)||0,u=(null===(n=t.current_snapshot)||void 0===n?void 0:n.case_volume)||0;break;case"cases_per_facility":m=(null===(l=e.current_snapshot)||void 0===l?void 0:l.case_volume)&&e.facility_count&&e.facility_count>0?e.current_snapshot.case_volume/e.facility_count:0,u=(null===(i=t.current_snapshot)||void 0===i?void 0:i.case_volume)&&t.facility_count&&t.facility_count>0?t.current_snapshot.case_volume/t.facility_count:0;break;case"trend":let h={worsening:3,stable:2,improving:1,"":0};m=h[null===(o=e.current_snapshot)||void 0===o?void 0:o.trend_direction]||0,u=h[null===(c=t.current_snapshot)||void 0===c?void 0:c.trend_direction]||0;break;case"last_analyzed":m=(null===(d=e.current_snapshot)||void 0===d?void 0:d.created_at)?new Date(e.current_snapshot.created_at).getTime():0,u=(null===(x=t.current_snapshot)||void 0===x?void 0:x.created_at)?new Date(t.current_snapshot.created_at).getTime():0;break;default:return 0}return m<u?"asc"===W?-1:1:m>u?"asc"===W?1:-1:0}).map(e=>{var t,s,r,n,l;return(0,a.jsxs)("tr",{onClick:()=>ex.push("/account/".concat(e.id)),className:"hover:bg-gray-50 cursor-pointer",children:[(0,a.jsxs)("td",{className:"px-4 py-3 whitespace-nowrap",children:[(0,a.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.name}),(0,a.jsx)("div",{className:"text-xs text-gray-500",children:e.segment})]}),(0,a.jsxs)("td",{className:"px-3 py-3 whitespace-nowrap text-sm text-gray-900",children:["$",Math.round(e.arr||0).toLocaleString()]}),(0,a.jsx)("td",{className:"px-3 py-3 text-sm text-gray-900",children:ev(e)}),(0,a.jsx)("td",{className:"px-3 py-3 whitespace-nowrap",children:(null===(t=e.current_snapshot)||void 0===t?void 0:t.ofi_score)?(0,a.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(e.current_snapshot.ofi_score>=70?"bg-red-100 text-red-800":e.current_snapshot.ofi_score>=40?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"),children:e.current_snapshot.ofi_score}):(0,a.jsx)("span",{className:"text-xs text-gray-400",children:"-"})}),(0,a.jsx)("td",{className:"px-3 py-3 whitespace-nowrap text-sm",children:(null===(s=e.current_snapshot)||void 0===s?void 0:s.case_volume)!==void 0?(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)("span",{className:"text-gray-900 font-medium",children:e.current_snapshot.case_volume}),S>0&&e.current_snapshot.case_volume>1.5*S&&(0,a.jsxs)("div",{className:"relative inline-block",onMouseEnter:()=>en("high-".concat(e.id)),onMouseLeave:()=>en(null),children:[(0,a.jsx)("span",{className:"text-xs text-red-600 font-medium cursor-help",children:"⚠️"}),er==="high-".concat(e.id)&&(0,a.jsxs)("div",{className:"absolute left-0 top-full mt-1 w-56 bg-gray-900 text-white text-xs rounded-lg shadow-xl p-3 z-50 whitespace-normal",children:["High volume: 50%+ above portfolio average (",Math.round(S)," cases)",(0,a.jsx)("div",{className:"absolute -top-1 left-3 w-2 h-2 bg-gray-900 transform rotate-45"})]})]}),S>0&&e.current_snapshot.case_volume<.5*S&&(0,a.jsxs)("div",{className:"relative inline-block",onMouseEnter:()=>en("low-".concat(e.id)),onMouseLeave:()=>en(null),children:[(0,a.jsx)("span",{className:"text-xs text-yellow-600 cursor-help",children:"⬇️"}),er==="low-".concat(e.id)&&(0,a.jsxs)("div",{className:"absolute left-0 top-full mt-1 w-56 bg-gray-900 text-white text-xs rounded-lg shadow-xl p-3 z-50 whitespace-normal",children:["Low volume: 50%+ below portfolio average (",Math.round(S)," cases)",(0,a.jsx)("div",{className:"absolute -top-1 left-3 w-2 h-2 bg-gray-900 transform rotate-45"})]})]})]}):(0,a.jsx)("span",{className:"text-gray-400",children:"-"})}),(0,a.jsx)("td",{className:"px-3 py-3 whitespace-nowrap text-sm",children:(null===(r=e.current_snapshot)||void 0===r?void 0:r.case_volume)!==void 0&&e.facility_count&&e.facility_count>0?(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)("span",{className:"text-gray-900 font-medium",children:(e.current_snapshot.case_volume/e.facility_count).toFixed(1)}),(0,a.jsxs)("div",{className:"relative inline-block",onMouseEnter:()=>en("facility-".concat(e.id)),onMouseLeave:()=>en(null),children:[(0,a.jsxs)("span",{className:"text-xs text-gray-500 cursor-help",children:["(",e.facility_count," loc)"]}),er==="facility-".concat(e.id)&&(0,a.jsxs)("div",{className:"absolute left-0 top-full mt-1 w-56 bg-gray-900 text-white text-xs rounded-lg shadow-xl p-3 z-50 whitespace-normal",children:[(0,a.jsx)("div",{className:"font-semibold mb-1",children:e.name}),(0,a.jsxs)("div",{className:"text-gray-300",children:[e.facility_count," facilit",1===e.facility_count?"y":"ies"," / location",1===e.facility_count?"":"s"]}),(0,a.jsx)("div",{className:"mt-2 text-gray-400 italic text-[10px]",children:"Individual facility names available in Salesforce"}),(0,a.jsx)("div",{className:"absolute -top-1 left-8 w-2 h-2 bg-gray-900 transform rotate-45"})]})]}),A>0&&e.current_snapshot.case_volume/e.facility_count>1.3*A&&(0,a.jsxs)("div",{className:"relative inline-block",onMouseEnter:()=>en("per-facility-high-".concat(e.id)),onMouseLeave:()=>en(null),children:[(0,a.jsx)("span",{className:"text-xs text-orange-600 font-medium cursor-help",children:"⚠️"}),er==="per-facility-high-".concat(e.id)&&(0,a.jsxs)("div",{className:"absolute left-0 top-full mt-1 w-64 bg-gray-900 text-white text-xs rounded-lg shadow-xl p-3 z-50 whitespace-normal",children:["Above normal: 30%+ above portfolio average (",A.toFixed(1)," cases/location). May indicate friction.",(0,a.jsx)("div",{className:"absolute -top-1 left-3 w-2 h-2 bg-gray-900 transform rotate-45"})]})]})]}):0===e.facility_count?(0,a.jsx)("span",{className:"text-xs text-gray-400",children:"No facilities"}):(0,a.jsx)("span",{className:"text-gray-400",children:"-"})}),(0,a.jsx)("td",{className:"px-3 py-3 whitespace-nowrap",children:ef(null===(n=e.current_snapshot)||void 0===n?void 0:n.trend_direction)}),(0,a.jsx)("td",{className:"px-3 py-3 whitespace-nowrap text-sm text-gray-500",children:(null===(l=e.current_snapshot)||void 0===l?void 0:l.created_at)?new Date(e.current_snapshot.created_at).toLocaleDateString():"Never"}),(0,a.jsx)("td",{className:"px-3 py-3 whitespace-nowrap text-sm",children:el[e.id]?(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-green-700 font-medium",title:"Resolved (7 days)",children:el[e.id].resolved_7d}),(0,a.jsx)("span",{className:"text-gray-300",children:"/"}),(0,a.jsx)("span",{className:"text-blue-700 font-medium",title:"In Progress",children:el[e.id].in_progress}),(0,a.jsx)("span",{className:"text-gray-300",children:"/"}),(0,a.jsx)("span",{className:"text-gray-600 font-medium",title:"Open",children:el[e.id].open})]}):(0,a.jsx)("span",{className:"text-gray-400",children:"-"})})]},e.id)})})]})})]})]}),"favorites"===L&&(0,a.jsx)(N,{favorites:s,onUpdate:eh}),"reports"===L&&(0,a.jsx)(z,{allAccounts:eb(e)}),"themes"===L&&(0,a.jsx)(P,{accounts:eb(e),initialExpandedTheme:eo})]})]})}}},function(e){e.O(0,[180,785,780,971,69,744],function(){return e(e.s=30646)}),_N_E=e.O()}]);