(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[702],{30646:function(e,t,r){Promise.resolve().then(r.bind(r,58239))},58239:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return D}});var a=r(3827),s=r(64090),n=r(58714),l=r(47907),o=r(87461);/**
 * @license lucide-react v0.316.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let i=(0,o.Z)("ArrowUpDown",[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]]),c=(0,o.Z)("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]),d=(0,o.Z)("ArrowDown",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]);var u=r(29733),m=r(10775),x=r(27271);/**
 * @license lucide-react v0.316.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let g=(0,o.Z)("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),h=(0,o.Z)("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]);var p=r(98998),y=r(22071);function v(e){let{top25:t,singleOperator:r}=e,s=[...t,...r],n=s.length,l=s.reduce((e,t)=>{var r;return e+((null===(r=t.current_snapshot)||void 0===r?void 0:r.ofi_score)||0)},0)/(n||1),o=s.filter(e=>{var t;return(null===(t=e.current_snapshot)||void 0===t?void 0:t.trend_direction)==="worsening"}).length,i=s.filter(e=>{var t;return(null===(t=e.current_snapshot)||void 0===t?void 0:t.trend_direction)==="improving"}).length,c=s.reduce((e,t)=>e+(t.alert_count||0),0),d=s.filter(e=>{var t;return(null===(t=e.current_snapshot)||void 0===t?void 0:t.case_volume)!==void 0}),x=d.length>0?d.reduce((e,t)=>{var r;return e+((null===(r=t.current_snapshot)||void 0===r?void 0:r.case_volume)||0)},0)/d.length:0,g=d.filter(e=>{var t;let r=(null===(t=e.current_snapshot)||void 0===t?void 0:t.case_volume)||0;return r>1.5*x||r<.5*x}).length,v=[{name:"Total Accounts",value:n,icon:h,color:"text-blue-600",bg:"bg-blue-50"},{name:"Avg. Friction Score",value:l.toFixed(1),icon:h,color:l>=50?"text-red-600":"text-green-600",bg:l>=50?"bg-red-50":"bg-green-50"},{name:"Trending Up",value:o,icon:u.Z,color:"text-red-600",bg:"bg-red-50",subtext:"friction increasing"},{name:"Trending Down",value:i,icon:m.Z,color:"text-green-600",bg:"bg-green-50",subtext:"friction decreasing"},{name:"Active Alerts",value:c,icon:p.Z,color:c>0?"text-yellow-600":"text-gray-600",bg:c>0?"bg-yellow-50":"bg-gray-50"},{name:"Abnormal Volume",value:g,icon:y.Z,color:g>0?"text-orange-600":"text-gray-600",bg:g>0?"bg-orange-50":"bg-gray-50",subtext:"unusual case count"}];return(0,a.jsx)("div",{className:"grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6",children:v.map(e=>{let t=e.icon;return(0,a.jsx)("div",{className:"bg-white overflow-hidden rounded-lg border border-gray-200",children:(0,a.jsx)("div",{className:"p-5",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"flex-shrink-0 ".concat(e.bg," rounded-md p-3"),children:(0,a.jsx)(t,{className:"h-6 w-6 ".concat(e.color),"aria-hidden":"true"})}),(0,a.jsx)("div",{className:"ml-5 flex-1",children:(0,a.jsxs)("dl",{children:[(0,a.jsx)("dt",{className:"text-sm font-medium text-gray-500",children:e.name}),(0,a.jsxs)("dd",{className:"flex items-baseline",children:[(0,a.jsx)("div",{className:"text-2xl font-semibold ".concat(e.color),children:e.value}),e.subtext&&(0,a.jsx)("div",{className:"ml-2 text-xs text-gray-500",children:e.subtext})]})]})})]})})},e.name)})})}/**
 * @license lucide-react v0.316.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let f=(0,o.Z)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);var b=r(52235);/**
 * @license lucide-react v0.316.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let j=(0,o.Z)("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]);function w(e){var t,r,s;let{account:n}=e,o=(0,l.useRouter)(),i=n.arr?Math.round(n.arr/12):null,c=(null===(t=n.current_snapshot)||void 0===t?void 0:t.ofi_score)||0;return(0,a.jsxs)("button",{onClick:()=>o.push("/account/".concat(n.id)),className:"w-full text-left p-4 bg-white rounded-lg border border-gray-200 hover:border-blue-500 hover:shadow-md transition-all",children:[(0,a.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h3",{className:"font-semibold text-gray-900 mb-1",children:n.name}),(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[(0,a.jsx)("span",{children:i?"$".concat(i.toLocaleString(),"/mo"):"No MRR"}),n.vertical&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{children:"•"}),(0,a.jsx)("span",{children:n.vertical})]})]})]}),n.current_snapshot&&(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"text-lg font-bold ".concat(c>=70?"text-red-600":c>=40?"text-yellow-600":"text-green-600"),children:Math.round(c)}),n.current_snapshot.trend_direction&&(0,a.jsx)("div",{className:"worsening"===(r=n.current_snapshot.trend_direction)?"text-red-600":"improving"===r?"text-green-600":"text-gray-400",children:"worsening"===(s=n.current_snapshot.trend_direction)?(0,a.jsx)(u.Z,{className:"w-4 h-4"}):"improving"===s?(0,a.jsx)(m.Z,{className:"w-4 h-4"}):null})]})]}),n.alert_count>0&&(0,a.jsxs)("div",{className:"flex items-center gap-1 text-sm text-red-600 mt-2",children:[(0,a.jsx)(p.Z,{className:"w-4 h-4"}),(0,a.jsxs)("span",{children:[n.alert_count," active alert",1!==n.alert_count?"s":""]})]}),n.recent_friction_cards&&n.recent_friction_cards.length>0&&(0,a.jsx)("div",{className:"mt-3 pt-3 border-t border-gray-100",children:(0,a.jsxs)("p",{className:"text-xs text-gray-600 line-clamp-2",children:["Latest: ",n.recent_friction_cards[0].summary]})})]})}function N(e){let{favorites:t,onUpdate:r}=e,[l,o]=(0,s.useState)(""),[i,c]=(0,s.useState)([]),[d,u]=(0,s.useState)([]),[m,x]=(0,s.useState)(!1),g=(0,n.createClientComponentClient)();async function h(){let{data:e}=await g.from("accounts").select("*").order("arr",{ascending:!1}).limit(200);u(e||[])}(0,s.useEffect)(()=>{h()},[]);let p=(0,s.useMemo)(()=>{if(!l)return t;let e=l.toLowerCase();return t.filter(t=>t.account.name.toLowerCase().includes(e))},[t,l]);async function y(e){console.log("Adding favorite:",e);try{let{data:{user:t}}=await g.auth.getUser();if(!t)return;await g.from("favorites").insert({user_id:t.id,account_id:e}),o(""),x(!1),c([]),r()}catch(e){console.error("Error adding favorite:",e)}}async function v(e){try{await g.from("favorites").delete().eq("id",e),r()}catch(e){console.error("Error removing favorite:",e)}}let N=l.length>=2?i:d.filter(e=>!t.some(t=>t.account_id===e.id)).slice(0,50);return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:"Favorites"}),(0,a.jsxs)("button",{onClick:()=>x(!m),className:"flex items-center gap-2 px-3 py-2 text-sm bg-purple-600 text-white rounded-lg hover:bg-purple-700",children:[(0,a.jsx)(f,{className:"w-4 h-4"}),m?"Close":"Add Account"]})]}),m&&(0,a.jsxs)("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(f,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),(0,a.jsx)("input",{type:"text",value:l,onChange:e=>{o(e.target.value),function(e){if(e.length<2){c([]);return}let r=new Set(t.map(e=>e.account_id));c(d.filter(t=>!r.has(t.id)&&t.name.toLowerCase().includes(e.toLowerCase())).slice(0,20))}(e.target.value)},placeholder:"Search accounts by name...",className:"w-full pl-10 pr-10 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"}),l&&(0,a.jsx)("button",{onClick:()=>{o(""),c([])},className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:(0,a.jsx)(b.Z,{className:"w-5 h-5"})})]}),N.length>0&&(0,a.jsxs)("div",{className:"mt-4 space-y-2 max-h-96 overflow-y-auto",children:[(0,a.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:l.length>=2?"Search results:":"All accounts (top 50):"}),N.map(e=>(0,a.jsx)("button",{onClick:()=>y(e.id),className:"w-full text-left p-3 bg-white rounded-lg border border-gray-200 hover:border-purple-500 hover:bg-purple-50 transition-all",children:(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-semibold text-gray-900",children:e.name}),(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:["$",Math.round((e.arr||0)/12).toLocaleString(),"/mo",e.vertical&&" • ".concat(e.vertical)]})]}),(0,a.jsx)(j,{className:"w-5 h-5 text-gray-400"})]})},e.id))]})]}),!m&&t.length>5&&(0,a.jsxs)("div",{className:"relative mb-4",children:[(0,a.jsx)(f,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),(0,a.jsx)("input",{type:"text",value:l,onChange:e=>o(e.target.value),placeholder:"Filter your favorites...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]})]}),0===p.length?(0,a.jsxs)("div",{className:"text-center py-12 bg-white rounded-lg border border-gray-200",children:[(0,a.jsx)(j,{className:"w-12 h-12 text-gray-300 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-600",children:l?"No favorites match your search":'No favorites yet. Click "Add Account" to get started!'})]}):(0,a.jsx)("div",{className:"grid grid-cols-1 gap-4",children:p.map(e=>(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(w,{account:e.account}),(0,a.jsx)("button",{onClick:()=>v(e.id),className:"absolute top-2 right-2 px-3 py-1 bg-white text-red-600 text-sm font-medium rounded-lg border border-gray-200 shadow hover:bg-red-50 transition-colors",title:"Remove from favorites",children:"Remove"})]},e.id))})]})}var _=r(63280);/**
   * react-table
   *
   * Copyright (c) TanStack
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE.md file in the root directory of this source tree.
   *
   * @license MIT
   */function k(e,t){return e?"function"==typeof e&&(()=>{let t=Object.getPrototypeOf(e);return t.prototype&&t.prototype.isReactComponent})()||"function"==typeof e||"object"==typeof e&&"symbol"==typeof e.$$typeof&&["react.memo","react.forward_ref"].includes(e.$$typeof.description)?s.createElement(e,t):e:null}var S=r(44715),C=r(85159),A=r(23441);/**
 * @license lucide-react v0.316.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let Z=(0,o.Z)("ChevronsUpDown",[["path",{d:"m7 15 5 5 5-5",key:"1hf1tw"}],["path",{d:"m7 9 5-5 5 5",key:"sgt6xg"}]]);function M(e){let{allAccounts:t}=e,r=(0,l.useRouter)(),[n,o]=(0,s.useState)([]),[i,c]=(0,s.useState)([{id:"ofi_score",desc:!0}]),[d,g]=(0,s.useState)(""),h=(0,s.useMemo)(()=>t.map(e=>{var t,r,a,s,n,l,o,i,c,d;let u="Other";return(null===(t=e.vertical)||void 0===t?void 0:t.includes("EDGE"))?u="EDGE":(null===(r=e.vertical)||void 0===r?void 0:r.includes("SiteLink"))&&(u="SiteLink"),{id:e.id,name:e.name,arr:e.arr,vertical:e.vertical,segment:e.segment,ofi_score:null!==(o=null===(a=e.current_snapshot)||void 0===a?void 0:a.ofi_score)&&void 0!==o?o:null,case_volume:null!==(i=null===(s=e.current_snapshot)||void 0===s?void 0:s.case_volume)&&void 0!==i?i:null,trend_direction:null!==(c=null===(n=e.current_snapshot)||void 0===n?void 0:n.trend_direction)&&void 0!==c?c:null,last_analyzed:null!==(d=null===(l=e.current_snapshot)||void 0===l?void 0:l.created_at)&&void 0!==d?d:null,product:u}}),[t]),p=function(e){let t={state:{},onStateChange:()=>{},renderFallbackValue:null,...e},[r]=s.useState(()=>({current:(0,_.W_)(t)})),[a,n]=s.useState(()=>r.current.initialState);return r.current.setOptions(t=>({...t,...e,state:{...a,...e.state},onStateChange:t=>{n(t),null==e.onStateChange||e.onStateChange(t)}})),r.current}({data:h,columns:(0,s.useMemo)(()=>[{accessorKey:"name",header:"Account Name",cell:e=>{let{row:t}=e;return(0,a.jsx)("button",{onClick:()=>r.push("/account/".concat(t.original.id)),className:"text-left font-medium text-blue-600 hover:text-blue-800 hover:underline",children:t.original.name})}},{accessorKey:"arr",header:"ARR",cell:e=>{let{row:t}=e;return(0,a.jsx)("span",{children:t.original.arr?"$".concat(t.original.arr.toLocaleString()):"-"})},filterFn:"inNumberRange"},{accessorKey:"product",header:"Product",filterFn:"equalsString"},{accessorKey:"segment",header:"Segment",cell:e=>{var t;let{row:r}=e;return(0,a.jsx)("span",{className:"capitalize",children:(null===(t=r.original.segment)||void 0===t?void 0:t.replace("_"," "))||"-"})},filterFn:"equalsString"},{accessorKey:"ofi_score",header:"OFI Score",cell:e=>{let{row:t}=e,r=t.original.ofi_score;if(null===r)return(0,a.jsx)("span",{className:"text-gray-400",children:"-"});let s=r>=70?"bg-red-100 text-red-800":r>=40?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800";return(0,a.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(s),children:r})},filterFn:"inNumberRange"},{accessorKey:"case_volume",header:"Cases (90d)",cell:e=>{var t;let{row:r}=e;return(0,a.jsx)("span",{children:null!==(t=r.original.case_volume)&&void 0!==t?t:"-"})},filterFn:"inNumberRange"},{accessorKey:"trend_direction",header:"Trend",cell:e=>{let{row:t}=e,r=t.original.trend_direction;return"worsening"===r?(0,a.jsx)(u.Z,{className:"w-4 h-4 text-red-500"}):"improving"===r?(0,a.jsx)(m.Z,{className:"w-4 h-4 text-green-500"}):(0,a.jsx)(x.Z,{className:"w-4 h-4 text-gray-400"})},filterFn:"equalsString"},{accessorKey:"last_analyzed",header:"Last Analyzed",cell:e=>{let{row:t}=e;return(0,a.jsx)("span",{className:"text-sm text-gray-600",children:t.original.last_analyzed?new Date(t.original.last_analyzed).toLocaleDateString():"Never"})}}],[r]),state:{columnFilters:n,sorting:i,globalFilter:d},onColumnFiltersChange:o,onSortingChange:c,onGlobalFilterChange:g,getCoreRowModel:(0,_.sC)(),getFilteredRowModel:(0,_.vL)(),getSortedRowModel:(0,_.tj)(),getPaginationRowModel:(0,_.G_)(),initialState:{pagination:{pageSize:25}}}),y=(0,s.useMemo)(()=>Array.from(new Set(h.map(e=>e.product))).sort(),[h]),v=(0,s.useMemo)(()=>Array.from(new Set(h.map(e=>e.segment).filter(Boolean))).sort(),[h]),f=(0,s.useMemo)(()=>Array.from(new Set(h.map(e=>e.trend_direction).filter(Boolean))).sort(),[h]);return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsx)("input",{type:"text",value:null!=d?d:"",onChange:e=>g(e.target.value),placeholder:"Search accounts...",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})}),(0,a.jsxs)("button",{onClick:()=>{let e=[["Account Name","ARR","Product","Segment","OFI Score","Cases (90d)","Trend","Last Analyzed"],...p.getFilteredRowModel().rows.map(e=>e.original).map(e=>[e.name,e.arr||"",e.product,e.segment||"",e.ofi_score||"",e.case_volume||"",e.trend_direction||"",e.last_analyzed?new Date(e.last_analyzed).toLocaleDateString():""])].map(e=>e.map(e=>'"'.concat(e,'"')).join(",")).join("\n"),t=new Blob([e],{type:"text/csv"}),r=URL.createObjectURL(t),a=document.createElement("a");a.href=r,a.download="friction-report-".concat(new Date().toISOString().split("T")[0],".csv"),a.click(),URL.revokeObjectURL(r)},className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[(0,a.jsx)(S.Z,{className:"w-4 h-4"}),"Export CSV"]})]}),(0,a.jsxs)("div",{className:"mt-4 space-y-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-xs font-medium text-gray-700 uppercase tracking-wide mb-1 block",children:"Product"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:y.map(e=>{let t=n.some(t=>"product"===t.id&&t.value===e);return(0,a.jsx)("button",{onClick:()=>{t?o(e=>e.filter(e=>"product"!==e.id)):o(t=>[...t.filter(e=>"product"!==e.id),{id:"product",value:e}])},className:"px-3 py-1 text-sm rounded-full border transition-colors ".concat(t?"bg-blue-100 border-blue-300 text-blue-700":"bg-gray-50 border-gray-200 text-gray-600 hover:bg-gray-100"),children:e},e)})})]}),v.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-xs font-medium text-gray-700 uppercase tracking-wide mb-1 block",children:"Segment"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:v.map(e=>{let t=n.some(t=>"segment"===t.id&&t.value===e);return(0,a.jsx)("button",{onClick:()=>{t?o(e=>e.filter(e=>"segment"!==e.id)):o(t=>[...t.filter(e=>"segment"!==e.id),{id:"segment",value:e}])},className:"px-3 py-1 text-sm rounded-full border transition-colors capitalize ".concat(t?"bg-purple-100 border-purple-300 text-purple-700":"bg-gray-50 border-gray-200 text-gray-600 hover:bg-gray-100"),children:null==e?void 0:e.replace("_"," ")},e)})})]}),f.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-xs font-medium text-gray-700 uppercase tracking-wide mb-1 block",children:"Trend"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:f.map(e=>{let t=n.some(t=>"trend_direction"===t.id&&t.value===e);return(0,a.jsx)("button",{onClick:()=>{t?o(e=>e.filter(e=>"trend_direction"!==e.id)):o(t=>[...t.filter(e=>"trend_direction"!==e.id),{id:"trend_direction",value:e}])},className:"px-3 py-1 text-sm rounded-full border transition-colors capitalize ".concat(t?"bg-green-100 border-green-300 text-green-700":"bg-gray-50 border-gray-200 text-gray-600 hover:bg-gray-100"),children:e},e)})})]}),(n.length>0||d)&&(0,a.jsxs)("button",{onClick:()=>{o([]),g("")},className:"flex items-center gap-1 text-sm text-gray-600 hover:text-gray-900",children:[(0,a.jsx)(b.Z,{className:"w-4 h-4"}),"Clear all filters"]})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Report Summary"}),(0,a.jsxs)("div",{className:"grid grid-cols-4 gap-4",children:[(0,a.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Accounts"}),(0,a.jsx)("p",{className:"text-3xl font-bold text-gray-900",children:p.getFilteredRowModel().rows.length})]}),(0,a.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Avg OFI Score"}),(0,a.jsx)("p",{className:"text-3xl font-bold text-gray-900",children:(()=>{let e=p.getFilteredRowModel().rows.filter(e=>null!==e.original.ofi_score);return 0===e.length?"-":Math.round(e.reduce((e,t)=>e+(t.original.ofi_score||0),0)/e.length)})()})]}),(0,a.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"High Friction"}),(0,a.jsx)("p",{className:"text-3xl font-bold text-red-600",children:p.getFilteredRowModel().rows.filter(e=>(e.original.ofi_score||0)>=70).length})]}),(0,a.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Worsening"}),(0,a.jsx)("p",{className:"text-3xl font-bold text-orange-600",children:p.getFilteredRowModel().rows.filter(e=>"worsening"===e.original.trend_direction).length})]})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:[(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:p.getHeaderGroups().map(e=>(0,a.jsx)("tr",{children:e.headers.map(e=>(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100",onClick:e.column.getToggleSortingHandler(),children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[k(e.column.columnDef.header,e.getContext()),"asc"===e.column.getIsSorted()&&(0,a.jsx)(C.Z,{className:"w-4 h-4"}),"desc"===e.column.getIsSorted()&&(0,a.jsx)(A.Z,{className:"w-4 h-4"}),!e.column.getIsSorted()&&(0,a.jsx)(Z,{className:"w-4 h-4 text-gray-400"})]})},e.id))},e.id))}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:p.getRowModel().rows.map(e=>(0,a.jsx)("tr",{className:"hover:bg-gray-50",children:e.getVisibleCells().map(e=>(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:k(e.column.columnDef.cell,e.getContext())},e.id))},e.id))})]})}),(0,a.jsxs)("div",{className:"bg-gray-50 px-6 py-3 flex items-center justify-between border-t border-gray-200",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("button",{onClick:()=>p.setPageIndex(0),disabled:!p.getCanPreviousPage(),className:"px-3 py-1 text-sm border border-gray-300 rounded bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"First"}),(0,a.jsx)("button",{onClick:()=>p.previousPage(),disabled:!p.getCanPreviousPage(),className:"px-3 py-1 text-sm border border-gray-300 rounded bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),(0,a.jsx)("button",{onClick:()=>p.nextPage(),disabled:!p.getCanNextPage(),className:"px-3 py-1 text-sm border border-gray-300 rounded bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"}),(0,a.jsx)("button",{onClick:()=>p.setPageIndex(p.getPageCount()-1),disabled:!p.getCanNextPage(),className:"px-3 py-1 text-sm border border-gray-300 rounded bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Last"})]}),(0,a.jsxs)("div",{className:"text-sm text-gray-700",children:["Page ",p.getState().pagination.pageIndex+1," of ",p.getPageCount()," ","(",p.getFilteredRowModel().rows.length," total accounts)"]})]})]})]})}/**
 * @license lucide-react v0.316.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let L=(0,o.Z)("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);function R(e){if(!e)return"Other";let t=e.toUpperCase();return t.includes("EDGE")?"EDGE":t.includes("SITELINK")?"SiteLink":"Other"}function E(e){let{accounts:t}=e,[r,n]=(0,s.useState)("All"),[o,i]=(0,s.useState)(null),c=(0,l.useRouter)(),d=function(e,t){let r="All"===t?e:e.filter(e=>R(e.vertical)===t),a=new Map;for(let e of r){var s;let t=null===(s=e.current_snapshot)||void 0===s?void 0:s.top_themes;if(t&&0!==t.length)for(let r of t){let t=a.get(r.theme_key);t||(t={theme_key:r.theme_key,total_count:0,total_severity:0,accounts:new Map,severity_counts:{low:0,medium:0,high:0}},a.set(r.theme_key,t)),t.total_count+=r.count,t.total_severity+=r.avg_severity*r.count,r.avg_severity<3?t.severity_counts.low+=r.count:r.avg_severity<4?t.severity_counts.medium+=r.count:t.severity_counts.high+=r.count;let s=t.accounts.get(e.id);s||(s={id:e.id,name:e.name,count:0,total_severity:0},t.accounts.set(e.id,s)),s.count+=r.count,s.total_severity+=r.avg_severity*r.count}}let n=[];for(let e of Array.from(a.values())){let t=Array.from(e.accounts.values()).map(e=>({id:e.id,name:e.name,count:e.count,avg_severity:e.total_severity/e.count}));t.sort((e,t)=>{let r=e.count*e.avg_severity;return t.count*t.avg_severity-r}),n.push({theme_key:e.theme_key,theme_label:e.theme_key.split("_").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" "),total_count:e.total_count,avg_severity:e.total_severity/e.total_count,affected_accounts:t,severity_distribution:e.severity_counts})}return n.sort((e,t)=>{let r=e.total_count*e.avg_severity;return t.total_count*t.avg_severity-r}),n}(t,r),u=d.reduce((e,t)=>e+t.total_count,0),m=("All"===r?t:t.filter(e=>R(e.vertical)===r)).filter(e=>{var t;return(null===(t=e.current_snapshot)||void 0===t?void 0:t.top_themes)&&e.current_snapshot.top_themes.length>0}).length;function x(e){return e>=4?"bg-red-100 text-red-800":e>=3?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"}return(0,a.jsx)("div",{className:"space-y-6",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Key Friction Themes"}),(0,a.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:[u," total issues across ",m," accounts"]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("label",{htmlFor:"product-filter",className:"text-sm font-medium text-gray-700",children:"Filter by Product:"}),(0,a.jsxs)("select",{id:"product-filter",value:r,onChange:e=>n(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm",children:[(0,a.jsx)("option",{value:"All",children:"All Products"}),(0,a.jsx)("option",{value:"EDGE",children:"EDGE"}),(0,a.jsx)("option",{value:"SiteLink",children:"SiteLink"}),(0,a.jsx)("option",{value:"Other",children:"Other"})]})]})]}),0===d.length&&(0,a.jsx)("div",{className:"text-center py-12",children:(0,a.jsxs)("p",{className:"text-gray-500",children:["No friction data found for ","All"===r?"any accounts":"".concat(r," customers"),"."]})}),d.length>0&&(0,a.jsx)("div",{className:"space-y-3",children:d.map((e,t)=>(0,a.jsxs)("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[(0,a.jsxs)("button",{onClick:()=>{var t;i(o===(t=e.theme_key)?null:t)},className:"w-full px-4 py-3 flex items-center justify-between hover:bg-gray-50 transition-colors",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[o===e.theme_key?(0,a.jsx)(A.Z,{className:"w-5 h-5 text-gray-400"}):(0,a.jsx)(L,{className:"w-5 h-5 text-gray-400"}),(0,a.jsxs)("span",{className:"text-sm font-medium text-gray-500",children:[t+1,"."]}),(0,a.jsx)("span",{className:"text-base font-semibold text-gray-900",children:e.theme_label})]}),(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsxs)("span",{className:"text-sm text-gray-600",children:[e.total_count," ",1===e.total_count?"issue":"issues"]}),(0,a.jsxs)("span",{className:"px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(x(e.avg_severity)),children:["Avg Severity: ",e.avg_severity.toFixed(1)]}),(0,a.jsxs)("span",{className:"text-sm text-gray-600",children:[e.affected_accounts.length," ",1===e.affected_accounts.length?"account":"accounts"]})]})]}),o===e.theme_key&&(0,a.jsxs)("div",{className:"px-4 py-4 bg-gray-50 border-t border-gray-200",children:[(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Severity Distribution"}),(0,a.jsxs)("div",{className:"flex items-center gap-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-xs font-medium text-red-800",children:"High (4-5):"}),(0,a.jsx)("span",{className:"text-sm text-gray-900",children:e.severity_distribution.high})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-xs font-medium text-yellow-800",children:"Medium (3):"}),(0,a.jsx)("span",{className:"text-sm text-gray-900",children:e.severity_distribution.medium})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-xs font-medium text-green-800",children:"Low (1-2):"}),(0,a.jsx)("span",{className:"text-sm text-gray-900",children:e.severity_distribution.low})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Affected Accounts"}),(0,a.jsx)("div",{className:"space-y-2",children:e.affected_accounts.map(t=>(0,a.jsx)("button",{onClick:()=>c.push("/account/".concat(t.id,"?theme=").concat(e.theme_key)),className:"w-full text-left px-3 py-2 bg-white rounded border border-gray-200 hover:border-blue-500 hover:bg-blue-50 transition-colors",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-gray-900",children:t.name}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsxs)("span",{className:"text-xs text-gray-600",children:[t.count," ",1===t.count?"issue":"issues"]}),(0,a.jsx)("span",{className:"px-2 py-0.5 rounded-full text-xs font-medium ".concat(x(t.avg_severity)),children:t.avg_severity.toFixed(1)}),(0,a.jsx)("span",{className:"text-xs text-blue-600 font-medium",children:"View →"})]})]})},t.id))})]})]})]},e.theme_key))})]})})}function D(){let[e,t]=(0,s.useState)([]),[r,o]=(0,s.useState)([]),[h,p]=(0,s.useState)(!0),[y,f]=(0,s.useState)(!1),[b,j]=(0,s.useState)(""),[w,_]=(0,s.useState)(0),[k,S]=(0,s.useState)(0),[C,A]=(0,s.useState)(0),[Z,L]=(0,s.useState)("portfolios"),[R,D]=(0,s.useState)([]),[F,z]=(0,s.useState)([]),[T,O]=(0,s.useState)(!1),[P,q]=(0,s.useState)("arr"),[I,U]=(0,s.useState)("desc"),[G,V]=(0,s.useState)("all"),K=(0,n.createClientComponentClient)(),$=(0,l.useRouter)();async function H(){try{let{data:{user:e}}=await K.auth.getUser();if(!e){$.push("/");return}let{data:r}=await K.from("portfolios").select("*").eq("user_id",e.id).order("created_at",{ascending:!1}),a=null==r?void 0:r.find(e=>"top_25_edge"===e.portfolio_type),s=null==r?void 0:r.find(e=>"top_25_sitelink"===e.portfolio_type),n=[...(null==a?void 0:a.account_ids)||[],...(null==s?void 0:s.account_ids)||[]],l=Array.from(new Set(n));if(l.length>0){let{data:e}=await K.from("accounts").select("\n            *,\n            current_snapshot:account_snapshots!account_snapshots_account_id_fkey(\n              ofi_score,\n              trend_direction,\n              top_themes,\n              case_volume,\n              created_at\n            )\n          ").in("id",l).eq("status","active").order("arr",{ascending:!1});if(e){let r=e.map(e=>({...e,current_snapshot:Array.isArray(e.current_snapshot)?e.current_snapshot.sort((e,t)=>new Date(t.created_at).getTime()-new Date(e.created_at).getTime())[0]:e.current_snapshot})).filter(e=>"Test"!==e.name);t(r),S(r.length);let a=new Date().toISOString().split("T")[0],{data:s}=await K.from("account_snapshots").select("account_id").in("account_id",l).eq("snapshot_date",a),n=new Set((null==s?void 0:s.map(e=>e.account_id))||[]),o=r.filter(e=>n.has(e.id)).map(e=>e.name),i=r.filter(e=>!n.has(e.id)).map(e=>e.name);_((null==s?void 0:s.length)||0),D(o),z(i);let{data:c}=await K.from("account_snapshots").select("case_volume").in("account_id",l).gte("snapshot_date",new Date(Date.now()-7776e6).toISOString());if(c&&c.length>0){let e=c.reduce((e,t)=>e+(t.case_volume||0),0)/c.length;A(e)}}}await B()}catch(e){console.error("Error loading dashboard:",e)}finally{p(!1)}}async function B(){let{data:{user:e}}=await K.auth.getUser();if(!e)return;let{data:t}=await K.from("favorites").select("\n        *,\n        account:accounts(*)\n      ").eq("user_id",e.id).order("created_at",{ascending:!1});o(t||[])}async function W(){f(!0),j("Step 1/2: Syncing account data from Salesforce...");try{let e=await fetch("/api/salesforce/sync",{method:"POST"});if(!e.ok)throw Error("Sync failed");await e.json(),j("Step 2/2: Analyzing up to 3 accounts (100 cases from last 90 days)...");let t=new Date().toISOString().split("T")[0],{data:r}=await K.from("account_snapshots").select("id").eq("snapshot_date",t),a=(null==r?void 0:r.length)||0,s=0,n=0,l=0,o=async()=>{var e,t,r;let i=new Date(Date.now()-6e5).toISOString(),{data:c}=await K.from("raw_inputs").select("id").gte("created_at",i),{data:d}=await K.from("friction_cards").select("id").gte("created_at",i),u=new Date().toISOString().split("T")[0],{data:m}=await K.from("account_snapshots").select("id").eq("snapshot_date",u),x=(null==c?void 0:c.length)||0,g=(null==d?void 0:d.length)||0,h=(null==m?void 0:m.length)||0;if(s>=150){j("Refreshing dashboard..."),await H();let e=h-a,t=k-h,r=e>0?"✓ ".concat(e," account").concat(e>1?"s":""," analyzed!"):"✓ Sync complete!";j(t>0?"".concat(r," ").concat(t," accounts still need analysis."):"✓ All ".concat(k," accounts are up to date!")),f(!1),setTimeout(()=>j(""),1e4);return}if(x>0){let{data:r}=await K.from("raw_inputs").select("account_id, accounts(name)").gte("created_at",i).limit(1),s=(null==r?void 0:null===(t=r[0])||void 0===t?void 0:null===(e=t.accounts)||void 0===e?void 0:e.name)||"account";if(j("Analyzing ".concat(s,": ").concat(g,"/").concat(x," cases analyzed (").concat(x>0?Math.round(g/x*100):0,"%) • ").concat(h," accounts complete")),g===n?l++:l=0,n=g,l>=3||h>0&&g>20){j("Refreshing dashboard..."),await H();let e=h-a,t=k-h;if(t>0){let r=e>0?"✓ ".concat(e," account").concat(e>1?"s":""," analyzed!"):"✓ Sync complete!";j("".concat(r," ").concat(t," accounts still need analysis."))}else j("✓ All ".concat(k," accounts are up to date!"));f(!1),setTimeout(()=>j(""),1e4);return}}else if(s>5){j("Refreshing dashboard...");let{data:{user:e}}=await K.auth.getUser();if(!e)return;let{data:t}=await K.from("portfolios").select("account_ids").eq("user_id",e.id).in("portfolio_type",["top_25_edge","top_25_sitelink"]);if(t&&t.length>0){let e=t.flatMap(e=>e.account_ids||[]),s=Array.from(new Set(e)),n=new Date().toISOString().split("T")[0],{data:l}=await K.from("account_snapshots").select("account_id").in("account_id",s).eq("snapshot_date",n),o=(null==l?void 0:l.length)||0;if(await H(),o-a>0){let{data:e}=await K.from("account_snapshots").select("account_id, accounts(name)").eq("snapshot_date",n).in("account_id",s).order("created_at",{ascending:!1}).limit(1).single(),t=(null==e?void 0:null===(r=e.accounts)||void 0===r?void 0:r.name)||"Account";j("✓ ".concat(t," analyzed (0 cases found). ").concat(k-o," accounts still need analysis."))}else j("✓ No new cases to sync. Already up to date!")}f(!1),setTimeout(()=>j(""),1e4);return}s++,setTimeout(o,2e3)};setTimeout(o,2e3)}catch(e){console.error("Sync error:",e),alert("Failed to sync with Salesforce. Please try again."),f(!1),j("")}}function X(e){P===e?U("asc"===I?"desc":"asc"):(q(e),U("desc"))}function J(e){return P!==e?(0,a.jsx)(i,{className:"w-4 h-4 ml-1 inline"}):"asc"===I?(0,a.jsx)(c,{className:"w-4 h-4 ml-1 inline"}):(0,a.jsx)(d,{className:"w-4 h-4 ml-1 inline"})}(0,s.useEffect)(()=>{H()},[]);let Q=e=>"worsening"===e?(0,a.jsx)(u.Z,{className:"w-4 h-4 text-red-500"}):"improving"===e?(0,a.jsx)(m.Z,{className:"w-4 h-4 text-green-500"}):(0,a.jsx)(x.Z,{className:"w-4 h-4 text-gray-400"}),Y=e=>{let t=e.vertical||"",r=t.includes("EDGE")||t.includes("Storable Edge"),a=t.includes("SiteLink");return r&&a||r?"EDGE":a?"SiteLink":"N/A"},ee=e=>"all"===G?e:e.filter(e=>{let t=Y(e);return"edge"===G?"EDGE"===t:"sitelink"===G&&"SiteLink"===t});return h?(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),(0,a.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading your portfolio..."})]})}):(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsx)("header",{className:"bg-white border-b border-gray-200",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Friction Intelligence"}),(0,a.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"Early warning system for customer friction"})]}),(0,a.jsxs)("button",{onClick:()=>$.push("/settings"),className:"flex items-center gap-2 px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50",children:[(0,a.jsx)(g,{className:"w-4 h-4"}),"Settings"]})]})})}),(0,a.jsxs)("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,a.jsxs)("div",{className:"mb-6 flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:()=>L("portfolios"),className:"px-4 py-2 rounded-lg font-medium ".concat("portfolios"===Z?"bg-blue-600 text-white":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"),children:"Portfolios"}),(0,a.jsxs)("button",{onClick:()=>L("favorites"),className:"px-4 py-2 rounded-lg font-medium ".concat("favorites"===Z?"bg-blue-600 text-white":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"),children:["Favorites (",r.length,")"]}),(0,a.jsx)("button",{onClick:()=>L("reports"),className:"px-4 py-2 rounded-lg font-medium ".concat("reports"===Z?"bg-blue-600 text-white":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"),children:"Custom Reports"}),(0,a.jsx)("button",{onClick:()=>L("themes"),className:"px-4 py-2 rounded-lg font-medium ".concat("themes"===Z?"bg-blue-600 text-white":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"),children:"Key Friction Themes"})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)("button",{onClick:W,disabled:y,onMouseEnter:()=>O(!0),onMouseLeave:()=>O(!1),className:"px-4 py-2 rounded-lg font-medium flex items-center gap-2 ".concat(y?"bg-gray-400 text-white cursor-not-allowed":w<k?"bg-blue-600 text-white hover:bg-blue-700":"bg-green-600 text-white hover:bg-green-700"),children:[y&&(0,a.jsxs)("svg",{className:"animate-spin h-4 w-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),y?"Syncing Portfolio...":w<k?"Sync & Analyze All":"All Up to Date ✓"]}),!y&&w<k&&(0,a.jsx)("span",{className:"absolute -top-2 -right-2 bg-red-500 text-white text-xs font-bold px-2 py-1 rounded-full",children:k-w}),T&&(R.length>0||F.length>0)&&(0,a.jsxs)("div",{className:"absolute top-full right-0 mt-2 w-80 bg-white border border-gray-200 rounded-lg shadow-lg p-4 z-50",children:[(0,a.jsxs)("div",{className:"space-y-3",children:[R.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"flex items-center gap-2 mb-2",children:(0,a.jsxs)("span",{className:"text-xs font-semibold text-green-700 uppercase tracking-wide",children:["✓ Analyzed Today (",R.length,")"]})}),(0,a.jsx)("div",{className:"max-h-32 overflow-y-auto space-y-1",children:R.map(e=>(0,a.jsxs)("div",{className:"text-xs text-gray-700 pl-3",children:["• ",e]},e))})]}),F.length>0&&(0,a.jsxs)("div",{className:"pt-3 border-t border-gray-200",children:[(0,a.jsx)("div",{className:"flex items-center gap-2 mb-2",children:(0,a.jsxs)("span",{className:"text-xs font-semibold text-orange-700 uppercase tracking-wide",children:["⏳ Needs Analysis (",F.length,")"]})}),(0,a.jsx)("div",{className:"max-h-32 overflow-y-auto space-y-1",children:F.map(e=>(0,a.jsxs)("div",{className:"text-xs text-gray-700 pl-3",children:["• ",e]},e))})]})]}),(0,a.jsx)("div",{className:"mt-3 pt-3 border-t border-gray-200 text-xs text-gray-500",children:'Click "Sync & Analyze All" to process all pending accounts. Runs automatically every night at 2am UTC.'})]})]})]}),b&&(0,a.jsx)("div",{className:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:(0,a.jsx)("p",{className:"text-sm text-blue-700",children:b})}),"portfolios"===Z&&(0,a.jsxs)(a.Fragment,{children:[0===e.length&&(0,a.jsx)("div",{className:"text-center py-12 bg-white rounded-lg border border-gray-200",children:(0,a.jsx)("p",{className:"text-gray-500",children:"No accounts found. Click Sync Now to load accounts from Salesforce."})}),e.length>0&&(0,a.jsx)(v,{top25:ee(e),singleOperator:[]}),(0,a.jsxs)("section",{className:"mt-12",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"Software Accounts (EDGE & SiteLink)"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("label",{htmlFor:"software-filter",className:"text-sm font-medium text-gray-700",children:"Filter by:"}),(0,a.jsxs)("select",{id:"software-filter",value:G,onChange:e=>V(e.target.value),className:"block w-40 px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500",children:[(0,a.jsx)("option",{value:"all",children:"All Software"}),(0,a.jsx)("option",{value:"edge",children:"EDGE Only"}),(0,a.jsx)("option",{value:"sitelink",children:"SiteLink Only"})]}),(0,a.jsxs)("span",{className:"text-sm text-gray-600",children:["Showing ",ee(e).length," of ",e.length," accounts"]})]})]}),(0,a.jsx)("div",{className:"bg-white rounded-lg border border-gray-200 overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsxs)("th",{onClick:()=>X("name"),className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100",children:["Account ",J("name")]}),(0,a.jsxs)("th",{onClick:()=>X("arr"),className:"px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100",children:["ARR ",J("arr")]}),(0,a.jsx)("th",{className:"px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Software"}),(0,a.jsxs)("th",{onClick:()=>X("ofi"),className:"px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100",children:["OFI Score ",J("ofi")]}),(0,a.jsxs)("th",{onClick:()=>X("case_volume"),className:"px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100",children:["Cases (90d) ",J("case_volume")]}),(0,a.jsx)("th",{className:"px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Trend"}),(0,a.jsx)("th",{className:"px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Last Analyzed"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:ee(e).sort((e,t)=>{var r,a,s,n;let l,o;switch(P){case"name":l=e.name.toLowerCase(),o=t.name.toLowerCase();break;case"arr":l=e.arr||0,o=t.arr||0;break;case"ofi":l=(null===(r=e.current_snapshot)||void 0===r?void 0:r.ofi_score)||0,o=(null===(a=t.current_snapshot)||void 0===a?void 0:a.ofi_score)||0;break;case"case_volume":l=(null===(s=e.current_snapshot)||void 0===s?void 0:s.case_volume)||0,o=(null===(n=t.current_snapshot)||void 0===n?void 0:n.case_volume)||0;break;default:return 0}return l<o?"asc"===I?-1:1:l>o?"asc"===I?1:-1:0}).map(e=>{var t,r,s,n;return(0,a.jsxs)("tr",{onClick:()=>$.push("/account/".concat(e.id)),className:"hover:bg-gray-50 cursor-pointer",children:[(0,a.jsxs)("td",{className:"px-4 py-3 whitespace-nowrap",children:[(0,a.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.name}),(0,a.jsx)("div",{className:"text-xs text-gray-500",children:e.segment})]}),(0,a.jsxs)("td",{className:"px-3 py-3 whitespace-nowrap text-sm text-gray-900",children:["$",Math.round(e.arr||0).toLocaleString()]}),(0,a.jsx)("td",{className:"px-3 py-3 text-sm text-gray-900",children:Y(e)}),(0,a.jsx)("td",{className:"px-3 py-3 whitespace-nowrap",children:(null===(t=e.current_snapshot)||void 0===t?void 0:t.ofi_score)?(0,a.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(e.current_snapshot.ofi_score>=70?"bg-red-100 text-red-800":e.current_snapshot.ofi_score>=40?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"),children:e.current_snapshot.ofi_score}):(0,a.jsx)("span",{className:"text-xs text-gray-400",children:"-"})}),(0,a.jsx)("td",{className:"px-3 py-3 whitespace-nowrap text-sm",children:(null===(r=e.current_snapshot)||void 0===r?void 0:r.case_volume)!==void 0?(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)("span",{className:"text-gray-900 font-medium",children:e.current_snapshot.case_volume}),C>0&&(0,a.jsx)("span",{className:"text-xs ".concat(e.current_snapshot.case_volume>1.5*C?"text-red-600 font-medium":e.current_snapshot.case_volume<.5*C?"text-yellow-600":"text-gray-500"),children:e.current_snapshot.case_volume>1.5*C?"⚠️":e.current_snapshot.case_volume<.5*C?"⬇️":""})]}):(0,a.jsx)("span",{className:"text-gray-400",children:"-"})}),(0,a.jsx)("td",{className:"px-3 py-3 whitespace-nowrap",children:Q(null===(s=e.current_snapshot)||void 0===s?void 0:s.trend_direction)}),(0,a.jsx)("td",{className:"px-3 py-3 whitespace-nowrap text-sm text-gray-500",children:(null===(n=e.current_snapshot)||void 0===n?void 0:n.created_at)?new Date(e.current_snapshot.created_at).toLocaleDateString():"Never"})]},e.id)})})]})})]})]}),"favorites"===Z&&(0,a.jsx)(N,{favorites:r,onUpdate:B}),"reports"===Z&&(0,a.jsx)(M,{allAccounts:e}),"themes"===Z&&(0,a.jsx)(E,{accounts:e})]})]})}},87461:function(e,t,r){"use strict";r.d(t,{Z:function(){return l}});var a=r(64090),s={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.316.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),l=(e,t)=>{let r=(0,a.forwardRef)((r,l)=>{let{color:o="currentColor",size:i=24,strokeWidth:c=2,absoluteStrokeWidth:d,className:u="",children:m,...x}=r;return(0,a.createElement)("svg",{ref:l,...s,width:i,height:i,stroke:o,strokeWidth:d?24*Number(c)/Number(i):c,className:["lucide","lucide-".concat(n(e)),u].join(" "),...x},[...t.map(e=>{let[t,r]=e;return(0,a.createElement)(t,r)}),...Array.isArray(m)?m:[m]])});return r.displayName="".concat(e),r}},98998:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});/**
 * @license lucide-react v0.316.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,r(87461).Z)("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},22071:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});/**
 * @license lucide-react v0.316.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,r(87461).Z)("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]])},23441:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});/**
 * @license lucide-react v0.316.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,r(87461).Z)("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]])},85159:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});/**
 * @license lucide-react v0.316.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,r(87461).Z)("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]])},44715:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});/**
 * @license lucide-react v0.316.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,r(87461).Z)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]])},27271:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});/**
 * @license lucide-react v0.316.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,r(87461).Z)("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]])},10775:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});/**
 * @license lucide-react v0.316.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,r(87461).Z)("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]])},29733:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});/**
 * @license lucide-react v0.316.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,r(87461).Z)("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]])},52235:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});/**
 * @license lucide-react v0.316.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,r(87461).Z)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])}},function(e){e.O(0,[180,785,971,69,744],function(){return e(e.s=30646)}),_N_E=e.O()}]);