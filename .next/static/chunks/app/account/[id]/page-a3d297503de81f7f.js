(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[114],{97802:function(e,s,t){Promise.resolve().then(t.bind(t,53393))},53393:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return Y}});var a=t(3827),r=t(64090),l=t(47907),i=t(58714),n=t(81708),c=t(98998),o=t(32805),d=t(44715),x=t(28814),m=t(29733),h=t(10775),u=t(27271),g=t(52235),p=t(26587),b=t(71362),y=t(38333),f=t(23356),j=t(22983),v=t(10166),N=t(98061),w=t(69475),_=t(18994),k=t(40834),S=t(61524),C=t(92493);function F(e){var s,t,l;let{account:c,frictionCards:o,snapshot:x}=e,[m,h]=(0,r.useState)(!1),[u,p]=(0,r.useState)(!1),[b,y]=(0,r.useState)(null),[f,j]=(0,r.useState)(null),[v,N]=(0,r.useState)([]),F=(0,i.createClientComponentClient)();async function D(e){p(!0),j(e),y(null),N([]);try{let s=o.map(e=>e.raw_input_id).filter(Boolean),{data:t}=await F.from("raw_inputs").select("*").in("id",s),a=[];o.forEach(e=>{let s=null==t?void 0:t.find(s=>s.id===e.raw_input_id);if(null==s?void 0:s.source_id){var r;a.push({id:e.id,summary:e.summary,severity:e.severity,theme:e.theme_key,case_id:s.source_id,case_date:(null===(r=s.metadata)||void 0===r?void 0:r.created_date)||s.created_at})}}),a.sort((e,s)=>s.severity!==e.severity?s.severity-e.severity:new Date(s.case_date).getTime()-new Date(e.case_date).getTime());let r=[],l=new Set;for(let e of a){if(r.length>=6)break;e.severity>=4&&!l.has(e.theme)&&(r.push(e),l.add(e.theme))}for(let e of a){if(r.length>=6)break;r.includes(e)||r.push(e)}N(r);let i=await fetch("/api/briefing/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({account_id:c.id,briefing_type:e})});if(!i.ok)throw Error("Failed to generate briefing");let n=await i.json();y(n.briefing)}catch(e){console.error("Error generating briefing:",e),alert("Failed to generate briefing. Please try again.")}finally{p(!1)}}return m?(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center p-6 border-b",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"Visit Briefing"}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:c.name})]}),(0,a.jsx)("button",{onClick:()=>h(!1),className:"text-gray-400 hover:text-gray-600",children:(0,a.jsx)(g.Z,{className:"w-6 h-6"})})]}),(0,a.jsx)("div",{className:"p-6 overflow-y-auto flex-1",children:b||u?u?(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center py-12",children:[(0,a.jsx)(_.Z,{className:"w-12 h-12 animate-spin text-purple-600 mb-4"}),(0,a.jsx)("p",{className:"text-lg font-medium text-gray-900",children:"Generating briefing..."})]}):b?(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between pb-4 border-b",children:[(0,a.jsx)("span",{className:"px-3 py-1 bg-purple-100 text-purple-700 text-sm font-medium rounded-full",children:"quick"===f?"Quick Briefing":"Deep Dive"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)("button",{onClick:function(){y(null),j(null),N([])},className:"flex items-center gap-2 px-3 py-2 text-sm bg-gray-100 rounded-lg hover:bg-gray-200",children:[(0,a.jsx)(k.Z,{className:"w-4 h-4"}),"New"]}),(0,a.jsxs)("button",{onClick:function(){if(!b)return;let e=new C.ZP,s=e.internal.pageSize.getWidth()-28,t=20;e.setFontSize(18),e.setFont("helvetica","bold"),e.text("Visit Briefing",14,t),t+=10,e.setFontSize(14),e.text(b.account_name,14,t),t+=8,e.setFontSize(10),e.setFont("helvetica","normal"),e.text("Generated: "+new Date().toLocaleDateString(),14,t),t+=5,e.text("ARR: "+b.arr,14,t),t+=5,e.text(b.vertical+" | "+b.segment,14,t),t+=10,e.setFontSize(12),e.setFont("helvetica","bold");let a=b.ofi_score,r=b.trend&&"stable"!==b.trend.toLowerCase()?" ("+b.trend+")":"";a>=70?e.setTextColor(220,38,38):a>=40?e.setTextColor(234,179,8):e.setTextColor(22,163,74),e.text("OFI Score: "+a+" - "+(a>=70?"CRITICAL":a>=40?"MODERATE":"HEALTHY")+r,14,t),e.setTextColor(0,0,0),t+=12,b.attention_items&&b.attention_items.length>0&&(e.setFontSize(12),e.setFont("helvetica","bold"),e.text("Items Requiring Attention",14,t),t+=8,e.setFontSize(9),e.setFont("helvetica","normal"),b.attention_items.forEach((a,r)=>{t>260&&(e.addPage(),t=20),e.setFont("helvetica","bold"),e.text(r+1+". "+a.title,16,t),t+=5,e.setFont("helvetica","normal"),e.splitTextToSize(a.details,s-4).forEach(s=>{t>270&&(e.addPage(),t=20),e.text(s,18,t),t+=4}),t+=3}),t+=5),b.talking_points&&b.talking_points.length>0&&(t>240&&(e.addPage(),t=20),e.setFontSize(12),e.setFont("helvetica","bold"),e.text("Key Talking Points",14,t),t+=8,e.setFontSize(9),e.setFont("helvetica","normal"),b.talking_points.forEach(a=>{t>270&&(e.addPage(),t=20),e.splitTextToSize("• "+a,s-2).forEach(s=>{e.text(s,16,t),t+=4}),t+=2}),t+=5),b.wins&&b.wins.length>0&&(t>240&&(e.addPage(),t=20),e.setFontSize(12),e.setFont("helvetica","bold"),e.text("Recent Wins",14,t),t+=8,e.setFontSize(9),e.setFont("helvetica","normal"),b.wins.forEach(a=>{t>270&&(e.addPage(),t=20),e.splitTextToSize("• "+a,s-2).forEach(s=>{e.text(s,16,t),t+=4}),t+=2}),t+=5),v.length>0&&(t>220&&(e.addPage(),t=20),e.setFontSize(12),e.setFont("helvetica","bold"),e.text("Top Support Cases (Highest Severity)",14,t),t+=5,e.setFontSize(9),e.setFont("helvetica","normal"),e.setTextColor(100,100,100),e.text("Showing ".concat(v.length," of ").concat(o.length," cases"),14,t),e.setTextColor(0,0,0),t+=6,e.setFontSize(8),e.setFont("helvetica","normal"),v.forEach(a=>{t>265&&(e.addPage(),t=20);let r=new Date(a.case_date).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"});e.splitTextToSize(a.summary,s-4).forEach(s=>{t>270&&(e.addPage(),t=20),e.text(s,16,t),t+=3.5}),e.text("Date: "+r+" | Severity: "+a.severity+"/5 | "+a.theme.replace(/_/g," "),16,t),t+=3,e.setTextColor(0,0,255),e.text("Salesforce Case ID: "+a.case_id,16,t),e.setTextColor(0,0,0),t+=5})),e.save(c.name.replace(/\s+/g,"_")+"_Briefing.pdf")},className:"flex items-center gap-2 px-3 py-2 text-sm bg-purple-600 text-white rounded-lg hover:bg-purple-700",children:[(0,a.jsx)(d.Z,{className:"w-4 h-4"}),"PDF"]})]})]}),(0,a.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:["ARR: ",b.arr]}),(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:[b.vertical," | ",b.segment]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"OFI Score"}),(0,a.jsx)("p",{className:"text-3xl font-bold ".concat(b.ofi_score>=70?"text-red-600":b.ofi_score>=40?"text-yellow-600":"text-green-600"),children:b.ofi_score}),(0,a.jsxs)("p",{className:"text-sm font-medium ".concat(b.ofi_score>=70?"text-red-700":b.ofi_score>=40?"text-yellow-700":"text-green-700"),children:[b.ofi_score>=70?"CRITICAL":b.ofi_score>=40?"MODERATE":"HEALTHY",b.trend&&"stable"!==b.trend.toLowerCase()?" - ".concat(b.trend):""]})]})]})}),(null===(s=b.attention_items)||void 0===s?void 0:s.length)>0&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("h3",{className:"flex items-center gap-2 text-lg font-semibold mb-3",children:[(0,a.jsx)(S.Z,{className:"w-5 h-5 text-red-600"}),"Items Requiring Attention"]}),(0,a.jsx)("div",{className:"space-y-3",children:b.attention_items.map((e,s)=>(0,a.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[(0,a.jsx)("p",{className:"font-semibold text-red-900",children:e.title}),(0,a.jsx)("p",{className:"text-sm text-red-700 mt-1",children:e.details}),(0,a.jsx)("span",{className:"inline-block mt-2 px-2 py-1 bg-red-200 text-red-800 text-xs rounded",children:e.severity})]},s))})]}),(null===(t=b.talking_points)||void 0===t?void 0:t.length)>0&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-3",children:"\uD83D\uDCAC Key Talking Points"}),(0,a.jsx)("ul",{className:"space-y-2",children:b.talking_points.map((e,s)=>(0,a.jsxs)("li",{className:"flex gap-2",children:[(0,a.jsx)("span",{className:"text-purple-600",children:"•"}),(0,a.jsx)("span",{className:"text-gray-700",children:e})]},s))})]}),(null===(l=b.wins)||void 0===l?void 0:l.length)>0&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-3",children:"\uD83C\uDFAF Recent Wins"}),(0,a.jsx)("ul",{className:"space-y-2",children:b.wins.map((e,s)=>(0,a.jsxs)("li",{className:"flex gap-2",children:[(0,a.jsx)("span",{className:"text-green-600",children:"•"}),(0,a.jsx)("span",{className:"text-gray-700",children:e})]},s))})]}),v.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:"\uD83D\uDD0D Top Support Cases"}),(0,a.jsxs)("span",{className:"text-xs text-gray-500",children:["Showing ",v.length," of ",o.length," cases (highest severity)"]})]}),(0,a.jsx)("div",{className:"space-y-2",children:v.map(e=>(0,a.jsx)("div",{className:"p-3 bg-gray-50 border border-gray-200 rounded-lg hover:bg-gray-100 transition-colors",children:(0,a.jsxs)("div",{className:"flex justify-between items-start gap-3",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-900",children:e.summary}),(0,a.jsxs)("div",{className:"flex items-center gap-4 mt-1 text-xs text-gray-600",children:[(0,a.jsxs)("span",{className:"flex items-center gap-1",children:["\uD83D\uDCC5 ",new Date(e.case_date).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})]}),(0,a.jsxs)("span",{children:["Severity: ",e.severity,"/5"]}),(0,a.jsx)("span",{className:"px-2 py-0.5 bg-gray-200 rounded text-gray-700",children:e.theme.replace(/_/g," ")})]})]}),(0,a.jsxs)("a",{href:"https://storable.my.salesforce.com/"+e.case_id,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-1 text-xs text-blue-600 hover:underline whitespace-nowrap px-3 py-1 bg-blue-50 rounded hover:bg-blue-100",children:["View Case ",(0,a.jsx)(n.Z,{className:"w-3 h-3"})]})]})},e.id))})]})]}):null:(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("p",{className:"text-gray-600",children:"Generate a briefing to prepare for your customer visit:"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsx)("button",{onClick:()=>D("quick"),className:"group p-6 border-2 border-gray-200 rounded-lg hover:border-purple-500 hover:bg-purple-50 transition-all text-left",children:(0,a.jsxs)("div",{className:"flex items-start gap-4",children:[(0,a.jsx)("div",{className:"p-3 bg-purple-100 rounded-lg group-hover:bg-purple-200",children:(0,a.jsx)(w.Z,{className:"w-6 h-6 text-purple-600"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-semibold text-lg mb-2",children:"Quick Briefing"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Essential talking points and top friction issues"}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-2",children:"~30 seconds"})]})]})}),(0,a.jsx)("button",{onClick:()=>D("deep"),className:"group p-6 border-2 border-gray-200 rounded-lg hover:border-purple-500 hover:bg-purple-50 transition-all text-left",children:(0,a.jsxs)("div",{className:"flex items-start gap-4",children:[(0,a.jsx)("div",{className:"p-3 bg-purple-100 rounded-lg group-hover:bg-purple-200",children:(0,a.jsx)(w.Z,{className:"w-6 h-6 text-purple-600"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-semibold text-lg mb-2",children:"Deep Dive"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Comprehensive analysis with history and recommendations"}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-2",children:"~60 seconds"})]})]})})]}),x&&(0,a.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-blue-900",children:"Current OFI Score"}),(0,a.jsx)("p",{className:"text-3xl font-bold text-blue-600 mt-1",children:x.ofi_score})]}),(0,a.jsx)("div",{className:"text-right text-sm text-blue-700",children:(0,a.jsxs)("p",{children:[o.length," friction points"]})})]})})]})})]})}):(0,a.jsxs)("button",{onClick:()=>h(!0),className:"flex items-center gap-2 px-4 py-2.5 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition-colors shadow-sm",children:[(0,a.jsx)(w.Z,{className:"w-4 h-4"}),"Visit Briefing"]})}var D=t(46578);function A(e){let{currentVolume:s,accountHistoricalAvg:t,portfolioAvg:l,last7Days:i,accountName:n,facilityCount:c}=e,[o,d]=(0,r.useState)(!1),x=t/13,m=x>0?(i-x)/x*100:0,u=m>50,g=m<-50;return(0,a.jsxs)("div",{className:"rounded-lg border p-6 ".concat(u?"bg-red-50 border-red-200":g?"bg-yellow-50 border-yellow-200":"bg-green-50 border-green-200"," relative"),children:[(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[(0,a.jsxs)("div",{className:"relative",onMouseEnter:()=>d(!0),onMouseLeave:()=>d(!1),children:[u?(0,a.jsx)(S.Z,{className:"w-5 h-5 text-red-600"}):g?(0,a.jsx)(h.Z,{className:"w-5 h-5 text-yellow-600"}):(0,a.jsx)(D.Z,{className:"w-5 h-5 text-green-600"}),o&&(0,a.jsxs)("div",{className:"absolute left-0 top-full mt-2 w-64 bg-gray-900 text-white text-xs rounded-lg shadow-xl p-3 z-50 whitespace-normal",children:[u?"Warning: Case volume is 50%+ above this account's typical weekly baseline":g?"Notice: Case volume is 50%+ below this account's typical weekly baseline":"Case volume is within normal range for this account",(0,a.jsx)("div",{className:"absolute -top-1 left-3 w-2 h-2 bg-gray-900 transform rotate-45"})]})]}),"Support Volume Analysis"]}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:u?"Unusually High Volume":g?"Unusually Low Volume":"Normal Volume"})]}),(0,a.jsx)("p",{className:"text-sm text-gray-700 mb-4",children:(()=>{let e=s>1.5*l?"much higher than peers":s<.5*l?"much lower than peers":"similar to peers",t=0===m?"stable at their usual level":m>0?"trending up ".concat(Math.abs(m).toFixed(0),"% above their baseline"):"trending down ".concat(Math.abs(m).toFixed(0),"% below their baseline");return"Support volume is ".concat(e," and ").concat(t,".")})()}),(0,a.jsxs)("div",{className:"mb-3",children:[(0,a.jsx)("h4",{className:"text-xs font-semibold text-gray-700 uppercase tracking-wider mb-2",children:"Account Metrics"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:[(0,a.jsx)("div",{className:"text-xs text-gray-600 uppercase tracking-wide mb-1",children:"Weekly Baseline"}),(0,a.jsxs)("div",{className:"flex items-baseline gap-2",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-gray-900",children:x.toFixed(1)}),(0,a.jsx)("div",{className:"text-xs text-gray-500",children:"cases/week"})]}),(0,a.jsxs)("div",{className:"text-xs text-gray-500 mt-1",children:[s," total in last 90 days"]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:[(0,a.jsx)("div",{className:"text-xs text-gray-600 uppercase tracking-wide mb-1",children:"Last 7 Days"}),(0,a.jsxs)("div",{className:"flex items-baseline gap-2",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-gray-900",children:i}),(0,a.jsx)("div",{className:"text-xs text-gray-500",children:"cases"})]}),(0,a.jsxs)("div",{className:"text-xs text-gray-500 mt-0.5",children:[(i/7).toFixed(1)," avg cases/day"]}),(0,a.jsx)("div",{className:"text-xs font-medium mt-1 ".concat(m>20?"text-red-600":m<-20?"text-yellow-600":"text-gray-600"),children:10>Math.abs(m)?"Normal week":m>0?"".concat(m.toFixed(0),"% above baseline"):"".concat(Math.abs(m).toFixed(0),"% below baseline")})]})]})]}),c&&c>0&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-xs font-semibold text-gray-700 uppercase tracking-wider mb-2",children:"Per Facility Metrics"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:[(0,a.jsx)("div",{className:"text-xs text-gray-600 uppercase tracking-wide mb-1",children:"90-Day Average"}),(0,a.jsxs)("div",{className:"flex items-baseline gap-2",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-gray-900",children:(s/c).toFixed(1)}),(0,a.jsx)("div",{className:"text-xs text-gray-500",children:"cases/loc"})]}),(0,a.jsx)("div",{className:"text-xs text-gray-500 mt-0.5",children:"per facility (90 days)"}),(0,a.jsxs)("div",{className:"text-xs text-gray-600 mt-1",children:[c," location",1===c?"":"s"," total"]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:[(0,a.jsx)("div",{className:"text-xs text-gray-600 uppercase tracking-wide mb-1",children:"Last 7 Days"}),(0,a.jsxs)("div",{className:"flex items-baseline gap-2",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-gray-900",children:(i/c).toFixed(1)}),(0,a.jsx)("div",{className:"text-xs text-gray-500",children:"cases/loc"})]}),(0,a.jsx)("div",{className:"text-xs text-gray-500 mt-0.5",children:"per facility (last week)"}),(0,a.jsxs)("div",{className:"text-xs text-gray-600 mt-1",children:[i," total cases / ",c," locations"]})]})]})]}),(0,a.jsxs)("div",{className:"mt-4 pt-3 border-t border-gray-200",children:[(0,a.jsxs)("p",{className:"text-xs text-gray-600 font-medium mb-1",children:["✓ Confirmed: All cases belong to ",n]}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"Weekly Baseline = This account's average cases per week over 90 days • Last 7 Days = Cases synced in the most recent week"})]})]})}var E=t(85904),I=t(90684),T=t(37451),P=t(30438),Z=t(85159),O=t(23441);function z(e){let{origins:s,accountName:t,totalCases:l}=e,[i,o]=(0,r.useState)(new Set),[d,x]=(0,r.useState)(null);if(0===s.length)return null;let m=e=>{let s=new Set(i);s.has(e)?s.delete(e):s.add(e),o(s)},h=e=>{let s=e.toLowerCase();return s.includes("phone")?(0,a.jsx)(E.Z,{className:"w-4 h-4"}):s.includes("email")||s.includes("mail")?(0,a.jsx)(I.Z,{className:"w-4 h-4"}):s.includes("web")||s.includes("portal")?(0,a.jsx)(T.Z,{className:"w-4 h-4"}):s.includes("chat")?(0,a.jsx)(P.Z,{className:"w-4 h-4"}):(0,a.jsx)(c.Z,{className:"w-4 h-4"})},u=e=>e>40?"bg-red-50 border-red-200 text-red-900":e>25?"bg-orange-50 border-orange-200 text-orange-900":"bg-blue-50 border-blue-200 text-blue-900",g=s.filter(e=>parseFloat(e.percentage)>40),p=g.length>0;return(0,a.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-6 mb-6",children:[(0,a.jsx)("div",{className:"flex items-start justify-between mb-4",children:(0,a.jsxs)("div",{children:[(0,a.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[(0,a.jsxs)("div",{className:"relative",onMouseEnter:()=>x("main"),onMouseLeave:()=>x(null),children:[(0,a.jsx)(c.Z,{className:"w-5 h-5 text-blue-600"}),"main"===d&&(0,a.jsxs)("div",{className:"absolute left-0 top-full mt-2 w-64 bg-gray-900 text-white text-xs rounded-lg shadow-xl p-3 z-50 whitespace-normal",children:["Shows which channels customers are using to contact support (phone, email, web, chat, etc.)",(0,a.jsx)("div",{className:"absolute -top-1 left-3 w-2 h-2 bg-gray-900 transform rotate-45"})]})]}),"Case Origins (Last 7 Days)"]}),(0,a.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:[l," total cases from ",s.length," channel",1!==s.length?"s":""]})]})}),p&&(0,a.jsx)("div",{className:"mb-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:(0,a.jsxs)("p",{className:"text-sm text-yellow-800 font-medium flex items-center gap-2",children:[(0,a.jsxs)("div",{className:"relative",onMouseEnter:()=>x("alert"),onMouseLeave:()=>x(null),children:[(0,a.jsx)(c.Z,{className:"w-4 h-4"}),"alert"===d&&(0,a.jsxs)("div",{className:"absolute left-0 top-full mt-2 w-64 bg-gray-900 text-white text-xs rounded-lg shadow-xl p-3 z-50 whitespace-normal",children:["Warning: Over 40% of cases coming from one channel may indicate a specific problem with that support workflow or customer preference.",(0,a.jsx)("div",{className:"absolute -top-1 left-3 w-2 h-2 bg-gray-900 transform rotate-45"})]})]}),"Alert: ",g[0].percentage,"% of cases coming from ",g[0].origin," channel"]})}),(0,a.jsx)("div",{className:"space-y-3",children:s.map(e=>{let s=parseFloat(e.percentage),t=u(s);return(0,a.jsxs)("div",{className:"rounded-lg border p-4 ".concat(t),children:[(0,a.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("div",{className:"relative",onMouseEnter:()=>x(e.origin),onMouseLeave:()=>x(null),children:[h(e.origin),d===e.origin&&(0,a.jsxs)("div",{className:"absolute left-0 top-full mt-2 w-56 bg-gray-900 text-white text-xs rounded-lg shadow-xl p-3 z-50 whitespace-normal",children:[e.percentage,"% of recent cases came from this channel. High concentration in one channel may indicate specific workflow issues.",(0,a.jsx)("div",{className:"absolute -top-1 left-3 w-2 h-2 bg-gray-900 transform rotate-45"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-semibold",children:e.origin}),(0,a.jsxs)("p",{className:"text-sm opacity-80",children:[e.count," cases (",e.percentage,"%)",e.priority>0&&(0,a.jsxs)("span",{className:"ml-2 font-medium",children:["• ",e.priority," high priority"]})]})]})]}),(0,a.jsx)("div",{className:"text-right",children:(0,a.jsx)("div",{className:"text-2xl font-bold",children:e.count})})]}),(0,a.jsx)("div",{className:"w-full bg-white/50 rounded-full h-2 mb-3",children:(0,a.jsx)("div",{className:"bg-current rounded-full h-2 transition-all",style:{width:"".concat(Math.min(100,s),"%")}})}),e.cases.length>0&&(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("p",{className:"text-xs font-medium opacity-70 uppercase tracking-wide",children:"Recent Cases:"}),(i.has(e.origin)?e.cases:e.cases.slice(0,3)).map(e=>{var s,t,r,l;return(0,a.jsxs)("div",{className:"flex items-center justify-between text-xs bg-white/50 rounded px-2 py-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[(0,a.jsxs)("span",{className:"font-mono whitespace-nowrap",children:["Case #",(null===(s=e.metadata)||void 0===s?void 0:s.case_number)||"Unknown",(null===(t=e.metadata)||void 0===t?void 0:t.priority)&&(0,a.jsx)("span",{className:"ml-2 font-medium",children:e.metadata.priority})]}),(null===(r=e.metadata)||void 0===r?void 0:r.subject)&&(0,a.jsxs)("span",{className:"text-gray-600 truncate",children:["• ",e.metadata.subject]}),(null===(l=e.metadata)||void 0===l?void 0:l.created_date)&&(0,a.jsxs)("span",{className:"text-gray-500 whitespace-nowrap",children:["• ",new Date(e.metadata.created_date).toLocaleDateString("en-US",{month:"short",day:"numeric"})]})]}),e.source_url&&(0,a.jsxs)("a",{href:e.source_url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-1 hover:underline ml-2 whitespace-nowrap",children:["View",(0,a.jsx)(n.Z,{className:"w-3 h-3"})]})]},e.id)}),e.count>3&&(0,a.jsx)("button",{onClick:()=>m(e.origin),className:"text-xs opacity-70 hover:opacity-100 italic flex items-center gap-1 hover:underline",children:i.has(e.origin)?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(Z.Z,{className:"w-3 h-3"}),"Show less"]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(O.Z,{className:"w-3 h-3"}),"+ ",e.count-3," more cases"]})})]})]},e.origin)})}),(0,a.jsx)("div",{className:"mt-4 text-xs text-gray-500",children:"Data shows case distribution by origin channel. High concentration in one channel may indicate specific issues."})]})}var L=t(22071);function R(e){var s;let{currentAccount:t,peers:r}=e,l=r.filter(e=>e.product===t.product);console.log("PeerCaseComparison debug:",{currentAccountProduct:t.product,totalPeers:r.length,matchingPeers:l.length,peerProducts:r.map(e=>({name:e.name,product:e.product})).slice(0,5)});let i=[...l].sort((e,s)=>s.caseVolume-e.caseVolume),n=i.findIndex(e=>e.name===t.name)+1,c=l.length>0?l.reduce((e,s)=>e+s.caseVolume,0)/l.length:0,o=(null===(s=i[Math.floor(i.length/2)])||void 0===s?void 0:s.caseVolume)||0,d=i.filter(e=>e.name!==t.name&&Math.abs(e.caseVolume-t.caseVolume)/t.caseVolume*100<=20),x=c>0?(t.caseVolume-c)/c*100:0;return(0,a.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-6 mb-6",children:[(0,a.jsx)("div",{className:"flex items-start justify-between mb-4",children:(0,a.jsxs)("div",{children:[(0,a.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[(0,a.jsx)(L.Z,{className:"w-5 h-5 text-purple-600"}),"Peer Comparison"]}),(0,a.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:["Case volume vs Top 25 ",t.product," accounts (last 90 days)"]})]})}),(0,a.jsx)("div",{className:"mb-4 p-4 bg-gradient-to-r from-purple-50 to-blue-50 rounded-lg border border-purple-200",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600 font-medium",children:"Portfolio Ranking"}),(0,a.jsxs)("p",{className:"text-3xl font-bold text-gray-900",children:["#",n]}),(0,a.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["out of ",l.length," ",t.product," accounts"]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsxs)("p",{className:"text-sm text-gray-600 mb-1",children:["vs ",t.product," Avg"]}),(0,a.jsxs)("div",{className:"flex items-center gap-1 ".concat(x>0?"text-red-600":x<0?"text-green-600":"text-gray-600"),children:[x>0?(0,a.jsx)(m.Z,{className:"w-4 h-4"}):x<0?(0,a.jsx)(h.Z,{className:"w-4 h-4"}):null,(0,a.jsxs)("span",{className:"text-lg font-bold",children:[x>0?"+":"",x.toFixed(0),"%"]})]})]})]})}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[(0,a.jsxs)("div",{className:"text-center p-3 bg-blue-50 rounded-lg border border-blue-200",children:[(0,a.jsxs)("p",{className:"text-xs text-blue-700 font-medium uppercase tracking-wide",children:[t.product," Avg"]}),(0,a.jsx)("p",{className:"text-2xl font-bold text-blue-900 mt-1",children:c.toFixed(0)}),(0,a.jsx)("p",{className:"text-xs text-blue-600",children:"cases/90d"})]}),(0,a.jsxs)("div",{className:"text-center p-3 bg-gray-50 rounded-lg",children:[(0,a.jsx)("p",{className:"text-xs text-gray-600 font-medium uppercase tracking-wide",children:"Median"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-gray-900 mt-1",children:o}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"middle value"})]})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("p",{className:"text-xs text-gray-600 font-medium mb-2",children:"CASE VOLUME DISTRIBUTION"}),(0,a.jsx)("div",{className:"relative h-24 bg-gray-100 rounded-lg p-2",children:i.slice(0,10).map((e,s)=>{let r=i[0].caseVolume,l=e.caseVolume/r*100,n=e.name===t.name;return(0,a.jsx)("div",{className:"inline-block mx-0.5",style:{width:"calc(10% - 4px)"},children:(0,a.jsxs)("div",{className:"h-full flex flex-col justify-end items-center",children:[(0,a.jsx)("div",{className:"w-full rounded-t transition-all ".concat(n?"bg-purple-600":"bg-gray-400 hover:bg-gray-500"),style:{height:"".concat(l,"%")},title:"".concat(e.name,": ").concat(e.caseVolume," cases")}),n&&(0,a.jsx)("span",{className:"text-xs font-bold text-purple-600 mt-1",children:"You"})]})},e.name)})}),(0,a.jsxs)("div",{className:"flex justify-between text-xs text-gray-500 mt-1",children:[(0,a.jsx)("span",{children:"Highest"}),(0,a.jsx)("span",{children:"Top 10 Accounts"}),(0,a.jsx)("span",{children:"10th"})]})]}),d.length>0&&(0,a.jsxs)("div",{className:"pt-4 border-t border-gray-200",children:[(0,a.jsxs)("p",{className:"text-xs text-gray-600 font-medium mb-2",children:["SIMILAR ",t.product.toUpperCase()," ACCOUNTS (within 20% of your volume)"]}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-2",children:[d.slice(0,5).map(e=>(0,a.jsxs)("div",{className:"px-3 py-1 bg-purple-50 border border-purple-200 rounded-full text-sm",children:[(0,a.jsx)("span",{className:"font-medium text-purple-900",children:e.name}),(0,a.jsxs)("span",{className:"text-purple-600 ml-1",children:["(",e.caseVolume,")"]})]},e.name)),d.length>5&&(0,a.jsxs)("span",{className:"text-sm text-gray-500",children:["+",d.length-5," more"]})]})]})]})}function M(e){let{frictionCards:s,themes:t}=e,[l,i]=(0,r.useState)(null),[c,o]=(0,r.useState)(null),[d,x]=(0,r.useState)(null);console.log("FrictionClusters component rendering:",{frictionCardsCount:s.length,themesCount:t.length,frictionCards:s.slice(0,2)});let m=s.reduce((e,s)=>(e[s.theme_key]||(e[s.theme_key]=[]),e[s.theme_key].push(s),e),{}),h=e=>{let s={};return e.forEach(e=>{let t=e.summary.toLowerCase(),a="other_issues",r="Other Issues",l=0;[{key:"phone_calls",terms:["call","phone","dialer","calling"],label:"Phone/Call Issues"},{key:"login_auth",terms:["login","authentication","password","access denied"],label:"Login & Authentication"},{key:"system_stuck",terms:["stuck","frozen","freeze","not responding"],label:"System Freezing/Stuck"},{key:"connectivity",terms:["connection","connectivity","network","disconnect"],label:"Connectivity Issues"},{key:"microphone",terms:["microphone","mic","audio","headset"],label:"Audio/Microphone Problems"},{key:"location_access",terms:["location","locations","district","site access"],label:"Location Access Issues"},{key:"integration",terms:["integration","api","sync","observe.ai"],label:"Integration Problems"},{key:"billing",terms:["billing","invoice","charge","payment"],label:"Billing Issues"},{key:"email_delivery",terms:["email","notification","alert"],label:"Email/Notification Issues"},{key:"data_issues",terms:["data","report","duplicate","missing"],label:"Data Quality Issues"},{key:"system_errors",terms:["error","failed","failure","crash"],label:"System Errors"},{key:"ui_problems",terms:["button","screen","interface","display"],label:"UI/Interface Problems"}].forEach(e=>{let s=e.terms.filter(e=>t.includes(e)).length;s>l&&(l=s,a=e.key,r=e.label)});let i="".concat(a,"|||").concat(r);s[i]||(s[i]=[]),s[i].push(e)}),Object.entries(s).map(e=>{let[s,t]=e,[a,r]=s.split("|||"),l=t.reduce((e,s)=>e+s.severity,0)/t.length,i={critical:t.filter(e=>5===e.severity).length,high:t.filter(e=>4===e.severity).length,medium:t.filter(e=>3===e.severity).length,low:t.filter(e=>2===e.severity).length,minor:t.filter(e=>1===e.severity).length};return{pattern:r,cards:t.sort((e,s)=>s.severity-e.severity),avgSeverity:l,severityDistribution:i}}).sort((e,s)=>{let t=e.cards.length*e.avgSeverity;return s.cards.length*s.avgSeverity-t})},u=e=>{let s=t.find(s=>s.theme_key===e);return(null==s?void 0:s.label)||e.replace(/_/g," ")},g=e=>e>=5?"text-red-700 bg-red-100":e>=4?"text-red-600 bg-red-50":e>=3?"text-yellow-600 bg-yellow-50":e>=2?"text-blue-600 bg-blue-50":"text-gray-600 bg-gray-50",p=e=>e>=5?"bg-red-600 text-white":e>=4?"bg-red-500 text-white":e>=3?"bg-yellow-500 text-white":e>=2?"bg-blue-500 text-white":"bg-gray-400 text-white",b=e=>e>=.8?"High confidence":e>=.6?"Medium confidence":"Low confidence",y=Object.entries(m).map(e=>{let[s,t]=e,a=t.reduce((e,s)=>e+s.severity,0)/t.length,r=t.length*a;return{themeKey:s,cards:t,avgSeverity:a,impact:r}}).sort((e,s)=>s.impact-e.impact);return(0,a.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("h2",{className:"text-lg font-semibold text-gray-900",children:["Friction Signals (",s.length," in last 30 days)"]}),(0,a.jsx)("div",{className:"text-xs text-gray-500",children:"Grouped by patterns for easier analysis"})]}),0===y.length?(0,a.jsx)("div",{className:"text-center py-12 text-gray-500",children:"No friction signals detected in the last 30 days"}):(0,a.jsx)("div",{className:"space-y-4",children:y.map(e=>{let{themeKey:s,cards:t,avgSeverity:r,impact:m}=e,y=h(t),f=l===s;return(0,a.jsxs)("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[(0,a.jsxs)("button",{onClick:()=>i(f?null:s),className:"w-full bg-gray-50 px-4 py-3 flex justify-between items-center hover:bg-gray-100 transition-colors",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[f?(0,a.jsx)(Z.Z,{className:"w-5 h-5 text-gray-600"}):(0,a.jsx)(O.Z,{className:"w-5 h-5 text-gray-600"}),(0,a.jsx)("h3",{className:"font-semibold text-gray-900",children:u(s)})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[(0,a.jsxs)("span",{className:"font-medium",children:[t.length," issues"]}),(0,a.jsx)("span",{children:"•"}),(0,a.jsxs)("span",{children:["Avg severity: ",r.toFixed(1)]})]})]}),(0,a.jsx)("div",{className:"flex items-center gap-2",children:t.some(e=>e.severity>=4)&&(0,a.jsxs)("span",{className:"px-2 py-1 bg-red-100 text-red-700 text-xs font-medium rounded",children:[t.filter(e=>e.severity>=4).length," high severity"]})})]}),f&&(0,a.jsx)("div",{className:"divide-y divide-gray-200",children:y.map((e,t)=>{let r="".concat(s,"-").concat(t),l=c===r;return(0,a.jsxs)("div",{className:"bg-white",children:[(0,a.jsxs)("button",{onClick:()=>o(l?null:r),className:"w-full px-4 py-3 flex justify-between items-center hover:bg-gray-50 transition-colors",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[l?(0,a.jsx)(Z.Z,{className:"w-4 h-4 text-gray-500"}):(0,a.jsx)(O.Z,{className:"w-4 h-4 text-gray-500"}),(0,a.jsxs)("div",{className:"relative",onMouseEnter:()=>x(r),onMouseLeave:()=>x(null),children:[(0,a.jsx)(S.Z,{className:"w-4 h-4 text-orange-500"}),d===r&&(0,a.jsxs)("div",{className:"absolute left-0 top-full mt-2 w-64 bg-gray-900 text-white text-xs rounded-lg shadow-xl p-3 z-50 whitespace-normal",children:["Friction cluster: Related issues grouped by pattern. Click to expand and see individual cases.",(0,a.jsx)("div",{className:"absolute -top-1 left-3 w-2 h-2 bg-gray-900 transform rotate-45"})]})]})]}),(0,a.jsxs)("div",{className:"text-left",children:[(0,a.jsx)("p",{className:"font-medium text-gray-900",children:e.pattern}),(0,a.jsxs)("p",{className:"text-xs text-gray-600",children:[e.cards.length," cases • Avg severity: ",e.avgSeverity.toFixed(1)]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[e.severityDistribution.critical>0&&(0,a.jsxs)("span",{className:"px-2 py-1 bg-red-600 text-white text-xs font-bold rounded",children:[e.severityDistribution.critical," Critical"]}),e.severityDistribution.high>0&&(0,a.jsxs)("span",{className:"px-2 py-1 bg-red-500 text-white text-xs font-bold rounded",children:[e.severityDistribution.high," High"]}),e.severityDistribution.medium>0&&(0,a.jsxs)("span",{className:"px-2 py-1 bg-yellow-500 text-white text-xs font-bold rounded",children:[e.severityDistribution.medium," Med"]})]})]}),l&&(0,a.jsx)("div",{className:"px-4 pb-3 space-y-2",children:e.cards.map((e,s)=>{var t,r,l;return(0,a.jsxs)("div",{className:"p-3 rounded-lg border ".concat(g(e.severity)),children:[(0,a.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,a.jsxs)("span",{className:"px-2 py-0.5 rounded text-xs font-bold ".concat(p(e.severity)),children:["Severity ",e.severity]}),e.sentiment&&(0,a.jsx)("span",{className:"text-xs text-gray-600 capitalize",children:e.sentiment}),(null===(r=e.raw_input)||void 0===r?void 0:null===(t=r.metadata)||void 0===t?void 0:t.created_date)&&(0,a.jsx)("span",{className:"text-xs text-gray-500",children:new Date(e.raw_input.metadata.created_date).toLocaleDateString("en-US",{month:"short",day:"numeric"})})]}),(0,a.jsx)("p",{className:"text-sm text-gray-900",children:e.summary}),e.root_cause_hypothesis&&(0,a.jsxs)("p",{className:"text-xs text-gray-600 mt-2 italic",children:["→ ",e.root_cause_hypothesis]})]}),(null===(l=e.raw_input)||void 0===l?void 0:l.source_url)&&(0,a.jsxs)("a",{href:e.raw_input.source_url,target:"_blank",rel:"noopener noreferrer",className:"ml-3 flex items-center gap-1 text-xs text-blue-600 hover:text-blue-800",onClick:e=>e.stopPropagation(),children:["View",(0,a.jsx)(n.Z,{className:"w-3 h-3"})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 mt-2 pt-2 border-t border-current border-opacity-20",children:[(0,a.jsx)("span",{className:"text-xs text-gray-600",children:b(e.confidence_score)}),(0,a.jsx)("div",{className:"flex-1 h-1.5 bg-gray-200 rounded-full overflow-hidden",children:(0,a.jsx)("div",{className:"h-full bg-current rounded-full",style:{width:"".concat(100*e.confidence_score,"%")}})}),(0,a.jsxs)("span",{className:"text-xs font-medium text-gray-700",children:[(100*e.confidence_score).toFixed(0),"%"]})]})]},e.id)})})]},r)})})]},s)})})]})}var U=t(23416);function V(e){let{isOpen:s,onClose:t,accountName:l,accountId:i,synced:n,analyzed:c,processed:o,ofiScore:d,highSeverity:x,remaining:m}=e,[h,u]=(0,r.useState)(!1);if(!s)return null;let p=o||c,b=p+(m||0),y=b>0?Math.round(p/b*100):0,f="✅ Analysis Complete!\n\nAccount: ".concat(l,"\nAccount ID: ").concat(i,"\n\n").concat(n>0?"New cases synced: ".concat(n,"\n"):"","Processed: ").concat(p," cases → ").concat(c," friction points\nProgress: ").concat(p," of ").concat(b," cases (").concat(y,"%)\nOFI Score: ").concat(d,"\nHigh Severity: ").concat(x).concat(m?"\n\n⚠️ ".concat(m," cases remaining - click Analyze again to continue"):""),j=async()=>{await navigator.clipboard.writeText(f),u(!0),setTimeout(()=>u(!1),2e3)};return(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[(0,a.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[(0,a.jsx)(D.Z,{className:"w-5 h-5 text-green-600"}),"Analysis Complete"]}),(0,a.jsx)("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 transition-colors",children:(0,a.jsx)(g.Z,{className:"w-5 h-5"})})]}),(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsx)("div",{className:"mb-4 pb-4 border-b border-gray-200 select-text",children:(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsx)("div",{className:"font-semibold text-gray-900 mb-1",children:l}),(0,a.jsx)("div",{className:"text-xs text-gray-500 font-mono",children:i})]})}),(0,a.jsx)("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200 select-text",children:(0,a.jsxs)("div",{className:"space-y-2 text-sm font-mono",children:[n>0&&(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"New cases synced:"}),(0,a.jsx)("span",{className:"font-semibold text-gray-900",children:n})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Processed this batch:"}),(0,a.jsxs)("span",{className:"font-semibold text-gray-900",children:[p," cases"]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Friction points found:"}),(0,a.jsx)("span",{className:"font-semibold text-gray-900",children:c})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Progress:"}),(0,a.jsxs)("span",{className:"font-semibold text-gray-900",children:[p," of ",b," cases (",y,"%)"]})]}),(0,a.jsx)("div",{className:"pt-2 mt-2 border-t border-gray-200"}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"OFI Score:"}),(0,a.jsx)("span",{className:"font-semibold text-gray-900",children:d})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"High Severity:"}),(0,a.jsx)("span",{className:"font-semibold text-gray-900",children:x})]})]})}),b>0&&(0,a.jsxs)("div",{className:"mt-4",children:[(0,a.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2.5",children:(0,a.jsx)("div",{className:"bg-blue-600 h-2.5 rounded-full transition-all duration-300",style:{width:"".concat(y,"%")}})}),(0,a.jsxs)("p",{className:"text-xs text-gray-500 mt-1 text-center",children:[y,"% complete"]})]}),m&&m>0&&(0,a.jsx)("div",{className:"mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:(0,a.jsxs)("p",{className:"text-sm text-yellow-800 font-medium",children:["⚠️ ",m," cases remaining - click Analyze again to continue"]})})]}),(0,a.jsxs)("div",{className:"flex items-center justify-end gap-3 p-4 border-t border-gray-200 bg-gray-50",children:[(0,a.jsxs)("button",{onClick:j,className:"flex items-center gap-2 px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:[(0,a.jsx)(U.Z,{className:"w-4 h-4"}),h?"Copied!":"Copy Results"]}),(0,a.jsx)("button",{onClick:t,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition-colors",children:"Close & Reload"})]})]})})}var H=t(57976),B=t(51318),J=t(26490);let q={billing_confusion:"Billing & Pricing",integration_failures:"Integrations",ui_confusion:"UI/UX Issues",performance_issues:"Performance",missing_features:"Missing Features",training_gaps:"Training & Documentation",support_response_time:"Support Response",data_quality:"Data Quality",reporting_issues:"Reporting",access_permissions:"Access & Permissions",configuration_problems:"Configuration",notification_issues:"Notifications",workflow_inefficiency:"Workflow Efficiency",mobile_issues:"Mobile Experience"};function W(e){let{accountId:s}=e,[t,l]=(0,r.useState)(!0),[c,o]=(0,r.useState)(null),[d,x]=(0,r.useState)("resolved"),[m,h]=(0,r.useState)(null);async function u(){try{let e=await fetch("/api/accounts/".concat(s,"/jira-status"));if(e.ok){let s=await e.json();o(s)}}catch(e){console.error("Failed to fetch Jira status:",e)}finally{l(!1)}}if((0,i.createClientComponentClient)(),(0,r.useEffect)(()=>{u()},[s]),t)return(0,a.jsx)("div",{className:"bg-white rounded-lg shadow p-6",children:(0,a.jsxs)("div",{className:"animate-pulse space-y-4",children:[(0,a.jsx)("div",{className:"h-6 bg-gray-200 rounded w-1/3"}),(0,a.jsx)("div",{className:"h-4 bg-gray-200 rounded w-1/2"})]})});if(!c||0===c.recentlyResolved.length&&0===c.onRadar.length&&0===c.shouldPrioritize.length)return(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Support & Roadmap"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"No Jira issues linked to this account's friction themes yet. Connect Jira in Settings to start tracking progress."})]});let g=e=>q[e]||e.replace(/_/g," ");return(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:"Support & Roadmap"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Jira ticket progress for this account's friction themes"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-4 gap-4 mb-6",children:[(0,a.jsxs)("button",{onClick:()=>x("resolved"),className:"bg-green-50 rounded-lg p-4 text-left hover:bg-green-100 transition-colors cursor-pointer",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,a.jsx)(H.Z,{className:"w-4 h-4 text-green-600"}),(0,a.jsx)("span",{className:"text-xs font-medium text-green-700",children:"Resolved (7d)"})]}),(0,a.jsx)("div",{className:"text-2xl font-bold text-green-900",children:c.summary.resolved_7d}),(0,a.jsx)("div",{className:"text-xs text-green-600 mt-1",children:"Click to view →"})]}),(0,a.jsxs)("button",{onClick:()=>x("coming"),className:"bg-blue-50 rounded-lg p-4 text-left hover:bg-blue-100 transition-colors cursor-pointer",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,a.jsx)(B.Z,{className:"w-4 h-4 text-blue-600"}),(0,a.jsx)("span",{className:"text-xs font-medium text-blue-700",children:"In Progress"})]}),(0,a.jsx)("div",{className:"text-2xl font-bold text-blue-900",children:c.summary.in_progress}),(0,a.jsx)("div",{className:"text-xs text-blue-600 mt-1",children:"Click to view →"})]}),(0,a.jsxs)("button",{onClick:()=>x("radar"),className:"bg-gray-50 rounded-lg p-4 text-left hover:bg-gray-100 transition-colors cursor-pointer",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,a.jsx)(J.Z,{className:"w-4 h-4 text-gray-600"}),(0,a.jsx)("span",{className:"text-xs font-medium text-gray-700",children:"On Radar"})]}),(0,a.jsx)("div",{className:"text-2xl font-bold text-gray-900",children:c.summary.open_count}),(0,a.jsx)("div",{className:"text-xs text-gray-600 mt-1",children:"Click to view →"})]}),(0,a.jsxs)("button",{onClick:()=>x("priority"),className:"bg-amber-50 rounded-lg p-4 text-left hover:bg-amber-100 transition-colors cursor-pointer",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,a.jsx)(S.Z,{className:"w-4 h-4 text-amber-600"}),(0,a.jsx)("span",{className:"text-xs font-medium text-amber-700",children:"Needs Ticket"})]}),(0,a.jsx)("div",{className:"text-2xl font-bold text-amber-900",children:c.summary.needs_ticket}),(0,a.jsx)("div",{className:"text-xs text-amber-600 mt-1",children:"Click to view →"})]})]}),(0,a.jsx)("div",{className:"border-b border-gray-200 mb-4",children:(0,a.jsxs)("div",{className:"flex gap-4",children:[(0,a.jsxs)("button",{onClick:()=>x("resolved"),className:"pb-2 px-1 border-b-2 text-sm font-medium transition-colors ".concat("resolved"===d?"border-green-600 text-green-700":"border-transparent text-gray-500 hover:text-gray-700"),children:["Quick Wins (",c.recentlyResolved.length,")"]}),(0,a.jsxs)("button",{onClick:()=>x("coming"),className:"pb-2 px-1 border-b-2 text-sm font-medium transition-colors ".concat("coming"===d?"border-blue-600 text-blue-700":"border-transparent text-gray-500 hover:text-gray-700"),children:["Coming Soon (",c.comingSoon.length,")"]}),(0,a.jsxs)("button",{onClick:()=>x("radar"),className:"pb-2 px-1 border-b-2 text-sm font-medium transition-colors ".concat("radar"===d?"border-gray-600 text-gray-700":"border-transparent text-gray-500 hover:text-gray-700"),children:["On Our Radar (",c.onRadar.length,")"]}),(0,a.jsxs)("button",{onClick:()=>x("priority"),className:"pb-2 px-1 border-b-2 text-sm font-medium transition-colors ".concat("priority"===d?"border-amber-600 text-amber-700":"border-transparent text-gray-500 hover:text-gray-700"),children:["Should Prioritize (",c.shouldPrioritize.length,")"]})]})}),m&&(0,a.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4 flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-sm text-blue-700",children:"Filtered by:"}),(0,a.jsx)("span",{className:"bg-blue-100 text-blue-900 px-2 py-1 rounded text-sm font-medium",children:g(m)})]}),(0,a.jsx)("button",{onClick:()=>h(null),className:"text-blue-600 hover:text-blue-800 text-sm font-medium",children:"Clear filter"})]}),(0,a.jsxs)("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:["resolved"===d&&(0,a.jsx)(a.Fragment,{children:0===(m?c.recentlyResolved.filter(e=>e.theme_key===m):c.recentlyResolved).length?(0,a.jsx)("p",{className:"text-sm text-gray-500 text-center py-8",children:m?"No tickets resolved for ".concat(g(m)):"No tickets resolved recently"}):(m?c.recentlyResolved.filter(e=>e.theme_key===m):c.recentlyResolved).map(e=>(0,a.jsx)("div",{className:"border border-green-200 rounded-lg p-3 bg-green-50",children:(0,a.jsx)("div",{className:"flex items-start justify-between gap-3",children:(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,a.jsx)(H.Z,{className:"w-4 h-4 text-green-600 flex-shrink-0"}),(0,a.jsxs)("a",{href:e.issue_url,target:"_blank",rel:"noopener noreferrer",className:"text-sm font-medium text-green-900 hover:underline flex items-center gap-1",children:[e.jira_key,(0,a.jsx)(n.Z,{className:"w-3 h-3"})]}),(0,a.jsxs)("span",{className:"text-xs text-green-600 bg-green-100 px-2 py-0.5 rounded",children:[e.resolved_days_ago,"d ago"]})]}),(0,a.jsx)("p",{className:"text-sm text-gray-700 mb-1",children:e.summary}),(0,a.jsxs)("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[(0,a.jsx)("button",{onClick:()=>h(e.theme_key),className:"bg-white px-2 py-0.5 rounded border border-green-200 hover:bg-green-50 transition-colors cursor-pointer",title:"Filter by this theme",children:g(e.theme_key)}),(0,a.jsxs)("span",{children:[e.case_count," cases"]})]})]})})},e.id))}),"coming"===d&&(0,a.jsx)(a.Fragment,{children:0===(m?c.comingSoon.filter(e=>e.theme_key===m):c.comingSoon).length?(0,a.jsx)("p",{className:"text-sm text-gray-500 text-center py-8",children:m?"No tickets in progress for ".concat(g(m)):"No tickets in progress"}):(m?c.comingSoon.filter(e=>e.theme_key===m):c.comingSoon).map(e=>(0,a.jsx)("div",{className:"border border-blue-200 rounded-lg p-3 bg-blue-50",children:(0,a.jsx)("div",{className:"flex items-start justify-between gap-3",children:(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,a.jsx)(B.Z,{className:"w-4 h-4 text-blue-600 flex-shrink-0"}),(0,a.jsxs)("a",{href:e.issue_url,target:"_blank",rel:"noopener noreferrer",className:"text-sm font-medium text-blue-900 hover:underline flex items-center gap-1",children:[e.jira_key,(0,a.jsx)(n.Z,{className:"w-3 h-3"})]}),(0,a.jsx)("span",{className:"text-xs text-blue-700 bg-blue-100 px-2 py-0.5 rounded",children:e.status})]}),(0,a.jsx)("p",{className:"text-sm text-gray-700 mb-1",children:e.summary}),(0,a.jsxs)("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[(0,a.jsx)("button",{onClick:()=>h(e.theme_key),className:"bg-white px-2 py-0.5 rounded border border-blue-200 hover:bg-blue-50 transition-colors cursor-pointer",title:"Filter by this theme",children:g(e.theme_key)}),(0,a.jsxs)("span",{children:[e.case_count," cases"]}),e.assignee_name&&(0,a.jsxs)("span",{children:["• ",e.assignee_name]})]})]})})},e.id))}),"radar"===d&&(0,a.jsx)(a.Fragment,{children:0===(m?c.onRadar.filter(e=>e.theme_key===m):c.onRadar).length?(0,a.jsx)("p",{className:"text-sm text-gray-500 text-center py-8",children:m?"No open tickets for ".concat(g(m)):"No open tickets"}):(m?c.onRadar.filter(e=>e.theme_key===m):c.onRadar).map(e=>(0,a.jsx)("div",{className:"border border-gray-200 rounded-lg p-3 bg-gray-50",children:(0,a.jsx)("div",{className:"flex items-start justify-between gap-3",children:(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,a.jsx)(J.Z,{className:"w-4 h-4 text-gray-600 flex-shrink-0"}),(0,a.jsxs)("a",{href:e.issue_url,target:"_blank",rel:"noopener noreferrer",className:"text-sm font-medium text-gray-900 hover:underline flex items-center gap-1",children:[e.jira_key,(0,a.jsx)(n.Z,{className:"w-3 h-3"})]}),(0,a.jsx)("span",{className:"text-xs text-gray-600 bg-gray-100 px-2 py-0.5 rounded",children:e.status})]}),(0,a.jsx)("p",{className:"text-sm text-gray-700 mb-1",children:e.summary}),(0,a.jsxs)("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[(0,a.jsx)("button",{onClick:()=>h(e.theme_key),className:"bg-white px-2 py-0.5 rounded border border-gray-200 hover:bg-gray-100 transition-colors cursor-pointer",title:"Filter by this theme",children:g(e.theme_key)}),(0,a.jsxs)("span",{children:[e.case_count," cases"]}),e.priority&&(0,a.jsxs)("span",{children:["• ",e.priority]})]})]})})},e.id))}),"priority"===d&&(0,a.jsx)(a.Fragment,{children:0===(m?c.shouldPrioritize.filter(e=>e.theme_key===m):c.shouldPrioritize).length?(0,a.jsx)("p",{className:"text-sm text-gray-500 text-center py-8",children:m?"".concat(g(m)," has a ticket"):"All friction themes have tickets"}):(m?c.shouldPrioritize.filter(e=>e.theme_key===m):c.shouldPrioritize).map(e=>(0,a.jsx)("div",{className:"border border-amber-200 rounded-lg p-3 bg-amber-50",children:(0,a.jsx)("div",{className:"flex items-start justify-between gap-3",children:(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,a.jsx)(S.Z,{className:"w-4 h-4 text-amber-600 flex-shrink-0"}),(0,a.jsx)("button",{onClick:()=>{h(e.theme_key),x("resolved")},className:"text-sm font-medium text-amber-900 hover:text-amber-700 cursor-pointer underline decoration-dotted",title:"Search for related tickets",children:g(e.theme_key)}),(0,a.jsx)("span",{className:"text-xs text-amber-700 bg-amber-100 px-2 py-0.5 rounded",children:"No ticket"})]}),(0,a.jsx)("p",{className:"text-sm text-gray-700 mb-1",children:"High friction area with no roadmap item"}),(0,a.jsxs)("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[(0,a.jsxs)("span",{className:"bg-white px-2 py-0.5 rounded border border-amber-200",children:[e.case_count," cases"]}),(0,a.jsxs)("span",{children:["Avg severity: ",e.avg_severity.toFixed(1)]}),(0,a.jsxs)("span",{children:["Impact score: ",Math.round(e.weight)]})]})]})})},e.theme_key))})]})]})}function G(e){let{accountId:s}=e,[t,l]=(0,r.useState)(!0),[n,o]=(0,r.useState)(null);async function d(){try{let e=await fetch("/api/accounts/".concat(s,"/issue-progress"));if(e.ok){let s=await e.json();o(s)}}catch(e){console.error("Failed to fetch issue progress:",e)}finally{l(!1)}}if((0,i.createClientComponentClient)(),(0,r.useEffect)(()=>{d()},[s]),t)return(0,a.jsx)("div",{className:"bg-white rounded-lg shadow p-6",children:(0,a.jsxs)("div",{className:"animate-pulse space-y-4",children:[(0,a.jsx)("div",{className:"h-6 bg-gray-200 rounded w-1/3"}),(0,a.jsx)("div",{className:"h-4 bg-gray-200 rounded w-1/2"})]})});if(!n||0===n.total_issues)return null;let x=n.open+n.in_progress,h=(n.fixed/n.total_issues*100).toFixed(0);return(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:"Issue Resolution Progress"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Your team's progress fixing customer-reported issues"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-4 gap-4 mb-6",children:[(0,a.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,a.jsx)(c.Z,{className:"w-4 h-4 text-gray-600"}),(0,a.jsx)("span",{className:"text-xs font-medium text-gray-700",children:"Total Issues"})]}),(0,a.jsx)("div",{className:"text-2xl font-bold text-gray-900",children:n.total_issues}),(0,a.jsx)("div",{className:"text-xs text-gray-600 mt-1",children:"Customer-reported"})]}),(0,a.jsxs)("div",{className:"bg-green-50 rounded-lg p-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,a.jsx)(H.Z,{className:"w-4 h-4 text-green-600"}),(0,a.jsx)("span",{className:"text-xs font-medium text-green-700",children:"Fixed"})]}),(0,a.jsx)("div",{className:"text-2xl font-bold text-green-900",children:n.fixed}),(0,a.jsxs)("div",{className:"text-xs text-green-600 mt-1",children:[h,"% resolved"]})]}),(0,a.jsxs)("div",{className:"bg-blue-50 rounded-lg p-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,a.jsx)(B.Z,{className:"w-4 h-4 text-blue-600"}),(0,a.jsx)("span",{className:"text-xs font-medium text-blue-700",children:"In Progress"})]}),(0,a.jsx)("div",{className:"text-2xl font-bold text-blue-900",children:n.in_progress}),(0,a.jsx)("div",{className:"text-xs text-blue-600 mt-1",children:"Being worked on"})]}),(0,a.jsxs)("div",{className:"bg-orange-50 rounded-lg p-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,a.jsx)(c.Z,{className:"w-4 h-4 text-orange-600"}),(0,a.jsx)("span",{className:"text-xs font-medium text-orange-700",children:"Remaining"})]}),(0,a.jsx)("div",{className:"text-2xl font-bold text-orange-900",children:x}),(0,a.jsx)("div",{className:"text-xs text-orange-600 mt-1",children:"To be addressed"})]})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Resolution Rate"}),(0,a.jsxs)("span",{className:"text-sm text-gray-600",children:[h,"%"]})]}),(0,a.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-3",children:(0,a.jsx)("div",{className:"bg-gradient-to-r from-green-500 to-green-600 h-3 rounded-full transition-all duration-500",style:{width:"".concat(h,"%")}})})]}),n.fix_rate_30d>0&&(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,a.jsx)(m.Z,{className:"w-4 h-4 text-green-600"}),(0,a.jsxs)("span",{className:"text-gray-700",children:[(0,a.jsx)("span",{className:"font-semibold text-green-700",children:n.fix_rate_30d})," issues fixed in last 30 days"]})]})]})}function Y(){var e,s,t,w,_,k,S,C,D,E,I;let T=(0,l.useParams)().id,P=(0,l.useRouter)(),Z=(0,l.useSearchParams)().get("theme"),[O,L]=(0,r.useState)(null),[U,H]=(0,r.useState)([]),[B,J]=(0,r.useState)([]),[q,Y]=(0,r.useState)([]),[K,Q]=(0,r.useState)(!0),[X,$]=(0,r.useState)(!1),[ee,es]=(0,r.useState)(!1),[et,ea]=(0,r.useState)({current:0,accountAvg:0,portfolioAvg:0,last7Days:0}),[er,el]=(0,r.useState)([]),[ei,en]=(0,r.useState)([]),[ec,eo]=(0,r.useState)(null),ed=(0,i.createClientComponentClient)();async function ex(){try{Q(!0);let{data:{user:e}}=await ed.auth.getUser();if(!e){console.error("No authenticated user");return}let{data:s}=await ed.from("accounts").select("*").eq("id",T).single();s&&L(s);let{data:t}=await ed.from("account_snapshots").select("*").eq("account_id",T).gte("snapshot_date",new Date(Date.now()-7776e6).toISOString()).order("snapshot_date",{ascending:!0});t&&H(t);let{data:a,error:r}=await ed.from("friction_cards").select("\n          *,\n          raw_input:raw_inputs(source_url, metadata, created_at)\n        ").eq("account_id",T).eq("user_id",e.id).order("created_at",{ascending:!1});console.log("Friction cards query params:",{account_id:T,user_id:e.id,note:"Loading ALL friction cards (no date filter)"}),r&&(console.error("Error loading friction cards:",r),console.error("Full error details:",JSON.stringify(r,null,2))),a?(console.log("Loaded ".concat(a.length," friction cards for account")),a.length>0&&console.log("Sample friction card:",a[0]),J(a)):console.log("No friction cards data returned (cardsData is null/undefined)");let{data:l}=await ed.from("themes").select("*").eq("is_active",!0);if(l&&Y(l),t&&t.length>0){let s=t[t.length-1].case_volume||0,a=t.reduce((e,s)=>e+(s.case_volume||0),0)/t.length;if(e){let{data:t}=await ed.from("portfolios").select("account_ids").eq("user_id",e.id).in("portfolio_type",["top_25_edge","top_25_sitelink"]);if(t&&t.length>0){let r=t.flatMap(e=>e.account_ids||[]),l={account_ids:Array.from(new Set(r))},{data:i}=await ed.from("account_snapshots").select("case_volume").in("account_id",l.account_ids).gte("snapshot_date",new Date(Date.now()-7776e6).toISOString()),n=i&&i.length>0?i.reduce((e,s)=>e+(s.case_volume||0),0)/i.length:0,{data:c}=await ed.from("raw_inputs").select("id, metadata, source_url, created_at").eq("account_id",T).eq("user_id",e.id).order("created_at",{ascending:!1}),o=new Date(Date.now()-6048e5),d=(null==c?void 0:c.filter(e=>{var s;let t=null===(s=e.metadata)||void 0===s?void 0:s.created_date;return!!t&&new Date(t)>=o}))||[],x=d.length,m={};d.forEach(e=>{var s,t,a,r,l,i,n,c,o,d;let x=(null===(s=e.metadata)||void 0===s?void 0:s.Origin)||(null===(t=e.metadata)||void 0===t?void 0:t.SuppliedChannel)||(null===(a=e.metadata)||void 0===a?void 0:a.origin)||(null===(r=e.metadata)||void 0===r?void 0:r.supplied_channel)||(null===(l=e.metadata)||void 0===l?void 0:l.CaseOrigin)||(null===(i=e.metadata)||void 0===i?void 0:i["Case Origin"])||(null===(n=e.metadata)||void 0===n?void 0:n.Channel)||(null===(c=e.metadata)||void 0===c?void 0:c.channel)||(null===(o=e.metadata)||void 0===o?void 0:o.Source)||(null===(d=e.metadata)||void 0===d?void 0:d.source);if(!x||""===x){let s=e.metadata||{};for(let e in s){let t=e.toLowerCase();if((t.includes("origin")||t.includes("channel")||t.includes("source"))&&s[e]&&"string"==typeof s[e]){x=s[e];break}}}x&&""!==x||(x="Unknown"),m[x]||(m[x]=[]),m[x].push(e)});let h=Object.entries(m).map(e=>{let[s,t]=e;return{origin:s,count:t.length,percentage:(t.length/x*100).toFixed(1),cases:t,priority:t.filter(e=>{var s;return(null===(s=e.metadata)||void 0===s?void 0:s.priority)==="High"}).length}}).sort((e,s)=>s.count-e.count);el(h),ea({current:s,accountAvg:a,portfolioAvg:n,last7Days:x});let{data:u}=await ed.from("accounts").select("\n                id,\n                name,\n                vertical,\n                current_snapshot:account_snapshots!account_snapshots_account_id_fkey(\n                  case_volume,\n                  created_at\n                )\n              ").in("id",l.account_ids);if(u){let e=u.map(e=>{var s,t;let a=Array.isArray(e.current_snapshot)?e.current_snapshot.sort((e,s)=>new Date(s.created_at).getTime()-new Date(e.created_at).getTime())[0]:e.current_snapshot,r="Other";return(null===(s=e.vertical)||void 0===s?void 0:s.includes("EDGE"))?r="EDGE":(null===(t=e.vertical)||void 0===t?void 0:t.includes("SiteLink"))&&(r="SiteLink"),{id:e.id,name:e.name,caseVolume:(null==a?void 0:a.case_volume)||0,product:r}}).filter(e=>e.caseVolume>0);console.log("Peer accounts loaded:",e.length,"total peers"),console.log("Product breakdown:",{edge:e.filter(e=>"EDGE"===e.product).length,sitelink:e.filter(e=>"SiteLink"===e.product).length,other:e.filter(e=>"Other"===e.product).length}),en(e)}}}}}catch(e){console.error("Error loading account data:",e)}finally{Q(!1)}}async function em(){try{let e=crypto.randomUUID(),s=new Date(Date.now()+6048e5),{data:t,error:a}=await ed.from("shared_links").insert({account_id:T,token:e,expires_at:s.toISOString()}).select().single();if(a)throw a;let r="".concat(window.location.origin,"/share/").concat(e);await navigator.clipboard.writeText(r),alert("Share link copied to clipboard! Valid for 7 days.")}catch(e){console.error("Error creating share link:",e),alert("Failed to create share link")}}function eh(){return(null==O?void 0:O.salesforce_id)?"https://storable.my.salesforce.com/".concat(O.salesforce_id):null}async function eu(){if(confirm("This will:\n1. Sync Salesforce Cases (last 90 days)\n2. Analyze unprocessed cases with Claude (processes in batches)\n3. Calculate OFI score\n4. Link friction themes to Jira tickets\n\nFor accounts with many cases, you may need to click Analyze multiple times. Continue?")){$(!0);try{let e,s,t;console.log("Step 1: Syncing cases...");let a=await fetch("/api/salesforce/sync-cases",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({accountId:T})});console.log("Sync cases response status:",a.status);let r=await a.text();console.log("Sync cases response (first 500 chars):",r.substring(0,500));try{e=JSON.parse(r)}catch(e){throw console.error("Failed to parse sync cases response:",e),Error("STEP 1 FAILED - Sync Cases API returned invalid JSON. Status: ".concat(a.status,". Response: ").concat(r.substring(0,300)))}if(!a.ok)throw Error("STEP 1 FAILED - ".concat(e.error||"Failed to sync cases"));console.log("Step 1 complete:",e),console.log("Step 2: Analyzing friction...");let l=await fetch("/api/analyze-friction",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({accountId:T})});console.log("Analyze friction response status:",l.status);let i=await l.text();console.log("Analyze friction response (first 500 chars):",i.substring(0,500));try{s=JSON.parse(i)}catch(e){throw console.error("Failed to parse analyze friction response:",e),Error("STEP 2 FAILED - Analyze Friction API returned invalid JSON. Status: ".concat(l.status,". Response: ").concat(i.substring(0,300)))}if(!l.ok)throw Error("STEP 2 FAILED - ".concat(s.error||"Failed to analyze friction"));console.log("Step 2 complete:",s),console.log("Step 3: Calculating OFI...");let n=await fetch("/api/calculate-ofi",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({accountId:T})});console.log("Calculate OFI response status:",n.status);let c=await n.text();console.log("Calculate OFI response (first 500 chars):",c.substring(0,500));try{t=JSON.parse(c)}catch(e){throw console.error("Failed to parse OFI response:",e),Error("STEP 3 FAILED - Calculate OFI API returned invalid JSON. Status: ".concat(n.status,". Response: ").concat(c.substring(0,300)))}if(!n.ok)throw Error("STEP 3 FAILED - ".concat(t.error||"Failed to calculate OFI"));console.log("Step 3 complete:",t),eo({synced:e.synced,analyzed:s.analyzed,processed:s.processed,ofiScore:t.ofi_score,highSeverity:t.high_severity,remaining:s.remaining})}catch(s){console.error("Analysis error:",s);let e="Unknown error";s instanceof Error?e=s.message:"object"==typeof s&&null!==s?e=JSON.stringify(s):"string"==typeof s&&(e=s),alert("❌ Analysis failed: ".concat(e))}finally{$(!1)}}}if((0,r.useEffect)(()=>{ex()},[T]),K)return(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),(0,a.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading account details..."})]})});if(!O)return(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,a.jsx)("div",{className:"text-center",children:(0,a.jsx)("p",{className:"text-xl text-gray-600",children:"Account not found"})})});let eg=U[U.length-1],ep=(null==eg?void 0:eg.ofi_score)||0,eb=(null==eg?void 0:eg.trend_vs_prior_period)||0,ey=U.map(e=>({date:new Date(e.snapshot_date).toLocaleDateString("en-US",{month:"short",day:"numeric"}),ofi:e.ofi_score}));return(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsx)("header",{className:"bg-white border-b border-gray-200",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm mb-4",children:[(0,a.jsx)("button",{onClick:()=>P.push("/dashboard"),className:"text-blue-600 hover:text-blue-800 font-medium",children:"Dashboard"}),(0,a.jsx)("span",{className:"text-gray-400",children:"/"}),(0,a.jsx)("span",{className:"text-gray-600",children:O.name})]}),(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:O.name}),eh()&&(0,a.jsxs)("a",{href:eh(),target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-1 text-blue-600 hover:text-blue-700 text-sm",children:[(0,a.jsx)(n.Z,{className:"w-4 h-4"}),"View in Salesforce"]}),"active"!==O.status&&(0,a.jsx)("span",{className:"px-3 py-1 bg-gray-100 text-gray-700 text-sm font-medium rounded-full",children:O.status})]}),(0,a.jsxs)("div",{className:"flex gap-4 mt-2 text-sm text-gray-600",children:[(0,a.jsxs)("span",{className:"font-medium",children:[new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0}).format(O.arr||0)," ARR"]}),(0,a.jsx)("span",{children:"•"}),(0,a.jsx)("span",{children:(null===(e=O.products)||void 0===e?void 0:e.toUpperCase())||"N/A"}),(0,a.jsx)("span",{children:"•"}),(0,a.jsx)("span",{children:(null===(s=O.segment)||void 0===s?void 0:s.replace("_"," ").toUpperCase())||"N/A"}),O.customer_since&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{children:"•"}),(0,a.jsxs)("span",{children:["Customer since ",new Date(O.customer_since).getFullYear()]})]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsxs)("button",{onClick:eu,disabled:X,className:"flex items-center gap-2 px-4 py-2.5 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors shadow-sm",children:[(0,a.jsx)(c.Z,{className:"w-4 h-4"}),X?"Analyzing...":"Analyze Friction"]}),(0,a.jsx)(F,{account:O,frictionCards:B,snapshot:eg}),(0,a.jsxs)("button",{onClick:em,className:"flex items-center gap-2 px-4 py-2.5 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:[(0,a.jsx)(o.Z,{className:"w-4 h-4"}),"Share"]}),(0,a.jsxs)("button",{onClick:function(){var e;if(!O)return;let s=[];s.push(["Friction Intelligence Export"]),s.push(["Account:",O.name]),s.push(["ARR:","$".concat((null===(e=O.arr)||void 0===e?void 0:e.toLocaleString())||"N/A")]),s.push(["Products:",O.products||"N/A"]),s.push(["Business Unit:",O.vertical||"N/A"]),s.push(["Segment:",O.segment||"N/A"]),s.push(["Customer Since:",O.customer_since?new Date(O.customer_since).getFullYear():"N/A"]),s.push([""]);let t=U[U.length-1];t&&(s.push(["OFI Score:",t.ofi_score]),s.push(["Trend:",t.trend_direction]),s.push(["High Severity Issues:",t.high_severity_count]),s.push(["Total Friction Cards:",t.friction_card_count])),s.push([""]),et.current>0&&(s.push(["Case Volume Analysis"]),s.push(["90-Day Total:",et.current]),s.push(["Weekly Average:",(et.accountAvg/13).toFixed(1)]),s.push(["Last 7 Days:",et.last7Days])),s.push([""]),s.push(["Friction Cards"]),s.push(["Theme","Summary","Severity","Sentiment","Root Cause","Created Date"]),B.forEach(e=>{let t=q.find(s=>s.theme_key===e.theme_key);s.push([(null==t?void 0:t.label)||e.theme_key,e.summary,e.severity.toString(),e.sentiment,e.root_cause_hypothesis,new Date(e.created_at).toLocaleDateString()])});let a=s.map(e=>e.map(e=>{let s=String(e||"");return s.includes(",")||s.includes('"')||s.includes("\n")?'"'.concat(s.replace(/"/g,'""'),'"'):s}).join(",")).join("\n"),r=new Blob([a],{type:"text/csv;charset=utf-8;"}),l=document.createElement("a"),i=URL.createObjectURL(r);l.setAttribute("href",i),l.setAttribute("download","".concat(O.name.replace(/[^a-z0-9]/gi,"_"),"_friction_report_").concat(new Date().toISOString().split("T")[0],".csv")),l.style.visibility="hidden",document.body.appendChild(l),l.click(),document.body.removeChild(l)},className:"flex items-center gap-2 px-4 py-2.5 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:[(0,a.jsx)(d.Z,{className:"w-4 h-4"}),"Export"]})]})]})]})}),(0,a.jsxs)("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,a.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-6 mb-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Operational Friction Index"}),(0,a.jsx)("button",{onClick:()=>es(!ee),className:"text-gray-400 hover:text-gray-600",children:(0,a.jsx)(x.Z,{className:"w-5 h-5"})})]}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"Last 14 days • Updated daily"})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("div",{className:"text-5xl font-bold text-gray-900",children:ep.toFixed(0)}),(0,a.jsxs)("div",{className:"flex items-center justify-end gap-1 mt-1 ".concat(eb>0?"text-red-600":eb<0?"text-green-600":"text-gray-600"),children:[eb>0?(0,a.jsx)(m.Z,{className:"w-5 h-5"}):eb<0?(0,a.jsx)(h.Z,{className:"w-5 h-5"}):(0,a.jsx)(u.Z,{className:"w-5 h-5"}),(0,a.jsxs)("span",{className:"text-lg font-medium",children:[eb>0?"+":"",eb.toFixed(0),"%"]})]})]})]}),ee&&eg&&(0,a.jsxs)("div",{className:"mt-4 pt-4 border-t border-gray-200",children:[(0,a.jsx)("h3",{className:"text-sm font-semibold text-gray-900 mb-3",children:"How this score is calculated:"}),(0,a.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Friction cards (last 14 days):"}),(0,a.jsx)("span",{className:"font-medium text-gray-900",children:(null===(t=eg.score_breakdown)||void 0===t?void 0:t.card_count)||eg.friction_card_count})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Severity-weighted score:"}),(0,a.jsx)("span",{className:"font-medium text-gray-900",children:(null===(w=eg.score_breakdown)||void 0===w?void 0:w.severity_weighted)||0})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Base score (log scale):"}),(0,a.jsx)("span",{className:"font-medium text-gray-900",children:(null===(_=eg.score_breakdown)||void 0===_?void 0:_.base_score)?eg.score_breakdown.base_score.toFixed(1):"0"})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Friction density (% of cases):"}),(0,a.jsx)("span",{className:"font-medium text-gray-900",children:(null===(k=eg.score_breakdown)||void 0===k?void 0:k.friction_density)?eg.score_breakdown.friction_density.toFixed(1)+"%":"0%"})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Density multiplier:"}),(0,a.jsx)("span",{className:"font-medium text-gray-900",children:(null===(S=eg.score_breakdown)||void 0===S?void 0:S.density_multiplier)?eg.score_breakdown.density_multiplier.toFixed(2)+"x":"1.0x"})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"High severity boost:"}),(0,a.jsxs)("span",{className:"font-medium text-gray-900",children:["+",(null===(D=eg.score_breakdown)||void 0===D?void 0:null===(C=D.high_severity_boost)||void 0===C?void 0:C.toFixed(1))||0]})]}),(0,a.jsxs)("div",{className:"pt-2 mt-2 border-t border-gray-100 flex justify-between",children:[(0,a.jsx)("span",{className:"font-medium text-gray-900",children:"Total OFI Score:"}),(0,a.jsx)("span",{className:"font-bold text-gray-900",children:ep.toFixed(0)})]})]}),(0,a.jsxs)("div",{className:"mt-3 text-xs text-gray-500 space-y-1",children:[(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Formula:"})," (Base Score \xd7 Density Multiplier) + High Severity Boost"]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Severity weights:"})," 1→1pt, 2→2pts, 3→3pts, 4→5pts, 5→8pts"]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Scores:"})," 70+ = High Friction, 40-69 = Medium, 0-39 = Low"]})]})]})]}),et.current>0&&(0,a.jsx)("div",{className:"mb-6",children:(0,a.jsx)(A,{currentVolume:et.current,accountHistoricalAvg:et.accountAvg,portfolioAvg:et.portfolioAvg,last7Days:et.last7Days,accountName:(null==O?void 0:O.name)||"",facilityCount:(null==O?void 0:O.facility_count)||void 0})}),er.length>0&&(0,a.jsx)(z,{origins:er,accountName:(null==O?void 0:O.name)||"",totalCases:et.last7Days}),ei.length>0&&O&&et.current>0&&(0,a.jsx)(R,{currentAccount:{name:O.name,caseVolume:et.current,product:(null===(E=O.vertical)||void 0===E?void 0:E.includes("EDGE"))?"EDGE":(null===(I=O.vertical)||void 0===I?void 0:I.includes("SiteLink"))?"SiteLink":"Other"},peers:ei}),(0,a.jsx)("div",{className:"mb-6",children:(0,a.jsx)(G,{accountId:T})}),(0,a.jsx)("div",{className:"mb-6",children:(0,a.jsx)(W,{accountId:T})}),(0,a.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-6 mb-6",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"90-Day Trend"}),(0,a.jsx)(p.h,{width:"100%",height:300,children:(0,a.jsxs)(b.w,{data:ey,children:[(0,a.jsx)(y.q,{strokeDasharray:"3 3",stroke:"#e5e7eb"}),(0,a.jsx)(f.K,{dataKey:"date",tick:{fill:"#6b7280",fontSize:12},stroke:"#d1d5db"}),(0,a.jsx)(j.B,{tick:{fill:"#6b7280",fontSize:12},stroke:"#d1d5db",domain:[0,100]}),(0,a.jsx)(v.u,{contentStyle:{backgroundColor:"#fff",border:"1px solid #e5e7eb",borderRadius:"8px",padding:"8px 12px"}}),(0,a.jsx)(N.x,{type:"monotone",dataKey:"ofi",stroke:"#3b82f6",strokeWidth:2,dot:{fill:"#3b82f6",r:4},name:"OFI Score"})]})})]}),Z&&(0,a.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6 flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(x.Z,{className:"w-5 h-5 text-blue-600"}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"text-sm font-medium text-blue-900",children:["Filtered by theme: ",Z.split("_").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")]}),(0,a.jsxs)("p",{className:"text-xs text-blue-700",children:["Showing ",B.filter(e=>e.theme_key===Z).length," of ",B.length," friction cards"]})]})]}),(0,a.jsxs)("button",{onClick:()=>P.push("/account/".concat(T)),className:"flex items-center gap-2 px-3 py-1.5 text-sm font-medium text-blue-700 bg-white rounded-lg hover:bg-blue-100 border border-blue-300",children:[(0,a.jsx)(g.Z,{className:"w-4 h-4"}),"Clear Filter"]})]}),(0,a.jsx)(M,{frictionCards:Z?B.filter(e=>e.theme_key===Z):B,themes:q})]}),(0,a.jsx)(V,{isOpen:null!==ec,onClose:()=>{eo(null),window.location.reload()},accountName:(null==O?void 0:O.name)||"Unknown Account",accountId:T,synced:(null==ec?void 0:ec.synced)||0,analyzed:(null==ec?void 0:ec.analyzed)||0,processed:null==ec?void 0:ec.processed,ofiScore:(null==ec?void 0:ec.ofiScore)||0,highSeverity:(null==ec?void 0:ec.highSeverity)||0,remaining:null==ec?void 0:ec.remaining})]})}}},function(e){e.O(0,[125,505,785,670,971,69,744],function(){return e(e.s=97802)}),_N_E=e.O()}]);