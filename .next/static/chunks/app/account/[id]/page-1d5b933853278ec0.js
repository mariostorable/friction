(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[114],{97802:function(e,t,s){Promise.resolve().then(s.bind(s,96890))},96890:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return U}});var a=s(3827),r=s(64090),l=s(47907),i=s(58714),n=s(81708),c=s(98998),o=s(32805),d=s(44715),m=s(28814),x=s(29733),h=s(10775),u=s(27271),g=s(52235),p=s(26587),y=s(71362),b=s(38333),f=s(23356),v=s(22983),j=s(10166),N=s(98061),w=s(69475),_=s(18994),S=s(40834),k=s(61524),C=s(92493);function D(e){var t,s,l;let{account:c,frictionCards:o,snapshot:m}=e,[x,h]=(0,r.useState)(!1),[u,p]=(0,r.useState)(!1),[y,b]=(0,r.useState)(null),[f,v]=(0,r.useState)(null),[j,N]=(0,r.useState)([]),D=(0,i.createClientComponentClient)();async function F(e){p(!0),v(e),b(null),N([]);try{let t=o.map(e=>e.raw_input_id).filter(Boolean),{data:s}=await D.from("raw_inputs").select("*").in("id",t),a=[];o.forEach(e=>{let t=null==s?void 0:s.find(t=>t.id===e.raw_input_id);if(null==t?void 0:t.source_id){var r;a.push({id:e.id,summary:e.summary,severity:e.severity,theme:e.theme_key,case_id:t.source_id,case_date:(null===(r=t.metadata)||void 0===r?void 0:r.created_date)||t.created_at})}}),a.sort((e,t)=>new Date(t.case_date).getTime()-new Date(e.case_date).getTime()),N(a);let r=await fetch("/api/briefing/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({account_id:c.id,briefing_type:e})});if(!r.ok)throw Error("Failed to generate briefing");let l=await r.json();b(l.briefing)}catch(e){console.error("Error generating briefing:",e),alert("Failed to generate briefing. Please try again.")}finally{p(!1)}}return x?(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center p-6 border-b",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"Visit Briefing"}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:c.name})]}),(0,a.jsx)("button",{onClick:()=>h(!1),className:"text-gray-400 hover:text-gray-600",children:(0,a.jsx)(g.Z,{className:"w-6 h-6"})})]}),(0,a.jsx)("div",{className:"p-6 overflow-y-auto flex-1",children:y||u?u?(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center py-12",children:[(0,a.jsx)(_.Z,{className:"w-12 h-12 animate-spin text-purple-600 mb-4"}),(0,a.jsx)("p",{className:"text-lg font-medium text-gray-900",children:"Generating briefing..."})]}):y?(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between pb-4 border-b",children:[(0,a.jsx)("span",{className:"px-3 py-1 bg-purple-100 text-purple-700 text-sm font-medium rounded-full",children:"quick"===f?"Quick Briefing":"Deep Dive"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)("button",{onClick:function(){b(null),v(null),N([])},className:"flex items-center gap-2 px-3 py-2 text-sm bg-gray-100 rounded-lg hover:bg-gray-200",children:[(0,a.jsx)(S.Z,{className:"w-4 h-4"}),"New"]}),(0,a.jsxs)("button",{onClick:function(){if(!y)return;let e=new C.ZP,t=e.internal.pageSize.getWidth()-28,s=20;e.setFontSize(18),e.setFont("helvetica","bold"),e.text("Visit Briefing",14,s),s+=10,e.setFontSize(14),e.text(y.account_name,14,s),s+=8,e.setFontSize(10),e.setFont("helvetica","normal"),e.text("Generated: "+new Date().toLocaleDateString(),14,s),s+=5,e.text("ARR: "+y.arr,14,s),s+=5,e.text(y.vertical+" | "+y.segment,14,s),s+=10,e.setFontSize(12),e.setFont("helvetica","bold");let a=y.ofi_score,r=y.trend&&"stable"!==y.trend.toLowerCase()?" ("+y.trend+")":"";a>=70?e.setTextColor(220,38,38):a>=40?e.setTextColor(234,179,8):e.setTextColor(22,163,74),e.text("OFI Score: "+a+" - "+(a>=70?"CRITICAL":a>=40?"MODERATE":"HEALTHY")+r,14,s),e.setTextColor(0,0,0),s+=12,y.attention_items&&y.attention_items.length>0&&(e.setFontSize(12),e.setFont("helvetica","bold"),e.text("Items Requiring Attention",14,s),s+=8,e.setFontSize(9),e.setFont("helvetica","normal"),y.attention_items.forEach((a,r)=>{s>260&&(e.addPage(),s=20),e.setFont("helvetica","bold"),e.text(r+1+". "+a.title,16,s),s+=5,e.setFont("helvetica","normal"),e.splitTextToSize(a.details,t-4).forEach(t=>{s>270&&(e.addPage(),s=20),e.text(t,18,s),s+=4}),s+=3}),s+=5),y.talking_points&&y.talking_points.length>0&&(s>240&&(e.addPage(),s=20),e.setFontSize(12),e.setFont("helvetica","bold"),e.text("Key Talking Points",14,s),s+=8,e.setFontSize(9),e.setFont("helvetica","normal"),y.talking_points.forEach(a=>{s>270&&(e.addPage(),s=20),e.splitTextToSize("• "+a,t-2).forEach(t=>{e.text(t,16,s),s+=4}),s+=2}),s+=5),y.wins&&y.wins.length>0&&(s>240&&(e.addPage(),s=20),e.setFontSize(12),e.setFont("helvetica","bold"),e.text("Recent Wins",14,s),s+=8,e.setFontSize(9),e.setFont("helvetica","normal"),y.wins.forEach(a=>{s>270&&(e.addPage(),s=20),e.splitTextToSize("• "+a,t-2).forEach(t=>{e.text(t,16,s),s+=4}),s+=2}),s+=5),j.length>0&&(s>220&&(e.addPage(),s=20),e.setFontSize(12),e.setFont("helvetica","bold"),e.text("Support Cases (Chronological)",14,s),s+=8,e.setFontSize(8),e.setFont("helvetica","normal"),j.forEach(a=>{s>265&&(e.addPage(),s=20);let r=new Date(a.case_date).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"});e.splitTextToSize(a.summary,t-4).forEach(t=>{s>270&&(e.addPage(),s=20),e.text(t,16,s),s+=3.5}),e.text("Date: "+r+" | Severity: "+a.severity+"/5 | "+a.theme.replace(/_/g," "),16,s),s+=3,e.setTextColor(0,0,255),e.text("Salesforce Case ID: "+a.case_id,16,s),e.setTextColor(0,0,0),s+=5})),e.save(c.name.replace(/\s+/g,"_")+"_Briefing.pdf")},className:"flex items-center gap-2 px-3 py-2 text-sm bg-purple-600 text-white rounded-lg hover:bg-purple-700",children:[(0,a.jsx)(d.Z,{className:"w-4 h-4"}),"PDF"]})]})]}),(0,a.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:["ARR: ",y.arr]}),(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:[y.vertical," | ",y.segment]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"OFI Score"}),(0,a.jsx)("p",{className:"text-3xl font-bold ".concat(y.ofi_score>=70?"text-red-600":y.ofi_score>=40?"text-yellow-600":"text-green-600"),children:y.ofi_score}),(0,a.jsxs)("p",{className:"text-sm font-medium ".concat(y.ofi_score>=70?"text-red-700":y.ofi_score>=40?"text-yellow-700":"text-green-700"),children:[y.ofi_score>=70?"CRITICAL":y.ofi_score>=40?"MODERATE":"HEALTHY",y.trend&&"stable"!==y.trend.toLowerCase()?" - ".concat(y.trend):""]})]})]})}),(null===(t=y.attention_items)||void 0===t?void 0:t.length)>0&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("h3",{className:"flex items-center gap-2 text-lg font-semibold mb-3",children:[(0,a.jsx)(k.Z,{className:"w-5 h-5 text-red-600"}),"Items Requiring Attention"]}),(0,a.jsx)("div",{className:"space-y-3",children:y.attention_items.map((e,t)=>(0,a.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[(0,a.jsx)("p",{className:"font-semibold text-red-900",children:e.title}),(0,a.jsx)("p",{className:"text-sm text-red-700 mt-1",children:e.details}),(0,a.jsx)("span",{className:"inline-block mt-2 px-2 py-1 bg-red-200 text-red-800 text-xs rounded",children:e.severity})]},t))})]}),(null===(s=y.talking_points)||void 0===s?void 0:s.length)>0&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-3",children:"\uD83D\uDCAC Key Talking Points"}),(0,a.jsx)("ul",{className:"space-y-2",children:y.talking_points.map((e,t)=>(0,a.jsxs)("li",{className:"flex gap-2",children:[(0,a.jsx)("span",{className:"text-purple-600",children:"•"}),(0,a.jsx)("span",{className:"text-gray-700",children:e})]},t))})]}),(null===(l=y.wins)||void 0===l?void 0:l.length)>0&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-3",children:"\uD83C\uDFAF Recent Wins"}),(0,a.jsx)("ul",{className:"space-y-2",children:y.wins.map((e,t)=>(0,a.jsxs)("li",{className:"flex gap-2",children:[(0,a.jsx)("span",{className:"text-green-600",children:"•"}),(0,a.jsx)("span",{className:"text-gray-700",children:e})]},t))})]}),j.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-3",children:"\uD83D\uDD0D Support Cases (Chronological)"}),(0,a.jsx)("div",{className:"space-y-2",children:j.map(e=>(0,a.jsx)("div",{className:"p-3 bg-gray-50 border border-gray-200 rounded-lg hover:bg-gray-100 transition-colors",children:(0,a.jsxs)("div",{className:"flex justify-between items-start gap-3",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-900",children:e.summary}),(0,a.jsxs)("div",{className:"flex items-center gap-4 mt-1 text-xs text-gray-600",children:[(0,a.jsxs)("span",{className:"flex items-center gap-1",children:["\uD83D\uDCC5 ",new Date(e.case_date).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})]}),(0,a.jsxs)("span",{children:["Severity: ",e.severity,"/5"]}),(0,a.jsx)("span",{className:"px-2 py-0.5 bg-gray-200 rounded text-gray-700",children:e.theme.replace(/_/g," ")})]})]}),(0,a.jsxs)("a",{href:"https://storable.my.salesforce.com/"+e.case_id,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-1 text-xs text-blue-600 hover:underline whitespace-nowrap px-3 py-1 bg-blue-50 rounded hover:bg-blue-100",children:["View Case ",(0,a.jsx)(n.Z,{className:"w-3 h-3"})]})]})},e.id))})]})]}):null:(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("p",{className:"text-gray-600",children:"Generate a briefing to prepare for your customer visit:"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsx)("button",{onClick:()=>F("quick"),className:"group p-6 border-2 border-gray-200 rounded-lg hover:border-purple-500 hover:bg-purple-50 transition-all text-left",children:(0,a.jsxs)("div",{className:"flex items-start gap-4",children:[(0,a.jsx)("div",{className:"p-3 bg-purple-100 rounded-lg group-hover:bg-purple-200",children:(0,a.jsx)(w.Z,{className:"w-6 h-6 text-purple-600"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-semibold text-lg mb-2",children:"Quick Briefing"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Essential talking points and top friction issues"}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-2",children:"~30 seconds"})]})]})}),(0,a.jsx)("button",{onClick:()=>F("deep"),className:"group p-6 border-2 border-gray-200 rounded-lg hover:border-purple-500 hover:bg-purple-50 transition-all text-left",children:(0,a.jsxs)("div",{className:"flex items-start gap-4",children:[(0,a.jsx)("div",{className:"p-3 bg-purple-100 rounded-lg group-hover:bg-purple-200",children:(0,a.jsx)(w.Z,{className:"w-6 h-6 text-purple-600"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-semibold text-lg mb-2",children:"Deep Dive"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Comprehensive analysis with history and recommendations"}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-2",children:"~60 seconds"})]})]})})]}),m&&(0,a.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-blue-900",children:"Current OFI Score"}),(0,a.jsx)("p",{className:"text-3xl font-bold text-blue-600 mt-1",children:m.ofi_score})]}),(0,a.jsx)("div",{className:"text-right text-sm text-blue-700",children:(0,a.jsxs)("p",{children:[o.length," friction points"]})})]})})]})})]})}):(0,a.jsxs)("button",{onClick:()=>h(!0),className:"flex items-center gap-2 px-4 py-2 text-sm font-medium text-white bg-purple-600 rounded-lg hover:bg-purple-700",children:[(0,a.jsx)(w.Z,{className:"w-4 h-4"}),"Visit Briefing"]})}var F=s(46578);function A(e){let{currentVolume:t,accountHistoricalAvg:s,portfolioAvg:r,last7Days:l,accountName:i}=e,n=s/13,c=n>0?(l-n)/n*100:0,o=c>50,d=c<-50;return(0,a.jsxs)("div",{className:"rounded-lg border p-6 ".concat(o?"bg-red-50 border-red-200":d?"bg-yellow-50 border-yellow-200":"bg-green-50 border-green-200"),children:[(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[o?(0,a.jsx)(k.Z,{className:"w-5 h-5 text-red-600"}):d?(0,a.jsx)(h.Z,{className:"w-5 h-5 text-yellow-600"}):(0,a.jsx)(F.Z,{className:"w-5 h-5 text-green-600"}),"Support Volume Analysis"]}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:o?"Unusually High Volume":d?"Unusually Low Volume":"Normal Volume"})]}),(0,a.jsx)("p",{className:"text-sm text-gray-700 mb-4",children:(()=>{let e=t>1.5*r?"much higher than peers":t<.5*r?"much lower than peers":"similar to peers",s=0===c?"stable at their usual level":c>0?"trending up ".concat(Math.abs(c).toFixed(0),"% above their baseline"):"trending down ".concat(Math.abs(c).toFixed(0),"% below their baseline");return"Support volume is ".concat(e," and ").concat(s,".")})()}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:[(0,a.jsx)("div",{className:"text-xs text-gray-600 uppercase tracking-wide mb-1",children:"Weekly Baseline"}),(0,a.jsxs)("div",{className:"flex items-baseline gap-2",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-gray-900",children:n.toFixed(1)}),(0,a.jsx)("div",{className:"text-xs text-gray-500",children:"cases/week"})]}),(0,a.jsxs)("div",{className:"text-xs text-gray-500 mt-1",children:[t," total in last 90 days"]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:[(0,a.jsx)("div",{className:"text-xs text-gray-600 uppercase tracking-wide mb-1",children:"Last 7 Days"}),(0,a.jsxs)("div",{className:"flex items-baseline gap-2",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-gray-900",children:l}),(0,a.jsx)("div",{className:"text-xs text-gray-500",children:"cases"})]}),(0,a.jsxs)("div",{className:"text-xs text-gray-500 mt-0.5",children:[(l/7).toFixed(1)," avg cases/day"]}),(0,a.jsx)("div",{className:"text-xs font-medium mt-1 ".concat(c>20?"text-red-600":c<-20?"text-yellow-600":"text-gray-600"),children:10>Math.abs(c)?"Normal week":c>0?"".concat(c.toFixed(0),"% above baseline"):"".concat(Math.abs(c).toFixed(0),"% below baseline")})]})]}),(0,a.jsxs)("div",{className:"mt-4 pt-3 border-t border-gray-200",children:[(0,a.jsxs)("p",{className:"text-xs text-gray-600 font-medium mb-1",children:["✓ Confirmed: All cases belong to ",i]}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"Weekly Baseline = This account's average cases per week over 90 days • Last 7 Days = Cases synced in the most recent week"})]})]})}var T=s(85904),E=s(90684),O=s(37451),I=s(30438),Z=s(85159),L=s(23441);function z(e){let{origins:t,accountName:s,totalCases:l}=e,[i,o]=(0,r.useState)(new Set);if(0===t.length)return null;let d=e=>{let t=new Set(i);t.has(e)?t.delete(e):t.add(e),o(t)},m=e=>{let t=e.toLowerCase();return t.includes("phone")?(0,a.jsx)(T.Z,{className:"w-4 h-4"}):t.includes("email")||t.includes("mail")?(0,a.jsx)(E.Z,{className:"w-4 h-4"}):t.includes("web")||t.includes("portal")?(0,a.jsx)(O.Z,{className:"w-4 h-4"}):t.includes("chat")?(0,a.jsx)(I.Z,{className:"w-4 h-4"}):(0,a.jsx)(c.Z,{className:"w-4 h-4"})},x=e=>e>40?"bg-red-50 border-red-200 text-red-900":e>25?"bg-orange-50 border-orange-200 text-orange-900":"bg-blue-50 border-blue-200 text-blue-900",h=t.filter(e=>parseFloat(e.percentage)>40),u=h.length>0;return(0,a.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-6 mb-6",children:[(0,a.jsx)("div",{className:"flex items-start justify-between mb-4",children:(0,a.jsxs)("div",{children:[(0,a.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[(0,a.jsx)(c.Z,{className:"w-5 h-5 text-blue-600"}),"Case Origins (Last 7 Days)"]}),(0,a.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:[l," total cases from ",t.length," channel",1!==t.length?"s":""]})]})}),u&&(0,a.jsx)("div",{className:"mb-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:(0,a.jsxs)("p",{className:"text-sm text-yellow-800 font-medium flex items-center gap-2",children:[(0,a.jsx)(c.Z,{className:"w-4 h-4"}),"Alert: ",h[0].percentage,"% of cases coming from ",h[0].origin," channel"]})}),(0,a.jsx)("div",{className:"space-y-3",children:t.map(e=>{let t=parseFloat(e.percentage),s=x(t);return(0,a.jsxs)("div",{className:"rounded-lg border p-4 ".concat(s),children:[(0,a.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[m(e.origin),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-semibold",children:e.origin}),(0,a.jsxs)("p",{className:"text-sm opacity-80",children:[e.count," cases (",e.percentage,"%)",e.priority>0&&(0,a.jsxs)("span",{className:"ml-2 font-medium",children:["• ",e.priority," high priority"]})]})]})]}),(0,a.jsx)("div",{className:"text-right",children:(0,a.jsx)("div",{className:"text-2xl font-bold",children:e.count})})]}),(0,a.jsx)("div",{className:"w-full bg-white/50 rounded-full h-2 mb-3",children:(0,a.jsx)("div",{className:"bg-current rounded-full h-2 transition-all",style:{width:"".concat(Math.min(100,t),"%")}})}),e.cases.length>0&&(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("p",{className:"text-xs font-medium opacity-70 uppercase tracking-wide",children:"Recent Cases:"}),(i.has(e.origin)?e.cases:e.cases.slice(0,3)).map(e=>{var t,s,r,l;return(0,a.jsxs)("div",{className:"flex items-center justify-between text-xs bg-white/50 rounded px-2 py-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[(0,a.jsxs)("span",{className:"font-mono whitespace-nowrap",children:["Case #",(null===(t=e.metadata)||void 0===t?void 0:t.case_number)||"Unknown",(null===(s=e.metadata)||void 0===s?void 0:s.priority)&&(0,a.jsx)("span",{className:"ml-2 font-medium",children:e.metadata.priority})]}),(null===(r=e.metadata)||void 0===r?void 0:r.subject)&&(0,a.jsxs)("span",{className:"text-gray-600 truncate",children:["• ",e.metadata.subject]}),(null===(l=e.metadata)||void 0===l?void 0:l.created_date)&&(0,a.jsxs)("span",{className:"text-gray-500 whitespace-nowrap",children:["• ",new Date(e.metadata.created_date).toLocaleDateString("en-US",{month:"short",day:"numeric"})]})]}),e.source_url&&(0,a.jsxs)("a",{href:e.source_url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-1 hover:underline ml-2 whitespace-nowrap",children:["View",(0,a.jsx)(n.Z,{className:"w-3 h-3"})]})]},e.id)}),e.count>3&&(0,a.jsx)("button",{onClick:()=>d(e.origin),className:"text-xs opacity-70 hover:opacity-100 italic flex items-center gap-1 hover:underline",children:i.has(e.origin)?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(Z.Z,{className:"w-3 h-3"}),"Show less"]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(L.Z,{className:"w-3 h-3"}),"+ ",e.count-3," more cases"]})})]})]},e.origin)})}),(0,a.jsx)("div",{className:"mt-4 text-xs text-gray-500",children:"Data shows case distribution by origin channel. High concentration in one channel may indicate specific issues."})]})}var P=s(22071);function V(e){var t;let{currentAccount:s,peers:r}=e,l=r.filter(e=>e.product===s.product),i=[...l].sort((e,t)=>t.caseVolume-e.caseVolume),n=i.findIndex(e=>e.name===s.name)+1,c=l.length>0?l.reduce((e,t)=>e+t.caseVolume,0)/l.length:0,o=(null===(t=i[Math.floor(i.length/2)])||void 0===t?void 0:t.caseVolume)||0,d=i.filter(e=>e.name!==s.name&&Math.abs(e.caseVolume-s.caseVolume)/s.caseVolume*100<=20),m=c>0?(s.caseVolume-c)/c*100:0;return(0,a.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-6 mb-6",children:[(0,a.jsx)("div",{className:"flex items-start justify-between mb-4",children:(0,a.jsxs)("div",{children:[(0,a.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[(0,a.jsx)(P.Z,{className:"w-5 h-5 text-purple-600"}),"Peer Comparison"]}),(0,a.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:["Case volume vs Top 25 ",s.product," accounts (last 90 days)"]})]})}),(0,a.jsx)("div",{className:"mb-4 p-4 bg-gradient-to-r from-purple-50 to-blue-50 rounded-lg border border-purple-200",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600 font-medium",children:"Portfolio Ranking"}),(0,a.jsxs)("p",{className:"text-3xl font-bold text-gray-900",children:["#",n]}),(0,a.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["out of ",l.length," ",s.product," accounts"]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsxs)("p",{className:"text-sm text-gray-600 mb-1",children:["vs ",s.product," Avg"]}),(0,a.jsxs)("div",{className:"flex items-center gap-1 ".concat(m>0?"text-red-600":m<0?"text-green-600":"text-gray-600"),children:[m>0?(0,a.jsx)(x.Z,{className:"w-4 h-4"}):m<0?(0,a.jsx)(h.Z,{className:"w-4 h-4"}):null,(0,a.jsxs)("span",{className:"text-lg font-bold",children:[m>0?"+":"",m.toFixed(0),"%"]})]})]})]})}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[(0,a.jsxs)("div",{className:"text-center p-3 bg-blue-50 rounded-lg border border-blue-200",children:[(0,a.jsxs)("p",{className:"text-xs text-blue-700 font-medium uppercase tracking-wide",children:[s.product," Avg"]}),(0,a.jsx)("p",{className:"text-2xl font-bold text-blue-900 mt-1",children:c.toFixed(0)}),(0,a.jsx)("p",{className:"text-xs text-blue-600",children:"cases/90d"})]}),(0,a.jsxs)("div",{className:"text-center p-3 bg-gray-50 rounded-lg",children:[(0,a.jsx)("p",{className:"text-xs text-gray-600 font-medium uppercase tracking-wide",children:"Median"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-gray-900 mt-1",children:o}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"middle value"})]})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("p",{className:"text-xs text-gray-600 font-medium mb-2",children:"CASE VOLUME DISTRIBUTION"}),(0,a.jsx)("div",{className:"relative h-24 bg-gray-100 rounded-lg p-2",children:i.slice(0,10).map((e,t)=>{let r=i[0].caseVolume,l=e.caseVolume/r*100,n=e.name===s.name;return(0,a.jsx)("div",{className:"inline-block mx-0.5",style:{width:"calc(10% - 4px)"},children:(0,a.jsxs)("div",{className:"h-full flex flex-col justify-end items-center",children:[(0,a.jsx)("div",{className:"w-full rounded-t transition-all ".concat(n?"bg-purple-600":"bg-gray-400 hover:bg-gray-500"),style:{height:"".concat(l,"%")},title:"".concat(e.name,": ").concat(e.caseVolume," cases")}),n&&(0,a.jsx)("span",{className:"text-xs font-bold text-purple-600 mt-1",children:"You"})]})},e.name)})}),(0,a.jsxs)("div",{className:"flex justify-between text-xs text-gray-500 mt-1",children:[(0,a.jsx)("span",{children:"Highest"}),(0,a.jsx)("span",{children:"Top 10 Accounts"}),(0,a.jsx)("span",{children:"10th"})]})]}),d.length>0&&(0,a.jsxs)("div",{className:"pt-4 border-t border-gray-200",children:[(0,a.jsxs)("p",{className:"text-xs text-gray-600 font-medium mb-2",children:["SIMILAR ",s.product.toUpperCase()," ACCOUNTS (within 20% of your volume)"]}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-2",children:[d.slice(0,5).map(e=>(0,a.jsxs)("div",{className:"px-3 py-1 bg-purple-50 border border-purple-200 rounded-full text-sm",children:[(0,a.jsx)("span",{className:"font-medium text-purple-900",children:e.name}),(0,a.jsxs)("span",{className:"text-purple-600 ml-1",children:["(",e.caseVolume,")"]})]},e.name)),d.length>5&&(0,a.jsxs)("span",{className:"text-sm text-gray-500",children:["+",d.length-5," more"]})]})]})]})}function R(e){let{frictionCards:t,themes:s}=e,[l,i]=(0,r.useState)(null),[c,o]=(0,r.useState)(null);console.log("FrictionClusters component rendering:",{frictionCardsCount:t.length,themesCount:s.length,frictionCards:t.slice(0,2)});let d=t.reduce((e,t)=>(e[t.theme_key]||(e[t.theme_key]=[]),e[t.theme_key].push(t),e),{}),m=e=>{let t={};return e.forEach(e=>{let s=e.summary.toLowerCase(),a="other_issues",r="Other Issues",l=0;[{key:"phone_calls",terms:["call","phone","dialer","calling"],label:"Phone/Call Issues"},{key:"login_auth",terms:["login","authentication","password","access denied"],label:"Login & Authentication"},{key:"system_stuck",terms:["stuck","frozen","freeze","not responding"],label:"System Freezing/Stuck"},{key:"connectivity",terms:["connection","connectivity","network","disconnect"],label:"Connectivity Issues"},{key:"microphone",terms:["microphone","mic","audio","headset"],label:"Audio/Microphone Problems"},{key:"location_access",terms:["location","locations","district","site access"],label:"Location Access Issues"},{key:"integration",terms:["integration","api","sync","observe.ai"],label:"Integration Problems"},{key:"billing",terms:["billing","invoice","charge","payment"],label:"Billing Issues"},{key:"email_delivery",terms:["email","notification","alert"],label:"Email/Notification Issues"},{key:"data_issues",terms:["data","report","duplicate","missing"],label:"Data Quality Issues"},{key:"system_errors",terms:["error","failed","failure","crash"],label:"System Errors"},{key:"ui_problems",terms:["button","screen","interface","display"],label:"UI/Interface Problems"}].forEach(e=>{let t=e.terms.filter(e=>s.includes(e)).length;t>l&&(l=t,a=e.key,r=e.label)});let i="".concat(a,"|||").concat(r);t[i]||(t[i]=[]),t[i].push(e)}),Object.entries(t).map(e=>{let[t,s]=e,[a,r]=t.split("|||"),l=s.reduce((e,t)=>e+t.severity,0)/s.length,i={critical:s.filter(e=>5===e.severity).length,high:s.filter(e=>4===e.severity).length,medium:s.filter(e=>3===e.severity).length,low:s.filter(e=>2===e.severity).length,minor:s.filter(e=>1===e.severity).length};return{pattern:r,cards:s.sort((e,t)=>t.severity-e.severity),avgSeverity:l,severityDistribution:i}}).sort((e,t)=>{let s=e.cards.length*e.avgSeverity;return t.cards.length*t.avgSeverity-s})},x=e=>{let t=s.find(t=>t.theme_key===e);return(null==t?void 0:t.label)||e.replace(/_/g," ")},h=e=>e>=5?"text-red-700 bg-red-100":e>=4?"text-red-600 bg-red-50":e>=3?"text-yellow-600 bg-yellow-50":e>=2?"text-blue-600 bg-blue-50":"text-gray-600 bg-gray-50",u=e=>e>=5?"bg-red-600 text-white":e>=4?"bg-red-500 text-white":e>=3?"bg-yellow-500 text-white":e>=2?"bg-blue-500 text-white":"bg-gray-400 text-white",g=e=>e>=.8?"High confidence":e>=.6?"Medium confidence":"Low confidence",p=Object.entries(d).map(e=>{let[t,s]=e,a=s.reduce((e,t)=>e+t.severity,0)/s.length,r=s.length*a;return{themeKey:t,cards:s,avgSeverity:a,impact:r}}).sort((e,t)=>t.impact-e.impact);return(0,a.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("h2",{className:"text-lg font-semibold text-gray-900",children:["Friction Signals (",t.length," in last 30 days)"]}),(0,a.jsx)("div",{className:"text-xs text-gray-500",children:"Grouped by patterns for easier analysis"})]}),0===p.length?(0,a.jsx)("div",{className:"text-center py-12 text-gray-500",children:"No friction signals detected in the last 30 days"}):(0,a.jsx)("div",{className:"space-y-4",children:p.map(e=>{let{themeKey:t,cards:s,avgSeverity:r,impact:d}=e,p=m(s),y=l===t;return(0,a.jsxs)("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[(0,a.jsxs)("button",{onClick:()=>i(y?null:t),className:"w-full bg-gray-50 px-4 py-3 flex justify-between items-center hover:bg-gray-100 transition-colors",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[y?(0,a.jsx)(Z.Z,{className:"w-5 h-5 text-gray-600"}):(0,a.jsx)(L.Z,{className:"w-5 h-5 text-gray-600"}),(0,a.jsx)("h3",{className:"font-semibold text-gray-900",children:x(t)})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[(0,a.jsxs)("span",{className:"font-medium",children:[s.length," issues"]}),(0,a.jsx)("span",{children:"•"}),(0,a.jsxs)("span",{children:["Avg severity: ",r.toFixed(1)]})]})]}),(0,a.jsx)("div",{className:"flex items-center gap-2",children:s.some(e=>e.severity>=4)&&(0,a.jsxs)("span",{className:"px-2 py-1 bg-red-100 text-red-700 text-xs font-medium rounded",children:[s.filter(e=>e.severity>=4).length," high severity"]})})]}),y&&(0,a.jsx)("div",{className:"divide-y divide-gray-200",children:p.map((e,s)=>{let r="".concat(t,"-").concat(s),l=c===r;return(0,a.jsxs)("div",{className:"bg-white",children:[(0,a.jsxs)("button",{onClick:()=>o(l?null:r),className:"w-full px-4 py-3 flex justify-between items-center hover:bg-gray-50 transition-colors",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[l?(0,a.jsx)(Z.Z,{className:"w-4 h-4 text-gray-500"}):(0,a.jsx)(L.Z,{className:"w-4 h-4 text-gray-500"}),(0,a.jsx)(k.Z,{className:"w-4 h-4 text-orange-500"})]}),(0,a.jsxs)("div",{className:"text-left",children:[(0,a.jsx)("p",{className:"font-medium text-gray-900",children:e.pattern}),(0,a.jsxs)("p",{className:"text-xs text-gray-600",children:[e.cards.length," cases • Avg severity: ",e.avgSeverity.toFixed(1)]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[e.severityDistribution.critical>0&&(0,a.jsxs)("span",{className:"px-2 py-1 bg-red-600 text-white text-xs font-bold rounded",children:[e.severityDistribution.critical," Critical"]}),e.severityDistribution.high>0&&(0,a.jsxs)("span",{className:"px-2 py-1 bg-red-500 text-white text-xs font-bold rounded",children:[e.severityDistribution.high," High"]}),e.severityDistribution.medium>0&&(0,a.jsxs)("span",{className:"px-2 py-1 bg-yellow-500 text-white text-xs font-bold rounded",children:[e.severityDistribution.medium," Med"]})]})]}),l&&(0,a.jsx)("div",{className:"px-4 pb-3 space-y-2",children:e.cards.map((e,t)=>{var s,r,l;return(0,a.jsxs)("div",{className:"p-3 rounded-lg border ".concat(h(e.severity)),children:[(0,a.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,a.jsxs)("span",{className:"px-2 py-0.5 rounded text-xs font-bold ".concat(u(e.severity)),children:["Severity ",e.severity]}),e.sentiment&&(0,a.jsx)("span",{className:"text-xs text-gray-600 capitalize",children:e.sentiment}),(null===(r=e.raw_input)||void 0===r?void 0:null===(s=r.metadata)||void 0===s?void 0:s.created_date)&&(0,a.jsx)("span",{className:"text-xs text-gray-500",children:new Date(e.raw_input.metadata.created_date).toLocaleDateString("en-US",{month:"short",day:"numeric"})})]}),(0,a.jsx)("p",{className:"text-sm text-gray-900",children:e.summary}),e.root_cause_hypothesis&&(0,a.jsxs)("p",{className:"text-xs text-gray-600 mt-2 italic",children:["→ ",e.root_cause_hypothesis]})]}),(null===(l=e.raw_input)||void 0===l?void 0:l.source_url)&&(0,a.jsxs)("a",{href:e.raw_input.source_url,target:"_blank",rel:"noopener noreferrer",className:"ml-3 flex items-center gap-1 text-xs text-blue-600 hover:text-blue-800",onClick:e=>e.stopPropagation(),children:["View",(0,a.jsx)(n.Z,{className:"w-3 h-3"})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 mt-2 pt-2 border-t border-current border-opacity-20",children:[(0,a.jsx)("span",{className:"text-xs text-gray-600",children:g(e.confidence_score)}),(0,a.jsx)("div",{className:"flex-1 h-1.5 bg-gray-200 rounded-full overflow-hidden",children:(0,a.jsx)("div",{className:"h-full bg-current rounded-full",style:{width:"".concat(100*e.confidence_score,"%")}})}),(0,a.jsxs)("span",{className:"text-xs font-medium text-gray-700",children:[(100*e.confidence_score).toFixed(0),"%"]})]})]},e.id)})})]},r)})})]},t)})})]})}function U(){var e,t,s,w,_,S,k;let C=(0,l.useParams)().id,F=(0,l.useRouter)(),T=(0,l.useSearchParams)().get("theme"),[E,O]=(0,r.useState)(null),[I,Z]=(0,r.useState)([]),[L,P]=(0,r.useState)([]),[U,M]=(0,r.useState)([]),[q,H]=(0,r.useState)(!0),[B,J]=(0,r.useState)(!1),[G,W]=(0,r.useState)(!1),[K,Y]=(0,r.useState)({current:0,accountAvg:0,portfolioAvg:0,last7Days:0}),[Q,$]=(0,r.useState)([]),[X,ee]=(0,r.useState)([]),et=(0,i.createClientComponentClient)();async function es(){try{H(!0);let{data:{user:e}}=await et.auth.getUser();if(!e){console.error("No authenticated user");return}let{data:t}=await et.from("accounts").select("*").eq("id",C).single();t&&O(t);let{data:s}=await et.from("account_snapshots").select("*").eq("account_id",C).gte("snapshot_date",new Date(Date.now()-7776e6).toISOString()).order("snapshot_date",{ascending:!0});s&&Z(s);let{data:a,error:r}=await et.from("friction_cards").select("\n          *,\n          raw_input:raw_inputs(source_url, metadata, created_at)\n        ").eq("account_id",C).eq("user_id",e.id).order("created_at",{ascending:!1});console.log("Friction cards query params:",{account_id:C,user_id:e.id,note:"Loading ALL friction cards (no date filter)"}),r&&(console.error("Error loading friction cards:",r),console.error("Full error details:",JSON.stringify(r,null,2))),a?(console.log("Loaded ".concat(a.length," friction cards for account")),a.length>0&&console.log("Sample friction card:",a[0]),P(a)):console.log("No friction cards data returned (cardsData is null/undefined)");let{data:l}=await et.from("themes").select("*").eq("is_active",!0);if(l&&M(l),s&&s.length>0){let t=s[s.length-1].case_volume||0,a=s.reduce((e,t)=>e+(t.case_volume||0),0)/s.length;if(e){let{data:s}=await et.from("portfolios").select("account_ids").eq("user_id",e.id).in("portfolio_type",["top_25_edge","top_25_sitelink"]);if(s&&s.length>0){let r=s.flatMap(e=>e.account_ids||[]),l={account_ids:Array.from(new Set(r))},{data:i}=await et.from("account_snapshots").select("case_volume").in("account_id",l.account_ids).gte("snapshot_date",new Date(Date.now()-7776e6).toISOString()),n=i&&i.length>0?i.reduce((e,t)=>e+(t.case_volume||0),0)/i.length:0,{data:c}=await et.from("raw_inputs").select("id, metadata, source_url, created_at").eq("account_id",C).eq("user_id",e.id).order("created_at",{ascending:!1}),o=new Date(Date.now()-6048e5),d=(null==c?void 0:c.filter(e=>{var t;let s=null===(t=e.metadata)||void 0===t?void 0:t.created_date;return!!s&&new Date(s)>=o}))||[],m=d.length,x={};d.forEach(e=>{var t,s,a,r,l,i,n,c,o,d;let m=(null===(t=e.metadata)||void 0===t?void 0:t.Origin)||(null===(s=e.metadata)||void 0===s?void 0:s.SuppliedChannel)||(null===(a=e.metadata)||void 0===a?void 0:a.origin)||(null===(r=e.metadata)||void 0===r?void 0:r.supplied_channel)||(null===(l=e.metadata)||void 0===l?void 0:l.CaseOrigin)||(null===(i=e.metadata)||void 0===i?void 0:i["Case Origin"])||(null===(n=e.metadata)||void 0===n?void 0:n.Channel)||(null===(c=e.metadata)||void 0===c?void 0:c.channel)||(null===(o=e.metadata)||void 0===o?void 0:o.Source)||(null===(d=e.metadata)||void 0===d?void 0:d.source);if(!m||""===m){let t=e.metadata||{};for(let e in t){let s=e.toLowerCase();if((s.includes("origin")||s.includes("channel")||s.includes("source"))&&t[e]&&"string"==typeof t[e]){m=t[e];break}}}m&&""!==m||(m="Unknown"),x[m]||(x[m]=[]),x[m].push(e)});let h=Object.entries(x).map(e=>{let[t,s]=e;return{origin:t,count:s.length,percentage:(s.length/m*100).toFixed(1),cases:s,priority:s.filter(e=>{var t;return(null===(t=e.metadata)||void 0===t?void 0:t.priority)==="High"}).length}}).sort((e,t)=>t.count-e.count);$(h),Y({current:t,accountAvg:a,portfolioAvg:n,last7Days:m});let{data:u}=await et.from("accounts").select("\n                id,\n                name,\n                vertical,\n                current_snapshot:account_snapshots!account_snapshots_account_id_fkey(\n                  case_volume,\n                  created_at\n                )\n              ").in("id",l.account_ids);if(u){let e=u.map(e=>{var t,s;let a=Array.isArray(e.current_snapshot)?e.current_snapshot.sort((e,t)=>new Date(t.created_at).getTime()-new Date(e.created_at).getTime())[0]:e.current_snapshot,r="Other";return(null===(t=e.vertical)||void 0===t?void 0:t.includes("EDGE"))?r="EDGE":(null===(s=e.vertical)||void 0===s?void 0:s.includes("SiteLink"))&&(r="SiteLink"),{id:e.id,name:e.name,caseVolume:(null==a?void 0:a.case_volume)||0,product:r}}).filter(e=>e.caseVolume>0);ee(e)}}}}}catch(e){console.error("Error loading account data:",e)}finally{H(!1)}}async function ea(){try{let e=crypto.randomUUID(),t=new Date(Date.now()+6048e5),{data:s,error:a}=await et.from("shared_links").insert({account_id:C,token:e,expires_at:t.toISOString()}).select().single();if(a)throw a;let r="".concat(window.location.origin,"/share/").concat(e);await navigator.clipboard.writeText(r),alert("Share link copied to clipboard! Valid for 7 days.")}catch(e){console.error("Error creating share link:",e),alert("Failed to create share link")}}function er(){return(null==E?void 0:E.salesforce_id)?"https://storable.my.salesforce.com/".concat(E.salesforce_id):null}async function el(){if(confirm("This will:\n1. Sync Salesforce Cases (last 90 days)\n2. Analyze them with Claude\n3. Calculate OFI score\n\nThis may take 30-60 seconds. Continue?")){J(!0);try{let e,t,s;let a=await fetch("/api/salesforce/sync-cases",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({accountId:C})}),r=await a.text();try{e=JSON.parse(r)}catch(e){throw Error("Sync Cases API returned invalid JSON. Status: ".concat(a.status,". Response: ").concat(r.substring(0,200)))}if(!a.ok)throw Error(e.error||"Failed to sync cases");let l=await fetch("/api/analyze-friction",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({accountId:C})}),i=await l.text();try{t=JSON.parse(i)}catch(e){throw Error("Analyze Friction API returned invalid JSON. Status: ".concat(l.status,". Response: ").concat(i.substring(0,200)))}if(!l.ok)throw Error(t.error||"Failed to analyze friction");let n=await fetch("/api/calculate-ofi",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({accountId:C})}),c=await n.text();try{s=JSON.parse(c)}catch(e){throw Error("Calculate OFI API returned invalid JSON. Status: ".concat(n.status,". Response: ").concat(c.substring(0,200)))}if(!n.ok)throw Error(s.error||"Failed to calculate OFI");alert("✅ Analysis Complete!\n\nSynced: ".concat(e.synced," cases\nAnalyzed: ").concat(t.analyzed," friction points\nOFI Score: ").concat(s.ofi_score,"\nHigh Severity: ").concat(s.high_severity)),window.location.reload()}catch(t){console.error("Analysis error:",t);let e="Unknown error";t instanceof Error?e=t.message:"object"==typeof t&&null!==t?e=JSON.stringify(t):"string"==typeof t&&(e=t),alert("❌ Analysis failed: ".concat(e))}finally{J(!1)}}}if((0,r.useEffect)(()=>{es()},[C]),q)return(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),(0,a.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading account details..."})]})});if(!E)return(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,a.jsx)("div",{className:"text-center",children:(0,a.jsx)("p",{className:"text-xl text-gray-600",children:"Account not found"})})});let ei=I[I.length-1],en=(null==ei?void 0:ei.ofi_score)||0,ec=(null==ei?void 0:ei.trend_vs_prior_period)||0,eo=I.map(e=>({date:new Date(e.snapshot_date).toLocaleDateString("en-US",{month:"short",day:"numeric"}),ofi:e.ofi_score}));return(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsx)("header",{className:"bg-white border-b border-gray-200",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm mb-4",children:[(0,a.jsx)("button",{onClick:()=>F.push("/dashboard"),className:"text-blue-600 hover:text-blue-800 font-medium",children:"Dashboard"}),(0,a.jsx)("span",{className:"text-gray-400",children:"/"}),(0,a.jsx)("span",{className:"text-gray-600",children:E.name})]}),(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:E.name}),er()&&(0,a.jsxs)("a",{href:er(),target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-1 text-blue-600 hover:text-blue-700 text-sm",children:[(0,a.jsx)(n.Z,{className:"w-4 h-4"}),"View in Salesforce"]}),"active"!==E.status&&(0,a.jsx)("span",{className:"px-3 py-1 bg-gray-100 text-gray-700 text-sm font-medium rounded-full",children:E.status})]}),(0,a.jsxs)("div",{className:"flex gap-4 mt-2 text-sm text-gray-600",children:[(0,a.jsxs)("span",{className:"font-medium",children:[new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0}).format(E.arr||0)," ARR"]}),(0,a.jsx)("span",{children:"•"}),(0,a.jsx)("span",{children:(null===(e=E.vertical)||void 0===e?void 0:e.toUpperCase())||"N/A"}),(0,a.jsx)("span",{children:"•"}),(0,a.jsx)("span",{children:(null===(t=E.segment)||void 0===t?void 0:t.replace("_"," ").toUpperCase())||"N/A"}),E.customer_since&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{children:"•"}),(0,a.jsxs)("span",{children:["Customer since ",new Date(E.customer_since).getFullYear()]})]})]})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)("button",{onClick:el,disabled:B,className:"flex items-center gap-2 px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:[(0,a.jsx)(c.Z,{className:"w-4 h-4"}),B?"Analyzing...":"Analyze Friction"]}),(0,a.jsx)(D,{account:E,frictionCards:L,snapshot:ei}),(0,a.jsxs)("button",{onClick:ea,className:"flex items-center gap-2 px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50",children:[(0,a.jsx)(o.Z,{className:"w-4 h-4"}),"Share"]}),(0,a.jsxs)("button",{onClick:function(){var e;if(!E)return;let t=[];t.push(["Friction Intelligence Export"]),t.push(["Account:",E.name]),t.push(["ARR:","$".concat((null===(e=E.arr)||void 0===e?void 0:e.toLocaleString())||"N/A")]),t.push(["Vertical:",E.vertical||"N/A"]),t.push(["Segment:",E.segment||"N/A"]),t.push(["Customer Since:",E.customer_since?new Date(E.customer_since).getFullYear():"N/A"]),t.push([""]);let s=I[I.length-1];s&&(t.push(["OFI Score:",s.ofi_score]),t.push(["Trend:",s.trend_direction]),t.push(["High Severity Issues:",s.high_severity_count]),t.push(["Total Friction Cards:",s.friction_card_count])),t.push([""]),K.current>0&&(t.push(["Case Volume Analysis"]),t.push(["90-Day Total:",K.current]),t.push(["Weekly Average:",(K.accountAvg/13).toFixed(1)]),t.push(["Last 7 Days:",K.last7Days])),t.push([""]),t.push(["Friction Cards"]),t.push(["Theme","Summary","Severity","Sentiment","Root Cause","Created Date"]),L.forEach(e=>{let s=U.find(t=>t.theme_key===e.theme_key);t.push([(null==s?void 0:s.label)||e.theme_key,e.summary,e.severity.toString(),e.sentiment,e.root_cause_hypothesis,new Date(e.created_at).toLocaleDateString()])});let a=t.map(e=>e.map(e=>{let t=String(e||"");return t.includes(",")||t.includes('"')||t.includes("\n")?'"'.concat(t.replace(/"/g,'""'),'"'):t}).join(",")).join("\n"),r=new Blob([a],{type:"text/csv;charset=utf-8;"}),l=document.createElement("a"),i=URL.createObjectURL(r);l.setAttribute("href",i),l.setAttribute("download","".concat(E.name.replace(/[^a-z0-9]/gi,"_"),"_friction_report_").concat(new Date().toISOString().split("T")[0],".csv")),l.style.visibility="hidden",document.body.appendChild(l),l.click(),document.body.removeChild(l)},className:"flex items-center gap-2 px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50",children:[(0,a.jsx)(d.Z,{className:"w-4 h-4"}),"Export"]})]})]})]})}),(0,a.jsxs)("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,a.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-6 mb-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Operational Friction Index"}),(0,a.jsx)("button",{onClick:()=>W(!G),className:"text-gray-400 hover:text-gray-600",children:(0,a.jsx)(m.Z,{className:"w-5 h-5"})})]}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"Last 14 days • Updated daily"})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("div",{className:"text-5xl font-bold text-gray-900",children:en.toFixed(0)}),(0,a.jsxs)("div",{className:"flex items-center justify-end gap-1 mt-1 ".concat(ec>0?"text-red-600":ec<0?"text-green-600":"text-gray-600"),children:[ec>0?(0,a.jsx)(x.Z,{className:"w-5 h-5"}):ec<0?(0,a.jsx)(h.Z,{className:"w-5 h-5"}):(0,a.jsx)(u.Z,{className:"w-5 h-5"}),(0,a.jsxs)("span",{className:"text-lg font-medium",children:[ec>0?"+":"",ec.toFixed(0),"%"]})]})]})]}),G&&ei&&(0,a.jsxs)("div",{className:"mt-4 pt-4 border-t border-gray-200",children:[(0,a.jsx)("h3",{className:"text-sm font-semibold text-gray-900 mb-3",children:"How this score is calculated:"}),(0,a.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Severity-weighted signals:"}),(0,a.jsx)("span",{className:"font-medium text-gray-900",children:(null===(s=ei.score_breakdown)||void 0===s?void 0:s.severity_weighted)||0})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Trend factor:"}),(0,a.jsx)("span",{className:"font-medium text-gray-900",children:(null===(w=ei.score_breakdown)||void 0===w?void 0:w.trend_factor)||0})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Recency boost:"}),(0,a.jsx)("span",{className:"font-medium text-gray-900",children:(null===(_=ei.score_breakdown)||void 0===_?void 0:_.recency_boost)||0})]}),(0,a.jsxs)("div",{className:"pt-2 mt-2 border-t border-gray-100 flex justify-between",children:[(0,a.jsx)("span",{className:"font-medium text-gray-900",children:"Total OFI Score:"}),(0,a.jsx)("span",{className:"font-bold text-gray-900",children:en.toFixed(0)})]})]}),(0,a.jsx)("p",{className:"mt-3 text-xs text-gray-500",children:"Scores above 70 indicate high friction. Scores below 30 indicate healthy operations. The score is normalized to 0-100 based on your portfolio's distribution."})]})]}),K.current>0&&(0,a.jsx)("div",{className:"mb-6",children:(0,a.jsx)(A,{currentVolume:K.current,accountHistoricalAvg:K.accountAvg,portfolioAvg:K.portfolioAvg,last7Days:K.last7Days,accountName:(null==E?void 0:E.name)||""})}),Q.length>0&&(0,a.jsx)(z,{origins:Q,accountName:(null==E?void 0:E.name)||"",totalCases:K.last7Days}),X.length>0&&E&&K.current>0&&(0,a.jsx)(V,{currentAccount:{name:E.name,caseVolume:K.current,product:(null===(S=E.vertical)||void 0===S?void 0:S.includes("EDGE"))?"EDGE":(null===(k=E.vertical)||void 0===k?void 0:k.includes("SiteLink"))?"SiteLink":"Other"},peers:X}),(0,a.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-6 mb-6",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"90-Day Trend"}),(0,a.jsx)(p.h,{width:"100%",height:300,children:(0,a.jsxs)(y.w,{data:eo,children:[(0,a.jsx)(b.q,{strokeDasharray:"3 3",stroke:"#e5e7eb"}),(0,a.jsx)(f.K,{dataKey:"date",tick:{fill:"#6b7280",fontSize:12},stroke:"#d1d5db"}),(0,a.jsx)(v.B,{tick:{fill:"#6b7280",fontSize:12},stroke:"#d1d5db",domain:[0,100]}),(0,a.jsx)(j.u,{contentStyle:{backgroundColor:"#fff",border:"1px solid #e5e7eb",borderRadius:"8px",padding:"8px 12px"}}),(0,a.jsx)(N.x,{type:"monotone",dataKey:"ofi",stroke:"#3b82f6",strokeWidth:2,dot:{fill:"#3b82f6",r:4},name:"OFI Score"})]})})]}),T&&(0,a.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6 flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(m.Z,{className:"w-5 h-5 text-blue-600"}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"text-sm font-medium text-blue-900",children:["Filtered by theme: ",T.split("_").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")]}),(0,a.jsxs)("p",{className:"text-xs text-blue-700",children:["Showing ",L.filter(e=>e.theme_key===T).length," of ",L.length," friction cards"]})]})]}),(0,a.jsxs)("button",{onClick:()=>F.push("/account/".concat(C)),className:"flex items-center gap-2 px-3 py-1.5 text-sm font-medium text-blue-700 bg-white rounded-lg hover:bg-blue-100 border border-blue-300",children:[(0,a.jsx)(g.Z,{className:"w-4 h-4"}),"Clear Filter"]})]}),(0,a.jsx)(R,{frictionCards:T?L.filter(e=>e.theme_key===T):L,themes:U})]})]})}}},function(e){e.O(0,[125,505,785,126,971,69,744],function(){return e(e.s=97802)}),_N_E=e.O()}]);